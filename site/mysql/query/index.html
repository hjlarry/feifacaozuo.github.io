
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="非法操作">
      
      
        <link rel="canonical" href="https://hjlarry.github.io/mysql/query/">
      
      <link rel="icon" href="../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.2">
    
    
      
        <title>Mysql查询 - 非法操作的笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.5d38496d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mysql" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="非法操作的笔记" class="md-header__button md-logo" aria-label="非法操作的笔记" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            非法操作的笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mysql查询
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hjlarry/hjlarry.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hjlarry/hjlarry.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="非法操作的笔记" class="md-nav__button md-logo" aria-label="非法操作的笔记" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    非法操作的笔记
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hjlarry/hjlarry.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    hjlarry/hjlarry.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        主页
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          计算机基础
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="计算机基础" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          计算机基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sicp/hardware/" class="md-nav__link">
        硬件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sicp/software/" class="md-nav__link">
        软件
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sicp/program/" class="md-nav__link">
        程序
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sicp/asm/" class="md-nav__link">
        汇编
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          GO语言
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GO语言" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          GO语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../go/map/" class="md-nav__link">
        字典
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../go/closure/" class="md-nav__link">
        闭包
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../go/defer/" class="md-nav__link">
        延迟调用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../go/goroutine/" class="md-nav__link">
        并发调度
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../go/alloc/" class="md-nav__link">
        内存分配
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../go/gc/" class="md-nav__link">
        垃圾回收
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../go/lock/" class="md-nav__link">
        锁
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Python语言
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python语言" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Python语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/memory/" class="md-nav__link">
        内存管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/interpreter/" class="md-nav__link">
        解释器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/tools/" class="md-nav__link">
        技巧工具
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Mysql
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mysql" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Mysql
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          查询
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        查询
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    数据准备
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    基础查询
  </a>
  
    <nav class="md-nav" aria-label="基础查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    别名
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../theory/" class="md-nav__link">
        原理
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6">
          其他
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="其他" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          其他
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/git/" class="md-nav__link">
        git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/docker/" class="md-nav__link">
        docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/raft/" class="md-nav__link">
        raft
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/shell/" class="md-nav__link">
        shell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/security/" class="md-nav__link">
        security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/oop/" class="md-nav__link">
        面向对象
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/protocol/" class="md-nav__link">
        网络协议
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../other/tools/" class="md-nav__link">
        系统工具
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    数据准备
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    基础查询
  </a>
  
    <nav class="md-nav" aria-label="基础查询">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    别名
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/hjlarry/hjlarry.github.io/edit/master/docs/mysql/query.md" title="编辑此页" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="mysql">Mysql常用查询整理<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h1>
<h2 id="_1">数据准备<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>1、创建表格:</p>
<p>{{&lt; highlight mysql&gt;}}
CREATE TABLE student_info (
    number INT PRIMARY KEY,
    name VARCHAR(5),
    sex ENUM('男', '女'),
    id_number CHAR(18),
    department VARCHAR(30),
    major VARCHAR(30),
    enrollment_time DATE,
    UNIQUE KEY (id_number)
);</p>
<p>CREATE TABLE student_score (
    number INT,
    subject VARCHAR(30),
    score TINYINT,
    PRIMARY KEY (number, subject),
    CONSTRAINT FOREIGN KEY(number) REFERENCES student_info(number)
);
{{&lt; /highlight &gt;}}</p>
<p>{{&lt; highlight python&gt;}}
class StudentInfo(models.Model):
    number = models.IntegerField(primary_key=True)
    name = models.CharField(max_length=5)
    sex = models.CharField(choices=[('男', '男'),('女', '女')], max_length=2)
    id_number = models.CharField(max_length=18, unique=True)
    department = models.CharField(max_length=30)
    major = models.CharField(max_length=30)
    enrollment_time = models.DateField()</p>
<div class="highlight"><pre><span></span><code>class Meta:
    db_table = &quot;student_info&quot;
    managed = False
</code></pre></div>
<p>class StudentScore(models.Model):
    number = models.ForeignKey(StudentInfo, db_column='number', on_delete=models.DO_NOTHING)
    subject = models.CharField(max_length=30)
    score = models.SmallIntegerField()</p>
<div class="highlight"><pre><span></span><code>class Meta:
    db_table = &quot;student_score&quot;
    managed = False
</code></pre></div>
<p>{{&lt; /highlight &gt;}}</p>
<p>2、填充数据:
{{&lt; highlight mysql&gt;}}
INSERT INTO student_info(number, name, sex, id_number, department, major, enrollment_time) VALUES
(20180101, '杜子腾', '男', '158177199901044792', '计算机学院', '计算机科学与工程', '2018-09-01'),
(20180102, '杜琦燕', '女', '151008199801178529', '计算机学院', '计算机科学与工程', '2018-09-01'),
(20180103, '范统', '男', '17156319980116959X', '计算机学院', '软件工程', '2018-09-01'),
(20180104, '史珍香', '女', '141992199701078600', '计算机学院', '软件工程', '2018-09-01'),
(20180105, '范剑', '男', '181048199308156368', '航天学院', '飞行器设计', '2018-09-01'),
(20180106, '朱逸群', '男', '197995199501078445', '航天学院', '电子信息', '2018-09-01');</p>
<p>INSERT INTO student_score (number, subject, score) VALUES
(20180101, '母猪的产后护理', 78),
(20180101, '论萨达姆的战争准备', 88),
(20180102, '母猪的产后护理', 100),
(20180102, '论萨达姆的战争准备', 98),
(20180103, '母猪的产后护理', 59),
(20180103, '论萨达姆的战争准备', 61),
(20180104, '母猪的产后护理', 55),
(20180104, '论萨达姆的战争准备', 46);
{{&lt; /highlight &gt;}}</p>
<p>3、填充结果:</p>
<p><strong>student_info表</strong></p>
<table>
<thead>
<tr>
<th>number</th>
<th>&nbsp;name&nbsp;</th>
<th>sex</th>
<th>id_number</th>
<th>department</th>
<th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;major&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th>enrollment_time</th>
</tr>
</thead>
<tbody>
<tr>
<td>20180101</td>
<td>杜子腾</td>
<td>男</td>
<td>158177199901044792</td>
<td>计算机学院</td>
<td>计算机科学与工程</td>
<td>2018-09-01</td>
</tr>
<tr>
<td>20180102</td>
<td>杜琦燕</td>
<td>女</td>
<td>151008199801178529</td>
<td>计算机学院</td>
<td>计算机科学与工程</td>
<td>2018-09-01</td>
</tr>
<tr>
<td>20180103</td>
<td>范统</td>
<td>男</td>
<td>17156319980116959X</td>
<td>计算机学院</td>
<td>软件工程</td>
<td>2018-09-01</td>
</tr>
<tr>
<td>20180104</td>
<td>史珍香</td>
<td>女</td>
<td>141992199701078600</td>
<td>计算机学院</td>
<td>软件工程</td>
<td>2018-09-01</td>
</tr>
<tr>
<td>20180105</td>
<td>范剑</td>
<td>男</td>
<td>181048199308156368</td>
<td>航天学院</td>
<td>飞行器设计</td>
<td>2018-09-01</td>
</tr>
<tr>
<td>20180106</td>
<td>朱逸群</td>
<td>男</td>
<td>197995199501078445</td>
<td>航天学院</td>
<td>电子信息</td>
<td>2018-09-01</td>
</tr>
</tbody>
</table>
<p><strong>student_score表</strong>    </p>
<table>
<thead>
<tr>
<th>number</th>
<th>subject</th>
<th>score</th>
</tr>
</thead>
<tbody>
<tr>
<td>20180101</td>
<td>母猪的产后护理</td>
<td>78</td>
</tr>
<tr>
<td>20180101</td>
<td>论萨达姆的战争准备</td>
<td>88</td>
</tr>
<tr>
<td>20180102</td>
<td>母猪的产后护理</td>
<td>100</td>
</tr>
<tr>
<td>20180102</td>
<td>论萨达姆的战争准备</td>
<td>98</td>
</tr>
<tr>
<td>20180103</td>
<td>母猪的产后护理</td>
<td>59</td>
</tr>
<tr>
<td>20180103</td>
<td>论萨达姆的战争准备</td>
<td>61</td>
</tr>
<tr>
<td>20180104</td>
<td>母猪的产后护理</td>
<td>55</td>
</tr>
<tr>
<td>20180104</td>
<td>论萨达姆的战争准备</td>
<td>46</td>
</tr>
</tbody>
</table>
<h2 id="_2">基础查询<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="_3">别名<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li>方式一:<code>select number as 学号 from student_score</code></li>
<li>方式二:<code>select number 学号 from student_score</code>    </li>
</ul>
<p>查询结果:
{{&lt; highlight mysql&gt;}}
mysql&gt; select number 学号 from student_score;
+----------+
| 学号     |
+----------+
| 20180101 |
| 20180101 |
| 20180102 |
| 20180102 |
| 20180103 |
| 20180103 |
| 20180104 |
| 20180104 |
+----------+
8 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>多列也可以:
{{&lt; highlight mysql&gt;}}
mysql&gt; select number 学号, name 姓名 from student_info;
+----------+-----------+
| 学号     | 姓名      |
+----------+-----------+
| 20180101 | 杜子腾    |
| 20180102 | 杜琦燕    |
| 20180103 | 范统      |
| 20180104 | 史珍香    |
| 20180105 | 范剑      |
| 20180106 | 朱逸群    |
+----------+-----------+
6 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}</p>
<h1 id="_4">方式一<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h1>
<p>StudentInfo.objects.annotate(学号=F('number'),姓名=F('name')).values('学号','姓名')</p>
<h1 id="_5">方式二<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h1>
<p>StudentInfo.objects.extra(select={'学号':'number', '姓名':'name'}).values('姓名','学号')
{{&lt; /highlight &gt;}}</p>
<h3 id="_6">去重<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>单列去重:
{{&lt; highlight mysql&gt;}}
mysql&gt; select distinct department from student_info;
+-----------------+
| department      |
+-----------------+
| 计算机学院      |
| 航天学院        |
+-----------------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>多列去重:
{{&lt; highlight mysql&gt;}}
mysql&gt; select distinct department,major from student_info;
+-----------------+--------------------------+
| department      | major                    |
+-----------------+--------------------------+
| 计算机学院      | 计算机科学与工程         |
| 计算机学院      | 软件工程                 |
| 航天学院        | 飞行器设计               |
| 航天学院        | 电子信息                 |
+-----------------+--------------------------+
4 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.values('department').distinct()
StudentInfo.objects.values('department','major').distinct()
{{&lt; /highlight &gt;}}</p>
<h3 id="_7">限制查询结果条数<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>使用<code>limit 从哪开始，多少条</code>，<code>从哪开始</code>可以省略，省略代表第0行。</p>
<p>{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info limit 3,2;
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| number   | name      | sex  | id_number          | department      | major           | enrollment_time |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计      | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.all()[3:5]
{{&lt; /highlight &gt;}}</p>
<h3 id="_8">排序<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>多列排序:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info order by name asc, number desc;
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程                 | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息                 | 2018-09-01      |
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计               | 2018-09-01      |
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
6 rows in set (0.00 sec)</p>
<p>mysql&gt; select * from student_info order by name desc, number desc;
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程                 | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计               | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息                 | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
6 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.order_by('-name', '-number')
{{&lt; /highlight &gt;}}</p>
<h2 id="_9">带条件查询<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<h3 id="_10">简单搜索条件<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>不等于可以使用<code>&lt;&gt;</code>或<code>!=</code> :
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info where department &lt;&gt; '计算机学院';
+----------+-----------+------+--------------------+--------------+-----------------+-----------------+
| number   | name      | sex  | id_number          | department   | major           | enrollment_time |
+----------+-----------+------+--------------------+--------------+-----------------+-----------------+
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院     | 飞行器设计      | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院     | 电子信息        | 2018-09-01      |
+----------+-----------+------+--------------------+--------------+-----------------+-----------------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.filter(~Q(department='计算机学院'))
{{&lt; /highlight &gt;}}</p>
<p>区间内使用<code>between...and...</code>，不在某区间使用<code>not between...and...</code>:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info where number between 20180103 and 20180105;
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| number   | name      | sex  | id_number          | department      | major           | enrollment_time |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计      | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
3 rows in set (0.01 sec)</p>
<p>mysql&gt; select * from student_info where number not between 20180103 and 20180105;
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
3 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.filter(number__range=(20180103, 20180105))
StudentInfo.objects.filter(~Q(number__range=(20180103, 20180105)))
{{&lt; /highlight &gt;}}</p>
<h3 id="_11">匹配列表中的元素<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>使用<code>in (...)</code>和<code>not in</code>筛选出在某个列表中的记录:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info where major in ('软件工程',  '电子信息');
+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
| number   | name      | sex  | id_number          | department      | major        | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程     | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程     | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息     | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
3 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.filter(major__in=('软件工程', '电子信息'))
{{&lt; /highlight &gt;}}</p>
<p>使用<code>is null</code> 和 <code>is not null</code>可筛选出某列是NULL的记录，而不能使用普通的操作符例如等号来进行比较，NULL代表没有值。</p>
<h3 id="_12">多个搜索条件<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>AND优先级高于OR:
{{&lt; highlight mysql&gt;}}
mysql&gt; SELECT * FROM student_score WHERE score &gt; 95 OR score &lt; 55 AND subject = '论萨达姆的战争准备';
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180102 | 母猪的产后护理              |   100 |
| 20180102 | 论萨达姆的战争准备          |    98 |
| 20180104 | 论萨达姆的战争准备          |    46 |
+----------+-----------------------------+-------+
3 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.filter(Q(score__gt=95) | Q(score__lt=55) &amp; Q(subject='论萨达姆的战争准备'))
{{&lt; /highlight &gt;}}</p>
<h3 id="_13">模糊查询<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>使用<code>like</code>和<code>not like</code>进行模糊匹配查询，<code>%</code>代表任意一个字符串，而<code>_</code>代表任意一个字符:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info where name like '杜_';
Empty set (0.00 sec)</p>
<p>mysql&gt; select * from student_info where name like '范_';
+----------+--------+------+--------------------+-----------------+-----------------+-----------------+
| number   | name   | sex  | id_number          | department      | major           | enrollment_time |
+----------+--------+------+--------------------+-----------------+-----------------+-----------------+
| 20180103 | 范统   | 男   | 17156319980116959X | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180105 | 范剑   | 男   | 181048199308156368 | 航天学院        | 飞行器设计      | 2018-09-01      |
+----------+--------+------+--------------------+-----------------+-----------------+-----------------+
2 rows in set (0.00 sec)</p>
<p>mysql&gt; select * from student_info where name like '%杜%';
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.extra(where=["name LIKE '杜_'"]) # django不支持_字符
StudentInfo.objects.extra(where=["name LIKE '范_'"])
StudentInfo.objects.filter(name__contains='杜')
{{&lt; /highlight &gt;}}</p>
<h2 id="_14">函数和表达式<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<h3 id="_15">表达式<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>可以将表达式放在查询列表中:
{{&lt; highlight mysql&gt;}}
mysql&gt; select number,subject,score+100 from student_score;
+----------+-----------------------------+-----------+
| number   | subject                     | score+100 |
+----------+-----------------------------+-----------+
| 20180101 | 母猪的产后护理              |       178 |
| 20180101 | 论萨达姆的战争准备          |       188 |
| 20180102 | 母猪的产后护理              |       200 |
| 20180102 | 论萨达姆的战争准备          |       198 |
| 20180103 | 母猪的产后护理              |       159 |
| 20180103 | 论萨达姆的战争准备          |       161 |
| 20180104 | 母猪的产后护理              |       155 |
| 20180104 | 论萨达姆的战争准备          |       146 |
+----------+-----------------------------+-----------+
8 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>也可以把表达式作为搜索的条件:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_score where score%3=0;
+----------+-----------------------+-------+
| number   | subject               | score |
+----------+-----------------------+-------+
| 20180101 | 母猪的产后护理        |    78 |
+----------+-----------------------+-------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.annotate(myscore=F('score')+100).values('number', 'subject', 'myscore')
StudentScore.objects.annotate(myscore=Mod('score',3)).filter(myscore=0)
{{&lt; /highlight &gt;}}</p>
<h3 id="_16">文本处理<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>连接字符串:
{{&lt; highlight mysql&gt;}}
mysql&gt; select concat('学号为',number,'的学生在[',subject,']的成绩为',score) from student_score;
+--------------------------------------------------------------------------+
| concat('学号为',number,'的学生在[',subject,']的成绩为',score)            |
+--------------------------------------------------------------------------+
| 学号为20180101的学生在[母猪的产后护理]的成绩为78                         |
| 学号为20180101的学生在[论萨达姆的战争准备]的成绩为88                     |
| 学号为20180102的学生在[母猪的产后护理]的成绩为100                        |
| 学号为20180102的学生在[论萨达姆的战争准备]的成绩为98                     |
| 学号为20180103的学生在[母猪的产后护理]的成绩为59                         |
| 学号为20180103的学生在[论萨达姆的战争准备]的成绩为61                     |
| 学号为20180104的学生在[母猪的产后护理]的成绩为55                         |
| 学号为20180104的学生在[论萨达姆的战争准备]的成绩为46                     |
+--------------------------------------------------------------------------+
8 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>子串:
{{&lt; highlight mysql&gt;}}
mysql&gt; select substring(number, 4, 5) as 学号尾号 from student_info;
+--------------+
| 学号尾号     |
+--------------+
| 80104        |
| 80102        |
| 80101        |
| 80103        |
| 80105        |
| 80106        |
+--------------+
6 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.annotate(mytest=Concat(Value('学号为'), 'number',Value('的学生在['), 'subject', Value(']的成绩为'), 'score', output_field=CharField()))
StudentScore.objects.annotate(num=Substr('number', 4,5)).values('num')
{{&lt; /highlight &gt;}}</p>
<h3 id="_17">时间处理函数<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>时间间隔:
{{&lt; highlight mysql&gt;}}
mysql&gt; select date_add('2015-01-01 10:20:33', interval 2 minute);
+----------------------------------------------------+
| date_add('2015-01-01 10:20:33', interval 2 minute) |
+----------------------------------------------------+
| 2015-01-01 10:22:33                                |
+----------------------------------------------------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>时间格式化:
{{&lt; highlight mysql&gt;}}
mysql&gt; select date_format(now(), '%b/%d/%Y %h:%i:%s~%p');
+--------------------------------------------+
| date_format(now(), '%b/%d/%Y %h:%i:%s~%p') |
+--------------------------------------------+
| Dec/02/2019 04:57:31~PM                    |
+--------------------------------------------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<h3 id="_18">聚集函数<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>COUNT用来统计行数
* <code>COUNT(*)</code>统计表中所有的行，包括NULL
* <code>COUNT(列名)</code>统计表中某列的所有行，不包括NULL</p>
<p>{{&lt; highlight mysql&gt;}}
mysql&gt; select count(<em>) from student_info;
+----------+
| count(</em>) |
+----------+
|        6 |
+----------+
1 row in set (0.00 sec)</p>
<p>mysql&gt; select count(distinct subject) from student_score;
+-------------------------+
| count(distinct subject) |
+-------------------------+
|                       2 |
+-------------------------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.count()
StudentScore.objects.values('subject').distinct().count()
{{&lt; /highlight &gt;}}</p>
<p>SUM和AVG:
{{&lt; highlight mysql&gt;}}
mysql&gt; select sum(score) from student_score;
+------------+
| sum(score) |
+------------+
|        585 |
+------------+
1 row in set (0.00 sec)</p>
<p>mysql&gt; select avg(score) from student_score where subject="论萨达姆的战争准备";
+------------+
| avg(score) |
+------------+
|    73.2500 |
+------------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>组合使用:
{{&lt; highlight mysql&gt;}}
mysql&gt; select count(<em>) as 成绩记录总数, max(score) as 最高分, min(score) as 最低分,avg(score) as 平均分 from student_score;
+--------------------+-----------+-----------+-----------+
| 成绩记录总数       | 最高分    | 最低分    | 平均分    |
+--------------------+-----------+-----------+-----------+
|                  8 |       100 |        46 |   73.1250 |
+--------------------+-----------+-----------+-----------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.aggregate(Sum('score'))
StudentScore.objects.filter(subject='论萨达姆的战争准备').aggregate(Avg('score'))
StudentScore.objects.aggregate(Max('score'), Min('score'),Avg('score'), nsum=Count('</em>'))
{{&lt; /highlight &gt;}}</p>
<h3 id="_19">隐式类型转换<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>Mysql会尽量把值转换为表达式中需要的类型，而不是产生错误:
{{&lt; highlight mysql&gt;}}
mysql&gt; select 1 + '2';
+---------+
| 1 + '2' |
+---------+
|       3 |
+---------+
1 row in set (0.00 sec)</p>
<p>mysql&gt; select '23sds'+17;
+------------+
| '23sds'+17 |
+------------+
|         40 |
+------------+
1 row in set, 1 warning (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>但这种转换不能用于存储数据:
{{&lt; highlight mysql&gt;}}
mysql&gt; insert into student_score(score,number,subject) values (100,20180101,300);
Query OK, 1 row affected (0.00 sec)</p>
<p>mysql&gt; insert into student_score(score,number,subject) values ('100',20180101,400);
Query OK, 1 row affected (0.00 sec)</p>
<p>mysql&gt; insert into student_score(score,number,subject) values ('asd',20180101,400);
ERROR 1366 (HY000): Incorrect integer value: 'asd' for column 'score' at row 1
{{&lt; /highlight &gt;}}</p>
<h2 id="_20">分组查询<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h2>
<h3 id="_21">基础查询<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>分组就是针对某个列，将该列的值相同的记录分到一个组中:
{{&lt; highlight mysql&gt;}}
mysql&gt; select subject, sum(score) from student_score group by subject;
+-----------------------------+------------+
| subject                     | sum(score) |
+-----------------------------+------------+
| 母猪的产后护理              |        292 |
| 论萨达姆的战争准备          |        293 |
+-----------------------------+------------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.values('subject').annotate(myscore=Sum('score'))
{{&lt; /highlight &gt;}}</p>
<p>把非分组列放入查询列表中会引起争议，导致结果不确定:
{{&lt; highlight mysql&gt;}}
mysql&gt; select subject, sum(score),number from student_score group by subject;
ERROR 1055 (42000): Expression <a class="magiclink magiclink-github magiclink-issue" href="https://github.com/squidfunk/mkdocs-material/issues/3" title="GitHub Issue: squidfunk/mkdocs-material #3">#3</a> of SELECT list is not in GROUP BY clause and contains nonaggregated column 'student.student_score.number' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
{{&lt; /highlight &gt;}}</p>
<h3 id="_22">分组和过滤条件<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>是先过滤出符合条件的数据，在进行分组运算的:
{{&lt; highlight mysql&gt;}}
mysql&gt; select subject, sum(score) from student_score where score&gt;70 group by subject;
+-----------------------------+------------+
| subject                     | sum(score) |
+-----------------------------+------------+
| 母猪的产后护理              |        178 |
| 论萨达姆的战争准备          |        186 |
+-----------------------------+------------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>也可以分组后，在筛选出合适的分组:
{{&lt; highlight mysql&gt;}}
mysql&gt; select subject, sum(score) from student_score group by subject having max(score)&gt;98;
+-----------------------+------------+
| subject               | sum(score) |
+-----------------------+------------+
| 母猪的产后护理        |        292 |
+-----------------------+------------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.filter(score__gt=70).values('subject').annotate(myscore=Sum('score'))
StudentScore.objects.values('subject').annotate(sumscore=Sum('score'), mscore=Max('score')).filter(mscore__gt=98)
{{&lt; /highlight &gt;}}</p>
<h3 id="_23">分组和排序<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>{{&lt; highlight mysql&gt;}}
mysql&gt; select subject, sum(score) as sum_s from student_score group by subject order by sum_s desc;
+-----------------------------+-------+
| subject                     | sum_s |
+-----------------------------+-------+
| 论萨达姆的战争准备          |   293 |
| 母猪的产后护理              |   292 |
+-----------------------------+-------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.values('subject').annotate(sum_s=Sum('score')).order_by('-sum_s')
{{&lt; /highlight &gt;}}</p>
<h3 id="_24">嵌套分组<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>如下例，可先按department分成大组，再按major分为小组:
{{&lt; highlight mysql&gt;}}
mysql&gt; select department, major, count(<em>) from student_info group by department, major;
+-----------------+--------------------------+----------+
| department      | major                    | count(</em>) |
+-----------------+--------------------------+----------+
| 航天学院        | 电子信息                 |        1 |
| 航天学院        | 飞行器设计               |        1 |
| 计算机学院      | 计算机科学与工程         |        2 |
| 计算机学院      | 软件工程                 |        2 |
+-----------------+--------------------------+----------+
4 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.values('department','major').annotate(sum_c=Count('*'))
{{&lt; /highlight &gt;}}</p>
<h3 id="_25">注意事项<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<ol>
<li>如果分组列中有NULL值，那么NULL会作为一个独立的分组</li>
<li>如果是嵌套分组，聚集函数将作用在最后的分组列上</li>
<li>非分组列不能单独出现在检索列表中(可以被放到聚集函数中)</li>
<li>GROUP BY子句后可以跟随表达式(但不能是聚集函数)</li>
</ol>
<p>简单查询语句中各子句的顺序为:
{{&lt; highlight mysql&gt;}}
SELECT [DISTINCT] 查询列表
[FROM 表名]
[WHERE 布尔表达式]
[GROUP BY 分组列表 ]
[HAVING 分组过滤条件]
[ORDER BY 排序列表]
[LIMIT 开始行, 限制条数]
{{&lt; /highlight &gt;}}</p>
<h2 id="_26">子查询<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h2>
<h3 id="_27">标量子查询<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<p>标量子查询单纯的代表一个值，可以作为表达式参与运算或作为搜索条件:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_score where number=(select number from student_info where name='范统');
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180103 | 母猪的产后护理              |    59 |
| 20180103 | 论萨达姆的战争准备          |    61 |
+----------+-----------------------------+-------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.filter(number=Subquery(StudentInfo.objects.filter(name='范统').values('number')))
{{&lt; /highlight &gt;}}</p>
<h3 id="_28">列子查询<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<p>内层查询结果不是一个单独的值，而是一个列:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_score where number=(select number from student_info where sex='男');
ERROR 1242 (21000): Subquery returns more than 1 row</p>
<p>mysql&gt; select * from student_score where number in (select number from student_info where sex='男');
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180101 | 母猪的产后护理              |    78 |
| 20180101 | 论萨达姆的战争准备          |    88 |
| 20180103 | 母猪的产后护理              |    59 |
| 20180103 | 论萨达姆的战争准备          |    61 |
+----------+-----------------------------+-------+
4 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.filter(number__in=Subquery(StudentInfo.objects.filter(sex='男').values('number')))
{{&lt; /highlight &gt;}}</p>
<p>而行子查询、表子查询不常用，省略。</p>
<h3 id="exists">EXISTS和相关子查询<a class="headerlink" href="#exists" title="Permanent link">&para;</a></h3>
<p>EXISTS和NOT EXISTS单独看很像一个函数，返回查询结果是否为空集:
{{&lt; highlight mysql&gt;}}
mysql&gt; select exists (select * from student_info where number=20180101);
+-----------------------------------------------------------+
| exists (select * from student_info where number=20180101) |
+-----------------------------------------------------------+
|                                                         1 |
+-----------------------------------------------------------+
1 row in set (0.00 sec)</p>
<p>mysql&gt; select not exists (select * from student_info where number=20180101);
+---------------------------------------------------------------+
| not exists (select * from student_info where number=20180101) |
+---------------------------------------------------------------+
|                                                             0 |
+---------------------------------------------------------------+
1 row in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>之前我们尝试的都是不相关子查询，而相关子查询就是内层查询语句要用到外层查询语句的值，比如我们查学生的基本信息并要求这些学生有成绩的记录:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info where exists(select * from student_score where student_score.number=student_info.number);
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程                 | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
4 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>这个相关子查询的查询过程是:先执行外层查询获得到student_info表的第一条记录，发现它的number值是20180101。把20180101当作参数传入到子查询，此时子查询的意思是判断student_score表的number字段是否有20180101这个值存在，子查询的结果是该值存在，所以整个EXISTS表达式的值为TRUE，那么student_info表的第一条记录可以被加入到结果集。每条记录依次按这个过程执行。</p>
<p>此外，子查询还可以应用于同一个表，比如我们去查student_score表中分数大于平均分的记录，第一印象可能是如下写法:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_score where score &gt; avg(score);
ERROR 1111 (HY000): Invalid use of group function
{{&lt; /highlight &gt;}}</p>
<p>实际应该使用子查询来实现:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_score where score &gt; (select avg(score) from student_score);
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180101 | 母猪的产后护理              |    78 |
| 20180101 | 论萨达姆的战争准备          |    88 |
| 20180102 | 母猪的产后护理              |   100 |
| 20180102 | 论萨达姆的战争准备          |    98 |
+----------+-----------------------------+-------+
4 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
因为聚集函数不能用于WHERE子句，可以把上述写法看做是给student_score做了一个副本。</p>
<h2 id="_29">连接查询<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h2>
<h3 id="_30">基础概念<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<p>连接的本质就是将各个表中的记录都拉取出来，依次匹配组合形成一个结果集，也就是笛卡尔积的方式。</p>
<p>我们来看一个示例:
{{&lt; highlight mysql&gt;}}
mysql&gt; create table t1(m1 int, n1 char(1));
Query OK, 0 rows affected (0.02 sec)</p>
<p>mysql&gt; create table t2(m2 int, n2 char(1));
Query OK, 0 rows affected (0.02 sec)</p>
<p>mysql&gt; insert into t1 values(1, 'a'),(2, 'b'),(3, 'c');
Query OK, 3 rows affected (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 0</p>
<p>mysql&gt; insert into t2 values(2, 'a'),(3, 'b'),(4, 'c');
Query OK, 3 rows affected (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 0
{{&lt; /highlight &gt;}}</p>
<p>新建了两个表，并各插入了三条数据，那么连接可以这样做:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from t1,t2;
+------+------+------+------+
| m1   | n1   | m2   | n2   |
+------+------+------+------+
|    1 | a    |    2 | a    |
|    2 | b    |    2 | a    |
|    3 | c    |    2 | a    |
|    1 | a    |    3 | b    |
|    2 | b    |    3 | b    |
|    3 | c    |    3 | b    |
|    1 | a    |    4 | c    |
|    2 | b    |    4 | c    |
|    3 | c    |    4 | c    |
+------+------+------+------+
9 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>使用以下写法连接都是可以的:</p>
<ul>
<li><code>select t1.m1,t1.n1,t2.m2,t2.n2 from t1, t2</code></li>
<li><code>select m1,n1,m2,n2 from t1, t2</code></li>
<li><code>select t1.*,t2.* from t1, t2</code></li>
</ul>
<h3 id="_31">内外连接<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<p>现在我们想通过一条语句既查到学生的基本信息，又查到他的成绩信息:
{{&lt; highlight mysql&gt;}}
mysql&gt; select student_info.number,name,sex,subject,score from student_info, student_score where student_info.number = student_score.number;
+----------+-----------+------+-----------------------------+-------+
| number   | name      | sex  | subject                     | score |
+----------+-----------+------+-----------------------------+-------+
| 20180101 | 杜子腾    | 男   | 母猪的产后护理              |    78 |
| 20180101 | 杜子腾    | 男   | 论萨达姆的战争准备          |    88 |
| 20180102 | 杜琦燕    | 女   | 母猪的产后护理              |   100 |
| 20180102 | 杜琦燕    | 女   | 论萨达姆的战争准备          |    98 |
| 20180103 | 范统      | 男   | 母猪的产后护理              |    59 |
| 20180103 | 范统      | 男   | 论萨达姆的战争准备          |    61 |
| 20180104 | 史珍香    | 女   | 母猪的产后护理              |    55 |
| 20180104 | 史珍香    | 女   | 论萨达姆的战争准备          |    46 |
+----------+-----------+------+-----------------------------+-------+
8 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.values('number__name','number__name','number__sex','subject','score')
{{&lt; /highlight &gt;}}</p>
<p>这时候我们发现有两个人没有成绩，所以他们没有显示在查询结果中。为了有办法让其显示出，就有了内连接和外连接的概念:</p>
<ul>
<li>内连接就是我们之前使用的，没有匹配的记录则结果不会加入到最后的结果集</li>
<li>对于外连接的两个表，驱动表中的记录即使在被驱动表中没有匹配的记录，也仍然需要加入到结果集</li>
</ul>
<p>而外连接又分为左外连接，即左侧的表为驱动表。右外连接，即右侧的表为驱动表。</p>
<p>此外，WHERE子句不论内外连接，凡是不符合WHERE条件的记录都不会在最后的结果集中。而对于外连接的驱动表，ON可以将被驱动表中找不到记录的对应驱动表记录加入到结果集，内连接中WHERE子句和ON子句是等价的。所以我们一般会把WHERE用于涉及单表的过滤条件，ON用于涉及多表的过滤条件。</p>
<p>外连接的标准语法为: <code>select * from t1 left/right [outer] join t2 on 连接条件 [where 普通过滤条件]</code>，outer和where可省略。</p>
<p>上例中使用外连接的结果为:
{{&lt; highlight mysql&gt;}}
mysql&gt; select student_info.number,name,sex,subject,score from student_info left join student_score on student_info.number = student_score.number;
+----------+-----------+------+-----------------------------+-------+
| number   | name      | sex  | subject                     | score |
+----------+-----------+------+-----------------------------+-------+
| 20180101 | 杜子腾    | 男   | 母猪的产后护理              |    78 |
| 20180101 | 杜子腾    | 男   | 论萨达姆的战争准备          |    88 |
| 20180102 | 杜琦燕    | 女   | 母猪的产后护理              |   100 |
| 20180102 | 杜琦燕    | 女   | 论萨达姆的战争准备          |    98 |
| 20180103 | 范统      | 男   | 母猪的产后护理              |    59 |
| 20180103 | 范统      | 男   | 论萨达姆的战争准备          |    61 |
| 20180104 | 史珍香    | 女   | 母猪的产后护理              |    55 |
| 20180104 | 史珍香    | 女   | 论萨达姆的战争准备          |    46 |
| 20180105 | 范剑      | 男   | NULL                        |  NULL |
| 20180106 | 朱逸群    | 男   | NULL                        |  NULL |
+----------+-----------+------+-----------------------------+-------+
10 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentInfo.objects.values('number', 'name','sex','studentscore__subject','studentscore__score')
{{&lt; /highlight &gt;}}</p>
<p>内连接以下的写法是等价的:</p>
<ul>
<li><code>select * from t1, t2</code></li>
<li><code>select * from t1 join t2</code></li>
<li><code>select * from t1 inner join t2</code></li>
<li><code>select * from t1 cross join t2</code></li>
</ul>
<p>综上，我们总结以下三种连接的结果差异:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from t1 inner join t2 on t1.m1=t2.m2;
+------+------+------+------+
| m1   | n1   | m2   | n2   |
+------+------+------+------+
|    2 | b    |    2 | a    |
|    3 | c    |    3 | b    |
+------+------+------+------+
2 rows in set (0.00 sec)</p>
<p>mysql&gt; select * from t1 left join t2 on t1.m1=t2.m2;
+------+------+------+------+
| m1   | n1   | m2   | n2   |
+------+------+------+------+
|    2 | b    |    2 | a    |
|    3 | c    |    3 | b    |
|    1 | a    | NULL | NULL |
+------+------+------+------+
3 rows in set (0.00 sec)</p>
<p>mysql&gt; select * from t1 right join t2 on t1.m1=t2.m2;
+------+------+------+------+
| m1   | n1   | m2   | n2   |
+------+------+------+------+
|    2 | b    |    2 | a    |
|    3 | c    |    3 | b    |
| NULL | NULL |    4 | c    |
+------+------+------+------+
3 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<h3 id="_32">多表连接<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<p>我们可以连接任意数量的表，我们再加入一张表试验:
{{&lt; highlight mysql&gt;}}
mysql&gt; create table t3(m3 int, n3 char(1));
Query OK, 0 rows affected (0.07 sec)</p>
<p>mysql&gt; insert into t3 values(3, 'a'),(3, 'b'),(4, 'c');
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0
{{&lt; /highlight &gt;}}</p>
<p>我们使用下面的语法查询是等价的:</p>
<ul>
<li><code>select * from t1 inner join t2 inner join t3 where t1.m1=t2.m2 and t2.m2=t3.m3;</code></li>
<li><code>select * from t1 inner join t2 on t1.m1=t2.m2 inner join t3 on t1.m1=t3.m3;</code></li>
</ul>
<p>查询结果:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from t1 inner join t2 on t1.m1=t2.m2 inner join t3 on t1.m1=t3.m3;
+------+------+------+------+------+------+
| m1   | n1   | m2   | n2   | m3   | n3   |
+------+------+------+------+------+------+
|    3 | c    |    3 | b    |    3 | a    |
|    3 | c    |    3 | b    |    3 | b    |
+------+------+------+------+------+------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
也可以用伪代码来描述:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>for each_row in t1{
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    for each_row in t2 which t1.m1=t2.m2{
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        for each_row in t3 which t2.m2=t3.m3{
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>            add_result(each_row)
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        }
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    }
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>}
</code></pre></div></p>
<h3 id="_33">自连接<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<p>我们无法直接自连接，但可以通过别名:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from t1, t1;
ERROR 1066 (42000): Not unique table/alias: 't1'
mysql&gt; select * from t1 as table1, t1 as table2;
+------+------+------+------+
| m1   | n1   | m1   | n1   |
+------+------+------+------+
|    1 | a    |    1 | a    |
|    2 | b    |    1 | a    |
|    3 | c    |    1 | a    |
|    1 | a    |    2 | b    |
|    2 | b    |    2 | b    |
|    3 | c    |    2 | b    |
|    1 | a    |    3 | c    |
|    2 | b    |    3 | c    |
|    3 | c    |    3 | c    |
+------+------+------+------+
9 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<p>而自连接的意义，比如要查询与'范统'的专业相同的同学:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_info as s1, student_info as s2 where s1.name='范统' and s1.major=s2.major;
+----------+--------+------+--------------------+-----------------+--------------+-----------------+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
| number   | name   | sex  | id_number          | department      | major        | enrollment_time | number   | name      | sex  | id_number          | department      | major        | enrollment_time |
+----------+--------+------+--------------------+-----------------+--------------+-----------------+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
| 20180103 | 范统   | 男   | 17156319980116959X | 计算机学院      | 软件工程     | 2018-09-01      | 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程     | 2018-09-01      |
| 20180103 | 范统   | 男   | 17156319980116959X | 计算机学院      | 软件工程     | 2018-09-01      | 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程     | 2018-09-01      |
+----------+--------+------+--------------------+-----------------+--------------+-----------------+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
2 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}</p>
<h3 id="_34">与子查询转换<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p>有的需求既可以用连接查询，也可以用子查询:
{{&lt; highlight mysql&gt;}}
mysql&gt; select * from student_score where number in (select number from student_info where major='软件工程');
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180103 | 母猪的产后护理              |    59 |
| 20180103 | 论萨达姆的战争准备          |    61 |
| 20180104 | 母猪的产后护理              |    55 |
| 20180104 | 论萨达姆的战争准备          |    46 |
+----------+-----------------------------+-------+
4 rows in set (0.00 sec)</p>
<p>mysql&gt; select s2.* from student_score as s2, student_info as s1 where s1.number=s2.number and s1.major='软件工程';
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180103 | 母猪的产后护理              |    59 |
| 20180103 | 论萨达姆的战争准备          |    61 |
| 20180104 | 母猪的产后护理              |    55 |
| 20180104 | 论萨达姆的战争准备          |    46 |
+----------+-----------------------------+-------+
4 rows in set (0.00 sec)
{{&lt; /highlight &gt;}}
{{&lt; highlight python&gt;}}
StudentScore.objects.filter(number__in=Subquery(StudentInfo.objects.filter(major='软件工程').values('number')))
StudentScore.objects.select_related('number').filter(number__major='软件工程')
{{&lt; /highlight &gt;}}</p>

              
            </article>
            
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

          </div>
        </div>
        
          <a href="#" class="md-top md-top--hidden md-icon" data-md-component="top">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="页脚" >
      
        
        <a href="../../python/tools/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 技巧工具" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              技巧工具
            </div>
          </div>
        </a>
      
      
        
        <a href="../theory/" class="md-footer__link md-footer__link--next" aria-label="下一页: 原理" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              原理
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/hjlarry" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="mailto:ultrahe@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 128c0-35.35 28.65-64 64-64h384c35.3 0 64 28.65 64 64v256c0 35.3-28.7 64-64 64H64c-35.35 0-64-28.7-64-64V128zm48 0v22.1l172.5 141.6c20.6 17 50.4 17 71 0L464 150.1v-23c0-7.9-7.2-16-16-16H64c-8.84 0-16 8.1-16 16v.9zm0 84.2V384c0 8.8 7.16 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.6 31.5-132.9 0L48 212.2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/hjlarry" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://t.me/hjlarry" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://paypal.me/hjlarry" target="_blank" rel="noopener" title="paypal.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M111.4 295.9c-3.5 19.2-17.4 108.7-21.5 134-.3 1.8-1 2.5-3 2.5H12.3c-7.6 0-13.1-6.6-12.1-13.9L58.8 46.6c1.5-9.6 10.1-16.9 20-16.9 152.3 0 165.1-3.7 204 11.4 60.1 23.3 65.6 79.5 44 140.3-21.5 62.6-72.5 89.5-140.1 90.3-43.4.7-69.5-7-75.3 24.2zM357.1 152c-1.8-1.3-2.5-1.8-3 1.3-2 11.4-5.1 22.5-8.8 33.6-39.9 113.8-150.5 103.9-204.5 103.9-6.1 0-10.1 3.3-10.9 9.4-22.6 140.4-27.1 169.7-27.1 169.7-1 7.1 3.5 12.9 10.6 12.9h63.5c8.6 0 15.7-6.3 17.4-14.9.7-5.4-1.1 6.1 14.4-91.3 4.6-22 14.3-19.7 29.3-19.7 71 0 126.4-28.8 142.9-112.3 6.5-34.8 4.6-71.4-23.8-92.6z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.tabs.link", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b028fd86.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.7f366e99.min.js"></script>
      
    
  </body>
</html>