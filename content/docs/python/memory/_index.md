---
title: "内存管理"
draft: false
---

# 内存管理

对象
-------
在Python中，变量只是一个名字，并不意味着内存地址。也就是说对于`a=12345`这样一个表达式来说，堆上有一块内存区域存储了变量的名称`a`，它是一个字符串；还有一块区域存储了`12345`这个实际的对象；还有一块区域我们称为名字空间，它是一个字典，存储了`a`和`12345`建立的映射关系。

对于这个实际的对象，它又分为两部分，头部存储元数据，包括它的引用计数，以及它是什么类型的；而数据部分对于固定长度的，则直接是它的数据，对于可变长度的，则首先有一部分描述该对象有多少个元素。

### 引用
当我们把一个变量赋值给另一个变量，传递的是实际对象的引用，python总是按引用传递的，包括函数的参数也是:
{{< highlight sh>}}
In [1]: a=12345
In [2]: def test(x):
   ...:     return x is a
In [3]: test(a)
Out[3]: True
{{< /highlight >}}
而像Go、C这样的语言，总是会按值传递，也就是说不管是把一个变量赋值给另一个变量，还是函数传参，都会把这个实际的对象`12345`复制一份。

对于`del a`这样的语句，只是把`a`和`12345`这个映射关系解除，并把`12345`的引用计数减一，当`12345`的引用计数为0时它会自动被垃圾回收器回收。使用`sys.getrefcount(a)`这个函数会得到a对应的实际对象的引用计数，但它总会比实际的计数多1，因为它本身也传入了a为参数。

内存分配
-------

垃圾回收
-------