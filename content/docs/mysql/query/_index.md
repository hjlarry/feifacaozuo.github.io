---
title: "Mysql查询"
draft: false
---

# Mysql常用查询整理

数据准备
-------

1、创建表格:

```
CREATE TABLE student_info (
    number INT PRIMARY KEY,
    name VARCHAR(5),
    sex ENUM('男', '女'),
    id_number CHAR(18),
    department VARCHAR(30),
    major VARCHAR(30),
    enrollment_time DATE,
    UNIQUE KEY (id_number)
);

CREATE TABLE student_score (
    number INT,
    subject VARCHAR(30),
    score TINYINT,
    PRIMARY KEY (number, subject),
    CONSTRAINT FOREIGN KEY(number) REFERENCES student_info(number)
);
```

2、填充数据:
```
INSERT INTO student_info(number, name, sex, id_number, department, major, enrollment_time) VALUES
(20180101, '杜子腾', '男', '158177199901044792', '计算机学院', '计算机科学与工程', '2018-09-01'),
(20180102, '杜琦燕', '女', '151008199801178529', '计算机学院', '计算机科学与工程', '2018-09-01'),
(20180103, '范统', '男', '17156319980116959X', '计算机学院', '软件工程', '2018-09-01'),
(20180104, '史珍香', '女', '141992199701078600', '计算机学院', '软件工程', '2018-09-01'),
(20180105, '范剑', '男', '181048199308156368', '航天学院', '飞行器设计', '2018-09-01'),
(20180106, '朱逸群', '男', '197995199501078445', '航天学院', '电子信息', '2018-09-01');

INSERT INTO student_score (number, subject, score) VALUES
(20180101, '母猪的产后护理', 78),
(20180101, '论萨达姆的战争准备', 88),
(20180102, '母猪的产后护理', 100),
(20180102, '论萨达姆的战争准备', 98),
(20180103, '母猪的产后护理', 59),
(20180103, '论萨达姆的战争准备', 61),
(20180104, '母猪的产后护理', 55),
(20180104, '论萨达姆的战争准备', 46);
```

3、填充结果:

**student_info表**

|number|&nbsp;name&nbsp;|sex|id_number|department|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;major&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|enrollment_time|
|----|----|----|----|----|----|----|
|20180101|杜子腾|男|158177199901044792|计算机学院|计算机科学与工程|2018-09-01|
|20180102|杜琦燕|女|151008199801178529|计算机学院|计算机科学与工程|2018-09-01|
|20180103|范统|男|17156319980116959X|计算机学院|软件工程|2018-09-01|
|20180104|史珍香|女|141992199701078600|计算机学院|软件工程|2018-09-01|
|20180105|范剑|男|181048199308156368|航天学院|飞行器设计|2018-09-01|
|20180106|朱逸群|男|197995199501078445|航天学院|电子信息|2018-09-01|

**student_score表**    

|number|subject|score|
|----|----|----|
|20180101|母猪的产后护理|78|
|20180101|论萨达姆的战争准备|88|
|20180102|母猪的产后护理|100|
|20180102|论萨达姆的战争准备|98|
|20180103|母猪的产后护理|59|
|20180103|论萨达姆的战争准备|61|
|20180104|母猪的产后护理|55|
|20180104|论萨达姆的战争准备|46|

基础查询
-------

### 别名

* 方式一:`select number as 学号 from student_score`
* 方式二:`select number 学号 from student_score`    

查询结果:
```
mysql> select number 学号 from student_score;
+----------+
| 学号     |
+----------+
| 20180101 |
| 20180101 |
| 20180102 |
| 20180102 |
| 20180103 |
| 20180103 |
| 20180104 |
| 20180104 |
+----------+
8 rows in set (0.00 sec)
```

多列也可以:
```
mysql> select number 学号, name 姓名 from student_info;
+----------+-----------+
| 学号     | 姓名      |
+----------+-----------+
| 20180101 | 杜子腾    |
| 20180102 | 杜琦燕    |
| 20180103 | 范统      |
| 20180104 | 史珍香    |
| 20180105 | 范剑      |
| 20180106 | 朱逸群    |
+----------+-----------+
6 rows in set (0.00 sec)
```

### 去重

单列去重:
```
mysql> select distinct department from student_info;
+-----------------+
| department      |
+-----------------+
| 计算机学院      |
| 航天学院        |
+-----------------+
2 rows in set (0.00 sec)
```

多列去重:
```
mysql> select distinct department,major from student_info;
+-----------------+--------------------------+
| department      | major                    |
+-----------------+--------------------------+
| 计算机学院      | 计算机科学与工程         |
| 计算机学院      | 软件工程                 |
| 航天学院        | 飞行器设计               |
| 航天学院        | 电子信息                 |
+-----------------+--------------------------+
4 rows in set (0.00 sec)
```

### 限制查询结果条数

使用`limit 从哪开始，多少条`，`从哪开始`可以省略，省略代表第0行。

```
mysql> select * from student_info limit 3,8;
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| number   | name      | sex  | id_number          | department      | major           | enrollment_time |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计      | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息        | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
3 rows in set (0.00 sec)
```

### 排序

多列排序:
```
mysql> select * from student_info order by name asc, number desc;
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程                 | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息                 | 2018-09-01      |
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计               | 2018-09-01      |
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
6 rows in set (0.00 sec)

mysql> select * from student_info order by name desc, number desc;
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程                 | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计               | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息                 | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
6 rows in set (0.00 sec)
```

带条件查询
-------

### 简单搜索条件

不等于可以使用`<>`或`!=` :
```
mysql> select * from student_info where department <> '计算机学院';
+----------+-----------+------+--------------------+--------------+-----------------+-----------------+
| number   | name      | sex  | id_number          | department   | major           | enrollment_time |
+----------+-----------+------+--------------------+--------------+-----------------+-----------------+
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院     | 飞行器设计      | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院     | 电子信息        | 2018-09-01      |
+----------+-----------+------+--------------------+--------------+-----------------+-----------------+
2 rows in set (0.00 sec)
```

区间内使用`between...and...`，不在某区间使用`not between...and...`:
```
mysql> select * from student_info where number between 20180103 and 20180105;
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| number   | name      | sex  | id_number          | department      | major           | enrollment_time |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180105 | 范剑      | 男   | 181048199308156368 | 航天学院        | 飞行器设计      | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+-----------------+-----------------+
3 rows in set (0.01 sec)

mysql> select * from student_info where number not between 20180103 and 20180105;
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
3 rows in set (0.00 sec)
```

### 匹配列表中的元素

使用`in (...)`和`not in`筛选出在某个列表中的记录:
```
mysql> select * from student_info where major in ('软件工程',  '电子信息');
+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
| number   | name      | sex  | id_number          | department      | major        | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程     | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程     | 2018-09-01      |
| 20180106 | 朱逸群    | 男   | 197995199501078445 | 航天学院        | 电子信息     | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------+-----------------+
3 rows in set (0.00 sec)
```

使用`is null` 和 `is not null`可筛选出某列是NULL的记录，而不能使用普通的操作符例如等号来进行比较，NULL代表没有值。

### 多个搜索条件

AND优先级高于OR:
```
mysql> SELECT * FROM student_score WHERE score > 95 OR score < 55 AND subject = '论萨达姆的战争准备';
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180102 | 母猪的产后护理              |   100 |
| 20180102 | 论萨达姆的战争准备          |    98 |
| 20180104 | 论萨达姆的战争准备          |    46 |
+----------+-----------------------------+-------+
3 rows in set (0.00 sec)
```

### 模糊查询

使用`like`和`not like`进行模糊匹配查询，`%`代表任意一个字符串，而`_`代表任意一个字符:
```
mysql> select * from student_info where name like '杜_';
Empty set (0.00 sec)

mysql> select * from student_info where name like '范_';
+----------+--------+------+--------------------+-----------------+-----------------+-----------------+
| number   | name   | sex  | id_number          | department      | major           | enrollment_time |
+----------+--------+------+--------------------+-----------------+-----------------+-----------------+
| 20180103 | 范统   | 男   | 17156319980116959X | 计算机学院      | 软件工程        | 2018-09-01      |
| 20180105 | 范剑   | 男   | 181048199308156368 | 航天学院        | 飞行器设计      | 2018-09-01      |
+----------+--------+------+--------------------+-----------------+-----------------+-----------------+
2 rows in set (0.00 sec)

mysql> select * from student_info where name like '%杜%';
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
2 rows in set (0.00 sec)
```

函数和表达式
-------

### 表达式

可以将表达式放在查询列表中:
```
mysql> select number,subject,score+100 from student_score;
+----------+-----------------------------+-----------+
| number   | subject                     | score+100 |
+----------+-----------------------------+-----------+
| 20180101 | 母猪的产后护理              |       178 |
| 20180101 | 论萨达姆的战争准备          |       188 |
| 20180102 | 母猪的产后护理              |       200 |
| 20180102 | 论萨达姆的战争准备          |       198 |
| 20180103 | 母猪的产后护理              |       159 |
| 20180103 | 论萨达姆的战争准备          |       161 |
| 20180104 | 母猪的产后护理              |       155 |
| 20180104 | 论萨达姆的战争准备          |       146 |
+----------+-----------------------------+-----------+
8 rows in set (0.00 sec)
```

也可以把表达式作为搜索的条件:
```
mysql> select * from student_score where score%3=0;
+----------+-----------------------+-------+
| number   | subject               | score |
+----------+-----------------------+-------+
| 20180101 | 母猪的产后护理        |    78 |
+----------+-----------------------+-------+
1 row in set (0.00 sec)
```

### 文本处理

连接字符串:
```
mysql> select concat('学号为',number,'的学生在[',subject,']的成绩为',score) from student_score;
+--------------------------------------------------------------------------+
| concat('学号为',number,'的学生在[',subject,']的成绩为',score)            |
+--------------------------------------------------------------------------+
| 学号为20180101的学生在[母猪的产后护理]的成绩为78                         |
| 学号为20180101的学生在[论萨达姆的战争准备]的成绩为88                     |
| 学号为20180102的学生在[母猪的产后护理]的成绩为100                        |
| 学号为20180102的学生在[论萨达姆的战争准备]的成绩为98                     |
| 学号为20180103的学生在[母猪的产后护理]的成绩为59                         |
| 学号为20180103的学生在[论萨达姆的战争准备]的成绩为61                     |
| 学号为20180104的学生在[母猪的产后护理]的成绩为55                         |
| 学号为20180104的学生在[论萨达姆的战争准备]的成绩为46                     |
+--------------------------------------------------------------------------+
8 rows in set (0.00 sec)
```

子串:
```
mysql> select substring(number, 4, 5) as 学号尾号 from student_info;
+--------------+
| 学号尾号     |
+--------------+
| 80104        |
| 80102        |
| 80101        |
| 80103        |
| 80105        |
| 80106        |
+--------------+
6 rows in set (0.00 sec)
```

### 时间处理函数

时间间隔:
```
mysql> select date_add('2015-01-01 10:20:33', interval 2 minute);
+----------------------------------------------------+
| date_add('2015-01-01 10:20:33', interval 2 minute) |
+----------------------------------------------------+
| 2015-01-01 10:22:33                                |
+----------------------------------------------------+
1 row in set (0.00 sec)
```

时间格式化:
```
mysql> select date_format(now(), '%b/%d/%Y %h:%i:%s~%p');
+--------------------------------------------+
| date_format(now(), '%b/%d/%Y %h:%i:%s~%p') |
+--------------------------------------------+
| Dec/02/2019 04:57:31~PM                    |
+--------------------------------------------+
1 row in set (0.00 sec)
```

### 聚集函数

COUNT用来统计行数
* `COUNT(*)`统计表中所有的行，包括NULL
* `COUNT(列名)`统计表中某列的所有行，不包括NULL

```
mysql> select count(*) from student_info;
+----------+
| count(*) |
+----------+
|        6 |
+----------+
1 row in set (0.00 sec)

mysql> select count(distinct subject) from student_score;
+-------------------------+
| count(distinct subject) |
+-------------------------+
|                       2 |
+-------------------------+
1 row in set (0.00 sec)
```

SUM和AVG:
```
mysql> select sum(score) from student_score;
+------------+
| sum(score) |
+------------+
|        585 |
+------------+
1 row in set (0.00 sec)

mysql> select avg(score) from student_score where subject="论萨达姆的战争准备";
+------------+
| avg(score) |
+------------+
|    73.2500 |
+------------+
1 row in set (0.00 sec)
```

组合使用:
```
mysql> select count(*) as 成绩记录总数, max(score) as 最高分, min(score) as 最低分,avg(score) as 平均分 from student_score;
+--------------------+-----------+-----------+-----------+
| 成绩记录总数       | 最高分    | 最低分    | 平均分    |
+--------------------+-----------+-----------+-----------+
|                  8 |       100 |        46 |   73.1250 |
+--------------------+-----------+-----------+-----------+
1 row in set (0.00 sec)
```

### 隐式类型转换

Mysql会尽量把值转换为表达式中需要的类型，而不是产生错误:
```
mysql> select 1 + '2';
+---------+
| 1 + '2' |
+---------+
|       3 |
+---------+
1 row in set (0.00 sec)

mysql> select '23sds'+17;
+------------+
| '23sds'+17 |
+------------+
|         40 |
+------------+
1 row in set, 1 warning (0.00 sec)
```

但这种转换不能用于存储数据:
```
mysql> insert into student_score(score,number,subject) values (100,20180101,300);
Query OK, 1 row affected (0.00 sec)

mysql> insert into student_score(score,number,subject) values ('100',20180101,400);
Query OK, 1 row affected (0.00 sec)

mysql> insert into student_score(score,number,subject) values ('asd',20180101,400);
ERROR 1366 (HY000): Incorrect integer value: 'asd' for column 'score' at row 1
```

分组查询
-------

### 基础查询

分组就是针对某个列，将该列的值相同的记录分到一个组中:
```
mysql> select subject, sum(score) from student_score group by subject;
+-----------------------------+------------+
| subject                     | sum(score) |
+-----------------------------+------------+
| 母猪的产后护理              |        292 |
| 论萨达姆的战争准备          |        293 |
+-----------------------------+------------+
2 rows in set (0.00 sec)
```

把非分组列放入查询列表中会引起争议，导致结果不确定:
```
mysql> select subject, sum(score),number from student_score group by subject;
ERROR 1055 (42000): Expression #3 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'student.student_score.number' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
```

### 分组和过滤条件

是先过滤出符合条件的数据，在进行分组运算的:
```
mysql> select subject, sum(score) from student_score where score>70 group by subject;
+-----------------------------+------------+
| subject                     | sum(score) |
+-----------------------------+------------+
| 母猪的产后护理              |        178 |
| 论萨达姆的战争准备          |        186 |
+-----------------------------+------------+
2 rows in set (0.00 sec)
```

也可以分组后，在筛选出合适的分组:
```
mysql> select subject, sum(score) from student_score group by subject having max(score)>98;
+-----------------------+------------+
| subject               | sum(score) |
+-----------------------+------------+
| 母猪的产后护理        |        292 |
+-----------------------+------------+
1 row in set (0.00 sec)
```

### 分组和排序

```
mysql> select subject, sum(score) as sum_s from student_score group by subject order by sum_s desc;
+-----------------------------+-------+
| subject                     | sum_s |
+-----------------------------+-------+
| 论萨达姆的战争准备          |   293 |
| 母猪的产后护理              |   292 |
+-----------------------------+-------+
2 rows in set (0.00 sec)
```

### 嵌套分组

如下例，可先按department分成大组，再按major分为小组:
```
mysql> select department, major, count(*) from student_info group by department, major;
+-----------------+--------------------------+----------+
| department      | major                    | count(*) |
+-----------------+--------------------------+----------+
| 航天学院        | 电子信息                 |        1 |
| 航天学院        | 飞行器设计               |        1 |
| 计算机学院      | 计算机科学与工程         |        2 |
| 计算机学院      | 软件工程                 |        2 |
+-----------------+--------------------------+----------+
4 rows in set (0.00 sec)
```

### 注意事项

1. 如果分组列中有NULL值，那么NULL会作为一个独立的分组
2. 如果是嵌套分组，聚集函数将作用在最后的分组列上
3. 非分组列不能单独出现在检索列表中（可以被放到聚集函数中）
4. GROUP BY子句后可以跟随表达式（但不能是聚集函数）

简单查询语句中各子句的顺序为:
```
SELECT [DISTINCT] 查询列表
[FROM 表名]
[WHERE 布尔表达式]
[GROUP BY 分组列表 ]
[HAVING 分组过滤条件]
[ORDER BY 排序列表]
[LIMIT 开始行, 限制条数]
```

子查询
-------

### 标量子查询

标量子查询单纯的代表一个值，可以作为表达式参与运算或作为搜索条件:
```
mysql> select * from student_score where number=(select number from student_info where name='范统');
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180103 | 母猪的产后护理              |    59 |
| 20180103 | 论萨达姆的战争准备          |    61 |
+----------+-----------------------------+-------+
2 rows in set (0.00 sec)
```

### 列子查询

内层查询结果不是一个单独的值，而是一个列:
```
mysql> select * from student_score where number=(select number from student_info where sex='男');
ERROR 1242 (21000): Subquery returns more than 1 row

mysql> select * from student_score where number in (select number from student_info where sex='男');
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180101 | 母猪的产后护理              |    78 |
| 20180101 | 论萨达姆的战争准备          |    88 |
| 20180103 | 母猪的产后护理              |    59 |
| 20180103 | 论萨达姆的战争准备          |    61 |
+----------+-----------------------------+-------+
4 rows in set (0.00 sec)
```

而行子查询、表子查询不常用，省略。

### EXISTS和相关子查询

EXISTS和NOT EXISTS单独看很像一个函数，返回查询结果是否为空集:
```
mysql> select exists (select * from student_info where number=20180101);
+-----------------------------------------------------------+
| exists (select * from student_info where number=20180101) |
+-----------------------------------------------------------+
|                                                         1 |
+-----------------------------------------------------------+
1 row in set (0.00 sec)

mysql> select not exists (select * from student_info where number=20180101);
+---------------------------------------------------------------+
| not exists (select * from student_info where number=20180101) |
+---------------------------------------------------------------+
|                                                             0 |
+---------------------------------------------------------------+
1 row in set (0.00 sec)
```

之前我们尝试的都是不相关子查询，而相关子查询就是内层查询语句要用到外层查询语句的值，比如我们查学生的基本信息并要求这些学生有成绩的记录:
```
mysql> select * from student_info where exists(select * from student_score where student_score.number=student_info.number);
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| number   | name      | sex  | id_number          | department      | major                    | enrollment_time |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
| 20180101 | 杜子腾    | 男   | 158177199901044792 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180102 | 杜琦燕    | 女   | 151008199801178529 | 计算机学院      | 计算机科学与工程         | 2018-09-01      |
| 20180103 | 范统      | 男   | 17156319980116959X | 计算机学院      | 软件工程                 | 2018-09-01      |
| 20180104 | 史珍香    | 女   | 141992199701078600 | 计算机学院      | 软件工程                 | 2018-09-01      |
+----------+-----------+------+--------------------+-----------------+--------------------------+-----------------+
4 rows in set (0.00 sec)
```

这个相关子查询的查询过程是:先执行外层查询获得到student_info表的第一条记录，发现它的number值是20180101。把20180101当作参数传入到子查询，此时子查询的意思是判断student_score表的number字段是否有20180101这个值存在，子查询的结果是该值存在，所以整个EXISTS表达式的值为TRUE，那么student_info表的第一条记录可以被加入到结果集。每条记录依次按这个过程执行。

此外，子查询还可以应用于同一个表，比如我们去查student_score表中分数大于平均分的记录，第一印象可能是如下写法:
```
mysql> select * from student_score where score > avg(score);
ERROR 1111 (HY000): Invalid use of group function
```

实际应该使用子查询来实现:
```
mysql> select * from student_score where score > (select avg(score) from student_score);
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180101 | 母猪的产后护理              |    78 |
| 20180101 | 论萨达姆的战争准备          |    88 |
| 20180102 | 母猪的产后护理              |   100 |
| 20180102 | 论萨达姆的战争准备          |    98 |
+----------+-----------------------------+-------+
4 rows in set (0.00 sec)
```
因为聚集函数不能用于WHERE子句，可以把上述写法看做是给student_score做了一个副本。